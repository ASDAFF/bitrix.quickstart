(function(d){BX.namespace("BX.Forum");var e=function(g){this.id="FTRList"+g.form.id;this.mess={};this.form=g.form;if(!!g.id){for(var f=0;f<g.id.length;f++){this.bind(g.id[f])}}this.params={preorder:(g.preorder=="Y"),pageNumber:g.pageNumber,pageCount:g.pageCount};BX.addCustomEvent(this.form,"onAdd",BX.delegate(this.add,this));BX.addCustomEvent(this.form,"onRequest",BX.delegate(function(){if(typeof this.params.pageNumber!="undefined"){var i=this.form.elements.pageNumber;if(!i){i=BX.create("input",{props:{type:"hidden",name:"pageNumber"}});this.form.appendChild(i)}i.value=this.params.pageNumber}if(typeof this.params.pageCount!="undefined"){var h=BX.findChild(this.form,{attr:{name:"pageCount"}});if(!h){h=BX.create("input",{props:{type:"hidden",name:"pageCount"}});this.form.appendChild(h)}h.value=this.params.pageCount}},this));BX.addCustomEvent(this.form,"onResponse",BX.delegate(function(){var h=BX.findChild(this.form,{attr:{name:"pageNumber"}},true);if(h){BX.remove(h)}},this))};e.prototype={add:function(h,r){var g=BX(this.form.id+"container"),m,n={className:/reviews-reply-form|reviews-collapse/},f=d.fTextToNode(r.message);if(!g){g=BX.create("div",{attrs:{id:this.form.id+"container"},props:{className:"reviews-block-container reviews-reviews-block-container"}});d.fReplaceOrInsertNode(g,null,BX.findChild(document,n,true).parentNode,n);g=BX(this.form.id+"container")}m=(g?BX.findChild(g,{className:"reviews-block-inner"},true):null);if(f&&m){if(!!r.allMessages){d.fReplaceOrInsertNode(f,m,BX.findChild(document,n,true).parentNode,n);if(!!r.navigation&&!!r.pageNumber){var j=d.fTextToNode(r.navigation),k,l=(j?BX.findChildren(g.parentNode,{className:"reviews-navigation-box"},true):null);if(j){if(!l){g.parentNode.insertBefore(BX.create("div",{props:{className:"reviews-navigation-box reviews-navigation-top"}}),g);var q=g;do{q=q.nextSibling}while(q&&q.nodeType!=1);var p=BX.create("div",{props:{className:"reviews-navigation-box reviews-navigation-bottom"}});if(q){g.parentNode.insertBefore(p,q)}else{g.parentNode.appendChild(p)}l=BX.findChildren(g.parentNode,{className:"reviews-navigation-box"},true)}for(k=0;k<l.length;k++){l[k].innerHTML=j.innerHTML}}this.params.pageNumber=r.pageNumber;this.params.pageCount=r.pageCount}if(r.messagesID&&typeof r.messagesID=="object"){for(var o=0;o<r.messagesID.length;o++){if(r.messagesID[o]!=h){this.bind(r.messagesID[o])}}}}else{if(typeof r.message!="undefined"){if(this.params.preorder){m.appendChild(f)}else{m.insertBefore(f,m.firstChild)}}}d.fRunScripts(r.message);this.bind(h)}},bind:function(l){var k=BX("message"+l);if(!!k){this.mess["m"+l]={node:k,author:{id:k.getAttribute("bx-author-id"),name:k.getAttribute("bx-author-name")}};var j=BX.findChildren(k,{tagName:"A",className:"reviews-button-small"},true),i=BX.delegate(function(){var m=BX.proxy_context;this.act(m.getAttribute("bx-act"),l)},this),g=BX.delegate(function(){this.act("reply",l)},this),f=BX.delegate(function(){this.act("quote",l)},this);if(!!j&&j.length>0){for(var h=0;h<j.length;h++){if(j[h].getAttribute("bx-act")=="moderate"||j[h].getAttribute("bx-act")=="del"){BX.adjust(j[h],{events:{click:i},attrs:{"bx-href":j[h].getAttribute("href"),href:"javascript:void(0);"}})}else{if(!!this.form){if(j[h].getAttribute("bx-act")=="reply"){BX.bind(j[h],"click",g)}else{if(j[h].getAttribute("bx-act")=="quote"){BX.bind(j[h],"mousedown",f)}}}}}}}},act:function(k,h){if(!h||!this.mess["m"+h]){BX.DoNothing()}else{if(k=="quote"){var o=d.GetSelection();if(document.getSelection){o=o.replace(/\r\n\r\n/gi,"_newstringhere_").replace(/\r\n/gi," ");o=o.replace(/	/gi,"").replace(/_newstringhere_/gi,"\r\n\r\n")}if(o===""&&h>0&&BX("message_text_"+h,true)){var q=BX("message_text_"+h,true);if(typeof(q)=="object"&&q){o=q.innerHTML}}o=o.replace(/[\n|\r]*<br(\s)*(\/)*>/gi,"\n");var g=function(w,v){var r=" ";var t=/showWMVPlayer.*?bx_wmv_player.*?file:[\s'"]*([^"']*).*?width:[\s'"]*([^"']*).*?height:[\s'"]*([^'"]*).*?/gi;var u=t.exec(v);if(u){r="[VIDEO WIDTH="+u[2]+" HEIGHT="+u[3]+"]"+u[1]+"[/VIDEO]"}if(r==" "){var s=/bxPlayerOnload[\s\S]*?[\s'"]*file[\s'"]*:[\s'"]*([^"']*)[\s\S]*?[\s'"]*height[\s'"]*:[\s'"]*([^"']*)[\s\S]*?[\s'"]*width[\s'"]*:[\s'"]*([^"']*)/gi;u=s.exec(v);if(u){r="[VIDEO WIDTH="+u[3]+" HEIGHT="+u[2]+"]"+u[1]+"[/VIDEO]"}}return r};o=o.replace(/<script[^>]*>/gi,"\001").replace(/<\/script[^>]*>/gi,"\002");o=o.replace(/\001([^\002]*)\002/gi,g);o=o.replace(/<noscript[^>]*>/gi,"\003").replace(/<\/noscript[^>]*>/gi,"\004");o=o.replace(/\003([^\004]*)\004/gi," ");o=o.replace(/<table class\=[\"]*forum-quote[\"]*>[^<]*<thead>[^<]*<tr>[^<]*<th>([^<]+)<\/th><\/tr><\/thead>[^<]*<tbody>[^<]*<tr>[^<]*<td>/gi,"\001");o=o.replace(/<table class\=[\"]*forum-code[\"]*>[^<]*<thead>[^<]*<tr>[^<]*<th>([^<]+)<\/th><\/tr><\/thead>[^<]*<tbody>[^<]*<tr>[^<]*<td>/gi,"\002");o=o.replace(/<table class\=[\"]*data-table[\"]*>[^<]*<tbody>/gi,"\004");o=o.replace(/<\/td>[^<]*<\/tr>(<\/tbody>)*<\/table>/gi,"\003");o=o.replace(/[\r|\n]{2,}([\001|\002])/gi,"\n$1");var p=0;while(p++<50&&(o.search(/\002([^\002\003]*)\003/gi)>=0||o.search(/\001([^\001\003]*)\003/gi)>=0)){o=o.replace(/\002([^\002\003]*)\003/gi,"[CODE]$1[/CODE]").replace(/\001([^\001\003]*)\003/gi,"[QUOTE]$1[/QUOTE]")}var i=function(w,r,v){var x=new RegExp("\004([^\004\003]*)("+r+")([^\004\003]*)\003","i");var u=new RegExp("((?:\004)(?:[^\004\003]*))("+r+")((?:[^\004\003]*)(?:\003))","i");var t=0;while((t++<300)&&(w.search(x)>=0)){w=w.replace(u,"$1"+v+"$3")}return w};p=0;while(p++<10&&(o.search(/\004([^\004\003]*)\003/gi)>=0)){o=i(o,"<tr>","[TR]");o=i(o,"</tr>","[/TR]");o=i(o,"<td>","[TD]");o=i(o,"</td>","[/TD]");o=o.replace(/\004([^\004\003]*)\003/gi,"[TABLE]$1[/TD][/TR][/TABLE]")}if(BX.browser.IsIE()){o=o.replace(/<img(?:(?:\s+alt\s*=\s*\"?smile([^\"\s]+)\"?)|(?:\s+\w+\s*=\s*[^\s>]*))*>/gi,"$1")}else{o=o.replace(/<img.*?alt=[\"]*smile([^\"\s]+)[\"]*[^>]*>/gi,"$1")}o=o.replace(/<a[^>]+href=[\"]([^\"]+)\"[^>]+>([^<]+)<\/a>/gi,"[URL=$1]$2[/URL]");o=o.replace(/<a[^>]+href=[\']([^\']+)\'[^>]+>([^<]+)<\/a>/gi,"[URL=$1]$2[/URL]");o=o.replace(/<[^>]+>/gi," ").replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&quot;/gi,'"');o=o.replace(/(smile(?=[:;8]))/g,"");o=o.replace(/\&shy;/gi,"");o=o.replace(/\&nbsp;/gi," ");BX.onCustomEvent(this.form,"onQuote",[{author:this.mess["m"+h]["author"],id:h,text:o}])}else{if(k=="reply"){BX.onCustomEvent(this.form,"onReply",[{author:this.mess["m"+h]["author"],id:h}])}else{if(k=="del"&&(!confirm(BX.message("f_cdm")))){BX.DoNothing()}else{if(k=="moderate"||k=="del"){var m=BX.proxy_context,f=m.getAttribute("bx-href").replace(/.AJAX_CALL=Y/g,"").replace(/.sessid=[^&]*/g,""),j=BX.findParent(m,{tag:"table"}),l=BX.create("a",{attrs:{className:"reply-action-note"}}),n=function(){BX.remove(l);BX.show(m.parentNode)};BX.hide(m.parentNode);l.innerHTML=BX.message("f_wait");m.parentNode.parentNode.appendChild(l);BX.ajax.loadJSON(f,{AJAX_CALL:"Y",sessid:BX.bitrix_sessid()},BX.delegate(function(s){if(s.status&&!!j){BX.onCustomEvent(d,"onForumCommentAJAXAction",[k]);if(k=="del"){var v=d.curpage||top.window.location.href;BX.fx.hide(j,"scroll",{time:0.15,callback_complete:BX.delegate(function(){BX.remove(j);n();var w=BX.findChild(BX(this.form.id+"container"),{"class":"reviews-post-table"},true,true);if((!w)||(w.length<1)){if(this.params.pageNumber>1){BX.reload(v)}}},this)})}else{var u=BX.hasClass(j,"reviews-post-hidden");var r=(u?BX.message("f_hide"):BX.message("f_show"));var t=BX.findChild(j,{className:"reviews-text"},true);BX.fx.hide(t,"fade",{time:0.1,callback_complete:function(){BX.toggleClass(j,"reviews-post-hidden");m.innerHTML=r;f=f.replace(new RegExp("REVIEW_ACTION="+(u?"SHOW":"HIDE")),("REVIEW_ACTION="+(u?"HIDE":"SHOW")));m.setAttribute("bx-href",f);BX.fx.show(t,"fade",{time:0.1});n();BX.style(t,"background-color",(u?"#FFFFFF":"#E5F8E3"))}})}}else{BX.addClass(l,"error");l.innerHTML='<span class="errortext">'+s.message+"</span>"}},this))}}}}}return false}};var c=(function(){var f=function(i,h){this.id="FTRForm"+i.form.id;this.form=i.form;this.editor=h;this.windowEvents={};this.params={messageMax:64000};this.onsuccess=BX.delegate(this.onsuccess,this);this.onfailure=BX.delegate(this.onfailure,this);this.submit=BX.delegate(this.submit,this);BX.bind(this.form,"submit",this.submit);this.isAjax=(i.ajaxPost=="Y");if(i.captcha=="Y"){var g=new Captcha(this.form);BX.ready(function(){BX.bind(BX("forum-refresh-captcha"),"click",BX.proxy(g.Update,g))});if(i.bVarsFromForm=="Y"){g.Show()}}BX.addCustomEvent(this.form,"onQuote",BX.delegate(function(j){this.show();this.quote(j)},this));BX.addCustomEvent(this.form,"onReply",BX.delegate(function(j){this.show();this.paste(j)},this));BX.addCustomEvent(this.form,"onTransverse",BX.delegate(this.transverse,this))};f.prototype={submit:function(g){if(this.validate()){this.prepareForm();this.disableButtons(true);if(!this.isAjax){return true}this.send()}return BX.PreventDefault(g)},prepareForm:function(){},disableButtons:function(j){var g=this.form.getElementsByTagName("input");for(var h=0;h<g.length;h++){if(g[h].getAttribute("type")=="submit"){g[h].disabled=(j!==false)}}},validate:function(){var k="",j=":SEPARATOR:",h=this.form.REVIEW_RATE.value+j+this.form.REVIEW_TEXT_plus.value+j+this.form.REVIEW_TEXT_minus.value+j+this.form.REVIEW_TEXT_comment.value,g=this.form.REVIEW_TEXT_plus.value.length+this.form.REVIEW_TEXT_comment.value.length+this.form.REVIEW_TEXT_comment.value.length,i=64000;if(this.form.TITLE&&(this.form.TITLE.value.length<=0)){k+=BX.message("no_topic_name")}if(g<=0){k+=BX.message("no_message")}else{if(g>i){k+=BX.message("max_len").replace(/#MAX_LENGTH#/gi,i).replace(/#LENGTH#/gi,g)}}if(k!==""){alert(k);return false}this.form.REVIEW_TEXT.value=h;return true},busy:false,send:function(){if(this.busy===true){return false}this.busy=true;if(!this.form.elements.dataType){this.form.appendChild(BX.create("input",{props:{type:"hidden",name:"dataType",value:"json"}}))}BX.onCustomEvent(this.form,"onRequest",[this.form,this]);BX.ajax.submitAjax(this.form,{method:"POST",url:this.form.action,dataType:"json",onsuccess:this.onsuccess,onfailure:this.onfailure});return true},onsuccess:function(g){this.busy=false;this.disableButtons(false);BX.onCustomEvent(this.form,"onResponse",[this.form,this]);this.get(g)},onfailure:function(){BX.onCustomEvent(this.form,"onResponse",[this.form,this]);BX.reload()},get:function(g){d.curpage=d.curpage||top.window.location.href;BX.onCustomEvent(d,"onForumCommentAJAXPost",[g,this.form]);if(typeof g=="undefined"||g.reload){BX.reload(d.curpage);return}if(g.status){if(!!g.allMessages||typeof g.message!="undefined"){BX.onCustomEvent(this.form,"onAdd",[g.messageID,g]);this.clear()}else{if(!!g.previewMessage){var k=BX.findChild(document,{className:"reviews-preview"},true),i=BX.findChild(document,{className:/reviews-reply-form|reviews-collapse/},true).parentNode,h=d.fTextToNode(g.previewMessage);d.fReplaceOrInsertNode(h,k,i,{className:/reviews-reply-form|reviews-collapse/});d.PostFormAjaxStatus("");d.fRunScripts(g.previewMessage)}}var j=(!!g.messageID?BX("message"+g.messageID):null);if(j){BX.scrollToNode(j)}if($.fancybox.isOpen){setTimeout(function(){$.fancybox.close(true);BX.closeWait()},appSLine.fancyTimeout)}}if(g.statusMessage){d.PostFormAjaxStatus(g.statusMessage)}},clear:function(){var h=BX.findChild(document,{className:"reviews-preview"},true);if(h){BX.remove(h)}var p=0,o,n,q;while((o=BX("upload_files_"+(p++)+"_"+this.form.index.value))&&o){if((n=BX.findChild(o,{tagName:"input"},true))&&BX(n)){q=BX.clone(n);q.value="";n.parentNode.insertBefore(q,n);n.parentNode.removeChild(n)}BX.hide(o)}var m=BX.findChild(this.form,{className:"forum-upload-file-attach"},true);if(m){BX.show(m)}var l=BX.findChild(this.form,{className:"reviews-upload-info"},true);if(l){BX.hide(l)}var r=null,j=BX.findChild(this.form,{attr:{name:"captcha_code"}},true),k=BX.findChild(this.form,{attr:{name:"captcha_word"}},true),g=BX.findChild(this.form,{className:"reviews-reply-field-captcha-image"},true);if(g){r=BX.findChild(g,{tag:"img"})}if(j&&k&&r){k.value="";BX.ajax.getCaptcha(function(i){j.value=i.captcha_sid;r.src="/bitrix/tools/captcha.php?captcha_code="+i.captcha_sid})}},show:function(){BX.onCustomEvent(this.form,"onBeforeShow",[this]);BX.show(this.form.parentNode);BX.scrollToNode(BX.findChild(this.form,{attribute:{name:"send_button"}},true));BX.onCustomEvent(this.form,"onAfterShow",[this]);return false},hide:function(){BX.onCustomEvent(this.form,"onBeforeHide",[this]);BX.hide(this.form.parentNode);BX.onCustomEvent(this.form,"onAfterHide",[this]);return false},transverse:function(g){if(BX.hasClass(document.documentElement,"bx-no-touch")&&appSLine.pageWidth>=appSLine.grid.sm){$.fancybox(this.form.parentNode,$.extend({},appSLine.fancyOptions,{title:$(g.target).attr("title")}))}else{if(this.form.parentNode.style.display=="none"){this.show()}else{this.hide()}}return false},quote:function(j){BX.onCustomEvent(this.form,"onPaste",[j,"QUOTE",this]);var h=(j.author||null),i=(j.text||""),g=i},paste:function(h){BX.onCustomEvent(this.form,"onPaste",[h,"REPLY",this]);var g=(h.author||null);if(g){}}};return f})(),b=[];BX.Forum.Init=function(f){if(!f||typeof f!="object"){return}new e(f);new c(f,false)};var a=function(f,g){};BX.ready(function(){if(BX.browser.IsIE()){var j=BX.findChildren(document,{className:"reviews-post-table"},true),h,g,f;if(!j){return}for(h=0;h<j.length;h++){g=j[h].getElementsByTagName("*");f=g.length;while(f--){if(g[f].scrollWidth>g[f].offsetWidth){g[f].style.paddingBottom="20px";g[f].style.overflowY="hidden"}}}}});d.fTextToNode=function(g){var f=BX.create("div");f.innerHTML=g;if(f.childNodes.length>0){return f}else{return null}};d.PostFormAjaxStatus=function(g){if($.fancybox.isOpen){formWrap=$.fancybox.inner.get(0)}else{formWrap=document}var n=BX.findChild(formWrap,{className:"reviews-note-box"},true,true),k;if(n){for(k=0;k<=n.length;k++){BX.remove(n[k])}}if(g.length<1){return}var m=d.fTextToNode(g);if(!m){return}if($.fancybox.isOpen){var f=BX.findChild(formWrap,{className:"reviews-reply-form"},true);f.parentNode.insertBefore(m,f)}else{var f=BX.findChild(document,{className:"reviews-block-container"},true);if(!f){return}var h=["reviews-reply-form","reviews-collapse"];var j=f;while((j=j.nextSibling)&&!!j){if(j.nodeType==1){var l=false;for(k=0;k<h.length;k++){if(BX.hasClass(j,h[k])){l=true;break}}if(l){j.parentNode.insertBefore(m,j);break}}}}};d.SetReviewsAjaxPostTmp=function(f){d.forumAjaxPostTmp=f};d.fReplaceOrInsertNode=function(g,i,h,j){var f=null;if(!BX.type.isDomNode(h)){return false}if(!BX.type.isDomNode(g)&&!BX.type.isArray(g)&&g.length>0){if(!(g=d.fTextToNode(g))){return false}}if(BX.type.isDomNode(i)){h=i.parentNode;f=i.nextSibling;h.removeChild(i)}if(!f){f=BX.findChild(h,j,true)}if(f){f.parentNode.insertBefore(g,f)}else{h.appendChild(g)}return true};d.fRunScripts=function(g){var f=BX.processHTML(g,true);BX.ajax.processScripts(f.SCRIPT,true)};d.ShowLastEditReason=function(f,g){if(g){if(f){g.style.display="block"}else{g.style.display="none"}}};d.AttachFile=function(i,m,l,g){var h=null;var f=false;i=parseInt(i);m=parseInt(m);document.getElementById("upload_files_info_"+l).style.display="block";for(var j=i;j<(i+m);j++){h=document.getElementById("upload_files_"+j+"_"+l);if(!h||typeof(h)===null){break}if(h.style.display=="none"){f=true;h.style.display="block";break}}var k=(!f?true:(j>=(i+m-1)));if(k===true){g.style.display="none"}};d.GetSelection=function(){var f,g="";if(d.getSelection){f=d.getSelection();g=f.toString()}else{if(document.selection){f=document.selection;g=f.createRange().text}}return g}})(window);$(document).ready(function(){var c=$(".js-stars > .icon-star"),a=c.parent(),b=0;c.on("click",function(){var e=$(this),d=e.data("index");e.addClass("checked").siblings().removeClass("checked");if(b==d){a.removeClass("rating-"+b);b=0;return false}if(b!=0){a.removeClass("rating-"+b).addClass("is-checked")}else{a.removeClass("is-checked")}a.find("input").val(d);a.addClass("rating-"+d);b=d})});