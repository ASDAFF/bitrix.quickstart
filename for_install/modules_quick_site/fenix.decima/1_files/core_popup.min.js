(function(a){if(BX.PopupWindowManager){return}BX.PopupWindowManager={_popups:[],_currentPopup:null,create:function(h,e,i){var f=-1;if((f=this._getPopupIndex(h))!==-1){return this._popups[f]}var g=new BX.PopupWindow(h,e,i);BX.addCustomEvent(g,"onPopupShow",BX.delegate(this.onPopupShow,this));BX.addCustomEvent(g,"onPopupClose",BX.delegate(this.onPopupClose,this));BX.addCustomEvent(g,"onPopupDestroy",BX.delegate(this.onPopupDestroy,this));this._popups.push(g);return g},onPopupShow:function(e){if(this._currentPopup!==null){this._currentPopup.close()}this._currentPopup=e},onPopupClose:function(e){this._currentPopup=null},onPopupDestroy:function(f){var e=-1;if((e=this._getPopupIndex(f.uniquePopupId))!==-1){this._popups=BX.util.deleteFromArray(this._popups,e)}},getCurrentPopup:function(){return this._currentPopup},isPopupExists:function(e){return this._getPopupIndex(e)!==-1},_getPopupIndex:function(g){var e=-1;for(var f=0;f<this._popups.length;f++){if(this._popups[f].uniquePopupId==g){return f}}return e}};BX.PopupWindow=function(g,f,i){BX.onCustomEvent("onPopupWindowInit",[g,f,i]);this.uniquePopupId=g;this.params=i||{};this.params.zIndex=parseInt(this.params.zIndex);this.params.zIndex=isNaN(this.params.zIndex)?0:this.params.zIndex;this.buttons=this.params.buttons&&BX.type.isArray(this.params.buttons)?this.params.buttons:[];this.offsetTop=BX.PopupWindow.getOption("offsetTop");this.offsetLeft=BX.PopupWindow.getOption("offsetLeft");this.firstShow=false;this.bordersWidth=20;this.bindElementPos=null;this.closeIcon=null;this.angle=null;this.overlay=null;this.titleBar=null;this.bindOptions=typeof(this.params.bindOptions)=="object"?this.params.bindOptions:{};this.isAutoHideBinded=false;this.closeByEsc=!!this.params.closeByEsc;this.isCloseByEscBinded=false;this.dragged=false;this.dragPageX=0;this.dragPageY=0;if(this.params.events){for(var e in this.params.events){BX.addCustomEvent(this,e,this.params.events[e])}}this.popupContainer=document.createElement("DIV");BX.adjust(this.popupContainer,{props:{id:g},style:{zIndex:this.getZindex(),position:"absolute",display:"none",top:"0px",left:"0px"}});var h="popup-window";if(i.lightShadow){h+=" popup-window-light"}if(i.titleBar){h+=i.lightShadow?" popup-window-titlebar-light":" popup-window-titlebar"}if(i.className&&BX.type.isNotEmptyString(i.className)){h+=" "+i.className}this.popupContainer.innerHTML=['<table class="',h,'" cellspacing="0"> 		<tr class="popup-window-top-row"> 			<td class="popup-window-left-column"><div class="popup-window-left-spacer"></div></td> 			<td class="popup-window-center-column">',(i.titleBar?'<div class="popup-window-titlebar" id="popup-window-titlebar-'+g+'"></div>':""),'</td> 			<td class="popup-window-right-column"><div class="popup-window-right-spacer"></div></td> 		</tr> 		<tr class="popup-window-content-row"> 			<td class="popup-window-left-column"></td> 			<td class="popup-window-center-column"><div class="popup-window-content" id="popup-window-content-',g,'"> 			</div></td> 			<td class="popup-window-right-column"></td> 		</tr> 		<tr class="popup-window-bottom-row"> 			<td class="popup-window-left-column"></td> 			<td class="popup-window-center-column"></td> 			<td class="popup-window-right-column"></td> 		</tr> 	</table>'].join("");document.body.appendChild(this.popupContainer);if(i.closeIcon){this.popupContainer.appendChild((this.closeIcon=BX.create("a",{props:{className:"popup-window-close-icon"+(i.titleBar?" popup-window-titlebar-close-icon":""),href:""},style:(typeof(i.closeIcon)=="object"?i.closeIcon:{}),events:{click:BX.proxy(this._onCloseIconClick,this)}})));if(BX.browser.IsIE()){BX.adjust(this.closeIcon,{attrs:{hidefocus:"true"}})}}this.contentContainer=BX("popup-window-content-"+g);this.titleBar=BX("popup-window-titlebar-"+g);this.buttonsContainer=this.buttonsHr=null;if(i.angle){this.setAngle(i.angle)}if(i.overlay){this.setOverlay(i.overlay)}this.setOffset(this.params);this.setBindElement(f);this.setTitleBar(this.params.titleBar);this.setContent(this.params.content);this.setButtons(this.params.buttons);if(this.params.bindOnResize!==false){BX.bind(a,"resize",BX.proxy(this._onResizeWindow,this))}};BX.PopupWindow.prototype.setContent=function(e){if(!this.contentContainer||!e){return}if(BX.type.isElementNode(e)){BX.cleanNode(this.contentContainer);this.contentContainer.appendChild(e.parentNode?e.parentNode.removeChild(e):e);e.style.display="block"}else{if(BX.type.isString(e)){this.contentContainer.innerHTML=e}else{this.contentContainer.innerHTML="&nbsp;"}}};BX.PopupWindow.prototype.setButtons=function(h){this.buttons=h&&BX.type.isArray(h)?h:[];if(this.buttonsHr){BX.remove(this.buttonsHr)}if(this.buttonsContainer){BX.remove(this.buttonsContainer)}if(this.buttons.length>0&&this.contentContainer){var e=[];for(var g=0;g<this.buttons.length;g++){var f=this.buttons[g];if(f==null||!BX.is_subclass_of(f,BX.PopupWindowButton)){continue}f.popupWindow=this;e.push(f.render())}this.buttonsHr=this.contentContainer.parentNode.appendChild(BX.create("div",{props:{className:"popup-window-hr popup-window-buttons-hr"},children:[BX.create("i",{})]}));this.buttonsContainer=this.contentContainer.parentNode.appendChild(BX.create("div",{props:{className:"popup-window-buttons"},children:e}))}};BX.PopupWindow.prototype.setBindElement=function(e){if(!e||typeof(e)!="object"){return}if(BX.type.isDomNode(e)||(BX.type.isNumber(e.top)&&BX.type.isNumber(e.left))){this.bindElement=e}else{if(BX.type.isNumber(e.clientX)&&BX.type.isNumber(e.clientY)){BX.fixEventPageXY(e);this.bindElement={left:e.pageX,top:e.pageY,bottom:e.pageY}}}};BX.PopupWindow.prototype.getBindElementPos=function(e){if(BX.type.isDomNode(e)){return BX.pos(e,false)}else{if(e&&typeof(e)=="object"){if(!BX.type.isNumber(e.bottom)){e.bottom=e.top}return e}else{var f=BX.GetWindowInnerSize();var i=BX.GetWindowScrollPos();var g=this.popupContainer.offsetWidth;var h=this.popupContainer.offsetHeight;return{left:f.innerWidth/2-g/2+i.scrollLeft,top:f.innerHeight/2-h/2+i.scrollTop,bottom:f.innerHeight/2-h/2+i.scrollTop,windowSize:f,windowScroll:i,popupWidth:g,popupHeight:h}}}};BX.PopupWindow.prototype.setAngle=function(f){var k=this.params.lightShadow?"popup-window-light-angly":"popup-window-angly";if(this.angle==null){var h=this.bindOptions.position&&this.bindOptions.position=="top"?"bottom":"top";var m=BX.PopupWindow.getOption(h=="top"?"angleMinTop":"angleMinBottom");var i=BX.type.isNumber(f.offset)?f.offset:0;var l=BX.PopupWindow.getOption("angleLeftOffset",null);if(i>0&&BX.type.isNumber(l)){i+=l-BX.PopupWindow.defaultOptions.angleLeftOffset}this.angle={element:BX.create("div",{props:{className:k+" "+k+"-"+h}}),position:h,offset:0,defaultOffset:Math.max(i,m)};this.popupContainer.appendChild(this.angle.element)}if(typeof(f)=="object"&&f.position&&BX.util.in_array(f.position,["top","right","bottom","left","hide"])){BX.removeClass(this.angle.element,k+"-"+this.angle.position);BX.addClass(this.angle.element,k+"-"+f.position);this.angle.position=f.position}if(typeof(f)=="object"&&BX.type.isNumber(f.offset)){var g=f.offset;var j,e;if(this.angle.position=="top"){j=BX.PopupWindow.getOption("angleMinTop");e=this.popupContainer.offsetWidth-BX.PopupWindow.getOption("angleMaxTop");e=e<j?Math.max(j,g):e;this.angle.offset=Math.min(Math.max(j,g),e);this.angle.element.style.left=this.angle.offset+"px";this.angle.element.style.marginLeft="auto"}else{if(this.angle.position=="bottom"){j=BX.PopupWindow.getOption("angleMinBottom");e=this.popupContainer.offsetWidth-BX.PopupWindow.getOption("angleMaxBottom");e=e<j?Math.max(j,g):e;this.angle.offset=Math.min(Math.max(j,g),e);this.angle.element.style.marginLeft=this.angle.offset+"px";this.angle.element.style.left="auto"}else{if(this.angle.position=="right"){j=BX.PopupWindow.getOption("angleMinRight");e=this.popupContainer.offsetHeight-BX.PopupWindow.getOption("angleMaxRight");e=e<j?Math.max(j,g):e;this.angle.offset=Math.min(Math.max(j,g),e);this.angle.element.style.top=this.angle.offset+"px"}else{if(this.angle.position=="left"){j=BX.PopupWindow.getOption("angleMinLeft");e=this.popupContainer.offsetHeight-BX.PopupWindow.getOption("angleMaxLeft");e=e<j?Math.max(j,g):e;this.angle.offset=Math.min(Math.max(j,g),e);this.angle.element.style.top=this.angle.offset+"px"}}}}}};BX.PopupWindow.prototype.isTopAngle=function(){return this.angle!=null&&this.angle.position=="top"};BX.PopupWindow.prototype.isBottomAngle=function(){return this.angle!=null&&this.angle.position=="bottom"};BX.PopupWindow.prototype.isTopOrBottomAngle=function(){return this.angle!=null&&BX.util.in_array(this.angle.position,["top","bottom"])};BX.PopupWindow.prototype.getAngleHeight=function(){return(this.isTopOrBottomAngle()?BX.PopupWindow.getOption("angleTopOffset"):0)};BX.PopupWindow.prototype.setOffset=function(e){if(typeof(e)!="object"){return}if(e.offsetLeft&&BX.type.isNumber(e.offsetLeft)){this.offsetLeft=e.offsetLeft+BX.PopupWindow.getOption("offsetLeft")}if(e.offsetTop&&BX.type.isNumber(e.offsetTop)){this.offsetTop=e.offsetTop+BX.PopupWindow.getOption("offsetTop")}};BX.PopupWindow.prototype.setTitleBar=function(e){if(!this.titleBar||typeof(e)!="object"||!BX.type.isDomNode(e.content)){return}this.titleBar.innerHTML="";this.titleBar.appendChild(e.content);if(this.params.draggable){this.titleBar.parentNode.style.cursor="move";BX.bind(this.titleBar.parentNode,"mousedown",BX.proxy(this._startDrag,this))}};BX.PopupWindow.prototype.setClosingByEsc=function(e){e=!!e;if(e){this.closeByEsc=true;if(!this.isCloseByEscBinded){BX.bind(document,"keyup",BX.proxy(this._onKeyUp,this));this.isCloseByEscBinded=true}}else{this.closeByEsc=false;if(this.isCloseByEscBinded){BX.unbind(document,"keyup",BX.proxy(this._onKeyUp,this));this.isCloseByEscBinded=false}}};BX.PopupWindow.prototype.setOverlay=function(e){if(this.overlay==null){this.overlay={element:BX.create("div",{props:{className:"popup-window-overlay",id:"popup-window-overlay-"+this.uniquePopupId}})};this.adjustOverlayZindex();this.resizeOverlay();document.body.appendChild(this.overlay.element)}if(e&&e.opacity&&BX.type.isNumber(e.opacity)&&e.opacity>=0&&e.opacity<=100){if(BX.browser.IsIE()&&!BX.browser.IsIE9()){this.overlay.element.style.filter="alpha(opacity="+e.opacity+")"}else{this.overlay.element.style.filter="none";this.overlay.element.style.opacity=parseFloat(e.opacity/100).toPrecision(3)}}if(e&&e.backgroundColor){this.overlay.element.style.backgroundColor=e.backgroundColor}};BX.PopupWindow.prototype.removeOverlay=function(){if(this.overlay!=null&&this.overlay.element!=null){BX.remove(this.overlay.element)}this.overlay=null};BX.PopupWindow.prototype.hideOverlay=function(){if(this.overlay!=null&&this.overlay.element!=null){this.overlay.element.style.display="none"}};BX.PopupWindow.prototype.showOverlay=function(){if(this.overlay!=null&&this.overlay.element!=null){this.overlay.element.style.display="block"}};BX.PopupWindow.prototype.resizeOverlay=function(){if(this.overlay!=null&&this.overlay.element!=null){var e=BX.GetWindowScrollSize();this.overlay.element.style.width=e.scrollWidth+"px";this.overlay.element.style.height=e.scrollHeight+"px"}};BX.PopupWindow.prototype.getZindex=function(){if(this.overlay!=null){return BX.PopupWindow.getOption("popupOverlayZindex")+this.params.zIndex}else{return BX.PopupWindow.getOption("popupZindex")+this.params.zIndex}};BX.PopupWindow.prototype.adjustOverlayZindex=function(){if(this.overlay!=null&&this.overlay.element!=null){this.overlay.element.style.zIndex=parseInt(this.popupContainer.style.zIndex)-1}};BX.PopupWindow.prototype.show=function(){if(!this.firstShow){BX.onCustomEvent(this,"onPopupFirstShow",[this]);this.firstShow=true}BX.onCustomEvent(this,"onPopupShow",[this]);this.showOverlay();this.popupContainer.style.display="block";this.adjustPosition();BX.onCustomEvent(this,"onAfterPopupShow",[this]);if(this.closeByEsc&&!this.isCloseByEscBinded){BX.bind(document,"keyup",BX.proxy(this._onKeyUp,this));this.isCloseByEscBinded=true}if(this.params.autoHide&&!this.isAutoHideBinded){setTimeout(BX.proxy(function(){this.isAutoHideBinded=true;BX.bind(this.popupContainer,"click",this.cancelBubble);BX.bind(document,"click",BX.proxy(this.close,this))},this),0)}};BX.PopupWindow.prototype.isShown=function(){return this.popupContainer.style.display=="block"};BX.PopupWindow.prototype.cancelBubble=function(e){if(!e){e=a.event}if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}};BX.PopupWindow.prototype.close=function(e){if(!this.isShown()){return}if(e&&!(BX.getEventButton(e)&BX.MSLEFT)){return true}BX.onCustomEvent(this,"onPopupClose",[this,e]);this.hideOverlay();this.popupContainer.style.display="none";if(this.isCloseByEscBinded){BX.unbind(document,"keyup",BX.proxy(this._onKeyUp,this));this.isCloseByEscBinded=false}setTimeout(BX.proxy(this._close,this),0)};BX.PopupWindow.prototype._close=function(){if(this.params.autoHide&&this.isAutoHideBinded){this.isAutoHideBinded=false;BX.unbind(this.popupContainer,"click",this.cancelBubble);BX.unbind(document,"click",BX.proxy(this.close,this))}};BX.PopupWindow.prototype._onCloseIconClick=function(e){e=e||a.event;this.close(e);BX.PreventDefault(e)};BX.PopupWindow.prototype._onKeyUp=function(e){e=e||a.event;if(e.keyCode==27){b(this.getZindex(),BX.proxy(this.close,this))}};BX.PopupWindow.prototype.destroy=function(){BX.onCustomEvent(this,"onPopupDestroy",[this]);BX.unbindAll(this);BX.unbind(document,"keyup",BX.proxy(this._onKeyUp,this));BX.unbind(document,"click",BX.proxy(this.close,this));BX.unbind(document,"mousemove",BX.proxy(this._moveDrag,this));BX.unbind(document,"mouseup",BX.proxy(this._stopDrag,this));BX.unbind(a,"resize",BX.proxy(this._onResizeWindow,this));BX.remove(this.popupContainer);this.removeOverlay()};BX.PopupWindow.prototype.adjustPosition=function(m){if(m&&typeof(m)=="object"){this.bindOptions=m}var g=this.getBindElementPos(this.bindElement);if(!this.bindOptions.forceBindPosition&&this.bindElementPos!=null&&g.top==this.bindElementPos.top&&g.left==this.bindElementPos.left){return}this.bindElementPos=g;var k=g.windowSize?g.windowSize:BX.GetWindowInnerSize();var n=g.windowScroll?g.windowScroll:BX.GetWindowScrollPos();var j=g.popupWidth?g.popupWidth:this.popupContainer.offsetWidth;var h=g.popupHeight?g.popupHeight:this.popupContainer.offsetHeight;var l=BX.PopupWindow.getOption("angleTopOffset");var f=this.bindElementPos.left+this.offsetLeft-(this.isTopOrBottomAngle()?BX.PopupWindow.getOption("angleLeftOffset"):0);if(!this.bindOptions.forceLeft&&(f+j+this.bordersWidth)>=(k.innerWidth+n.scrollLeft)&&(k.innerWidth+n.scrollLeft-j-this.bordersWidth)>0){var e=f;f=k.innerWidth+n.scrollLeft-j-this.bordersWidth;if(this.isTopOrBottomAngle()){this.setAngle({offset:e-f+this.angle.defaultOffset})}}else{if(this.isTopOrBottomAngle()){this.setAngle({offset:this.angle.defaultOffset+(f<0?f:0)})}}if(f<0){f=0}var i=0;if(this.bindOptions.position&&this.bindOptions.position=="top"){i=this.bindElementPos.top-h-this.offsetTop-(this.isBottomAngle()?l:0);if(i<0||(!this.bindOptions.forceTop&&i<n.scrollTop)){i=this.bindElementPos.bottom+this.offsetTop;if(this.angle!=null){i+=l;this.setAngle({position:"top"})}}else{if(this.isTopAngle()){i=i-l+BX.PopupWindow.getOption("positionTopXOffset");this.setAngle({position:"bottom"})}else{i+=BX.PopupWindow.getOption("positionTopXOffset")}}}else{i=this.bindElementPos.bottom+this.offsetTop+this.getAngleHeight();if(!this.bindOptions.forceTop&&(i+h)>(k.innerHeight+n.scrollTop)&&(this.bindElementPos.top-h-this.getAngleHeight())>=0){i=this.bindElementPos.top-h;if(this.isTopOrBottomAngle()){i-=l;this.setAngle({position:"bottom"})}i+=BX.PopupWindow.getOption("positionTopXOffset")}else{if(this.isBottomAngle()){i+=l;this.setAngle({position:"top"})}}}if(i<0){i=0}BX.adjust(this.popupContainer,{style:{top:i+"px",left:f+"px",zIndex:this.getZindex()}});this.adjustOverlayZindex()};BX.PopupWindow.prototype._onResizeWindow=function(e){if(this.isShown()){this.adjustPosition();if(this.overlay!=null){this.resizeOverlay()}}};BX.PopupWindow.prototype.move=function(e,k){var j=parseInt(this.popupContainer.style.left)+e;var i=parseInt(this.popupContainer.style.top)+k;if(typeof(this.params.draggable)=="object"&&this.params.draggable.restrict){if(j<0){j=0}var g=BX.GetWindowScrollSize();var h=this.popupContainer.offsetWidth;var f=this.popupContainer.offsetHeight;if(j>(g.scrollWidth-h)){j=g.scrollWidth-h}if(i>(g.scrollHeight-f)){i=g.scrollHeight-f}if(i<0){i=0}}this.popupContainer.style.left=j+"px";this.popupContainer.style.top=i+"px"};BX.PopupWindow.prototype._startDrag=function(e){e=e||a.event;BX.fixEventPageXY(e);this.dragPageX=e.pageX;this.dragPageY=e.pageY;this.dragged=false;BX.bind(document,"mousemove",BX.proxy(this._moveDrag,this));BX.bind(document,"mouseup",BX.proxy(this._stopDrag,this));if(document.body.setCapture){document.body.setCapture()}document.body.ondrag=BX.False;document.body.onselectstart=BX.False;document.body.style.cursor="move";document.body.style.MozUserSelect="none";this.popupContainer.style.MozUserSelect="none";return BX.PreventDefault(e)};BX.PopupWindow.prototype._moveDrag=function(e){e=e||a.event;BX.fixEventPageXY(e);if(this.dragPageX==e.pageX&&this.dragPageY==e.pageY){return}this.move((e.pageX-this.dragPageX),(e.pageY-this.dragPageY));this.dragPageX=e.pageX;this.dragPageY=e.pageY;if(!this.dragged){BX.onCustomEvent(this,"onPopupDragStart");this.dragged=true}BX.onCustomEvent(this,"onPopupDrag")};BX.PopupWindow.prototype._stopDrag=function(e){if(document.body.releaseCapture){document.body.releaseCapture()}BX.unbind(document,"mousemove",BX.proxy(this._moveDrag,this));BX.unbind(document,"mouseup",BX.proxy(this._stopDrag,this));document.body.ondrag=null;document.body.onselectstart=null;document.body.style.cursor="";document.body.style.MozUserSelect="";this.popupContainer.style.MozUserSelect="";BX.onCustomEvent(this,"onPopupDragEnd");this.dragged=false;return BX.PreventDefault(e)};BX.PopupWindow.options={};BX.PopupWindow.defaultOptions={angleLeftOffset:15,positionTopXOffset:0,angleTopOffset:8,popupZindex:1000,popupOverlayZindex:1100,angleMinLeft:10,angleMaxLeft:10,angleMinRight:10,angleMaxRight:10,angleMinBottom:7,angleMaxBottom:25,angleMinTop:7,angleMaxTop:25,offsetLeft:0,offsetTop:0};BX.PopupWindow.setOptions=function(e){if(!e||typeof(e)!="object"){return}for(var f in e){BX.PopupWindow.options[f]=e[f]}};BX.PopupWindow.getOption=function(f,e){if(typeof(BX.PopupWindow.options[f])!="undefined"){return BX.PopupWindow.options[f]}else{if(typeof(e)!="undefined"){return e}else{return BX.PopupWindow.defaultOptions[f]}}};BX.PopupWindowButton=function(f){this.popupWindow=null;this.params=f||{};this.text=this.params.text||"";this.id=this.params.id||"";this.className=this.params.className||"";this.events=this.params.events||{};this.contextEvents={};for(var e in this.events){this.contextEvents[e]=BX.proxy(this.events[e],this)}this.nameNode=BX.create("span",{props:{className:"popup-window-button-text"},text:this.text});this.buttonNode=BX.create("span",{props:{className:"popup-window-button"+(this.className.length>0?" "+this.className:""),id:this.id},children:[BX.create("span",{props:{className:"popup-window-button-left"}}),this.nameNode,BX.create("span",{props:{className:"popup-window-button-right"}})],events:this.contextEvents})};BX.PopupWindowButton.prototype.render=function(){return this.buttonNode};BX.PopupWindowButton.prototype.setName=function(e){this.text=e||"";if(this.nameNode){BX.cleanNode(this.nameNode);BX.adjust(this.nameNode,{text:this.text})}};BX.PopupWindowButton.prototype.setClassName=function(e){if(this.buttonNode){if(BX.type.isString(this.className)&&(this.className!="")){BX.removeClass(this.buttonNode,this.className)}BX.addClass(this.buttonNode,e)}this.className=e};BX.PopupWindowButtonLink=function(e){BX.PopupWindowButtonLink.superclass.constructor.apply(this,arguments);this.nameNode=BX.create("span",{props:{className:"popup-window-button-link-text"},text:this.text,events:this.contextEvents});this.buttonNode=BX.create("span",{props:{className:"popup-window-button popup-window-button-link"+(this.className.length>0?" "+this.className:""),id:this.id},children:[this.nameNode]})};BX.extend(BX.PopupWindowButtonLink,BX.PopupWindowButton);BX.PopupMenu={Data:{},currentItem:null,show:function(h,e,f,g){if(this.currentItem!==null){this.currentItem.popupWindow.close()}this.currentItem=this.create(h,e,f,g);this.currentItem.popupWindow.show()},create:function(h,e,f,g){if(!this.Data[h]){this.Data[h]=new BX.PopupMenuWindow(h,e,f,g)}return this.Data[h]},getCurrentMenu:function(){return this.currentItem},getMenuById:function(e){return this.Data[e]?this.Data[e]:null},destroy:function(f){var e=this.getMenuById(f);if(e){if(this.currentItem==e){this.currentItem=null}e.popupWindow.destroy();delete this.Data[f]}}};BX.PopupMenuWindow=function(j,e,g,h){this.id=j;this.bindElement=e;this.menuItems=[];this.itemsContainer=null;if(g&&BX.type.isArray(g)){for(var f=0;f<g.length;f++){this.__addMenuItem(g[f],null)}}this.params=h&&typeof(h)=="object"?h:{};this.popupWindow=this.__createPopup()};BX.PopupMenuWindow.prototype.__createItem=function(f,e){if(e>0){f.layout.hr=BX.create("div",{props:{className:"popup-window-hr"},children:[BX.create("i",{})]})}if(f.delimiter){f.layout.item=BX.create("span",{props:{className:"popup-window-delimiter"},html:"<i></i>"})}else{f.layout.item=BX.create(!!f.href?"a":"span",{props:{className:"menu-popup-item"+(BX.type.isNotEmptyString(f.className)?" "+f.className:" menu-popup-no-icon")},attrs:{title:f.title?f.title:"",onclick:f.onclick&&BX.type.isString(f.onclick)?f.onclick:""},events:f.onclick&&BX.type.isFunction(f.onclick)?{click:BX.proxy(this.onItemClick,{obj:this,item:f})}:null,children:[BX.create("span",{props:{className:"menu-popup-item-left"}}),BX.create("span",{props:{className:"menu-popup-item-icon"}}),(f.layout.text=BX.create("span",{props:{className:"menu-popup-item-text"},html:f.text})),BX.create("span",{props:{className:"menu-popup-item-right"}})]});if(f.href){f.layout.item.href=f.href}}return f};BX.PopupMenuWindow.prototype.__createPopup=function(){var e=[];for(var h=0;h<this.menuItems.length;h++){this.__createItem(this.menuItems[h],h);if(this.menuItems[h].layout.hr!=null){e.push(this.menuItems[h].layout.hr)}e.push(this.menuItems[h].layout.item)}var g=new BX.PopupWindow("menu-popup-"+this.id,this.bindElement,{closeByEsc:typeof(this.params.closeByEsc)!="undefined"?this.params.closeByEsc:false,bindOptions:typeof(this.params.bindOptions)=="object"?this.params.bindOptions:{},angle:typeof(this.params.angle)!="undefined"?this.params.angle:false,zIndex:this.params.zIndex?this.params.zIndex:0,overlay:typeof(this.params.overlay)=="object"?this.params.overlay:null,autoHide:typeof(this.params.autoHide)!="undefined"?this.params.autoHide:true,offsetTop:this.params.offsetTop?this.params.offsetTop:1,offsetLeft:this.params.offsetLeft?this.params.offsetLeft:0,lightShadow:typeof(this.params.lightShadow)!="undefined"?this.params.lightShadow:true,content:BX.create("div",{props:{className:"menu-popup"},children:[(this.itemsContainer=BX.create("div",{props:{className:"menu-popup-items"},children:e}))]})});if(this.params&&this.params.events){for(var f in this.params.events){if(this.params.events.hasOwnProperty(f)){BX.addCustomEvent(g,f,this.params.events[f])}}}return g};BX.PopupMenuWindow.prototype.onItemClick=function(e){e=e||a.event;this.item.onclick.call(this.obj,e,this.item)};BX.PopupMenuWindow.prototype.addMenuItem=function(h,g){var e=this.__addMenuItem(h,g);if(e<0){return false}this.__createItem(h,e);var f=this.getMenuItem(g);if(f!=null){if(f.layout.hr==null){f.layout.hr=BX.create("div",{props:{className:"popup-window-hr"},children:[BX.create("i",{})]});this.itemsContainer.insertBefore(f.layout.hr,f.layout.item)}if(h.layout.hr!=null){this.itemsContainer.insertBefore(h.layout.hr,f.layout.hr)}this.itemsContainer.insertBefore(h.layout.item,f.layout.hr)}else{if(h.layout.hr!=null){this.itemsContainer.appendChild(h.layout.hr)}this.itemsContainer.appendChild(h.layout.item)}return true};BX.PopupMenuWindow.prototype.__addMenuItem=function(g,f){if(!g||(!g.delimiter&&!BX.type.isNotEmptyString(g.text))||(g.id&&this.getMenuItem(g.id)!=null)){return -1}g.layout={item:null,text:null,hr:null};var e=this.getMenuItemPosition(f);if(e>=0){this.menuItems=BX.util.insertIntoArray(this.menuItems,e,g)}else{this.menuItems.push(g);e=this.menuItems.length-1}return e};BX.PopupMenuWindow.prototype.removeMenuItem=function(g){var f=this.getMenuItem(g);if(!f){return}for(var e=0;e<this.menuItems.length;e++){if(this.menuItems[e]==f){this.menuItems=BX.util.deleteFromArray(this.menuItems,e);break}}if(e==0){if(this.menuItems[0]){this.menuItems[0].layout.hr.parentNode.removeChild(this.menuItems[0].layout.hr);this.menuItems[0].layout.hr=null}}else{f.layout.hr.parentNode.removeChild(f.layout.hr)}f.layout.item.parentNode.removeChild(f.layout.item);f.layout.item=null};BX.PopupMenuWindow.prototype.getMenuItem=function(f){for(var e=0;e<this.menuItems.length;e++){if(this.menuItems[e].id&&this.menuItems[e].id==f){return this.menuItems[e]}}return null};BX.PopupMenuWindow.prototype.getMenuItemPosition=function(f){if(f){for(var e=0;e<this.menuItems.length;e++){if(this.menuItems[e].id&&this.menuItems[e].id==f){return e}}}return -1};a.BXInputPopup=function(e){this.id=e.id||"bx-inp-popup-"+Math.round(Math.random()*1000000);this.handler=e.handler||false;this.values=e.values||false;this.pInput=e.input;this.bValues=!!this.values;this.defaultValue=e.defaultValue||"";this.openTitle=e.openTitle||"";this.className=e.className||"";this.noMRclassName=e.noMRclassName||"ec-no-rm";this.emptyClassName=e.noMRclassName||"ec-label";var f=this;this.curInd=false;if(this.bValues){this.pInput.onfocus=this.pInput.onclick=function(g){if(this.value==f.defaultValue){this.value="";this.className=f.className}f.ShowPopup();return BX.PreventDefault(g)};this.pInput.onblur=function(){if(f.bShowed){setTimeout(function(){f.ClosePopup(true)},200)}f.OnChange()}}else{this.pInput.className=this.noMRclassName;this.pInput.onblur=BX.proxy(this.OnChange,this)}};BXInputPopup.prototype={ShowPopup:function(){if(this.bShowed){return}var j=this;if(!this.oPopup){var h,g=BX.create("DIV",{props:{className:"bxecpl-loc-popup "+this.className}});for(var f=0,e=this.values.length;f<e;f++){h=g.appendChild(BX.create("DIV",{props:{id:"bxecmr_"+f},text:this.values[f].NAME,events:{mouseover:function(){BX.addClass(this,"bxecplloc-over")},mouseout:function(){BX.removeClass(this,"bxecplloc-over")},click:function(){var i=this.id.substr("bxecmr_".length);j.pInput.value=j.values[i].NAME;j.curInd=i;j.OnChange();j.ClosePopup(true)}}}));if(this.values[f].DESCRIPTION){h.title=this.values[f].DESCRIPTION}if(this.values[f].CLASS_NAME){BX.addClass(h,this.values[f].CLASS_NAME)}if(this.values[f].URL){h.appendChild(BX.create("A",{props:{href:this.values[f].URL,className:"bxecplloc-view",target:"_blank",title:this.openTitle}}))}}this.oPopup=new BX.PopupWindow(this.id,this.pInput,{autoHide:true,offsetTop:1,offsetLeft:0,lightShadow:true,closeByEsc:true,content:g});BX.addCustomEvent(this.oPopup,"onPopupClose",BX.proxy(this.ClosePopup,this))}this.oPopup.show();this.pInput.select();this.bShowed=true;BX.onCustomEvent(this,"onInputPopupShow",[this])},ClosePopup:function(e){this.bShowed=false;if(this.pInput.value==""){this.OnChange()}BX.onCustomEvent(this,"onInputPopupClose",[this]);if(e===true){this.oPopup.close()}},OnChange:function(){var e=this.pInput.value;if(this.bValues){if(this.pInput.value==""||this.pInput.value==this.defaultValue){this.pInput.value=this.defaultValue;this.pInput.className=this.emptyClassName;e=""}else{this.pInput.className=""}}if(isNaN(parseInt(this.curInd))||this.curInd!==false&&e!=this.values[this.curInd].NAME){this.curInd=false}else{this.curInd=parseInt(this.curInd)}BX.onCustomEvent(this,"onInputPopupChanged",[this,this.curInd,e]);if(this.handler&&typeof this.handler=="function"){this.handler({ind:this.curInd,value:e})}},Set:function(f,g,e){this.curInd=f;if(this.curInd!==false){this.pInput.value=this.values[this.curInd].NAME}else{this.pInput.value=g}if(e!==false){this.OnChange()}},Get:function(e){var f=false;if(typeof e=="undefined"){e=this.curInd}if(e!==false&&this.values[e]){f=this.values[e].ID}return f},GetIndex:function(g){for(var f=0,e=this.values.length;f<e;f++){if(this.values[f].ID==g){return f}}return false},Deactivate:function(e){if(this.pInput.value==""||this.pInput.value==this.defaultValue){if(e){this.pInput.value="";this.pInput.className=this.noMRclassName}else{if(this.oEC.bUseMR){this.pInput.value=this.defaultValue;this.pInput.className=this.emptyClassName}}}this.pInput.disabled=e}};var d=-1,c=null;function b(g,f){if(g===false){if(c&&c.length>0){for(var e=0;e<c.length;e++){c[e]()}c=null;d=-1}}else{if(c===null){c=[];d=-1;BX.defer(b)(false)}if(g>d){d=g;c=[f]}else{if(g==d){c.push(f)}}}}})(window);