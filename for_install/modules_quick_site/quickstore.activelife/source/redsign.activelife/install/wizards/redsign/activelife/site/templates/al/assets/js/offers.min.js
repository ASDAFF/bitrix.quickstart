appSLine.offerPropChangedTimeout=0;appSLine.catalogElementSetPrice=function(c,b){var e=c.find(".js-price_pdv-"+b.PRICE_ID);if(e){if(parseFloat(b.DISCOUNT_DIFF)>0){e.closest(".price").addClass("price-disc")}else{e.closest(".price").removeClass("price-disc")}e.html(b.PRINT_DISCOUNT_VALUE)}var a=c.find(".js-price_pdd-"+b.PRICE_ID);if(a){if(parseFloat(b.DISCOUNT_DIFF>0)){a.html(b.PRINT_DISCOUNT)}else{a.html("")}}var d=c.find(".js-price_pv-"+b.PRICE_ID);if(d){if(parseFloat(b.DISCOUNT_DIFF)>0){d.html(b.PRINT_VALUE)}else{d.html("")}}};appSLine.catalogElementSetPriceMatrix=function(d,a){var c=d.find(".js-quantity").val();for(var e in a.ROWS){if((a.ROWS[e].QUANTITY_FROM==0||a.ROWS[e].QUANTITY_FROM<=c)&&(a.ROWS[e].QUANTITY_TO==0||a.ROWS[e].QUANTITY_TO>=c)){for(var b in a.COLS){if(!!a.MATRIX[b][e]){this.catalogElementSetPrice(d,{PRICE_ID:a.COLS[b].ID,PRINT_DISCOUNT_VALUE:a.MATRIX[b][e].PRINT_DISCOUNT_VALUE,PRINT_DISCOUNT:a.MATRIX[b][e].PRINT_DISCOUNT_DIFF,PRINT_VALUE:a.MATRIX[b][e].PRINT_VALUE,DISCOUNT_DIFF:a.MATRIX[b][e].DISCOUNT_DIFF})}}break}}};appSLine.offerPropChanged=function(a){var d=a.closest(".js-product"),n=d.data("product-id"),b=a.closest(".js-offer_prop"),o=b.data("code"),h=a.data("value");if(appSLine.offers[n]&&!a.hasClass("disabled")){b.find(".offer_prop__value").removeClass("checked");a.addClass("checked");b.find(".offer_prop__checked").text(a.text());var f="",k="",m=new Object();for(var c in appSLine.offers[n].SORT_PROPS){k=appSLine.offers[n].SORT_PROPS[c];m[k]=d.find('.offer_prop[data-code="'+k+'"]').find(".offer_prop__value.checked").data("value");if(k==o){if(appSLine.offers[n].SORT_PROPS[parseInt(c)+1]){f=appSLine.offers[n].SORT_PROPS[parseInt(c)+1]}else{f=false}break}}if(f){var j=true,e=new Array();for(var i in appSLine.offers[n].OFFERS){j=true;offer_loop:for(var l in m){if(m[l]!=appSLine.offers[n].OFFERS[i].PROPERTIES[l]){j=false;break offer_loop}}if(j){e.push(appSLine.offers[n].OFFERS[i].PROPERTIES[f])}}var g=d.find('.offer_prop[data-code="'+f+'"]');g.find(".offer_prop__value").each(function(r){var s=$(this),p=true;for(var q in e){if(s.data("value")==e[q]){p=false;break}}s.addClass("disabled");if(!p){s.removeClass("disabled")}});if(!g.find(".offer_prop__value.checked").hasClass("disabled")){$nextOption=g.find(".offer_prop__value.checked")}else{$nextOption=g.find(".offer_prop__value:not(.disabled):first")}this.offerPropChanged($nextOption)}else{this.catalogElementChangeOffer(d)}}};appSLine.catalogElementChangeOffer=function(c){var m=c.data("product-id"),g=appSLine.offers[m];if(!!g){var p={};c.find(".offer_prop__value.checked").each(function(E){var D=$(this),i=D.closest(".js-offer_prop").data("code"),C=D.data("value");p[i]=C});var t=0,v=true;for(var h in g.OFFERS){v=true;for(var l in p){if(p[l]!=g.OFFERS[h].PROPERTIES[l]){v=false;break}}if(v){t=h;break}}if(g.OFFERS[t]==undefined){return false}var d=g.OFFERS[t];c.data("offer-id",t);c.find(".js-product_id").val(t);if(d.DETAIL_PAGE_URL!=undefined){c.find(".js-product__name,        .catalog_item__detail,        .catalog_item__zoom,        .catalog_item__pic").attr("href",d.DETAIL_PAGE_URL)}if(d.IMAGES!=undefined){var x=c.find(".picbox__carousel"),j=x.data("owl.carousel");if(x.length>0){var w=j.settings.smartSpeed,k="";for(var u in d.IMAGES){if(u!="p"){var s='<a class="picbox__canvas js_picture_glass" data-offer-id="'+t+"\" data-dot=\"<img class='owl-preview' src='"+d.IMAGES[u].smaller+'\'>">                <img class="picbox__img" src="'+d.IMAGES[u].big+'" data-large="'+d.IMAGES[u].original+'"/>              </a>';if(u=="d"){k=s+k}else{k+=s}}}for(var u in j._items){var q=j._items[u].children("a");if(q.length==1&&!q.attr("data-offer-id")){k+=j._items[u].html()}}j._plugins.navigation._templates=[];j._plugins.navigation._controls.$absolute.html("");j.settings.smartSpeed=0;x.trigger("replace.owl.carousel",[k]);setTimeout(function(){x.trigger("refresh.owl.carousel").trigger("to.owl.carousel",[0])},250);j.settings.smartSpeed=w}else{var B=["p","d",0];for(var u in B){if(d.IMAGES[B[u]]!=undefined){c.find(".catalog_item__img").attr("src",d.IMAGES[B[u]].small);break}}}}if(d.DISPLAY_PROPERTIES!=undefined){for(var z in d.DISPLAY_PROPERTIES){var f=c.find(".sku_prop__val_"+z);if(f.length){f.html(d.DISPLAY_PROPERTIES[z].DISPLAY_VALUE);if(d.DISPLAY_PROPERTIES[z].DISPLAY_VALUE==""){f.prev(".sku_prop__name").hide();f.parent(".sku_prop").hide()}else{f.prev(".sku_prop__name").show();f.parent(".sku_prop").show()}}}}if(d.CATALOG_MEASURE_NAME){c.find(".js-measure").html(d.CATALOG_MEASURE_NAME)}if(d.CATALOG_MEASURE_RATIO){c.find(".js-quantity").data("ratio",d.CATALOG_MEASURE_RATIO).attr("step",d.CATALOG_MEASURE_RATIO).attr("min",d.CATALOG_MEASURE_RATIO).val(d.CATALOG_MEASURE_RATIO)}if(!!d.PRICE_MATRIX){this.catalogElementSetPriceMatrix(c,d.PRICE_MATRIX)}else{if(d.PRICES){for(var b in d.PRICES){this.catalogElementSetPrice(c,d.PRICES[b])}}}$timers=c.removeClass("qb da2").find(".js_timer, .rs_progress-wrap").hide();if(g.ELEMENT.DAYSARTICLE2||d.DAYSARTICLE2){c.addClass("da2");if($timers.filter('[data-offer-id="'+m+'"]').length>0){$timers.filter('[data-offer-id="'+m+'"]').show()}else{if($timers.filter('[data-offer-id="'+t+'"]').length>0){$timers.filter('[data-offer-id="'+t+'"]').show()}}}else{if(g.ELEMENT.QUICKBUY||d.QUICKBUY){c.addClass("qb");if($timers.filter('[data-offer-id="'+m+'"]').length>0){$timers.filter('[data-offer-id="'+m+'"]').show()}else{if($timers.filter('[data-offer-id="'+t+'"]').length>0){$timers.filter('[data-offer-id="'+t+'"]').show()}}}}if(d.CAN_BUY){c.find(".js-add2cart, .js-buy1click").removeClass("disabled");if(g.ELEMENT.CATALOG_SUBSCRIBE){c.find(".js-subscribe").hide()}}else{c.find(".js-add2cart, .js-buy1click").addClass("disabled");if(g.ELEMENT.CATALOG_SUBSCRIBE){c.find(".js-subscribe").attr("data-item",t).show()}}var e=c.find(".stocks");if(e.length){function n(C,D,i){C=parseInt(C);D=parseInt(D);if(C==0){return i[0]}else{if(C>=D){return i[2]}else{return i[1]}}}var A=["is-outofstock","is-limited","is-instock"];if(!this.offers[m].PARAMS.USE_STORE||this.stocks[m]==undefined){var y=[BX.message("RS_SLINE_STOCK_OUT_OF_STOCK"),BX.message("RS_SLINE_STOCK_LIMITED_AVAILABILITY"),BX.message("RS_SLINE_STOCK_IN_STOCK")];e.find(".stocks__amount").text(!!g.PARAMS.USE_MIN_AMOUNT?n(d.CATALOG_QUANTITY,g.PARAMS.MIN_AMOUNT,y):d.CATALOG_QUANTITY);var o=e.find(".stocks__scale").removeClass("is-outofstock is-limited is-instock").addClass(n(d.CATALOG_QUANTITY,g.PARAMS.MIN_AMOUNT,A));if(d.CATALOG_QUANTITY==0){o.children(".scale__over").removeAttr("style")}else{o.find(".scale__over").css("width","100%")}}else{var a=this.stocks[m],y=[a.MESSAGES.OUT_OF_STOCK,a.MESSAGES.LIMITED_AVAILABILITY,a.MESSAGES.IN_STOCK];e.find(".stocks__amount").text(!!a.USE_MIN_AMOUNT?n(a.SKU[t].TOTAL_AMOUNT,a.MIN_AMOUNT,y):a.SKU[t].TOTAL_AMOUNT);var o=e.find(".stocks__scale").removeClass("is-outofstock is-limited is-instock").addClass(n(a.SKU[t].TOTAL_AMOUNT,a.MIN_AMOUNT,A));if(a.SKU[t].MAX_AMOUNT==0){o.children(".scale__over").removeAttr("style")}else{o.children(".scale__over").css("width","100%")}for(u in a.STORES){var r=e.find("#"+a.ID+"_"+a.STORES[u]);if(!a.SHOW_EMPTY_STORE&&a.SKU[t].STORES[a.STORES[u]]<=0){r.hide()}else{r.find(".stock__quantity").text(!!a.USE_MIN_AMOUNT?n(a.SKU[t].STORES[a.STORES[u]],a.MIN_AMOUNT,y):a.SKU[t].STORES[a.STORES[u]]);var o=r.show().find(".stock__scale").removeClass("is-outofstock is-limited is-instock").addClass(n(a.SKU[t].STORES[a.STORES[u]],a.MIN_AMOUNT,A));if(a.SKU[t].MAX_AMOUNT==0){o.children(".scale__over").removeAttr("style")}else{o.children(".scale__over").css("width",100*a.SKU[t].STORES[a.STORES[u]]/a.SKU[t].MAX_AMOUNT+"%")}}}}}this.setProductItems({items:c});$.fancybox.toggle()}};$(document).on("click",".js-product .js-offer_prop .offer_prop__value",function(h){var g=$(this);if(!g.hasClass("disabled")&&(!g.hasClass("checked"))){var d=g.closest(".js-product"),a=parseInt(d.data("product-id")),b=g.closest(".js-offer_prop");if(a>0){clearTimeout(appSLine.offerPropChangedTimeout);if(appSLine.offers[a]){appSLine.offerPropChanged(g)}else{var c=d.find(".js-product__name").attr("href"),f=d.children(".catalog_item__inner");if(c==undefined){c=d.data("detail")==undefined?window.location.href:d.data("detail")}if(f.length<1){f=d}f.rsToggleDark({progress:true});appSLine.offerPropChangedTimeout=setTimeout(function(){$.ajax({type:"POST",url:c,dataType:"json",data:{AJAX_CALL:"Y",action:"get_element_json"},success:function(e){appSLine.offers[a]=e;appSLine.offerPropChanged(g)},error:function(j,e,i){console.error(j.status);console.error(i)},complete:function(){f.rsToggleDark()}})},appSLine.ajaxTimeoutTime)}}}});$(document).on("change",".js-product .js-quantity.js-use_count",function(h){var g=$(this);if(!g.hasClass("disabled")){var d=g.closest(".js-product"),a=parseInt(d.data("product-id"));if(a>0){clearTimeout(appSLine.offerPropChangedTimeout);h.stopPropagation();if(appSLine.offers[a]){var c=d.find(".js-product_id").val();if(appSLine.offers[a].OFFERS[c]!=undefined&&appSLine.offers[a].OFFERS[c].PRICE_MATRIX!=undefined){appSLine.catalogElementSetPriceMatrix(d,appSLine.offers[a].OFFERS[c].PRICE_MATRIX)}else{if(appSLine.offers[a].ELEMENT.PRICE_MATRIX!=undefined){appSLine.catalogElementSetPriceMatrix(d,appSLine.offers[a].ELEMENT.PRICE_MATRIX)}}}else{var b=d.find(".js-product__name").attr("href"),f=d.children(".catalog_item__inner");if(b==undefined){b=d.data("detail")==undefined?window.location.href:d.data("detail")}if(f.length<1){f=d}f.rsToggleDark({progress:true});appSLine.offerPropChangedTimeout=setTimeout(function(){$.ajax({type:"POST",url:b,dataType:"json",data:{AJAX_CALL:"Y",action:"get_element_json"},success:function(i){appSLine.offers[a]=i;var e=d.find(".js-product_id").val();if(appSLine.offers[a]){if(appSLine.offers[a].OFFERS[e]!=undefined&&appSLine.offers[a].OFFERS[e].PRICE_MATRIX!=undefined){appSLine.catalogElementSetPriceMatrix(d,appSLine.offers[a].OFFERS[e].PRICE_MATRIX)}else{if(appSLine.offers[a].ELEMENT.PRICE_MATRIX!=undefined){appSLine.catalogElementSetPriceMatrix(d,appSLine.offers[a].ELEMENT.PRICE_MATRIX)}}}},error:function(){console.error(xhr.status);console.error(thrownError)},complete:function(){f.rsToggleDark()}})},appSLine.ajaxTimeoutTime)}}else{console.error("Get element JSON -> iProductID is empty")}}return false});