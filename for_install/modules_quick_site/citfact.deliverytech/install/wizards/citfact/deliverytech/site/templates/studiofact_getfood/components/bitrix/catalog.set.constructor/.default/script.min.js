function catalogSetConstructDefault(a,c,f,d,b,g,e){this.arSetIDs=a;this.ajax_path=c;this.price_currency=f;this.lid=d;this.element_id=b;this.detail_img=g;this.items_ratio=e}catalogSetConstructDefault.prototype.Add2Basket=function(){var b=this.detail_img;var a=this.element_id;BX.ajax.post(this.ajax_path,{sessid:BX.bitrix_sessid(),action:"catalogSetAdd2Basket",set_ids:this.arSetIDs,lid:this.lid,iblockId:BX.message("setIblockId"),setOffersCartProps:BX.message("setOffersCartProps"),itemsRatio:this.items_ratio},function(c){showCatalogSetAdd2BasketPopup(b,a)})};catalogSetConstructDefault.prototype.DeleteItem=function(e,j){var c=e.parentNode;BX.remove(e);for(var f=0,d=this.arSetIDs.length;f<d;f++){if(this.arSetIDs[f]==j){this.arSetIDs.splice(f,1)}}var h=+BX.firstChild(c).getAttribute("data-price");var g=+BX.firstChild(c).getAttribute("data-old-price");var b=+BX.firstChild(c).getAttribute("data-discount-diff-price");var a=BX.findChildren(c,{className:"bx_default_set_items"},true);if(!a.length){BX.removeClass(BX.firstChild(c),"plus");BX.addClass(BX.firstChild(c),"equally")}else{for(var f=0;f<a.length;f++){if(f==a.length-1){BX.removeClass(a[f],"plus");BX.addClass(a[f],"equally")}h+=+a[f].getAttribute("data-price");g+=+a[f].getAttribute("data-old-price");b+=+a[f].getAttribute("data-discount-diff-price")}}BX.ajax.post(this.ajax_path,{sessid:BX.bitrix_sessid(),action:"ajax_recount_prices",sumPrice:h,sumOldPrice:g,sumDiffDiscountPrice:b,currency:this.price_currency},function(i){var k=JSON.parse(i);if(k.formatSum){BX.findChild(c,{className:"bx_item_set_current_price"},true,false).innerHTML=k.formatSum}if(k.formatOldSum){BX.findChild(c,{className:"bx_item_set_old_price"},true,false).innerHTML=k.formatOldSum}else{BX.findChild(c,{className:"bx_item_set_old_price"},true,false).style.display="none"}if(k.formatDiscDiffSum){BX.findChild(c,{className:"bx_set_discount_diff_price"},true,false).innerHTML=k.formatDiscDiffSum}else{BX.findChild(c,{className:"bx_item_set_economy_price"},true,false).style.display="none"}})};function catalogSetConstructPopup(l,f,g,h,k,b,j,d,i,c,e,a){this.catalogSetItemsCount=l;this.catalogSetItemsWidth=f;this.catalogCurrency=g;this.catalogDefaultItemPrice=h;this.catalogDefaultItemDiscountPrice=k;this.catalogDefaultItemDiscountDiffPrice=b;this.ajaxPath=j;this.catalogSetIds=d;this.lid=i;this.element_id=c;this.items_ratio=e;this.detail_img=a}catalogSetConstructPopup.prototype.scrollItems=function(c){if(c=="left"){var b=BX("bx_catalog_set_construct_slider_"+this.element_id).getAttribute("data-style-left");if(b>=0){return}var a=+(b)+20}else{var b=BX("bx_catalog_set_construct_slider_"+this.element_id).getAttribute("data-style-left");if(-b>=(this.catalogSetItemsCount-5)*this.catalogSetItemsWidth){return}var a=+(b)-20}BX("bx_catalog_set_construct_slider_"+this.element_id).setAttribute("data-style-left",a);BX("bx_catalog_set_construct_slider_"+this.element_id).style.left=a+"%"};catalogSetConstructPopup.prototype.recountSlider=function(c){if(c=="add"){this.catalogSetItemsCount-=1}else{if(c=="delete"){this.catalogSetItemsCount+=1}}this.catalogSetItemsWidth=(this.catalogSetItemsCount<=5)?20:100/this.catalogSetItemsCount;var b=BX.findChildren(BX("bx_catalog_set_construct_popup_"+this.element_id),{className:"bx_drag_obj"},true);for(var a=0;a<b.length;a++){b[a].style.width=this.catalogSetItemsWidth+"%"}BX("bx_catalog_set_construct_slider_"+this.element_id).style.width=this.catalogSetItemsCount<=5?"100%":(100+(this.catalogSetItemsCount-5)*20)+"%";if(this.catalogSetItemsCount>5){BX("bx_catalog_set_construct_slider_left_"+this.element_id).style.display="block";BX("bx_catalog_set_construct_slider_right_"+this.element_id).style.display="block"}else{BX("bx_catalog_set_construct_slider_left_"+this.element_id).style.display="none";BX("bx_catalog_set_construct_slider_right_"+this.element_id).style.display="none";BX("bx_catalog_set_construct_slider_"+this.element_id).style.left="0%";BX("bx_catalog_set_construct_slider_"+this.element_id).setAttribute("data-style-left",0)}};catalogSetConstructPopup.prototype.recountPrices=function(){var h=+this.catalogDefaultItemDiscountPrice;var f=+this.catalogDefaultItemPrice;var a=+this.catalogDefaultItemDiscountDiffPrice;var j=BX.findChildren(BX("bx_catalog_set_construct_popup_"+this.element_id),{className:"bx_drag_dest"},true);for(var d=0;d<j.length;d++){if(!BX.hasClass(j[d],"bx_kit_item_empty")){var e=BX.findChild(j[d],{className:"bx_kit_item_price"},true,false);var g=e.getAttribute("data-discount-price");if(g){h+=+g}var k=e.getAttribute("data-price");if(k){f+=+k}var c=e.getAttribute("data-discount-diff-price");if(c){a+=+c}}}var b=this.element_id;BX.ajax.post(this.ajaxPath,{sessid:BX.bitrix_sessid(),action:"ajax_recount_prices",sumPrice:h,sumOldPrice:f,sumDiffDiscountPrice:a,currency:this.catalogCurrency},function(i){var l=JSON.parse(i);if(l.formatSum){BX("bx_catalog_set_construct_sum_price_"+b).innerHTML=l.formatSum}if(l.formatOldSum){BX("bx_catalog_set_construct_sum_old_price_"+b).innerHTML=l.formatOldSum;BX("bx_catalog_set_construct_sum_old_price_"+b).parentNode.style.display="block"}else{BX("bx_catalog_set_construct_sum_old_price_"+b).parentNode.style.display="none"}if(l.formatDiscDiffSum){BX("bx_catalog_set_construct_sum_diff_price_"+b).innerHTML=l.formatDiscDiffSum;BX("bx_catalog_set_construct_sum_diff_price_"+b).parentNode.style.display="block"}else{BX("bx_catalog_set_construct_sum_diff_price_"+b).parentNode.style.display="none"}if(!l.formatOldSum&&!l.formatDiscDiffSum){BX.addClass(BX("bx_catalog_set_construct_price_block_"+b),"not_sale")}else{BX.removeClass(BX("bx_catalog_set_construct_price_block_"+b),"not_sale")}})};catalogSetConstructPopup.prototype.catalogSetAdd=function(f,b){if(!b){b=BX.findChild(BX("bx_catalog_set_construct_popup_"+this.element_id),{className:"bx_kit_item_empty"},true,false)}if(b){var d=f.parentNode;var e=BX.findChild(f,{className:"bx_kit_img_container"},true,false);var h=BX.findChild(f,{className:"bx_kit_item_title"},true,false);var a=h.getAttribute("data-item-id");var c=BX.findChild(f,{className:"bx_kit_item_price"},true,false);var g=this;var k=BX.create("DIV",{props:{className:"bx_kit_item_del"},events:{click:function(){g.catalogSetDelete(this.parentNode)}}});var j=BX.create("DIV",{props:{className:"bx_kit_item_children bx_kit_item_border"},children:[e,h,c,k]});b.appendChild(j);BX.removeClass(b,"bx_kit_item_empty bx_kit_item_border");if(BX.hasClass(f,"discount")){BX.addClass(b,"discount");var i=BX.findChild(d,{className:"bx_kit_item_discount"},true,false);b.appendChild(i)}BX.remove(d);this.recountSlider("add");this.recountPrices();this.catalogSetIds.push(a)}};catalogSetConstructPopup.prototype.catalogSetDelete=function(j){var n=j.parentNode;var g=BX.findChild(j,{className:"bx_kit_img_container"},true,false);var m=BX.findChild(j,{className:"bx_kit_item_title"},true,false);var c=m.getAttribute("data-item-id");var d=BX.findChild(j,{className:"bx_kit_item_price"},true,false);var k=this;var e=BX.create("DIV",{props:{className:"bx_kit_item_add"},events:{click:function(){k.catalogSetAdd(this.parentNode)}}});var a=BX.hasClass(n,"discount")?" discount":"";var p=BX.create("DIV",{props:{className:"bx_kit_item bx_kit_item_border"+a},children:[g,m,d,e]});var b=[];b.push(p);if(a){var o=BX.findChild(n,{className:"bx_kit_item_discount"},true,false);b.push(o)}var q=BX.create("DIV",{props:{className:"bx_kit_item_slider bx_drag_obj"},children:b});q.setAttribute("data-main-element-id",this.element_id);q.onbxdragstart=catalogSetConstructDragStart;q.onbxdrag=catalogSetConstructDragMove;q.onbxdraghover=catalogSetConstructDragHover;q.onbxdraghout=catalogSetConstructDragOut;q.onbxdragrelease=catalogSetConstructDragRelease;jsDD.registerObject(q);BX("bx_catalog_set_construct_slider_"+this.element_id).appendChild(q);n.innerHTML="";BX.addClass(n,"bx_kit_item_empty bx_kit_item_border");BX.removeClass(n,"discount");this.recountSlider("delete");this.recountPrices();for(var h=0,f=this.catalogSetIds.length;h<f;h++){if(this.catalogSetIds[h]==c){this.catalogSetIds.splice(h,1)}}};catalogSetConstructPopup.prototype.Add2Basket=function(){var b=this.detail_img;var a=this.element_id;BX.ajax.post(this.ajaxPath,{sessid:BX.bitrix_sessid(),action:"catalogSetAdd2Basket",set_ids:this.catalogSetIds,itemsRatio:this.items_ratio,lid:this.lid,iblockId:BX.message("setIblockId"),setOffersCartProps:BX.message("setOffersCartProps")},function(c){BX.CatalogSetConstructor.popup.close();showCatalogSetAdd2BasketPopup(b,a)})};function showCatalogSetAdd2BasketPopup(b,a){update_small_basket()}function catalogSetConstructDragStart(){var a=this.offsetWidth+"px";var b=this.offsetHeight+"px";this.style.width="100%";BX.firstChild(this).style.height=b;BX.addClass(BX.firstChild(this),"bx_kit_item_slider_drag");BX.removeClass(BX.firstChild(this),"bx_kit_item");window.bxcatalogset=document.body.appendChild(BX.create("DIV",{style:{position:"absolute",zIndex:"2000",height:b,width:a},children:[this]}))}function catalogSetConstructDragMove(a,b){window.bxcatalogset.style.left=a-(this.clientWidth/2)+"px";window.bxcatalogset.style.top=b-(this.clientHeight/2)+"px"}function catalogSetConstructDragHover(b,a,c){if(BX.hasClass(b,"bx_kit_item_empty")){b.style.border="1px solid grey"}}function catalogSetConstructDragOut(b,a,c){if(BX.hasClass(b,"bx_kit_item_empty")){b.style.border=""}}function catalogSetConstructDragRelease(){this.style.width=catalogSetPopupObj.catalogSetItemsWidth+"%";var a=this.getAttribute("data-main-element-id");BX.addClass(BX.firstChild(this),"bx_kit_item");BX("bx_catalog_set_construct_slider_"+a).appendChild(this);BX.remove(window.bxcatalogset);window.bxcatalogset=null}function catalogSetConstructDestFinish(b,a,c){if(BX.hasClass(this,"bx_kit_item_empty")){this.style.border="";catalogSetPopupObj.catalogSetAdd(BX.firstChild(b),this);BX.remove(b);BX.removeClass(this,"bx_kit_item_empty");BX.remove(window.bxcatalogset);window.bxcatalogset=null;jsDD.refreshDestArea();return true}else{return false}};