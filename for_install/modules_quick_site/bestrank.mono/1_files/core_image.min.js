(function(){if(window.BX.CImageView){return}BX.viewImage=function(c,b,j,f,g){g=g||{};g.cycle=false;g.list=[{image:c,height:j,width:b,title:f}];var d=new BX.CImageView(g);d.show();return d};BX.viewImageBind=function(b,g,d,f){var c=new BX.CImageView(g);if(!d){d={tag:"IMG"}}BX.ready(function(){a(b,d,f,c)});return c};function a(c,b,f,d){var c=BX(c);if(!!c){BX.bindDelegate(c,"click",b,function(e){var m=c;if(!!f){m=BX.findParent(this,f,c)||m}var t=BX.findChildren(m,b,true),k=[],j=false;for(var i=0;i<t.length;i++){var g={thumb:t[i].src,image:t[i].getAttribute("data-bx-image"),width:t[i].getAttribute("data-bx-width"),height:t[i].getAttribute("data-bx-height"),full:t[i].getAttribute("data-bx-full"),full_width:t[i].getAttribute("data-bx-full-width"),full_height:t[i].getAttribute("data-bx-full-height"),full_size:t[i].getAttribute("data-bx-full-size"),title:t[i].getAttribute("data-bx-title")||t[i].alt||t[i].title};var q=t[i].parentNode.tagName.toUpperCase()=="A"&&!!t[i].parentNode.href;if(q){g.image=g.image||t[i].parentNode.href;g.title=g.title||t[i].parentNode.title;g.width=t[i].parentNode.getAttribute("data-bx-width");g.height=t[i].parentNode.getAttribute("data-bx-height");g.full=g.full||t[i].parentNode.getAttribute("data-bx-full");if(!!g.full){g.full_width=g.full_width||t[i].parentNode.getAttribute("data-bx-full-width");g.full_height=g.full_height||t[i].parentNode.getAttribute("data-bx-full-height");g.full_size=g.full_size||t[i].parentNode.getAttribute("data-bx-full-size")}g.title=g.title||t[i].parentNode.getAttribute("data-bx-title")||t[i].parentNode.alt||t[i].parentNode.title}g.image=g.image||g.thumb;if(t[i]==this){j=g.image}if(!!g.image){k.push(g)}}var s=this.parentNode.tagName.toUpperCase()=="A"&&!!this.parentNode.href,v=s&&!!j&&this.parentNode.href!=j;if(!v){d.setList(k);d.show(this.getAttribute("data-bx-image")||this.src);if(s){return BX.PreventDefault(e)}}})}}BX.CImageView=function(c){this.params=BX.clone(BX.CImageView.defaultSettings);for(var b in c){this.params[b]=c[b]}this.DIV=null;this.OVERLAY=null;this.IMAGE_WRAP=null;this.IMAGE=BX.create("IMG",{props:{className:"bx-images-viewer-image"},events:{load:BX.proxy(this.adjustPos,this),click:BX.proxy(this.next,this)}});this.list=this.params.list;this.list_preload=[];this._current=0;this.bVisible=false};BX.CImageView.defaultSettings={list:[],cycle:true,resize:"WH",resizeToggle:false,showTitle:true,preload:1,minMargin:20,minPadding:12,lockScroll:false,keyMap:{27:"close",33:"prev",37:"prev",38:"prev",34:"next",39:"next",40:"next",32:"next"}};BX.CImageView.prototype._create=function(){if(!this.DIV){var c=BX.browser.IsIE()&&!BX.browser.IsDoctype()?"A":"SPAN",b=c=="A"?"javascript:void(0)":null;this.OVERLAY=document.body.appendChild(BX.create("DIV",{props:{className:"bx-images-viewer-overlay"},events:{click:BX.proxy(this._hide,this)}}));this.DIV=this.OVERLAY.appendChild(BX.create("DIV",{props:{className:"bx-images-viewer-wrap-outer"},events:{click:BX.eventCancelBubble},children:[this.PREV_LINK=BX.create(c,{props:{className:"bx-images-viewer-prev-outer",href:b},events:{click:BX.proxy(this.prev,this)},html:'<span class="bx-images-viewer-prev"></span>'}),this.NEXT_LINK=BX.create(c,{props:{className:"bx-images-viewer-next-outer",href:b},events:{click:BX.proxy(this.next,this)},html:'<span class="bx-images-viewer-next"></span>'}),this.IMAGE_TITLE=BX.create("DIV",{style:{bottom:"0"},props:{className:"bx-images-viewer-title"}}),BX.create("DIV",{props:{className:"bx-images-viewer-wrap-inner"},style:{padding:this.params.minPadding+"px"},children:[this.IMAGE_WRAP=BX.create("DIV",{props:{className:"bx-images-viewer-wrap"},children:[this.IMAGE]})]}),BX.create(c,{props:{className:"bx-images-viewer-close",href:b},events:{click:BX.proxy(this._hide,this)},html:'<span class="bx-images-viewer-close-inner"></span>'})]}));if(!!this.params.resizeToggle){this.IMAGE_WRAP.appendChild(BX.create("SPAN",{props:{className:"bx-images-viewer-size-toggle"},style:{right:this.params.minPadding+"px",bottom:this.params.minPadding+"px"},events:{click:BX.proxy(this._toggle_resize,this)}}))}}};BX.CImageView.prototype._keypress=function(c){var b=(c||window.event).keyCode||(c||window.event).charCode;if(!!this.params.keyMap&&!!this.params.keyMap[b]&&!!this[this.params.keyMap[b]]){this[this.params.keyMap[b]].apply(this);return BX.PreventDefault(c)}};BX.CImageView.prototype._toggle_resize=function(){var b=this.params.resize;this.params.resize=this.params.resizeToggle;this.params.resizeToggle=b;if(this.params.resize!="WH"){this.params.lockScroll=true;this._lock_scroll()}else{this.params.lockScroll=false;this._unlock_scroll()}this.adjustSize();this.adjustPos()};BX.CImageView.prototype.adjustPos=function(){if(this.list[this._current].height>0&&this.list[this._current].width>0){this._adjustPosByImg()}else{if(!this.IMAGE_WRAP.style.height){this.IMAGE_WRAP.style.height="100px"}if(!this.IMAGE_WRAP.style.width){this.IMAGE_WRAP.style.width="100px"}setTimeout(BX.proxy(this._adjustPosByImg,this),250)}};BX.CImageView.prototype._adjustPosByImg=function(){if(this.bVisible){var c=BX.GetWindowSize(),b=parseInt((c.innerHeight-parseInt(this.IMAGE_WRAP.style.height)-2*this.params.minPadding)/2),d=parseInt((c.innerWidth-parseInt(this.IMAGE_WRAP.style.width)-2*this.params.minPadding)/2);if(!this.params.lockScroll&&c.innerWidth<c.scrollHeight){d-=20}if(b<this.params.minMargin){b=this.params.minMargin}if(d<this.params.minMargin+Math.min(70,this.PREV_LINK.offsetWidth)){d=this.params.minMargin+Math.min(70,this.PREV_LINK.offsetWidth)}if(this.params.showTitle&&!!this.list[this._current].title){b-=20}this.DIV.style.top=b+"px";this.DIV.style.left=d+"px"}};BX.CImageView.prototype.adjustSize=function(){var c=BX.GetWindowSize(),b=this.list[this._current];if(!!b.height&&!!b.width){if(!this.params.lockScroll&&c.innerWidth<c.scrollHeight){c.innerWidth-=20}c.innerWidth-=this.params.minMargin*2+this.params.minPadding*2+Math.min(140,this.PREV_LINK.offsetWidth+this.NEXT_LINK.offsetWidth);c.innerHeight-=this.params.minMargin*2+this.params.minPadding*2;if(this.params.showTitle&&!!this.list[this._current].title){c.innerHeight-=40}var j=b.height,f=b.width,g=[1];if(this.params.resize){if(this.params.resize.indexOf("W")>=0){g.push(c.innerWidth/f)}if(this.params.resize.indexOf("H")>=0){g.push(c.innerHeight/j)}}g=Math.min.apply(window,g);j*=g;f*=g;this.IMAGE_WRAP.style.height=parseInt(j)+"px";this.IMAGE_WRAP.style.width=parseInt(f)+"px";if(BX.browser.IsIE()){var d=parseInt(this.IMAGE_WRAP.style.height)+this.params.minPadding*2;this.PREV_LINK.style.height=this.NEXT_LINK.style.height=d+"px";this.PREV_LINK.firstChild.style.top=this.NEXT_LINK.firstChild.style.top=parseInt(d/2-20)+"px"}}};BX.CImageView.prototype._lock_scroll=function(){if(this.params.lockScroll){BX.addClass(document.body,"bx-images-viewer-lock-scroll")}};BX.CImageView.prototype._unlock_scroll=function(){if(this.params.lockScroll){BX.removeClass(document.body,"bx-images-viewer-lock-scroll")}};BX.CImageView.prototype._unhide=function(){this.bVisible=true;this.DIV.style.display="block";this.OVERLAY.style.display="block";this.PREV_LINK.style.display=this.list.length>1&&(this.params.cycle||this._current>0)?"block":"none";this.NEXT_LINK.style.display=this.list.length>1&&(this.params.cycle||this._current<this.list.length-1)?"block":"none";this.adjustPos();BX.unbind(document,"keydown",BX.proxy(this._keypress,this));BX.unbind(window,"resize",BX.proxy(this.adjustSize,this));BX.unbind(window,"resize",BX.proxy(this.adjustPos,this));BX.bind(document,"keydown",BX.proxy(this._keypress,this));BX.bind(window,"resize",BX.proxy(this.adjustSize,this));BX.bind(window,"resize",BX.proxy(this.adjustPos,this));this._lock_scroll()};BX.CImageView.prototype._hide=function(){this.bVisible=false;this.DIV.style.display="none";this.OVERLAY.style.display="none";BX.unbind(document,"keydown",BX.proxy(this._keypress,this));BX.unbind(window,"resize",BX.proxy(this.adjustSize,this));BX.unbind(window,"resize",BX.proxy(this.adjustPos,this));this._unlock_scroll();BX.onCustomEvent(this,"onImageViewClose",[this.list[this._current]])};BX.CImageView.prototype.add=function(b){this.list.push(b)};BX.CImageView.prototype.setList=function(c){this.list=[];this.list_preload=[];if(!!c&&BX.type.isArray(c)){for(var b=0;b<c.length;b++){this.add(c[b])}}if(this.bVisible){if(this.list.length>0){this.show()}else{this.close()}}};BX.CImageView.prototype.show=function(c){var b=this._current;if(BX.type.isElementNode(c)){c=c.getAttribute("src")}if(typeof c=="object"&&(!!c.image||!!c.thumb)){c=c.image||c.thumb}if(BX.type.isString(c)){for(var d=0;d<this.list.length;d++){if(this.list[d].image==c||this.list[d].thumb==c){b=d;break}}}c=this.list[b];if(!c){return}this._current=b;this._create();this.IMAGE.style.opacity=0;this.adjustSize();if(!this.list_preload[this._current]){BX.addClass(this.IMAGE_WRAP,"bx-images-viewer-wrap-loading");this.list_preload[this._current]=new Image;this.list_preload[this._current].bxloaded=false;this.list_preload[this._current].onload=this._get_image_onload();this.list_preload[this._current].src=c.image;BX.defer(function(){if(this.list_preload[this._current].width>0||this.list_preload[this._current].height>0){this.IMAGE.onload=null;this.IMAGE.style.opacity=1}},this)()}else{if(this.list_preload[this._current].bxloaded){setTimeout(BX.delegate(this.list_preload[this._current].onload,this.list_preload[this._current]),350)}}setTimeout(BX.proxy(this._check_title,this),300);this._unhide();BX.onCustomEvent(this,"onImageViewShow",[c])};BX.CImageView.prototype._check_title=function(){this.IMAGE_TITLE.innerHTML="";if(this.params.showTitle&&this.list[this._current].title||this.list[this._current].full){var c=0,b=0,f={style:{opacity:"1"},children:[]};if(this.params.showTitle&&this.list[this._current].title){f.children.push(BX.create("DIV",{props:{className:"bx-images-viewer-title-item"},text:this.list[this._current].title}));c+=35;b+=35}if(this.list[this._current].full){var d=[];if(this.list[this._current].full_height&&this.list[this._current].full_width){d.push(this.list[this._current].full_width+"x"+this.list[this._current].full_height)}if(this.list[this._current].full_size){d.push(this.list[this._current].full_size)}html='<a href="'+this.list[this._current].full+'" class="bx-images-viewer-full-link" target="_blank">'+BX.message("JS_CORE_IMAGE_FULL")+(d.length>0?" ("+d.join(", ")+")":"")+"</a>";f.children.push(BX.create("DIV",{props:{className:"bx-images-viewer-title-item bx-images-viewer-full"},html:html}));c+=35;b+=35}f.style.height=c+"px";f.style.bottom=-b+"px";BX.adjust(this.IMAGE_TITLE,f)}else{this.IMAGE_TITLE.style.opacity="0";this.IMAGE_TITLE.style.bottom="0";this.IMAGE_TITLE.style.height="0"}};BX.CImageView.prototype._get_image_onload=function(b){b=typeof b=="undefined"?this._current:b;return BX.delegate(function(){BX.proxy_context.bxloaded=true;if(b==this._current){var c=this.list[this._current];BX.removeClass(this.IMAGE_WRAP,"bx-images-viewer-wrap-loading");this.IMAGE.onload=function(){this.onload=null;this.style.opacity=1};this.IMAGE.src=BX.proxy_context.src;if(BX.proxy_context.width){c.width=BX.proxy_context.width}if(BX.proxy_context.height){c.height=BX.proxy_context.height}this.adjustSize();this.adjustPos();BX.defer(this._preload,this)()}BX.onCustomEvent(this,"onImageViewLoad",[this.list[b],b==this._current])},this)};BX.CImageView.prototype._preload=function(){if(this.params.preload>0){var c=Math.max(this._current-this.params.preload,this.params.cycle?-1000:0),b=Math.min(this._current+this.params.preload,this.params.cycle?this.list.length+1000:this.list.length-1);if(c<b){for(var f=b;f>=c;f--){var d=f;if(d<0){d+=this.list.length}else{if(d>=this.list.length){d-=this.list.length}}if(!this.list_preload[d]){this.list_preload[d]=new Image;this.list_preload[d].src=this.list[d].image;this.list_preload[d].onload=this._get_image_onload(d)}}}}};BX.CImageView.prototype.next=function(){if(this.list.length>1){this._current++;if(this._current>=this.list.length){if(!!this.params.cycle){this._current=0}else{this._current--}BX.onCustomEvent(this,"onImageViewFinishList",[this.list[this._current],1])}this.show()}};BX.CImageView.prototype.prev=function(){if(this.list.length>1){this._current--;if(this._current<0){if(!!this.params.cycle){this._current=this.list.length-1}else{this._current++}BX.onCustomEvent(this,"onImageViewFinishList",[this.list[this._current],-1])}this.show()}};BX.CImageView.prototype.close=function(){this._hide()}})(window);