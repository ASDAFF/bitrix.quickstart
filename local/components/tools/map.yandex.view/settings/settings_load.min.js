function CBXYandexPoint(b){var a=this;this.DATA={LON:0,LAT:0,TEXT:""};this.PLACEMARK=null;this.VIEW=null;this.EDIT_CONTROL=null;this.onCreate=null;this.onDelete=null;this.__updatePointPosition=function(){var c=this.getGeoPoint();a.DATA.LON=c.getLng();a.DATA.LAT=c.getLat()};this.Delete=function(c){if(null!=a.VIEW&&null!=a.VIEW.parentNode){a.VIEW.parentNode.removeChild(a.VIEW)}jsYandexCE.map.removeOverlay(a.PLACEMARK);a.PLACEMARK=null;if(null!=a.onDelete){a.onDelete(a)}return BX.PreventDefault(c)};this.Edit=function(c){if(null==c){c=BX.GetContext(this).event}if(a.PLACEMARK._balloonVisible){a.PLACEMARK.closeBalloon()}else{a.PLACEMARK.openBalloon();a.EDIT_CONTROL.focus()}if(null!=c){return BX.PreventDefault(c)}};this.__updateView=function(d){if(null==d){d=BX.GetContext(this).event}value=this.value;a.DATA.TEXT=value;var c=value.indexOf("\n");var f="";if(value.length>0){f=c<=0?value:value.substring(0,c)}f=f.replace(/</g,"&lt;");f=f.replace(/>/g,"&gt;");a.__updateViewText(f?f:window.jsYandexMess.noname);a.PLACEMARK.setIconContent(f);if(d.type=="blur"){a.PLACEMARK.closeBalloon()}return BX.PreventDefault(d)};if(null!=b){this.Create(b)}}CBXYandexPoint.prototype.__point_link_hover=function(){this.style.backgroundColor="#E3E8F7";this.firstChild.style.display="block"};CBXYandexPoint.prototype.__point_link_hout=function(){this.style.backgroundColor="#FFFFFF";this.firstChild.style.display="none"};CBXYandexPoint.prototype.__updateViewText=function(a){this.VIEW.firstChild.nextSibling.innerHTML=a};CBXYandexPoint.prototype.getData=function(){return this.DATA};CBXYandexPoint.prototype.Create=function(b){this.DATA.TEXT=b.TEXT;this.DATA.LAT=b.LAT;this.DATA.LON=b.LON;this.PLACEMARK=new jsYandexCE.context.YMaps.Placemark(new jsYandexCE.context.YMaps.GeoPoint(this.DATA.LON,this.DATA.LAT),{draggable:1});this.PLACEMARK.setBalloonContent(this.__createEditForm());this.__createView();var c="";if(this.DATA.TEXT.length>0){var a=this.DATA.TEXT.indexOf("\n");c=a<=0?this.DATA.TEXT:this.DATA.TEXT.substring(0,a);c=c.replace(/>/g,"&gt;");c=c.replace(/</g,"&lt;")}this.__updateViewText(c?c:window.jsYandexMess.noname);this.PLACEMARK.setIconContent(c);jsYandexCE.context.YMaps.Events.observe(this.PLACEMARK,this.PLACEMARK.Events.DragEnd,this.__updatePointPosition);jsYandexCE.map.addOverlay(this.PLACEMARK);if(null!==this.onCreate){this.onCreate(this)}return this.PLACEMARK};CBXYandexPoint.prototype.__createEditForm=function(){this.EDIT_CONTROL=jsYandexCE.context.document.createElement("TEXTAREA");this.EDIT_CONTROL.value=this.DATA.TEXT;this.EDIT_CONTROL.onkeyup=this.__updateView;this.EDIT_CONTROL.onblur=this.__updateView;return this.EDIT_CONTROL};CBXYandexPoint.prototype.__createView=function(){this.VIEW=document.getElementById("bx_yandex_points").appendChild(document.createElement("LI"));var a=this.VIEW.appendChild(document.createElement("A"));a.href="javascript: void(0)";a.className="bx-yandex-delete";a.onclick=this.Delete;a.style.display="none";var b=this.VIEW.appendChild(document.createElement("A"));b.className="bx-yandex-point";b.href="javascript:void(0)";b.onclick=this.Edit;b.innerHTML=window.jsYandexMess.noname;this.VIEW.onmouseover=this.__point_link_hover;this.VIEW.onmouseout=this.__point_link_hout};function CBXYandexPoly(b){var a=this;this.DATA={POINTS:[],TITLE:"",STYLE:{}};this.POLYLINE=null;this.VIEW=null;this.EDIT_CONTROL=null;this.STYLE=null;this.STYLE_ID=null;this.START_POINT=null;this.END_POINT=null;this.ClickObserver=null;this.bFinished=false;this.onFinish=null;this.onDelete=null;this.Finish=function(c){if(!jsYandexCE.bAddPolyMode){return}a.bFinished=true;if(null!=a.ClickObserver){a.ClickObserver.cleanup()}jsYandexCE.map.removeOverlay(a.START_POINT);if(null==a.POLYLINE){a.Delete()}else{a.END_POINT.setIconContent(jsYandexMess.poly_settings)}if(null!=a.onFinish){a.onFinish(a)}};this.__addPoint=function(c){if(!jsYandexCE.bAddPolyMode){return}if(null==a.END_POINT){a.END_POINT=new jsYandexCE.context.YMaps.Placemark(c.getGeoPoint());a.END_POINT.setIconContent(jsYandexMess.poly_finish);jsYandexCE.context.YMaps.Events.observe(a.END_POINT,a.END_POINT.Events.Click,a.Finish);jsYandexCE.map.addOverlay(a.END_POINT)}else{a.END_POINT.setGeoPoint(c.getGeoPoint())}if(a.DATA.POINTS.length<=0){a.DATA.POINTS=[a.START_POINT.getGeoPoint(),c.getGeoPoint()]}if(null!==a.POLYLINE){a.POLYLINE.splice(a.DATA.POINTS.length,0,c.getGeoPoint());a.__updateViewText(jsYandexMess.noname)}else{a.setStyle();a.prepareSettingsForm();a.POLYLINE=new jsYandexCE.context.YMaps.Polyline(a.DATA.POINTS,{style:a.STYLE_ID,clickable:false});jsYandexCE.map.addOverlay(a.POLYLINE);a.__createView()}};this.Start=function(c){a.START_POINT=new jsYandexCE.context.YMaps.Placemark(c);a.START_POINT.setIconContent(jsYandexMess.poly_start_point);jsYandexCE.map.addOverlay(a.START_POINT);a.ClickObserver=jsYandexCE.context.YMaps.Events.observe(jsYandexCE.map,jsYandexCE.map.Events.Click,a.__addPoint)};this.showSettingsForm=function(c){if(!a.bFinished){a.Finish()}if(a.END_POINT._balloonVisible){a.END_POINT.closeBalloon()}else{jsYandexCE.map.addOverlay(a.END_POINT);a.END_POINT.openBalloon()}return BX.PreventDefault(c)};this.Delete=function(c){if(null!=a.VIEW&&null!=a.VIEW.parentNode){a.VIEW.parentNode.removeChild(a.VIEW)}if(null!=a.POLYLINE){jsYandexCE.map.removeOverlay(a.POLYLINE)}jsYandexCE.map.removeOverlay(a.START_POINT);if(null!=a.END_POINT){jsYandexCE.map.removeOverlay(a.END_POINT)}a.POLYLINE=null;if(!a.bFinished){a.Finish()}if(null!=a.onDelete){a.onDelete(a)}return BX.PreventDefault(c)};if(null!=b){this.Create(b)}}CBXYandexPoly.prototype.__poly_link_hover=function(){this.style.backgroundColor="#E3E8F7";this.firstChild.style.display="block"};CBXYandexPoly.prototype.__poly_link_hout=function(){this.style.backgroundColor="#FFFFFF";this.firstChild.style.display="none"};CBXYandexPoly.prototype.__updateViewText=function(a){this.VIEW.firstChild.nextSibling.innerHTML=a+" ("+this.DATA.POINTS.length+")"};CBXYandexPoly.prototype.getData=function(){var c={POINTS:[],TITLE:"",STYLE:{}};for(var b=0,a=this.DATA.POINTS.length;b<a;b++){c.POINTS[b]={LAT:this.DATA.POINTS[b].getLat(),LON:this.DATA.POINTS[b].getLng()}}c.TITLE=this.DATA.TITLE;c.STYLE={lineStyle:{strokeColor:this.STYLE.lineStyle.strokeColor,strokeWidth:this.STYLE.lineStyle.strokeWidth}};return c};CBXYandexPoly.prototype.Create=function(c){this.DATA.POINTS=[];for(var b=0,a=c.POINTS.length;b<a;b++){this.DATA.POINTS[b]=new jsYandexCE.context.YMaps.GeoPoint(c.POINTS[b].LON,c.POINTS[b].LAT)}if(null!=c.STYLE&&null!=c.STYLE.lineStyle){this.DATA.STYLE.lineStyle=c.STYLE.lineStyle}this.DATA.TITLE=c.TITLE;this.START_POINT=new jsYandexCE.context.YMaps.Placemark(new jsYandexCE.context.YMaps.GeoPoint(c.POINTS[0].LON,c.POINTS[0].LAT));this.END_POINT=new jsYandexCE.context.YMaps.Placemark(new jsYandexCE.context.YMaps.GeoPoint(c.POINTS[c.POINTS.length-1].LON,c.POINTS[c.POINTS.length-1].LAT));this.END_POINT.setIconContent(this.DATA.TITLE?this.DATA.TITLE:jsYandexMess.poly_settings);jsYandexCE.map.addOverlay(this.END_POINT);this.setStyle();this.POLYLINE=new jsYandexCE.context.YMaps.Polyline(this.DATA.POINTS,{style:this.STYLE_ID,clickable:true});this.prepareSettingsForm();jsYandexCE.map.addOverlay(this.POLYLINE);this.__createView();this.setTitle()};CBXYandexPoly.prototype.__createView=function(){this.VIEW=document.getElementById("bx_yandex_polylines").appendChild(document.createElement("LI"));var a=this.VIEW.appendChild(document.createElement("A"));a.href="javascript: void(0)";a.className="bx-yandex-delete";a.onclick=this.Delete;a.style.display="none";var b=this.VIEW.appendChild(document.createElement("A"));b.className="bx-yandex-poly";b.href="javascript:void(0)";b.onclick=this.showSettingsForm;b.innerHTML=window.jsYandexMess.noname+" ("+this.DATA.POINTS.length+")";this.VIEW.onmouseover=this.__poly_link_hover;this.VIEW.onmouseout=this.__poly_link_hout;return this.VIEW};CBXYandexPoly.prototype.prepareSettingsForm=function(){var c=this;this.EDIT_CONTROL=jsYandexCE.context.document.createElement("FORM");this.END_POINT.setBalloonContent(this.EDIT_CONTROL);this.EDIT_CONTROL.BX_POLYLINE=this;var b=jsYandexCE.context.document.createElement("DIV");this.EDIT_CONTROL.appendChild(b);this.COLORPICKER=new jsYandexCE.context.BXColorPicker({id:"CP_bx_yandex_ce",name:window.jsYandexMess.poly_opt_color,OnSelect:function(d){if(!d){d="FF0000"}else{d=d.substring(1)}c.EDIT_CONTROL.elements[1].value=d;c.setStyle("color",d,c.EDIT_CONTROL.elements[0])}});b.innerHTML="<b>"+window.jsYandexMess.poly_opt_header+'</b><br /><br /><table class="bx-yandex-poly-settings"><tr><td><span style="font-size: 11px;">'+window.jsYandexMess.poly_opt_title+'</span></td><td><input type="text" value="" style="width: 125px;" onkeyup="this.form.BX_POLYLINE.setTitle(this.value)" /></td></tr><tr><td><span style="font-size: 11px;">'+window.jsYandexMess.poly_opt_color+'</span></td><td><input type="text" value="'+this.STYLE.lineStyle.strokeColor.substring(0,6)+'" style="width: 100px; float: left;" onkeyup="this.form.BX_POLYLINE.setStyle(\'color\', this.value, this)" /></td></tr><tr><td><span style="font-size: 11px;">'+window.jsYandexMess.poly_opt_width+'</span></td><td><input type="text" value="'+this.STYLE.lineStyle.strokeWidth+'"  style="width: 125px;"onkeyup="this.form.BX_POLYLINE.setStyle(\'width\', this.value, this)" /></td></tr><tr><td><span style="font-size: 11px;">'+window.jsYandexMess.poly_opt_opacity+'</span></td><td><input type="text" value="'+Math.round(parseInt("0x"+this.STYLE.lineStyle.strokeColor.substring(6))/2.55)+'" style="width: 125px;"onkeyup="this.form.BX_POLYLINE.setStyle(\'opacity\', this.value, this)" /></td></tr></table>';if(null!=this.DATA.TITLE){this.EDIT_CONTROL.elements[0].value=this.DATA.TITLE}try{this.EDIT_CONTROL.elements[1].parentNode.appendChild(this.COLORPICKER.pCont)}catch(a){this.EDIT_CONTROL.elements[1].style.width="125px"}};CBXYandexPoly.prototype.setTitle=function(b){if(null!=b){this.DATA.TITLE=b}else{b=this.DATA.TITLE}this.END_POINT.setIconContent(b);var c="";if(this.DATA.TITLE.length>0){var a=this.DATA.TITLE.indexOf("\n");c=a<=0?this.DATA.TITLE:this.DATA.TITLE.substring(0,a);c=c.replace(/>/g,"&gt;");c=c.replace(/</g,"&lt;")}this.__updateViewText(c?c:window.jsYandexMess.noname)};CBXYandexPoly.prototype.setStyle=function(d,c,b){if(null==this.STYLE){this.STYLE=new jsYandexCE.context.YMaps.Style();this.STYLE.lineStyle=new jsYandexCE.context.YMaps.LineStyle();this.STYLE.lineStyle.strokeColor=this.DATA.STYLE.lineStyle==null?"FF00007F":this.DATA.STYLE.lineStyle.strokeColor;this.STYLE.lineStyle.strokeWidth=this.DATA.STYLE.lineStyle==null?"3":this.DATA.STYLE.lineStyle.strokeWidth;this.STYLE_ID="bitrix#line_"+Math.random();jsYandexCE.context.YMaps.Styles.add(this.STYLE_ID,this.STYLE)}var a=false;if(null!=d&&null!=c){switch(d){case"color":if(/^[A-F0-9]{6}$/i.test(c)){this.STYLE.lineStyle.strokeColor=c+this.STYLE.lineStyle.strokeColor.substring(6)}else{a=true}break;case"width":c=parseInt(c);if(isNaN(c)){a=true}else{this.STYLE.lineStyle.strokeWidth=c}break;case"opacity":c=parseInt(c);if(!isNaN(c)&&c>=0&&c<=100){c=Math.round(c*2.55).toString(16).toUpperCase();this.STYLE.lineStyle.strokeColor=this.STYLE.lineStyle.strokeColor.substring(0,6)+c}else{a=true}break}if(null!=b){if(a){b.style.backgroundColor="FFB0B0"}else{b.style.backgroundColor="white"}}if(!a&&null!=this.POLYLINE){this.DATA.STYLE=this.STYLE.lineStyle;jsYandexCE.map.removeOverlay(this.POLYLINE);this.POLYLINE.setStyle(this.STYLE_ID);jsYandexCE.map.addOverlay(this.POLYLINE)}}};var jsYandexCE={map:null,arData:{},obForm:null,currentView:"",bPositionFixed:true,bAddPointMode:false,bAddPolyMode:false,DblClickObserver:null,ClickObserver:null,onInitCompleted:null,bInitCompleted:false,bInitScriptsLoaded:false,__arValidKeys:["yandex_lat","yandex_lon","yandex_scale","PLACEMARKS","LON","LAT","TEXT","POLYLINES","POINTS","STYLE","lineStyle","strokeColor","strokeWidth","TITLE"],__currentPolyLine:null,__currentPolyLineObject:null,init:function(f){if(null!=f){jsYandexCE.map=f}jsYandexCE.context=jsYandexCE.map.bx_context;jsYandexCE.context.BX=window.BX;var d=jsYandexCE.context.document.getElementsByTagName("HEAD")[0];var a=["/bitrix/components/bitrix/map.yandex.system/templates/.default/style.css","/bitrix/components/bitrix/map.yandex.view/settings/settings_iframe.css"];for(var c=0;c<a.length;c++){var g=jsYandexCE.context.document.createElement("LINK");g.href=a[c];g.rel="stylesheet";g.type="text/css";d.appendChild(g)}jsYandexCE.context.BX.loadScript("/bitrix/components/bitrix/main.colorpicker/templates/.default/script.js",function(){top.jsYandexCE.bInitScriptsLoaded=true;top.jsYandexCE.checkInitCompleted()},jsYandexCE.context.document);jsYandexCE.context.jsColorPickerMess=window.jsColorPickerMess;jsYandexCE.obForm=document.forms.bx_popup_form_yandex_map;jsYandexCE.obForm.onsubmit=jsYandexCE.__saveChanges;jsYandexCE.context.YMaps.Events.observe(jsYandexCE.map,jsYandexCE.map.Events.Move,jsYandexCE.__getPositionValues);jsYandexCE.context.YMaps.Events.observe(jsYandexCE.map,jsYandexCE.map.Events.Update,jsYandexCE.__getPositionValues);jsYandexCE.context.YMaps.Events.observe(jsYandexCE.map,jsYandexCE.map.Events.ChangeType,jsYandexCE.__getPositionValues);if(!jsYandexCE.arData.yandex_lat||!jsYandexCE.arData.yandex_lon||!jsYandexCE.arData.yandex_scale){var b=jsYandexCE.map.getCenter();jsYandexCE.arData.yandex_lat=b.getLat();jsYandexCE.arData.yandex_lon=b.getLng();jsYandexCE.arData.yandex_scale=jsYandexCE.map.getZoom();jsYandexCE.bPositionFixed=false}else{jsYandexCE.bPositionFixed=true}jsYandexCE.setControlValue("yandex_lat",jsYandexCE.arData.yandex_lat);jsYandexCE.setControlValue("yandex_lon",jsYandexCE.arData.yandex_lon);jsYandexCE.setControlValue("yandex_scale",jsYandexCE.arData.yandex_scale);jsYandexCE.currentView=jsYandexMess.current_view;var e=jsYandexCE.map.getType();jsYandexCE.setControlValue("yandex_view",e.getName());document.getElementById("bx_restore_position").onclick=jsYandexCE.restorePositionValues;document.getElementById("bx_yandex_position_fix").onclick=function(){jsYandexCE.setFixedFlag(this.checked)};jsYandexCE.setFixedFlag(document.getElementById("bx_yandex_position_fix").defaultChecked);document.getElementById("bx_yandex_map_controls").style.visibility="visible";document.getElementById("bx_yandex_map_address_search").style.visibility="visible";jsYandexCE.bInitCompleted=true;jsYandexCE.checkInitCompleted()},checkInitCompleted:function(){if(jsYandexCE.bInitCompleted&&jsYandexCE.bInitScriptsLoaded){if(jsYandexCE.onInitCompleted){jsYandexCE.onInitCompleted()}return true}else{return false}},__getPositionValues:function(){if(jsYandexCE.bPositionFixed){return}var a=jsYandexCE.map.getCenter();jsYandexCE.arData.yandex_lat=a.getLat();jsYandexCE.arData.yandex_lon=a.getLng();jsYandexCE.arData.yandex_scale=jsYandexCE.map.getZoom();jsYandexCE.setControlValue("yandex_lat",jsYandexCE.arData.yandex_lat);jsYandexCE.setControlValue("yandex_lon",jsYandexCE.arData.yandex_lon);jsYandexCE.setControlValue("yandex_scale",jsYandexCE.arData.yandex_scale);var b=jsYandexCE.map.getType();jsYandexCE.currentView=(b==jsYandexCE.context.YMaps.MapType.HYBRID?"HYBRID":(b==jsYandexCE.context.YMaps.MapType.SATELLITE?"SATELLITE":"MAP"));jsYandexCE.setControlValue("yandex_view",b.getName())},restorePositionValues:function(a){BX.PreventDefault(a);if(jsYandexCE.currentView&&jsYandexCE.context.YMaps.MapType[jsYandexCE.currentView]){jsYandexCE.map.setType(jsYandexCE.context.YMaps.MapType[jsYandexCE.currentView])}jsYandexCE.map.setZoom(jsYandexCE.arData.yandex_scale);jsYandexCE.map.panTo(new jsYandexCE.context.YMaps.GeoPoint(jsYandexCE.arData.yandex_lon,jsYandexCE.arData.yandex_lat));return BX.PreventDefault(a)},setFixedFlag:function(a){jsYandexCE.bPositionFixed=a;if(!a){jsYandexCE.__getPositionValues()}},setControlValue:function(d,c){var b=jsYandexCE.obForm["bx_"+d];if(null!=b){b.value=c}var a=document.getElementById("bx_"+d+"_value");if(null!=a){a.innerHTML=c}},addPoint:function(){if(!jsYandexCE.bAddPointMode){if(jsYandexCE.bAddPolyMode){jsYandexCE.addPolyline()}jsYandexCE.bAddPointMode=true;jsYandexCE.map.disableDblClickZoom();document.getElementById("bx_yandex_addpoint_link").style.display="none";document.getElementById("bx_yandex_addpoint_message").style.display="block";jsYandexCE.DblClickObserver=jsYandexCE.context.YMaps.Events.observe(jsYandexCE.map,jsYandexCE.map.Events.DblClick,jsYandexCE.__addPoint)}else{jsYandexCE.bAddPointMode=false;jsYandexCE.map.enableDblClickZoom();document.getElementById("bx_yandex_addpoint_link").style.display="block";document.getElementById("bx_yandex_addpoint_message").style.display="none";jsYandexCE.DblClickObserver.cleanup()}},addPolyline:function(){if(jsYandexCE.bAddPolyMode){if(null!=jsYandexCE.arData.POLYLINES&&jsYandexCE.arData.POLYLINES.length>0&&!jsYandexCE.arData.POLYLINES[jsYandexCE.arData.POLYLINES.length-1].bFinished){jsYandexCE.arData.POLYLINES[jsYandexCE.arData.POLYLINES.length-1].Finish()}jsYandexCE.bAddPolyMode=false;jsYandexCE.map.enableDblClickZoom();document.getElementById("bx_yandex_addpoly_link").style.display="block";document.getElementById("bx_yandex_addpoly_message").style.display="none";document.getElementById("bx_yandex_addpoly_message1").style.display="none";jsYandexCE.DblClickObserver.cleanup()}else{if(jsYandexCE.bAddPointMode){jsYandexCE.addPoint()}jsYandexCE.bAddPolyMode=true;jsYandexCE.map.disableDblClickZoom();document.getElementById("bx_yandex_addpoly_link").style.display="none";document.getElementById("bx_yandex_addpoly_message").style.display="block";jsYandexCE.DblClickObserver=jsYandexCE.context.YMaps.Events.observe(jsYandexCE.map,jsYandexCE.map.Events.DblClick,jsYandexCE.__startPoly)}},addCustomPoint:function(a){if(null==jsYandexCE.arData.PLACEMARKS){jsYandexCE.arData.PLACEMARKS=[]}var b=jsYandexCE.arData.PLACEMARKS.length;jsYandexCE.arData.PLACEMARKS[b]=new CBXYandexPoint({TEXT:a.TEXT,LON:a.LON,LAT:a.LAT});jsYandexCE.arData.PLACEMARKS[b].onDelete=function(){jsYandexCE.arData.PLACEMARKS[b].DELETED=1};return b},addCustomPoly:function(b){if(null==jsYandexCE.arData.POLYLINES){jsYandexCE.arData.POLYLINES=[]}var a=jsYandexCE.arData.POLYLINES.length;jsYandexCE.arData.POLYLINES[a]=new CBXYandexPoly(b);jsYandexCE.arData.POLYLINES[a].onDelete=function(){jsYandexCE.arData.POLYLINES[a].DELETED=1};return a},__addPoint:function(c){if(!jsYandexCE.bAddPointMode){return}var b=c.getGeoPoint();var a=jsYandexCE.addCustomPoint({TEXT:"",LON:b.getLng(),LAT:b.getLat()});jsYandexCE.arData.PLACEMARKS[a].Edit()},__startPoly:function(b){if(!jsYandexCE.bAddPolyMode){return}if(null==jsYandexCE.arData.POLYLINES){jsYandexCE.arData.POLYLINES=[]}jsYandexCE.DblClickObserver.cleanup();document.getElementById("bx_yandex_addpoly_message").style.display="none";document.getElementById("bx_yandex_addpoly_message1").style.display="block";var a=jsYandexCE.arData.POLYLINES.length;jsYandexCE.arData.POLYLINES[a]=new CBXYandexPoly();jsYandexCE.arData.POLYLINES[a].Start(b.getGeoPoint());jsYandexCE.arData.POLYLINES[a].onFinish=function(){document.getElementById("bx_yandex_addpoly_message").style.display="block";document.getElementById("bx_yandex_addpoly_message1").style.display="none";jsYandexCE.DblClickObserver=jsYandexCE.context.YMaps.Events.observe(jsYandexCE.map,jsYandexCE.map.Events.DblClick,jsYandexCE.__startPoly)};jsYandexCE.arData.POLYLINES[a].onDelete=function(){jsYandexCE.arData.POLYLINES[a].DELETED=1}},__checkValidKey:function(c){if(Number(c)==c){return true}for(var b=0,a=jsYandexCE.__arValidKeys.length;b<a;b++){if(jsYandexCE.__arValidKeys[b]==c){return true}}return false},__serialize:function(d){if(typeof(d)=="object"){var f="",b=0;for(var a in d){if(jsYandexCE.__checkValidKey(a)){++b;f+=jsYandexCE.__serialize(a)+jsYandexCE.__serialize(d[a])}}f="a:"+b+":{"+f+"}";return f}else{if(typeof(d)=="boolean"){return"b:"+(d?1:0)+";"}else{if(null==d){return"N;"}else{if(Number(d)==d&&d!=""&&d!=" "){if(Math.floor(d)==d){return"i:"+d+";"}else{return"d:"+d+";"}}else{if(typeof(d)=="string"){d=d.replace(/\r\n/g,"\n");d=d.replace(/\n/g,"###RN###");var e=0;if(window._global_BX_UTF){for(var c=0,b=d.length;c<b;c++){if(d.charCodeAt(c)>127){e++}}}return"s:"+(d.length+e)+':"'+d+'";'}}}}}},__saveChanges:function(){if(!jsYandexCE.map){return false}jsYandexCE.bAddPointMode=false;var b={yandex_lat:jsYandexCE.arData.yandex_lat,yandex_lon:jsYandexCE.arData.yandex_lon,yandex_scale:jsYandexCE.arData.yandex_scale};if(jsYandexCE.arData.PLACEMARKS){b.PLACEMARKS=[];for(var c=0,a=jsYandexCE.arData.PLACEMARKS.length;c<a;c++){if(null==jsYandexCE.arData.PLACEMARKS[c].DELETED){b.PLACEMARKS[b.PLACEMARKS.length]=jsYandexCE.arData.PLACEMARKS[c].getData()}}}if(jsYandexCE.arData.POLYLINES){b.POLYLINES=[];for(var c=0,a=jsYandexCE.arData.POLYLINES.length;c<a;c++){if(null==jsYandexCE.arData.POLYLINES[c].DELETED&&null!=jsYandexCE.arData.POLYLINES[c].POLYLINE){b.POLYLINES[b.POLYLINES.length]=jsYandexCE.arData.POLYLINES[c].getData()}}}window.jsYandexCEOpener.saveData(jsYandexCE.__serialize(b),jsYandexCE.currentView);return false},clear:function(){jsYandexCE.bInitCompleted=false;jsYandexCE.bInitScriptsLoaded=false;jsYandexCE.bAddPointMode=false;jsYandexCE.bAddPolyMode=false;if(null!=jsYandexCE.arData.PLACEMARKS&&jsYandexCE.arData.PLACEMARKS.length>0){for(var b=0,a=jsYandexCE.arData.PLACEMARKS.length;b<a;b++){jsYandexCE.arData.PLACEMARKS[b].Delete();jsYandexCE.arData.PLACEMARKS[b]=null}jsYandexCE.arData.PLACEMARKS=[]}if(null!=jsYandexCE.arData.POLYLINES&&jsYandexCE.arData.POLYLINES.length>0){for(var b=0,a=jsYandexCE.arData.POLYLINES.length;b<a;b++){jsYandexCE.arData.POLYLINES[b].Delete();jsYandexCE.arData.POLYLINES[b]=null}jsYandexCE.arData.POLYLINES=[]}jsYandexCE.map=null}};var jsYandexCESearch={bInited:false,map:null,geocoder:null,obInput:null,timerID:null,timerDelay:1000,arSearchResults:[],obOut:null,__init:function(a){if(jsYandexCESearch.bInited){return}jsYandexCESearch.map=jsYandexCE.map;jsYandexCESearch.obInput=a;a.form.onsubmit=function(){jsYandexCESearch.doSearch();return false};a.onfocus=jsYandexCESearch.showResults;a.onblur=jsYandexCESearch.hideResults;jsYandexCESearch.bInited=true},setTypingStarted:function(a){if(!jsYandexCESearch.bInited){jsYandexCESearch.__init(a)}jsYandexCESearch.hideResults();if(null!=jsYandexCESearch.timerID){clearTimeout(jsYandexCESearch.timerID)}jsYandexCESearch.timerID=setTimeout(jsYandexCESearch.doSearch,jsYandexCESearch.timerDelay)},doSearch:function(){var a=BX.util.trim(jsYandexCESearch.obInput.value);if(a.length>1){var b=new jsYandexCE.context.YMaps.Geocoder(a);jsYandexCE.context.YMaps.Events.observe(b,b.Events.Load,jsYandexCESearch.__searchResultsLoad);jsYandexCE.context.YMaps.Events.observe(b,b.Events.Fault,jsYandexCESearch.handleError)}},handleError:function(a){alert(this.jsMess.mess_error+": "+a.message)},__generateOutput:function(){var a=BX.pos(jsYandexCESearch.obInput);jsYandexCESearch.obOut=document.body.appendChild(document.createElement("UL"));jsYandexCESearch.obOut.className="bx-yandex-address-search-results";jsYandexCESearch.obOut.style.top=(a.bottom+2)+"px";jsYandexCESearch.obOut.style.left=a.left+"px";jsYandexCESearch.obOut.style.zIndex=parseInt(BX.WindowManager.Get().zIndex)+200},__searchResultsLoad:function(d){var f=jsYandexCESearch;if(null==f.obOut){f.__generateOutput()}f.obOut.innerHTML="";f.clearSearchResults();if(len=d.length()){for(var c=0;c<len;c++){f.arSearchResults[c]=d.get(c);var b=document.createElement("LI");if(c==0){b.className="bx-yandex-first"}var e=document.createElement("A");e.href="javascript:void(0)";var a=e.appendChild(document.createElement("SPAN"));a.appendChild(document.createTextNode(f.arSearchResults[c].text));e.BXSearchIndex=c;e.onclick=f.__showSearchResult;b.appendChild(e);f.obOut.appendChild(b)}}else{f.obOut.innerHTML='<li class="bx-yandex-notfound">'+window.jsYandexMess.nothing_found+"</li>"}f.showResults()},__showSearchResult:function(a){if(null!==this.BXSearchIndex){jsYandexCESearch.map.panTo(jsYandexCESearch.arSearchResults[this.BXSearchIndex].getGeoPoint());jsYandexCESearch.map.redraw()}return BX.PreventDefault(a)},showResults:function(){if(null!=jsYandexCESearch.obOut){jsYandexCESearch.obOut.style.display="block"}},hideResults:function(){if(null!=jsYandexCESearch.obOut){setTimeout("jsYandexCESearch.obOut.style.display = 'none'",300)}},clearSearchResults:function(){for(var a=0;a<jsYandexCESearch.arSearchResults.length;a++){delete jsYandexCESearch.arSearchResults[a]}jsYandexCESearch.arSearchResults=[]},clear:function(){if(!jsYandexCESearch.bInited){return}jsYandexCESearch.bInited=false;if(null!=jsYandexCESearch.obOut){jsYandexCESearch.obOut.parentNode.removeChild(jsYandexCESearch.obOut);jsYandexCESearch.obOut=null}jsYandexCESearch.arSearchResults=[];jsYandexCESearch.map=null;jsYandexCESearch.geocoder=null;jsYandexCESearch.obInput=null;jsYandexCESearch.timerID=null}};