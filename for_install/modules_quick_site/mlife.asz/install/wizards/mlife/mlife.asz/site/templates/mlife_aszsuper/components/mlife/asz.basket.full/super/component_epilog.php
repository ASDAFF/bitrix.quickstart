<?if(!defined("B_PROLOG_INCLUDED") || B_PROLOG_INCLUDED!==true) die();?><?global $APPLICATION;?><?if($_REQUEST['ajaxrefresh']!=1){?><script>$(document).ready(function(){		function refreshBasket(){		$.ajax({			url: '<?=$APPLICATION->GetCurPage(false)?>',			data: {ajaxrefresh:'1'},			dataType : "html",			success: function (data, textStatus) {				$('.mlfSmallcart').trigger('refreshBasket');				$('.basketWrap').html(data);			}		});	}		function createPopupDiv(content){				$('body').append('<div id="popup" class="corzMessage"><div class="wrapFixerPopup">\		<div class="content">'+content+'</div>\		<div class="button b-close"><a href="#"><?=GetMessage("MLIFE_ASZ_CATALOG_CLOSER")?></a></div></div></div>');			}		$(document).on('click','.b-close',function(e){		e.preventDefault();		$("#popup").hide().remove();	});		$(document).on('click','.basketItems a.delete',function(e){		e.preventDefault();		var bid = $(this).attr('data-id');		var p_name = $("tr#p"+bid+" .name .itemName").text();		$('.basketWrap').append('<div class="preload"><div class="load"></div></div>');		$.ajax({			 url: '<?=$APPLICATION->GetCurPage(false)?>',			 data: {ajax:'1',action:'basket_delete', bid: bid},			 dataType : "html",			 success: function (data, textStatus) {				if(data != 'ok'){					$('.preload').remove();										var cnt = "";					cnt += '<div class="tovarName">'+p_name+'</div>\					<div class="wrapMess">'+data+'</div>\					';					createPopupDiv(cnt);									}else{					refreshBasket();				}			}		});	});	$(document).on('click','.basketItems a.minus, .basketItems a.update, .basketItems a.plus',function(e){		e.preventDefault();		var bid = $(this).attr('data-id');		var pid = $(this).attr('data-prod');		var p_name = $("tr#p"+bid+" .name .itemName").text();		var quant = 1;		if($(this).hasClass('minus')){			quant = parseInt($('tr#p'+bid+' .quant input').val()) - 1;		}else if($(this).hasClass('plus')){			quant = parseInt($('tr#p'+bid+' .quant input').val()) + 1;		}else if($(this).hasClass('update')){			quant = parseInt($('tr#p'+bid+' .quant input').val());		}		$('.basketWrap').append('<div class="preload"><div class="load"></div></div>');		if(quant==0) {			$.ajax({				 url: '<?=$APPLICATION->GetCurPage(false)?>',				 data: {ajax:'1',action:'basket_delete', bid: bid},				 dataType : "html",				 success: function (data, textStatus) {					if(data != 'ok'){						$('.preload').remove();						var cnt = "";						cnt += '<div class="tovarName">'+p_name+'</div>\						<div class="wrapMess">'+data+'</div>\						';						createPopupDiv(cnt);					}else{						refreshBasket();					}				}			});		}else{			$.ajax({				 url: '<?=$APPLICATION->GetCurPage(false)?>',				 data: {ajax:'1',action:'basket_update', bid: bid, prodid: pid, quant: quant},				 dataType : "html",				 success: function (data, textStatus) {					if(data != 'ok'){						$('.preload').remove();						var cnt = "";						cnt += '<div class="tovarName">'+p_name+'</div>\						<div class="wrapMess">'+data+'</div>\						';						createPopupDiv(cnt);					}else{						refreshBasket();					}				}			});		}	});		$(document).on('click','.deliveryItems .image img',function(e){		e.preventDefault();		var bid = $(this).attr('data-id');		$('#DELIVERY_ID').val(bid);		$('#ajaxrefresh').val('1');		$('.basketWrap').append('<div class="preload"><div class="load"></div></div>');		$.ajax({			 url: '<?=$APPLICATION->GetCurPage(false)?>',			 data: $("#orderForm").serialize(),			 type: "POST",			 dataType : "html",			 success: function (data, textStatus) {				$('.basketWrap').html(data);			}		});	});		$(document).on('click','.paymentItems .image img',function(e){		e.preventDefault();		var bid = $(this).attr('data-id');		$('#PAYMENT_ID').val(bid);		$('#ajaxrefresh').val('1');		$('.basketWrap').append('<div class="preload"><div class="load"></div></div>');		$.ajax({			 url: '<?=$APPLICATION->GetCurPage(false)?>',			 data: $("#orderForm").serialize(),			 type: "POST",			 dataType : "html",			 success: function (data, textStatus) {				$('.basketWrap').html(data);			}		});	});		$(document).on('click','.basketWrap .buttons a',function(e){		e.preventDefault();		var bid = $(this).attr('data-id');		$('#ajaxrefresh').val('1');		$('#orderfin').val('1');		$('.basketWrap').append('<div class="preload"><div class="load"></div></div>');		$.ajax({			 url: '<?=$APPLICATION->GetCurPage(false)?>',			 data: $("#orderForm").serialize(),			 type: "POST",			 dataType : "html",			 success: function (data, textStatus) {				$('.basketWrap').html(data);			}		});	});	<?if($arParams["PROP_LOCATION"]){?>	$(document).on('change','#user_<?=$arParams["PROP_LOCATION"]?>',function(e){		e.preventDefault();		$('#ajaxrefresh').val('1');		$('.basketWrap').append('<div class="preload"><div class="load"></div></div>');		$.ajax({			 url: '<?=$APPLICATION->GetCurPage(false)?>',			 data: $("#orderForm").serialize(),			 type: "POST",			 dataType : "html",			 success: function (data, textStatus) {				$('.basketWrap').html(data);			}		});	});	<?}?>	});</script><?}?>