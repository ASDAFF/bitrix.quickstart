(function(f){if(f.BX.localStorage){return}var c=f.BX,g=null,j=null,a="_bxCurrentKey",h=false;c.localStorage=function(){this.keyChanges={};c.bind((c.browser.IsIE()&&!c.browser.IsIE9())?document:f,"storage",c.proxy(this._onchange,this));setInterval(c.delegate(this._clear,this),5000)};c.localStorage.checkBrowser=function(){return h};c.localStorage.set=function(k,l,e){return c.localStorage.instance().set(k,l,e)};c.localStorage.get=function(e){return c.localStorage.instance().get(e)};c.localStorage.remove=function(e){return c.localStorage.instance().remove(e)};c.localStorage.instance=function(){if(!g){var e=c.localStorage.checkBrowser();if(e=="native"){g=new c.localStorage()}else{if(e=="ie8"){g=new c.localStorageIE8()}else{if(e=="ie7"){g=new c.localStorageIE7()}else{g={set:c.DoNothing,get:function(){return null},remove:c.DoNothing}}}}}return g};c.localStorage.prototype.prefix=function(){if(!j){j="bx"+c.message("USER_ID")+"-"+(c.message("SITE_ID")||"admin")+"-"}return j};c.localStorage.prototype._onchange=function(k){k=k||f.event;if(!k.key){return}if(c.browser.DetectIeVersion()>0&&this.keyChanges[k.key]){this.keyChanges[k.key]=false;return}if(!!k.key&&k.key.substring(0,this.prefix().length)==this.prefix()){var l={key:k.key.substring(this.prefix().length,k.key.length),value:!!k.newValue?this._decode(k.newValue.substring(11,k.newValue.length)):null,oldValue:!!k.oldValue?this._decode(k.oldValue.substring(11,k.oldValue.length)):null};switch(l.key){case"BXGCE":if(l.value){c.onCustomEvent(l.value.e,l.value.p)}break;default:if(k.newValue){c.onCustomEvent(f,"onLocalStorageSet",[l])}if(k.oldValue&&!k.newValue){c.onCustomEvent(f,"onLocalStorageRemove",[l])}c.onCustomEvent(f,"onLocalStorageChange",[l]);break}}};c.localStorage.prototype._clear=function(){var k=+new Date(),m,l;for(l=0;l<localStorage.length;l++){m=localStorage.key(l);if(m.substring(0,2)=="bx"){var e=localStorage.getItem(m).split(":",1)*1000;if(k>=e){localStorage.removeItem(m)}}}};c.localStorage.prototype._encode=function(e){if(typeof(e)=="object"){e=JSON.stringify(e)}else{e=e.toString()}return e};c.localStorage.prototype._decode=function(l){var k=null;if(!!l){try{k=JSON.parse(l)}catch(m){k=l}}return k};c.localStorage.prototype._trigger_error=function(n,l,m,k){c.onCustomEvent(this,"onLocalStorageError",[n,{key:l,value:m,ttl:k}])};c.localStorage.prototype.set=function(l,m,k){if(!k||k<=0){k=60}if(l==undefined||l==null||m==undefined){return false}this.keyChanges[this.prefix()+l]=true;try{localStorage.setItem(this.prefix()+l,(Math.round((+new Date())/1000)+k)+":"+this._encode(m))}catch(n){this._trigger_error(n,l,m,k)}};c.localStorage.prototype.get=function(k){var l=localStorage.getItem(this.prefix()+k);if(l){var e=l.split(":",1)*1000;if((+new Date())<=e){l=l.substring(11,l.length);return this._decode(l)}}return null};c.localStorage.prototype.remove=function(e){this.keyChanges[this.prefix()+e]=true;localStorage.removeItem(this.prefix()+e)};c.localStorageIE7=function(){this.NS="BXLocalStorage";this.__current_state={};this.keyChanges={};c.ready(c.delegate(this._Init,this))};c.extend(c.localStorageIE7,c.localStorage);c.localStorageIE7.prototype._Init=function(){this.storage_element=document.body.appendChild(c.create("DIV"));this.storage_element.addBehavior("#default#userData");this.storage_element.load(this.NS);var n=this.storage_element.xmlDocument,e=n.firstChild.attributes.length;for(var m=0;m<e;m++){if(!!n.firstChild.attributes[m]){var l=n.firstChild.attributes[m].nodeName;if(l.substring(0,this.prefix().length)==this.prefix()){this.__current_state[l]=n.firstChild.attributes[m].nodeValue}}}setInterval(c.delegate(this._Listener,this),500);setInterval(c.delegate(this._clear,this),5000)};c.localStorageIE7.prototype._Listener=function(l){this.storage_element.load(this.NS);var r=this.storage_element.xmlDocument,e=r.firstChild.attributes.length,q,o,n;var p={},m=[];for(q=0;q<e;q++){if(!!r.firstChild.attributes[q]){o=r.firstChild.attributes[q].nodeName;if(o.substring(0,this.prefix().length)==this.prefix()){n=r.firstChild.attributes[q].nodeValue;if(this.__current_state[o]!=n){m.push({key:o,newValue:n,oldValue:this.__current_state[o]})}p[o]=n;delete this.__current_state[o]}}}for(q in this.__current_state){if(this.__current_state.hasOwnProperty(q)){m.push({key:q,newValue:undefined,oldValue:this.__current_state[q]})}}this.__current_state=p;for(q=0;q<m.length;q++){this._onchange(m[q])}};c.localStorageIE7.prototype._clear=function(){this.storage_element.load(this.NS);var q=this.storage_element.xmlDocument,l=q.firstChild.attributes.length,o=+new Date(),p,n,m,e;for(p=0;p<l;p++){if(!!q.firstChild.attributes[p]){n=q.firstChild.attributes[p].nodeName;if(n.substring(0,2)=="bx"){m=q.firstChild.attributes[p].nodeValue;e=m.split(":",1)*1000;if(o>=e){q.firstChild.removeAttribute(n)}}}}this.storage_element.save(this.NS)};c.localStorageIE7.prototype.set=function(l,m,k){if(!k||k<=0){k=60}try{this.storage_element.load(this.NS);var o=this.storage_element.xmlDocument;this.keyChanges[this.prefix()+l]=true;o.firstChild.setAttribute(this.prefix()+l,(Math.round((+new Date())/1000)+k)+":"+this._encode(m));this.storage_element.save(this.NS)}catch(n){this._trigger_error(n,l,m,k)}};c.localStorageIE7.prototype.get=function(k){this.storage_element.load(this.NS);var m=this.storage_element.xmlDocument;var l=m.firstChild.getAttribute(this.prefix()+k);if(l){var e=l.split(":",1)*1000;if((+new Date())<=e){l=l.substring(11,l.length);return this._decode(l)}}return null};c.localStorageIE7.prototype.remove=function(e){this.storage_element.load(this.NS);var k=this.storage_element.xmlDocument;k.firstChild.removeAttribute(this.prefix()+e);this.keyChanges[this.prefix()+e]=true;this.storage_element.save(this.NS)};c.localStorageIE8=function(){this.key=a;this.currentKey=null;this.currentValue=null;c.localStorageIE8.superclass.constructor.apply(this)};c.extend(c.localStorageIE8,c.localStorage);c.localStorageIE8.prototype._onchange=function(k){if(null==this.currentKey){this.currentKey=localStorage.getItem(this.key);if(this.currentKey){this.currentValue=localStorage.getItem(this.prefix()+this.currentKey)}}else{k={key:this.prefix()+this.currentKey,newValue:localStorage.getItem(this.prefix()+this.currentKey),oldValue:this.currentValue};this.currentKey=null;this.currentValue=null;if(this.keyChanges[k.key]){this.keyChanges[k.key]=false;return}c.localStorageIE8.superclass._onchange.apply(this,[k])}};c.localStorageIE8.prototype.set=function(l,m,k){this.currentKey=null;this.keyChanges[this.prefix()+l]=true;try{localStorage.setItem(this.key,l);c.localStorageIE8.superclass.set.apply(this,arguments)}catch(n){this._trigger_error(n,l,m,k)}};c.localStorageIE8.prototype.remove=function(e){this.currentKey=null;this.keyChanges[this.prefix()+e]=true;localStorage.setItem(this.key,e);c.localStorageIE8.superclass.remove.apply(this,arguments)};c.onGlobalCustomEvent=function(l,e,k){if(!!c.localStorage.checkBrowser()){c.localStorage.set("BXGCE",{e:l,p:e},1)}if(!k){c.onCustomEvent(l,e)}};try{h=!!localStorage.setItem}catch(d){}if(h){h="native";var b=(c.browser.IsIE()&&!c.browser.IsIE9())?document:f,i=function(k){if(typeof(k||f.event).key=="undefined"){h="ie8"}c.unbind(b,"storage",i);c.localStorage.instance()};c.bind(b,"storage",i);localStorage.setItem(a,null)}else{if(c.browser.IsIE7()){h="ie7";c.localStorage.instance()}}})(window);