if(!BXRS){var BXRS={};var BXRSW={}}Rating=function(d,g,c,a,f,e,i,b,h){this.enabled=true;this.voteId=d;this.entityTypeId=g;this.entityId=c;this.available=a=="Y"?true:false;this.userId=f;this.localize=e;this.template=i;this.light=i=="light"?true:false;this.pathToUserProfile=b;this.pathToAjax=typeof(h)=="string"?h:"/bitrix/components/bitrix/rating.vote/vote.ajax.php";this.box=i=="light"?BX("bx-rating-"+d):BX("rating-vote-"+d);if(this.box===null){this.enabled=false;return false}if(!this.light){this.buttonPlus=BX("rating-vote-"+d+"-plus");this.buttonMinus=BX("rating-vote-"+d+"-minus");this.result=BX("rating-vote-"+d+"-result")}else{this.buttonPlus=BX.findChild(this.box,{className:"bx-rating-yes"},true,false);this.buttonMinus=BX.findChild(this.box,{className:"bx-rating-no"},true,false);this.buttonPlusCount=BX.findChild(this.buttonPlus,{className:"bx-rating-yes-count"},true,false);this.buttonMinusCount=BX.findChild(this.buttonMinus,{className:"bx-rating-no-count"},true,false);this.buttonPlusText=BX.findChild(this.buttonPlus,{className:"bx-rating-yes-text"},true,false);this.buttonMinusText=BX.findChild(this.buttonMinus,{className:"bx-rating-no-text"},true,false);this.popupPlus=null;this.popupMinus=null;this.popupTimeoutId=null;this.popupContentPlus=BX.findChild(BX("bx-rating-popup-cont-"+d+"-plus"),{tagName:"span",className:"bx-ilike-popup"},true,false);this.popupContentMinus=BX.findChild(BX("bx-rating-popup-cont-"+d+"-minus"),{tagName:"span",className:"bx-ilike-popup"},true,false);this.popupContentPagePlus=1;this.popupContentPageMinus=1;this.popupListProcess=false;this.popupTimeout=false}this.voteProcess=false};Rating.Set=function(e,h,d,a,g,f,j,c,i){if(j===undefined){j="standart"}if(!BXRS[e]||BXRS[e].tryToSet<=5){var b=BXRS[e]&&BXRS[e].tryToSet?BXRS[e].tryToSet:1;BXRS[e]=new Rating(e,h,d,a,g,f,j,c,i);if(BXRS[e].enabled){Rating.Init(e)}else{setTimeout(function(){BXRS[e].tryToSet=b+1;Rating.Set(e,h,d,a,g,f,j,c,i)},500)}}};Rating.Init=function(a){if(BXRS[a].available){BX.bind(BXRS[a].light?BXRS[a].buttonPlusText:BXRS[a].buttonPlus,"click",function(){if(BXRS[a].voteProcess){return false}BXRS[a].voteProcess=true;BX.addClass(BXRS[a].buttonPlus,BXRS[a].light?"bx-rating-load":"rating-vote-load");if(BX.hasClass(BXRS[a].buttonPlus,BXRS[a].light?"bx-rating-yes-active":"rating-vote-plus-active")){Rating.Vote(a,"plus","cancel")}else{Rating.Vote(a,"plus","plus")}return false});BX.bind(BXRS[a].buttonPlus,"mouseover",function(){BX.addClass(this,BXRS[a].light?"bx-rating-hover":"rating-vote-hover")});BX.bind(BXRS[a].buttonPlus,"mouseout",function(){BX.removeClass(this,BXRS[a].light?"bx-rating-hover":"rating-vote-hover")});if(false&&BXRS[a].light){Rating.PopupScroll(a,"plus");BX.bind(BXRS[a].buttonPlus,"mouseover",function(){clearTimeout(BXRS[a].popupTimeoutId);BXRS[a].popupTimeoutId=setTimeout(function(){if(BXRSW.plus==a){return false}if(BXRS[a].popupContentPagePlus==1){Rating.List(a,1,"plus")}BXRS[a].popupTimeoutId=setTimeout(function(){Rating.OpenWindow(a,"plus")},1000)},400)});BX.bind(BXRS[a].buttonPlus,"mouseout",function(){clearTimeout(BXRS[a].popupTimeoutId);BXRS[a].popupTimeout=setTimeout(function(){if(BXRS[a].popupPlus!==null){BXRS[a].popupPlus.close();BXRSW.plus=null}},1000)});BX.bind(BXRS[a].buttonPlusCount,"click",function(){clearTimeout(BXRS[a].popupTimeoutId);if(BXRS[a].popupContentPagePlus==1){Rating.List(a,1,"plus")}Rating.OpenWindow(a,"plus")});BX.bind(BXRS[a].buttonPlusCount,"mouseover",function(){clearTimeout(BXRS[a].popupTimeout)});BX.bind(BXRS[a].buttonPlusText,"mouseover",function(){clearTimeout(BXRS[a].popupTimeout)})}BX.bind(BXRS[a].light?BXRS[a].buttonMinusText:BXRS[a].buttonMinus,"click",function(){if(BXRS[a].voteProcess){return false}BXRS[a].voteProcess=true;BX.addClass(BXRS[a].buttonMinus,BXRS[a].light?"bx-rating-load":"rating-vote-load");if(BX.hasClass(BXRS[a].buttonMinus,BXRS[a].light?"bx-rating-no-active":"rating-vote-minus-active")){Rating.Vote(a,"minus","cancel")}else{Rating.Vote(a,"minus","minus")}return false});BX.bind(BXRS[a].buttonMinus,"mouseover",function(){BX.addClass(this,BXRS[a].light?"bx-rating-hover":"rating-vote-hover")});BX.bind(BXRS[a].buttonMinus,"mouseout",function(){BX.removeClass(this,BXRS[a].light?"bx-rating-hover":"rating-vote-hover")});if(false&&BXRS[a].light){Rating.PopupScroll(a,"minus");BX.bind(BXRS[a].buttonMinus,"mouseover",function(){clearTimeout(BXRS[a].popupTimeoutId);BXRS[a].popupTimeoutId=setTimeout(function(){if(BXRSW.minus==a){return false}if(BXRS[a].popupContentPageMinus==1){Rating.List(a,1,"minus")}BXRS[a].popupTimeoutId=setTimeout(function(){Rating.OpenWindow(a,"minus")},1000)},400)});BX.bind(BXRS[a].buttonMinus,"mouseout",function(){clearTimeout(BXRS[a].popupTimeoutId);BXRS[a].popupTimeout=setTimeout(function(){if(BXRS[a].popupMinus!==null){BXRS[a].popupMinus.close();BXRSW.minus=null}},1000)});BX.bind(BXRS[a].buttonMinusCount,"click",function(){clearTimeout(BXRS[a].popupTimeoutId);if(BXRS[a].popupContentPageMinus==1){Rating.List(a,1,"minus")}Rating.OpenWindow(a,"minus")});BX.bind(BXRS[a].buttonMinusCount,"mouseover",function(){clearTimeout(BXRS[a].popupTimeout)});BX.bind(BXRS[a].buttonMinusText,"mouseover",function(){clearTimeout(BXRS[a].popupTimeout)})}}};Rating.UpdateStatus=function(c,a,b){BXRS[c].buttonPlus.title=(b=="cancel"||a=="minus"?BXRS[c].localize.PLUS:BXRS[c].localize.CANCEL);BXRS[c].buttonMinus.title=(b=="cancel"||a=="plus"?BXRS[c].localize.MINUS:BXRS[c].localize.CANCEL);BX.removeClass(BXRS[c].buttonPlus,BXRS[c].light?(a=="plus"?"bx-rating-load":"bx-rating-yes-active"):(a=="plus"?"rating-vote-load":"rating-vote-plus-active"));BX.removeClass(BXRS[c].buttonMinus,BXRS[c].light?(a=="plus"?"bx-rating-no-active":"bx-rating-load"):(a=="plus"?"rating-vote-minus-active":"rating-vote-load"));if(b=="cancel"){BX.removeClass(a=="plus"?BXRS[c].buttonPlus:BXRS[c].buttonMinus,BXRS[c].light?"bx-rating-"+(a=="plus"?"yes":"no")+"-active":"rating-vote-"+a+"-active")}else{BX.addClass(a=="plus"?BXRS[c].buttonPlus:BXRS[c].buttonMinus,BXRS[c].light?"bx-rating-"+(a=="plus"?"yes":"no")+"-active":"rating-vote-"+a+"-active")}};Rating.Vote=function(c,a,b){BX.ajax({url:BXRS[c].pathToAjax,method:"POST",dataType:"json",data:{RATING_VOTE:"Y",RATING_RESULT:"Y",RATING_VOTE_TYPE_ID:BXRS[c].entityTypeId,RATING_VOTE_ENTITY_ID:BXRS[c].entityId,RATING_VOTE_ACTION:b,sessid:BX.bitrix_sessid()},onsuccess:function(d){if(BXRS[c].light){BXRS[c].buttonPlusCount.innerHTML=d.resultPositiveVotes;BXRS[c].buttonMinusCount.innerHTML=d.resultNegativeVotes;if(d.action=="cancel"){BX.removeClass(BXRS[c].box,"bx-rating-active")}else{BX.addClass(BXRS[c].box,"bx-rating-active")}}else{BXRS[c].result.title=d.resultTitle;BXRS[c].result.innerHTML=d.resultValue;BX.removeClass(BXRS[c].result,d.resultStatus=="minus"?"rating-vote-result-plus":"rating-vote-result-minus");BX.addClass(BXRS[c].result,d.resultStatus=="minus"?"rating-vote-result-minus":"rating-vote-result-plus")}Rating.UpdateStatus(c,a,b);BXRS[c].voteProcess=false},onfailure:function(d){BX.removeClass(a=="minus"?BXRS[c].buttonMinus:BXRS[c].buttonPlus,BXRS[c].light?"bx-rating-load":"rating-vote-load")}});return false};Rating.OpenWindow=function(b,a){if(parseInt(a=="plus"?BXRS[b].buttonPlusCount.innerHTML:BXRS[b].buttonMinusCount.innerHTML)==0){return false}if((a=="plus"?BXRS[b].popupPlus:BXRS[b].popupMinus)==null){__popup=new BX.PopupWindow("rating-popup-"+b+"-"+a,a=="plus"?BXRS[b].buttonPlusCount:BXRS[b].buttonMinusCount,{content:BX("bx-rating-popup-cont-"+b+(a=="plus"?"-plus":"-minus")),lightShadow:true,autoHide:true,zIndex:2500});if(a=="plus"){BXRS[b].popupPlus=__popup}else{BXRS[b].popupMinus=__popup}BX.bind(BX("rating-popup-"+b+"-"+a),"mouseout",function(){clearTimeout(BXRS[b].popupTimeout);BXRS[b].popupTimeout=setTimeout(function(){if(a=="plus"){BXRS[b].popupPlus.close()}else{BXRS[b].popupMinus.close()}BXRSW[a]=null},1000)});BX.bind(BX("rating-popup-"+b+"-"+a),"mouseover",function(){clearTimeout(BXRS[b].popupTimeout)})}else{if(BX("rating-popup-"+b+"-"+a).style.display=="block"){if(a=="plus"){BXRS[b].popupPlus.close()}else{BXRS[b].popupMinus.close()}BXRSW[a]=null;return false}}if(BXRSW.plus!=null){BXRS[BXRSW.plus].popupPlus.close();BXRSW.plus=null}if(BXRSW.minus!=null){BXRS[BXRSW.minus].popupMinus.close();BXRSW.minus=null}if(a=="plus"){BXRS[b].popupPlus.show()}else{BXRS[b].popupMinus.show()}BXRSW=b;if(a=="plus"){BXRS[b].popupPlus.setAngle({position:"bottom"})}else{BXRS[b].popupMinus.setAngle({position:"bottom"})}Rating.AdjustWindow(b,a)};Rating.List=function(c,b,a){if(parseInt(a=="plus"?BXRS[c].buttonPlusCount.innerHTML:BXRS[c].buttonMinusCount.innerHTML)==0){return false}if(b==null){b=a=="plus"?BXRS[c].popupContentPagePlus:BXRS[c].popupContentPageMinus}BXRS[c].popupListProcess=true;BX.ajax({url:BXRS[c].pathToAjax,method:"POST",dataType:"json",data:{RATING_VOTE_LIST:"Y",RATING_VOTE_LIST_TYPE:a,RATING_VOTE_TYPE_ID:BXRS[c].entityTypeId,RATING_VOTE_ENTITY_ID:BXRS[c].entityId,RATING_VOTE_LIST_PAGE:b,PATH_TO_USER_PROFILE:BXRS[c].pathToUserProfile,sessid:BX.bitrix_sessid()},onsuccess:function(e){if(parseInt(e.items_page)==0){return false}if(b==1){spanTag0=document.createElement("span");spanTag0.className="bx-ilike-bottom_scroll";if(a=="plus"){BXRS[c].popupContentPlus.innerHTML="";BXRS[c].popupContentPlus.appendChild(spanTag0)}else{BXRS[c].popupContentMinus.innerHTML="";BXRS[c].popupContentMinus.appendChild(spanTag0)}}if(a=="plus"){BXRS[c].popupContentPagePlus+=1}else{BXRS[c].popupContentPageMinus+=1}for(var d in e.items){aTag=document.createElement("a");aTag.className="bx-ilike-popup-img";aTag.href=e.items[d]["URL"];aTag.target="_blank";spanTag1=document.createElement("span");spanTag1.className="bx-ilike-popup-avatar";spanTag1.innerHTML=e.items[d]["PHOTO"];aTag.appendChild(spanTag1);spanTag2=document.createElement("span");spanTag2.className="bx-ilike-popup-name";spanTag2.appendChild(document.createTextNode(BX.util.htmlspecialcharsback(e.items[d]["FULL_NAME"])));aTag.appendChild(spanTag2);if(a=="plus"){BXRS[c].popupContentPlus.appendChild(aTag)}else{BXRS[c].popupContentMinus.appendChild(aTag)}}Rating.AdjustWindow(c,a);Rating.PopupScroll(c,a);BXRS[c].popupListProcess=false},onfailure:function(d){}});return false};Rating.AdjustWindow=function(d,c){children=BX.findChild(c=="plus"?BXRS[d].popupContentPlus:BXRS[d].popupContentMinus,{className:"bx-ilike-popup-img"},true,true);if(children!==null){iOffsetHeight=BX.browser.IsIE()?5:0;for(var a in children){iOffsetHeight+=children[a].offsetHeight}}else{iOffsetHeight=BX.browser.IsIE()?35:30}if(iOffsetHeight<121){if(c=="plus"){BXRS[d].popupContentPlus.style.height=iOffsetHeight+"px"}else{BXRS[d].popupContentMinus.style.height=iOffsetHeight+"px"}}else{if(c=="plus"){BXRS[d].popupContentPlus.style.height="121px"}else{BXRS[d].popupContentMinus.style.height="121px"}}var b=5;arScroll=BX.GetWindowScrollPos();if(c=="plus"){iLeft=BXRS[d].popupPlus.bindElementPos.left-10}else{iLeft=BXRS[d].popupMinus.bindElementPos.left-10}iLeftAngle=0;if(c=="plus"){iWindow=iLeft+BXRS[d].popupPlus.popupContainer.offsetWidth}else{iWindow=iLeft+BXRS[d].popupMinus.popupContainer.offsetWidth}iBody=document.body.clientWidth+arScroll.scrollLeft;if(iWindow>iBody){iLeft=iLeft-(iWindow-iBody);if(c=="plus"){BXRS[d].popupPlus.setAngle({offset:(iWindow-iBody)+iLeftAngle})}else{BXRS[d].popupMinus.setAngle({offset:(iWindow-iBody)+iLeftAngle})}}else{if(iLeft<0){if(c=="plus"){BXRS[d].popupPlus.setAngle({offset:(iLeft)+iLeftAngle})}else{BXRS[d].popupMinus.setAngle({offset:(iLeft)+iLeftAngle})}iLeft=0}}if(c=="plus"){BX.adjust(BX("rating-popup-"+d+"-"+c),{style:{top:BXRS[d].popupPlus.bindElementPos.top-(BXRS[d].popupPlus.popupContainer.offsetHeight+b)+"px",left:iLeft+"px"}})}else{BX.adjust(BX("rating-popup-"+d+"-"+c),{style:{top:BXRS[d].popupMinus.bindElementPos.top-(BXRS[d].popupMinus.popupContainer.offsetHeight+b)+"px",left:iLeft+"px"}})}};Rating.PopupScroll=function(b,a){BX.bind(a=="plus"?BXRS[b].popupContentPlus:BXRS[b].popupContentMinus,"scroll",function(){if(this.scrollTop>(this.scrollHeight-this.offsetHeight)/1.5){Rating.List(b,null,a);BX.unbindAll(this)}})};