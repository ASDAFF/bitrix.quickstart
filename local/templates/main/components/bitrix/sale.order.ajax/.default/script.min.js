BX.saleOrderAjax={BXCallAllowed:false,options:{},indexCache:{},controls:{},modes:{},properties:{},init:function(b){var a=this;this.options=b;window.submitFormProxy=BX.proxy(function(){a.submitFormProxy.apply(a,arguments)},this);BX(function(){a.initDeferredControl()});BX(function(){a.BXCallAllowed=true});this.controls.scope=BX("bx-soa-order");BX.bindDelegate(this.controls.scope,"click",{className:"-bx-popup-set-mode-add-loc"},function(){var c=BX.create("input",{attrs:{type:"hidden",name:"PERMANENT_MODE_STEPS",value:"1"}});BX.prepend(c,BX("bx-soa-order"));a.BXCallAllowed=false;BX.Sale.OrderAjaxComponent.sendRequest()})},cleanUp:function(){for(var a in this.properties){if(this.properties.hasOwnProperty(a)){if(typeof this.properties[a].input!="undefined"){BX.unbindAll(this.properties[a].input);this.properties[a].input=null}if(typeof this.properties[a].control!="undefined"){BX.unbindAll(this.properties[a].control)}}}this.properties={}},addPropertyDesc:function(a){this.properties[a.id]=a.attributes;this.properties[a.id].id=a.id},initDeferredControl:function(){var i=this,c,j,f,g,b,d,a,h,e;if(typeof window.BX.locationsDeferred!="undefined"){this.BXCallAllowed=false;for(c in window.BX.locationsDeferred){window.BX.locationsDeferred[c].call(this);window.BX.locationsDeferred[c]=null;delete (window.BX.locationsDeferred[c]);this.properties[c].control=window.BX.locationSelectors[c];delete (window.BX.locationSelectors[c])}}for(c in this.properties){if(this.properties[c].isZip){j=this.controls.scope.querySelector('[data-property-id-row="'+c+'"]');if(BX.type.isElementNode(j)){f=j.querySelector('input[type="text"]');if(BX.type.isElementNode(f)){this.properties[c].input=f;g=false;for(b in this.properties){if(this.properties[b].type=="LOCATION"){g=b;break}}if(g!==false){BX.bindDebouncedChange(f,function(l){var k=BX("ZIP_PROPERTY_CHANGED");k&&(k.value="Y");f=null;j=null;if(BX.type.isNotEmptyString(l)&&/^\s*\d+\s*$/.test(l)&&l.length>3){i.getLocationsByZip(l,function(m){i.properties[g].control.setValueByLocationIds(m)},function(){try{}catch(m){}})}})}}}}if(this.properties[c].type=="LOCATION"){if(typeof this.properties[c].control!="undefined"){d=this.properties[c].control;a=d.getSysCode();if(typeof this.properties[c].altLocationPropId!="undefined"){if(a=="sls"){d.replaceTemplate("nothing-found",this.options.messages.notFoundPrompt)}if(a=="slst"){(function(l,m){m.setOption("pseudoValues",["other"]);m.bindEvent("control-before-display-page",function(k){m=null;var n=k.getParentValue();if(n==this.getOption("rootNodeValue")||!this.checkCanSelectItem(n)){return}var o=k.getControl();if(typeof o.vars.cache.nodes.other=="undefined"){o.fillCache([{CODE:"other",DISPLAY:i.options.messages.otherLocation,IS_PARENT:false,VALUE:"other"}],{modifyOrigin:true,modifyOriginPosition:"prepend"})}});h=BX("LOCATION_ALT_PROP_DISPLAY_MANUAL["+parseInt(l)+"]");m.bindEvent("after-select-real-value",function(){if(BX.type.isDomNode(h)){h.value="0"}});m.bindEvent("after-select-pseudo-value",function(){if(BX.type.isDomNode(h)){h.value="1"}});m.bindEvent("before-set-value",function(){if(BX.type.isDomNode(h)){h.value="0"}});if(BX.type.isDomNode(h)&&h.value=="1"){e=m.getAdapterAtPosition(m.getStackSize()-1);if(typeof e!="undefined"&&e!==null){e.setValuePair("other",i.options.messages.otherLocation)}}})(c,d)}}}}}this.BXCallAllowed=true;if(BX.Sale.OrderAjaxComponent){BX.Sale.OrderAjaxComponent.locationsCompletion()}},checkMode:function(c,d){if(d=="altLocationChoosen"){if(this.checkAbility(c,"canHaveAltLocation")){var a=this.getInputByPropId(this.properties[c].altLocationPropId);var b=this.properties[c].altLocationPropId;if(a!==false&&a.value.length>0&&!a.disabled&&this.properties[b].valueSource!="default"){return true}}}return false},checkAbility:function(a,c){if(typeof this.properties[a]=="undefined"){this.properties[a]={}}if(typeof this.properties[a].abilities=="undefined"){this.properties[a].abilities={}}if(typeof this.properties[a].abilities!="undefined"&&this.properties[a].abilities[c]){return true}if(c=="canHaveAltLocation"){if(this.properties[a].type=="LOCATION"){if(typeof this.properties[a].altLocationPropId!="undefined"&&typeof this.properties[this.properties[a].altLocationPropId]){var b=this.properties[a].altLocationPropId;if(typeof this.properties[a].control!="undefined"&&this.properties[a].control.getSysCode()=="slst"){if(this.getInputByPropId(b)!==false){this.properties[a].abilities[c]=true;return true}}}}}return false},getInputByPropId:function(b){if(typeof this.properties[b].input!="undefined"){return this.properties[b].input}var c=this.getRowByPropId(b);if(BX.type.isElementNode(c)){var a=c.querySelector('input[type="text"]');if(BX.type.isElementNode(a)){this.properties[b].input=a;return a}}return false},getRowByPropId:function(a){if(typeof this.properties[a].row!="undefined"){return this.properties[a].row}var b=this.controls.scope.querySelector('[data-property-id-row="'+a+'"]');if(BX.type.isElementNode(b)){this.properties[a].row=b;return b}return false},getAltLocPropByRealLocProp:function(a){if(typeof this.properties[a].altLocationPropId!="undefined"){return this.properties[this.properties[a].altLocationPropId]}return false},toggleProperty:function(b,a,c){var d=this.properties[b];if(typeof d.row=="undefined"){d.row=this.getRowByPropId(b)}if(typeof d.input=="undefined"){d.input=this.getInputByPropId(b)}if(!a){if(!c){BX.hide(d.row)}d.input.disabled=true}else{if(!c){BX.show(d.row)}d.input.disabled=false}},submitFormProxy:function(c,d){var b=false;for(var a in this.properties){if(typeof this.properties[a].control!="undefined"&&this.properties[a].control==d){b=a;break}}if(c!="other"){if(this.BXCallAllowed){this.BXCallAllowed=false;setTimeout(function(){BX.Sale.OrderAjaxComponent.sendRequest()},20)}}},getPreviousAdapterSelectedNode:function(e,a){var b=a.getIndex();var f=e.getAdapterAtPosition(b-1);if(typeof f!=="undefined"&&f!=null){var d=f.getControl().getValue();if(typeof d!="undefined"){var c=e.getNodeByValue(d);if(typeof c!="undefined"){return c}return false}}return false},getLocationsByZip:function(c,a,d){if(typeof this.indexCache[c]!="undefined"){a.apply(this,[this.indexCache[c]]);return}var b=this;BX.ajax({url:this.options.source,method:"post",dataType:"json",async:true,processData:true,emulateOnload:true,start:true,data:{ACT:"GET_LOCS_BY_ZIP",ZIP:c},onsuccess:function(e){if(e.result){b.indexCache[c]=e.data;a.apply(b,[e.data])}else{d.call(b)}},onfailure:function(f,g){}})}};