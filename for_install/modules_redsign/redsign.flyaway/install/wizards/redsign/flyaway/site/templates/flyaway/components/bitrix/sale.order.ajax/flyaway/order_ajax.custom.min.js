(function(){window.RS=window.RS||{};window.RS.Sale=window.RS.Sale||{};if(!BX.Sale.OrderAjaxComponent){return}RS.Sale.OrderAjaxComponent=BX.clone(BX.Sale.OrderAjaxComponent);RS.Sale.OrderAjaxComponent.hiddenBlocks={};RS.Sale.OrderAjaxComponent.isInitDeliveryFirstTime=false;var a={};RS.Sale.OrderAjaxComponent.hideNode=function(b){b.classList.add("is-hide");this.hiddenBlocks[b.id]=true};RS.Sale.OrderAjaxComponent.showNode=function(b){b.classList.remove("is-hide");this.hiddenBlocks[b.id]=false};RS.Sale.OrderAjaxComponent.isHiddenNode=function(b){return this.hiddenBlocks[b.id]};RS.Sale.OrderAjaxComponent.getBlockFooter=function(){};RS.Sale.OrderAjaxComponent.initFirstSection=function(){};RS.Sale.OrderAjaxComponent.clickNextAction=function(){};RS.Sale.OrderAjaxComponent.startLoader=function(){if(this.BXFormPosting===true){return false}this.BXFormPosting=true;if(!this.loadingScreen){this.loadingScreen=new BX.PopupWindow("loading_screen",null,{overlay:{backgroundColor:"white",opacity:"80"},events:{onAfterPopupShow:BX.proxy(function(){BX.cleanNode(this.loadingScreen.popupContainer);BX.removeClass(this.loadingScreen.popupContainer,"popup-window");rsFlyaway.darken($(this.loadingScreen.popupContainer));this.loadingScreen.popupContainer.removeAttribute("style");this.loadingScreen.popupContainer.style.display="block"},this)}});BX.addClass(this.loadingScreen.popupContainer,"bx-step-opacity")}return setTimeout(BX.proxy(function(){this.loadingScreen.show()},this),100)};RS.Sale.OrderAjaxComponent.endLoader=function(){this.BXFormPosting=false;if(this.loadingScreen&&this.loadingScreen.isShown()){rsFlyaway.darken($(this.loadingScreen.popupContainer));this.loadingScreen.close()}clearTimeout(this.loaderTimer)};RS.Sale.OrderAjaxComponent.showActualBlock=function(d){var c=this.orderBlockNode.querySelectorAll(".bx-soa-section.bx-active"),b=0;for(b in c){if(!c.hasOwnProperty(b)){return}this.show(c[b]);BX.addClass(c[b],"bx-step-completed")}};RS.Sale.OrderAjaxComponent.getPersonTypeControl=function(h){if(!this.result.PERSON_TYPE){return}var b=BX.util.object_keys(this.result.PERSON_TYPE).length,f,j,g,c,e=[],d;if(b>1){c=BX.create("DIV",{props:{className:"form-group"},children:[BX.create("LABEL",{props:{className:"bx-soa-custom-label"},text:this.params.MESS_PERSON_TYPE}),BX.create("BR")]});h.appendChild(c);h=c}if(b>2){for(g in this.result.PERSON_TYPE){if(this.result.PERSON_TYPE.hasOwnProperty(g)){f=this.result.PERSON_TYPE[g];e.push(BX.create("OPTION",{props:{value:f.ID,selected:f.CHECKED=="Y"},text:f.NAME}));if(f.CHECKED=="Y"){j=f.ID}}}h.appendChild(BX.create("SELECT",{props:{name:"PERSON_TYPE",className:"form-control "},children:e,events:{change:BX.proxy(this.sendRequest,this)}}));this.regionBlockNotEmpty=true}else{if(b==2){for(g in this.result.PERSON_TYPE){if(this.result.PERSON_TYPE.hasOwnProperty(g)){f=this.result.PERSON_TYPE[g];d=BX.create("LABEL",{props:{className:"btn btn-default btn-button"+(f.CHECKED=="Y"?" active":"")},children:[BX.create("INPUT",{attrs:{checked:f.CHECKED=="Y"},props:{type:"radio",name:"PERSON_TYPE",value:f.ID}}),f.NAME],events:{change:BX.proxy(this.sendRequest,this)}});h.appendChild(BX.create("DIV",{props:{className:"bx-soa-persontypes"},children:[d]}));if(f.CHECKED=="Y"){j=f.ID}}}this.regionBlockNotEmpty=true}else{for(g in this.result.PERSON_TYPE){if(this.result.PERSON_TYPE.hasOwnProperty(g)){h.appendChild(BX.create("INPUT",{props:{type:"hidden",name:"PERSON_TYPE",value:this.result.PERSON_TYPE[g].ID}}))}}}}if(j){h.appendChild(BX.create("INPUT",{props:{type:"hidden",name:"PERSON_TYPE_OLD",value:j}}))}};RS.Sale.OrderAjaxComponent.editSection=function(d){if(!d||!d.id){return}if(this.result.SHOW_AUTH&&d.id!=this.authBlockNode.id&&d.id!=this.basketBlockNode.id){d.style.display="none"}else{if(d.id!=this.pickUpBlockNode.id){d.style.display=""}}var e=d.querySelector(".bx-soa-section-title-container"),c,b;BX.unbindAll(e);if(this.result.SHOW_AUTH){BX.bind(e,"click",BX.proxy(function(){this.animateScrollTo(this.authBlockNode);this.addAnimationEffect(this.authBlockNode,"bx-step-good")},this))}else{BX.bind(e,"click",BX.proxy(this.showByClick,this));c=e.querySelector(".bx-soa-editstep");c&&BX.bind(c,"click",BX.proxy(this.showByClick,this))}b=d.querySelector(".alert.alert-danger");this.hasErrorSection[d.id]=b&&b.style.display!="none";switch(d.id){case this.authBlockNode.id:this.editAuthBlock();break;case this.basketBlockNode.id:this.editBasketBlock(!this.isHiddenNode(d));break;case this.regionBlockNode.id:this.editRegionBlock(!this.isHiddenNode(d));break;case this.paySystemBlockNode.id:this.editPaySystemBlock(!this.isHiddenNode(d));break;case this.deliveryBlockNode.id:if(this.isInitDeliveryFirstTime){this.editDeliveryBlock(!this.isHiddenNode(d))}else{this.hideNode(d);this.editDeliveryBlock(false);this.isInitDeliveryFirstTime=true}break;case this.pickUpBlockNode.id:this.hideNode(d);this.editPickUpBlock(false);break;case this.propsBlockNode.id:this.editPropsBlock(!this.isHiddenNode(d));break}d.setAttribute("data-visited","true")};RS.Sale.OrderAjaxComponent.fixLocationsStyle=function(g,c){if(!g||!c){return}var e=this.isHiddenNode(g)?c:g,b,d,f;b=e.querySelectorAll("div.bx-sls div.dropdown-block.bx-ui-sls-input-block");d=e.querySelectorAll("div.bx-slst div.dropdown-block.bx-ui-slst-input-block");if(b.length){for(f=0;f<b.length;f++){BX.addClass(b[f],"form-control")}}if(d.length){for(f=0;f<d.length;f++){BX.addClass(d[f],"form-control")}}};RS.Sale.OrderAjaxComponent.locationsCompletion=function(){var b,e,j,c,h,g,d,f;this.locationsInitialized=true;this.fixLocationsStyle(this.regionBlockNode,this.regionHiddenBlockNode);this.fixLocationsStyle(this.propsBlockNode,this.propsHiddenBlockNode);for(b in this.locations){if(!this.locations.hasOwnProperty(b)){continue}e=this.orderBlockNode.querySelector('div[data-property-id-row="'+b+'"]');if(!e){continue}j=e.querySelector("div.bx-ui-sls-clear");c=e.querySelector("div.bx-ui-slst-pool");h=e.querySelector("input.bx-ui-sls-fake[type=text]");e.removeAttribute("style");this.bindValidation(b,e);if(j){BX.bind(j,"click",function(m){var l=m.target||m.srcElement,k=BX.findParent(l,{tagName:"DIV",className:"form-group"}),i;if(k){i=k.querySelector("input.bx-ui-sls-fake[type=text]")}if(i){BX.fireEvent(i,"keyup")}})}if(!this.firstLoad&&this.options.propertyValidation){if(c){g=this.validation.properties[b];d=this.getValidationData(g,e);f=BX.findParent(e,{className:"bx-soa-section"});if(f&&f.getAttribute("data-visited")=="true"){this.isValidProperty(d)}}if(h){BX.fireEvent(h,"keyup")}}if(this.isHiddenNode(this.regionBlockNode)){this.editFadeRegionContent(this.regionBlockNode.querySelector(".bx-soa-section-content"))}}if(this.firstLoad&&!this.result.LAST_ORDER_DATA.FAIL){this.showActualBlock()}this.checkNotifications()};RS.Sale.OrderAjaxComponent.editFadePropsContent=function(d){if(!d){return}var l=this.propsHiddenBlockNode.querySelector(".alert"),c=this.getSelectedPersonType(),m,h,j,k,b,f,e,g;BX.cleanNode(d);if(l){d.appendChild(l.cloneNode(true))}if(c){m="PROPS_FADE_LIST_"+c.ID;h=this.params[m]}if(!h||h.length==0){d.innerHTML+="<strong>"+BX.message("SOA_ORDER_PROPS")+"</strong>"}else{b=this.fadedPropertyCollection.getGroupIterator();while(j=b()){f=j.getIterator();while(k=f()){for(e=0;e<h.length;e++){if(h[e]==k.getId()&&k.getSettings()["IS_ZIP"]!="Y"){this.getPropertyRowNode(k,d,true)}}}}}if(this.propsBlockNode.getAttribute("data-visited")=="true"){g=this.isValidPropertiesBlock();if(g.length){this.showError(this.propsBlockNode,g)}}BX.bind(d.querySelector(".alert.alert-danger"),"click",BX.proxy(this.showByClick,this));BX.bind(d.querySelector(".alert.alert-warning"),"click",BX.proxy(this.showByClick,this))};RS.Sale.OrderAjaxComponent.show=function(b){if(!b||!b.id||!this.isHiddenNode(b)){return}this.showNode(b);BX.removeClass(b,"bx-step-error bx-step-warning");switch(b.id){case this.authBlockNode.id:this.authBlockNode.style.display="";BX.addClass(this.authBlockNode,"bx-active");break;case this.basketBlockNode.id:this.editActiveBasketBlock(true);this.alignBasketColumns();break;case this.regionBlockNode.id:this.editActiveRegionBlock(true);break;case this.deliveryBlockNode.id:this.editActiveDeliveryBlock(true);break;case this.paySystemBlockNode.id:this.editActivePaySystemBlock(true);break;case this.pickUpBlockNode.id:this.editActivePickUpBlock(true);break;case this.propsBlockNode.id:this.editActivePropsBlock(true);break}if(b.getAttribute("data-visited")==="false"){this.showBlockErrors(b)}b.setAttribute("data-visited","true");BX.removeClass(b,"bx-step-completed")};RS.Sale.OrderAjaxComponent.fade=function(b){BX.Sale.OrderAjaxComponent.fade.call(this,b);this.hideNode(b)};RS.Sale.OrderAjaxComponent.showByClick=function(c){var e=c.target||c.srcElement,b=$(c.target).closest(".bx-soa-section")[0],d=BX.GetWindowScrollPos().scrollTop;if(this.isHiddenNode(b)){this.show(b);this.cleanHideSection(b)}else{this.fade(b)}this.reachGoal("edit",b);return BX.PreventDefault(c)};RS.Sale.OrderAjaxComponent.cleanHideSection=function(b){var c=null;switch(b.id){case this.regionBlockNode.id:c=this.regionHiddenBlockNode;break;case this.deliveryBlockNode.id:c=this.deliveryHiddenBlockNode;break;case this.paySystemBlockNode.id:c=this.paySystemHiddenBlockNode;break;case this.propsBlockNode.id:c=this.propsHiddenBlockNode;break}BX.cleanNode(c)};RS.Sale.OrderAjaxComponent.editCoupons=function(c){var e=c.parentNode;var f=this.getCouponsList(true),d=this.getCouponsLabel(true),b=BX.create("DIV",{props:{className:"bx-soa-coupon-block"},children:[BX.create("DIV",{props:{className:"bx-soa-coupon-input"},children:[BX.create("INPUT",{props:{id:"coupon__"+e.id,className:"form-control bx-ios-fix",type:"text"},events:{change:BX.proxy(function(){var g=BX("coupon__"+e.id);if(g&&g.value){this.sendRequest("enterCoupon",g.value)}},this)}})]}),BX.create("SPAN",{props:{className:"bx-soa-coupon-item"},children:f})]});c.appendChild(BX.create("DIV",{props:{className:"bx-soa-coupon"},children:[d,b]}))};RS.Sale.OrderAjaxComponent.selectStore=function(b){var c=b.target||b.srcElement,d=BX.findParent(c,{className:"bx-soa-section"});BX.Sale.OrderAjaxComponent.selectStore.call(this,b);c=b.target||b.srcElement;if(c.tagName=="A"){this.hideNode(d);this.fade(d)}return BX.PreventDefault(b)};RS.Sale.OrderAjaxComponent.editAuthorizeForm=function(f){var b,c,g,d,e;b=this.createAuthFormInputContainer(BX.message("STOF_LOGIN"),BX.create("INPUT",{attrs:{"data-next":"USER_PASSWORD"},props:{name:"USER_LOGIN",type:"text",value:this.result.AUTH.USER_LOGIN,maxlength:"30"},events:{keypress:BX.proxy(this.checkKeyPress,this)}}));c=this.createAuthFormInputContainer(BX.message("STOF_PASSWORD"),BX.create("INPUT",{attrs:{"data-send":true},props:{name:"USER_PASSWORD",type:"password",value:"",maxlength:"30"},events:{keypress:BX.proxy(this.checkKeyPress,this)}}));g=BX.create("DIV",{props:{className:"bx-authform-formgroup-container"},children:[BX.create("DIV",{props:{className:"gui-box"},children:[BX.create("LABEL",{props:{className:"gui-checkbox"},children:[BX.create("INPUT",{props:{type:"checkbox",name:"USER_REMEMBER",value:"Y",className:"gui-checkbox-input"}}),BX.create("SPAN",{props:{className:"gui-checkbox-icon"}}),BX.create("SPAN",{text:BX.message("STOF_REMEMBER")})]})]})]});d=BX.create("DIV",{props:{className:"bx-authform-formgroup-container"},children:[BX.create("INPUT",{props:{id:"do_authorize",type:"hidden",name:"do_authorize",value:"N"}}),BX.create("INPUT",{props:{type:"submit",className:"btn btn-lg btn-default",value:BX.message("STOF_ENTER")},events:{click:BX.proxy(function(h){BX("do_authorize").value="Y";this.sendRequest("showAuthForm");return BX.PreventDefault(h)},this)}})]});e=BX.create("DIV",{props:{className:"bx-authform"},children:[BX.create("H3",{props:{className:"bx-title"},text:BX.message("STOF_AUTH_REQUEST")}),b,c,g,d,BX.create("A",{props:{href:this.params.PATH_TO_AUTH+"?forgot_password=yes&back_url="+encodeURIComponent(document.location.href)},text:BX.message("STOF_FORGET_PASSWORD")})]});f.appendChild(BX.create("DIV",{props:{className:"col-md-6"},children:[e]}))};RS.Sale.OrderAjaxComponent.isValidProperty=function(e,f){var b=[],d,c;if(!e||!e.inputs){return b}for(c=0;c<e.inputs.length;c++){console.log(a);if(a[e.inputs[c].id]){d=e.func(e.inputs[c],!!f);if(d.length){b[c]=d.join("<br />")}}}this.showValidationResult(e.inputs,b);return b};RS.Sale.OrderAjaxComponent.bindValidation=function(g,c){if(!this.validation.properties||!this.validation.properties[g]){return}var f=this.validation.properties[g],e=this.getValidationData(f,c),d,b;if(e&&e.inputs&&e.action){for(d=0;d<e.inputs.length;d++){if(BX.type.isElementNode(e.inputs[d])){BX.bind(e.inputs[d],e.action,BX.proxy(function(h){a[h.target.id]=true;this.isValidProperty(e)},this))}else{for(b=0;b<e.inputs[d].length;b++){BX.bind(e.inputs[d][b],e.action,BX.proxy(function(){this.isValidProperty(e)},this))}}}}}}());