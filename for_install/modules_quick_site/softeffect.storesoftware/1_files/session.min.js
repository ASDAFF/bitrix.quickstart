function CBXSession(){var a=this;this.mess={};this.timeout=null;this.sessid=null;this.bShowMess=true;this.dateStart=new Date();this.dateInput=new Date();this.dateCheck=new Date();this.activityInterval=0;this.notifier=null;this.Expand=function(e,d,c,b){this.timeout=e;this.sessid=d;this.bShowMess=c;this.key=b;BX.ready(function(){BX.bind(document,"keypress",a.OnUserInput);BX.bind(document.body,"mousemove",a.OnUserInput);BX.bind(document.body,"click",a.OnUserInput);setTimeout(a.CheckSession,(a.timeout-60)*1000)})};this.OnUserInput=function(){var b=new Date();a.dateInput.setTime(b.valueOf())};this.CheckSession=function(){var d=new Date();if(d.valueOf()-a.dateCheck.valueOf()<30000){return}a.activityInterval=Math.round((a.dateInput.valueOf()-a.dateStart.valueOf())/1000);a.dateStart.setTime(a.dateInput.valueOf());var b=(a.activityInterval>a.timeout?(a.timeout-60):a.activityInterval);var c={method:"GET",dataType:"html",url:"/bitrix/tools/public_session.php?sessid="+a.sessid+"&interval="+b+"&k="+a.key,data:"",onsuccess:function(e){a.CheckResult(e)},lsId:"sess_expand",lsTimeout:60};if(b>0){c.lsForce=true}BX.ajax(c)};this.CheckResult=function(d){if(d=="SESSION_EXPIRED"){if(a.bShowMess){if(!a.notifier){a.notifier=document.body.appendChild(BX.create("DIV",{props:{className:"bx-session-message"},style:{top:"0px"},html:'<a class="bx-session-message-close" href="javascript:bxSession.Close()"></a>'+a.mess.messSessExpired}));var f=BX.GetWindowScrollPos();var b=BX.GetWindowInnerSize();a.notifier.style.left=parseInt(f.scrollLeft+b.innerWidth/2-parseInt(a.notifier.clientWidth)/2)+"px";if(BX.browser.IsIE()){a.notifier.style.top=f.scrollTop+"px";BX.bind(window,"scroll",function(){var g=BX.GetWindowScrollPos();a.notifier.style.top=g.scrollTop+"px"})}else{a.notifier.style.position="fixed"}}a.notifier.style.display=""}}else{var c;if(d=="SESSION_CHANGED"){c=(a.timeout-60)}else{c=(a.activityInterval<60?60:(a.activityInterval>a.timeout?(a.timeout-60):a.activityInterval))}var e=new Date();a.dateCheck.setTime(e.valueOf());setTimeout(a.CheckSession,c*1000)}};this.Close=function(){this.notifier.style.display="none"}}var bxSession=new CBXSession();