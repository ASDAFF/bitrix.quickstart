if(typeof oForumForm!="object"){var oForumForm={}}var MessageMax=64000;function quoteMessageEx(b,a){if(typeof document.forms.REPLIER=="object"){init_form(document.forms.REPLIER);oForumForm[document.forms.REPLIER.id].quote(b,a)}}function CreatePalette(){if(oForumForm.PALETTE){return oForumForm.PALETTE}var c=["00","33","66","99","BB","FF"];var a={R:0,G:0,B:0,color:""};oDiv=document.body.appendChild(document.createElement("DIV"));oDiv.id="palette";oDiv.className="palette";oDiv.style.position="absolute";oDiv.style.width="199px";oDiv.style.height="133px";oDiv.style.border="none";oDiv.style.visibility="hidden";text="<table cellspacing='0' cellpadding='0' border='0' class='palette'><tr>";for(var b=0;b<216;b++){a.R=b%6;a.G=Math.round(b/36)%6;a.B=Math.round(b/6)%6;a.color="#"+c[a.R]+""+c[a.G]+c[a.B];if(b%18==0&&b>0){text+="</tr><tr>"}text+=('<td style="background-color:'+a.color+';" onmouseup="window.color_palette=\'#'+c[a.R]+""+c[a.G]+c[a.B]+"'\"><div></div></td>")}text+="</tr></table>";oDiv.innerHTML=text;oForumForm.PALETTE=oDiv;return oForumForm.PALETTE}function emoticon(a){return}function init_form(a){if(typeof(a)!="object"){return false}if(typeof(oForumForm[a.id])!="object"){oForumForm[a.id]=new PostForm(a);oForumForm[a.id].Init(a);a.onkeydown=function(){};a.onmouseover=function(){}}return}function PostForm(){this.open={B:0,I:0,U:0,CODE:0,QUOTE:0,FONT:0,COLOR:0};this.tags={B:"simple_tag",I:"simple_tag",U:"simple_tag",CODE:"simple_tag",QUOTE:"simple_tag",FONT:"simple_tag",PALETTE:"show_palette",COLOR:"simple_tag",CLOSEALL:"closeall",URL:"tag_url",IMG:"tag_image",LIST:"tag_list",TRANSLIT:"translit"};this.b={translit:0};this.str={translit:""};this.stack=[];this.form=false;this.tools={};this.nav="none";var a=this;this.popupMenu=false;this.now={};this.Init=function(c){if(this.form){return true}if(typeof(c)!="object"){return false}this.form=c;oDivs=this.form.getElementsByTagName("DIV");if(oDivs&&oDivs.length>0){for(var b=0;b<oDivs.length;b++){if(!(oDivs[b]&&oDivs[b].id&&oDivs[b].id.substring(0,5)=="form_")){continue}oDiv=oDivs[b];id=oDiv.id.substring(5).toUpperCase();if(id=="QUOTE"){oDiv.onmousedown=function(){a.quote(false,false)}}else{oDiv.onmousedown=function(){var i=this.id.substring(5).toUpperCase();var g=a.form.REVIEW_TEXT;var f=false;if((jsUtils.IsIE()||jsUtils.IsOpera())&&(g.isTextEdit)){g.focus();var h=document.selection;var e=h.createRange();e.colapse;if(h.type=="Text"&&e!=null){f=true}}else{if(document.getElementById&&(g.selectionEnd>g.selectionStart)){f=true}}a.now[i]=false;if(!f){return true}a.format_text(this,"onmousedown");a.now[i]=true}}oDiv.onclick=function(){a.format_text(this,"onclick")};oDiv.onmouseover=function(){this.className+=" marked"};oDiv.onmouseout=function(){this.className=this.className.replace(/marked/,"").replace("  "," ")};if(jsUtils.IsOpera()&&oDiv.title){oDiv.title=oDiv.title.replace(/\(alt+([^)])+\)/gi,"")}this.tools[id]=oDiv}}if(this.form.FONT){this.form.FONT.onchange=function(){a.format_text(this)};this.form.FONT.onmouseover=function(){this.className+=" marked"};this.form.FONT.onmouseout=function(){this.className=this.className.replace(/marked/,"").replace("  "," ")}}var d=this.form.getElementsByTagName("img");if(d&&d.length>0){for(var b=0;b<d.length;b++){if(d[b].className=="smiles"||d[b].className=="smiles-list"){d[b].onclick=function(){a.emoticon(this)}}}}if(this.form.REVIEW_TEXT){this.form.REVIEW_TEXT.onselect=function(){a.store_caret(this)};this.form.REVIEW_TEXT.onclick=function(){a.store_caret(this)};this.form.REVIEW_TEXT.onkeyup=function(f){a.OnKeyPress(f);a.store_caret(this)};this.form.REVIEW_TEXT.onkeypress=a.check_ctrl_enter}return true},this.OnKeyPress=function(b){if(!b){b=window.event}if(!b){return}if(!b.altKey){return}if(b.keyCode==73){this.format_text({id:"form_i",value:""})}else{if(b.keyCode==85){this.format_text({id:"form_u",value:""})}else{if(b.keyCode==66){this.format_text({id:"form_b",value:""})}else{if(b.keyCode==81){this.format_text({id:"form_quote",value:""})}else{if(b.keyCode==80){this.format_text({id:"form_code",value:""})}else{if(b.keyCode==71){this.tag_image()}else{if(b.keyCode==72){this.tag_url()}else{if(b.keyCode==76){this.tag_list()}}}}}}}}},this.Insert=function(d,e,f,g){if(!this.form||!this.form.REVIEW_TEXT){return false}var k=this.form.REVIEW_TEXT;var m=(f?true:false);g=(g==null?"":g);this.form.REVIEW_TEXT.focus();if(jsUtils.IsIE()||jsUtils.IsOpera()){this.form.REVIEW_TEXT.focus();var c=document.selection;var b=c.createRange();b.collapse;var j="";if(b.parentElement&&b.parentElement()&&b.parentElement().name){j=b.parentElement().name}if(j!="REVIEW_TEXT"){k.value+=d}else{if((c.type=="Text"||c.type=="None")&&b!=null){if(e!=""&&b.text.length>0){d+=b.text+e;m=false}else{if(g.length>0){d+=g+e;m=false}}b.text=d}}}else{if(document.getElementById){var n={start:d,end:""};if(e!=""&&k.selectionEnd>k.selectionStart){n.end=e;m=false}else{if(g.length>0){n.start=n.start+""+g+""+e;m=false}}n.start=(!n.start?"":n.start);n.end=(!n.end?"":n.end);var c={start:k.selectionStart,end:k.selectionEnd};if(c.end==1||c.end==2){c.end=k.textLength}var l=(k.value).substring(0,c.start);var i=(k.value).substring(c.start,c.end);var h=(k.value).substring(c.end,k.textLength);k.value=l+n.start+i+n.end+h;if(c.start!=c.end){k.selectionStart=c.start;k.selectionEnd=c.end+n.start.length+n.end.length}else{if(n.start.length>0||n.end.length>0){k.selectionStart=c.end+n.start.length+n.end.length;k.selectionEnd=k.selectionStart}}}else{k.value+=d}}k.focus();return m},this.format_text=function(b,g){if(!b||!b.id){return false}var h=b.id.substring(5).toUpperCase();if(this.now[h]==true){this.now[h]=false;return}if(this.tags[h]=="simple_tag"){var c=tag_name=h;if(tag_name=="FONT"||tag_name=="COLOR"){c+="="+b.value}if((this.open[tag_name]==0||(tag_name=="FONT"||tag_name=="COLOR"))&&this.Insert("["+c+"]","[/"+tag_name+"]",true)){this.open[tag_name]++;if(this.tools[h]){this.tools[h].className+=" opened"}this.stack.push(tag_name)}else{var f=[];var e=false;var d=false;while(d=this.stack.pop()){f.unshift(d);if(d==tag_name){e=true;break}}if(!e){this.stack=f}var d=false;while(d=f.pop()){this.Insert("[/"+d+"]","",false);if(this.tools[h]){this.tools[h].className=this.tools[h].className.replace(/opened/,"").replace("  "," ")}this.open[d]--}}this.tools.CLOSEALL.style.display=(this.stack<=0?"none":"")}else{if(this.tags[h]=="show_palette"){this.store_caret();this.show_palette(b)}else{if(this.tags[h]=="translit"){if(this.b.translit!=true){if(this.tools[h]){this.tools[h].className+=" opened translited"}this.b.translit=true}else{if(this.tools[h]){this.tools[h].className=this.tools[h].className.replace(/opened/,"").replace(/translited/,"").replace("  "," ")}this.b.translit=false}this.translit()}else{if(this.tags[h]){this[this.tags[h]]()}}}}},this.check_ctrl_enter=function(b){if(!b){b=window.event}if((b.keyCode==13||b.keyCode==10)&&b.ctrlKey&&ValidateForm(a.form)){a.form.submit()}return},this.store_caret=function(){if(this.form.REVIEW_TEXT.createTextRange){this.form.REVIEW_TEXT.caretPos=document.selection.createRange().duplicate()}},this.emoticon=function(b){this.Insert(" "+b.id+" ","",false)},this.tag_image=function(){var c=true;do{var b=prompt(oText.enter_image,"http://");if(b==null){c=false;return false}else{if(b.length<=0){alert("Error! "+oErrors.no_url)}else{c=false}}}while(c);this.Insert("[IMG]"+b+"[/IMG]","",false)},this.tag_list=function(){var b="[LIST]\n";var d=true;do{var c=prompt(oText.list_prompt,"");if(c==null){d=false;return false}else{if(c.length<=0){d=false}else{b=b+"[*]"+c+"\n"}}}while(d);this.Insert(b+"[/LIST]\n","",false)},this.closeall=function(){var b=false;while(b=this.stack.pop()){this.Insert("[/"+b+"]");if(this.form[b]){this.form[b].value=b}if(this.tools[b]){this.tools[b].className=this.tools[b].className.replace(/opened/,"").replace("  "," ")}this.open[b]--}this.tools.CLOSEALL.style.display=(this.stack<=0?"none":"")},this.tag_url=function(){var f="";var e=true;var b={URL:{text:oText.enter_url,"default":"http://",error:oErrors.no_url,value:""},TITLE:{text:oText.enter_url_name,"default":"My Webpage",error:oErrors.no_title,value:""}};for(var d in b){e=true;do{var c=prompt(b[d]["text"],b[d]["default"]);if(c==null){e=false;return false}else{if(c.length<=0){alert("Error! "+b[d]["error"])}else{b[d]["value"]=c;e=false}}}while(e)}this.Insert("[URL="+b.URL["value"]+"]"+b.TITLE["value"]+"[/URL]","",false)},this.storeCaret=function(b){if(b.createTextRange){b.caretPos=document.selection.createRange().duplicate()}},this.translit=function(){var g;var h=this.form.REVIEW_TEXT;var e=h.value;var f=false;if((jsUtils.IsIE()||jsUtils.IsOpera())&&(h.isTextEdit)){h.focus();var d=document.selection;var b=d.createRange();b.colapse;if(d.type=="Text"&&b!=null){e=b.text;f=true}}else{if(document.getElementById){if(h.selectionEnd>h.selectionStart){var j=h.selectionEnd;if(j==0){j=h.textLength}var k=(h.value).substring(0,h.selectionStart);e=(h.value).substring(h.selectionStart,j);var c=(h.value).substring(j,h.textLength);f=true}}}if(e){if(this.b.translit==0){for(g=0;g<capitEngLettersReg.length;g++){e=e.replace(capitEngLettersReg[g],capitRusLetters[g])}for(g=0;g<smallEngLettersReg.length;g++){e=e.replace(smallEngLettersReg[g],smallRusLetters[g])}}else{for(g=0;g<capitRusLetters.length;g++){e=e.replace(capitRusLettersReg[g],capitEngLetters[g])}for(g=0;g<smallRusLetters.length;g++){e=e.replace(smallRusLettersReg[g],smallEngLetters[g])}}if(!f){h.value=e}else{if((jsUtils.IsIE()||jsUtils.IsOpera())&&(h.isTextEdit)){b.text=e}else{h.value=k+e+c;h.selectionEnd=k.length+e.length}}}h.focus()},this.quote=function(d,b){var c="";var e=0;if(document.getSelection){c=document.getSelection();c=c.replace(/\r\n\r\n/gi,"_newstringhere_").replace(/\r\n/gi," ");c=c.replace(/  /gi,"").replace(/_newstringhere_/gi,"\r\n\r\n")}else{if(document.selection){c=document.selection.createRange().text}}if(c==""&&b){message=b.replace(/message_text_/gi,"");if(parseInt(message)>0){message=document.getElementById(b);if(typeof(message)=="object"&&message){c=message.innerHTML;c=c.replace(/\<br(\s)*(\/)*\>/gi,"\n").replace(/\<script[^\>]*>/gi,"\001").replace(/\<\/script[^\>]*>/gi,"\002");c=c.replace(/\<noscript[^\>]*>/gi,"\003").replace(/\<\/noscript[^\>]*>/gi,"\004");c=c.replace(/\001([^\002]*)\002/gi," ").replace(/\003([^\004]*)\004/gi," ").replace(/\<[^\>]+\>/gi," ");c=c.replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&quot;/gi,'"')}else{c="is not object"}}else{if(b.Length()>0){c=b}}}if(c!=""){c=c.replace(/\&shy;/gi,"");if(d!=null&&d){c=d+oText.author+c}this.Insert("[QUOTE]","[/QUOTE]",false,c);this.now.QUOTE=true}},this.show_palette=function(c){if(!c){return false}var b=CreatePalette();if(!this.popupMenu){window.ForumPopupMenu.prototype.ShowMenu=function(d,f){var e={top:20,left:20};this.PopupHide();if(typeof(d)=="object"){id=d.id;e=jsUtils.GetRealPos(d);this.ControlPos=e;this.oControl=d}this.oDiv=f;if(this.oDiv){this.PopupShow(e,this.oDiv)}};window.ForumPopupMenu.prototype.CheckClick=function(i){if(!this.oDiv){return}if(this.oDiv.style.visibility!="visible"||this.oDiv.style.display=="none"){return}var l=jsUtils.GetWindowSize();var m=i.clientX+l.scrollLeft;var k=i.clientY+l.scrollTop;j=jsUtils.GetRealPos(this.oDiv);var g=parseInt(j.left);var h=parseInt(j.top);var d=g+this.oDiv.offsetWidth;var f=h+this.oDiv.offsetHeight;if(m>=g&&m<=d&&k>=h&&k<=f){if(window.color_palette){a.format_text({id:"form_color",value:window.color_palette,className:""});this.PopupHide()}}if(this.ControlPos){var j=this.ControlPos;if(m>=j.left&&m<=j.right&&k>=j.top&&k<=j.bottom){return}}this.PopupHide()};this.popupMenu=new ForumPopupMenu()}this.popupMenu.ShowMenu(c,b)}}function ValidateForm(d,f){if(typeof d!="object"||typeof d.REVIEW_TEXT!="object"){return false}var e="";var b=d.REVIEW_TEXT.value.length;if(d.TITLE&&(d.TITLE.value.length<2)){e+=oErrors.no_topic_name}if(b<2){e+=oErrors.no_message}else{if((MessageMax!=0)&&(b>MessageMax)){e+=oErrors.max_len1+MessageMax+oErrors.max_len2+b}}if(e!=""){alert(e);return false}var a=d.getElementsByTagName("submit");for(var c in a){c.disabled=true}if(f=="Y"&&window.ForumPostMessage){ForumPostMessage(d)}return true};