BX.namespace("BX.Sale.component.location.selector");if(typeof BX.Sale.component.location.selector.search=="undefined"&&typeof BX.ui!="undefined"&&typeof BX.ui.widget!="undefined"){BX.Sale.component.location.selector.search=function(a,b){this.parentConstruct(BX.Sale.component.location.selector.search,a);BX.merge(this,{opts:{usePagingOnScroll:true,pageSize:10,arrowScrollAdditional:2,pageUpWardOffset:3,provideLinkBy:"id",bindEvents:{"after-input-value-modify":function(){this.ctrls.fullRoute.value=""},"after-select-item":function(g){var f=this.opts;var c=this.vars.cache.nodes[g];var e=c.DISPLAY;if(typeof c.PATH=="object"){for(var d=0;d<c.PATH.length;d++){e+=", "+this.vars.cache.path[c.PATH[d]]}}this.ctrls.inputs.fake.setAttribute("title",e);this.ctrls.fullRoute.value=e;if(typeof this.opts.callback=="string"&&this.opts.callback.length>0&&this.opts.callback in window){window[this.opts.callback].apply(this,[g,this])}},"after-deselect-item":function(){this.ctrls.fullRoute.value="";this.ctrls.inputs.fake.setAttribute("title","")},"before-render-variant":function(c){if(c.PATH.length>0){var f="";for(var d=0;d<c.PATH.length;d++){f+=", "+this.vars.cache.path[c.PATH[d]]}c.PATH=f}else{c.PATH=""}var e=this.vars.lastQuery.QUERY;if(BX.type.isNotEmptyString(e)){var g=[];if(this.opts.wrapSeparate){g=e.split(/\s+/)}else{g=[e]}c["=display_wrapped"]=BX.util.wrapSubstring(c.DISPLAY+c.PATH,g,this.opts.wrapTagName,true)}else{c["=display_wrapped"]=BX.util.htmlspecialchars(c.DISPLAY)}}}},vars:{cache:{path:{},nodesByCode:{}}},sys:{code:"sls"}});this.handleInitStack(b,BX.Sale.component.location.selector.search,a)};BX.extend(BX.Sale.component.location.selector.search,BX.ui.autoComplete);BX.merge(BX.Sale.component.location.selector.search.prototype,{init:function(){if(typeof this.opts.pathNames=="object"){BX.merge(this.vars.cache.path,this.opts.pathNames)}this.pushFuncStack("buildUpDOM",BX.Sale.component.location.selector.search);this.pushFuncStack("bindEvents",BX.Sale.component.location.selector.search)},buildUpDOM:function(){var e=this.ctrls,d=this.opts,b=this.vars,a=this,c=this.sys.code;e.fullRoute=BX.create("input",{props:{className:"bx-ui-"+c+"-route"},attrs:{type:"text",disabled:"disabled",autocomplete:"off"}});BX.addClass(e.inputs.fake,"form-control");BX.addClass(e.fullRoute,"form-control");BX.prepend(e.fullRoute,e.container);e.inputBlock=this.getControl("input-block");e.loader=this.getControl("loader")},bindEvents:function(){var a=this;BX.bindDelegate(this.getControl("quick-locations",true),"click",{tag:"a"},function(){a.setValueByLocationId(BX.data(this,"id"))});this.vars.outSideClickScope=this.ctrls.inputBlock},setValueByLocationId:function(b,a){BX.Sale.component.location.selector.search.superclass.setValue.apply(this,[b,a])},setValueByLocationCode:function(d,c){var b=this.vars,f=this.opts,g=this.ctrls,a=this;this.hideError();if(d==null||d==false||typeof d=="undefined"||d.toString().length==0){this.resetVariables();BX.cleanNode(g.vars);if(BX.type.isElementNode(g.nothingFound)){BX.hide(g.nothingFound)}this.fireEvent("after-deselect-item");this.fireEvent("after-clear-selection");return}if(c!==false){b.forceSelectSingeOnce=true}if(typeof b.cache.nodesByCode[d]=="undefined"){this.resetNavVariables();a.downloadBundle({CODE:d},function(i){a.fillCache(i,false);if(typeof b.cache.nodesByCode[d]=="undefined"){a.showNothingFound()}else{var h=b.cache.nodesByCode[d].VALUE;if(f.autoSelectIfOneVariant||b.forceSelectSingeOnce){a.selectItem(h)}else{a.displayVariants([h])}}},function(){b.forceSelectSingeOnce=false})}else{var e=b.cache.nodesByCode[d].VALUE;if(b.forceSelectSingeOnce){this.selectItem(e)}else{this.displayVariants([e])}b.forceSelectSingeOnce=false}},getNodeByValue:function(a){if(this.opts.provideLinkBy=="id"){return this.vars.cache.nodes[a]}else{return this.vars.cache.nodesByCode[a]}},setValue:function(a){if(this.opts.provideLinkBy=="id"){BX.Sale.component.location.selector.search.superclass.setValue.apply(this,[a])}else{this.setValueByLocationCode(a)}},getValue:function(){if(this.opts.provideLinkBy=="id"){return this.vars.value===false?"":this.vars.value}else{return this.vars.value?this.vars.cache.nodes[this.vars.value].CODE:""}},getSelectedPath:function(){var b=this.vars,a=[];if(typeof b.value=="undefined"||b.value==false||b.value==""){return a}if(typeof b.cache.nodes[b.value]!="undefined"){var d=BX.clone(b.cache.nodes[b.value]);if(typeof d.TYPE_ID!="undefined"&&typeof this.opts.types!="undefined"){d.TYPE=this.opts.types[d.TYPE_ID].CODE}var e=d.PATH;delete (d.PATH);a.push(d);if(typeof e!="undefined"){for(var c in e){var d=BX.clone(b.cache.nodes[e[c]]);if(typeof d.TYPE_ID!="undefined"&&typeof this.opts.types!="undefined"){d.TYPE=this.opts.types[d.TYPE_ID].CODE}delete (d.PATH);a.push(d)}}}return a},setInitialValue:function(){if(this.opts.selectedItem!==false){this.setValueByLocationId(this.opts.selectedItem)}else{if(this.ctrls.inputs.origin.value.length>0){if(this.opts.provideLinkBy=="id"){this.setValueByLocationId(this.ctrls.inputs.origin.value)}else{this.setValueByLocationCode(this.ctrls.inputs.origin.value)}}}},addItem2Cache:function(a){this.vars.cache.nodes[a.VALUE]=a;this.vars.cache.nodesByCode[a.CODE]=a},refineRequest:function(b){var a={};if(typeof b.QUERY!="undefined"){a["=PHRASE"]=b.QUERY}if(typeof b.VALUE!="undefined"){a["=ID"]=b.VALUE}if(typeof b.CODE!="undefined"){a["=CODE"]=b.CODE}if(typeof this.opts.query.BEHAVIOUR.LANGUAGE_ID!="undefined"){a["=NAME.LANGUAGE_ID"]=this.opts.query.BEHAVIOUR.LANGUAGE_ID}if(BX.type.isNotEmptyString(this.opts.query.FILTER.SITE_ID)){a["=SITE_ID"]=this.opts.query.FILTER.SITE_ID}return{select:{VALUE:"ID",DISPLAY:"NAME.NAME","1":"CODE","2":"TYPE_ID"},additionals:{"1":"PATH"},filter:a,version:"2"}},refineResponce:function(c,g){if(typeof c.ETC.PATH_ITEMS!="undefined"){for(var b in c.ETC.PATH_ITEMS){if(BX.type.isNotEmptyString(c.ETC.PATH_ITEMS[b].DISPLAY)){this.vars.cache.path[b]=c.ETC.PATH_ITEMS[b].DISPLAY}}for(var b in c.ITEMS){var f=c.ITEMS[b];if(typeof f.PATH!="undefined"){var a=BX.clone(f.PATH);for(var h in f.PATH){var e=f.PATH[h];a.shift();if(typeof this.vars.cache.nodes[e]=="undefined"&&typeof c.ETC.PATH_ITEMS[e]!="undefined"){var d=BX.clone(c.ETC.PATH_ITEMS[e]);d.PATH=BX.clone(a);this.vars.cache.nodes[e]=d}}}}}return c.ITEMS},refineItems:function(a){return a},refineItemDataForTemplate:function(a){return a},getSelectorValue:function(a){if(this.opts.provideLinkBy=="id"){return a}if(typeof this.vars.cache.nodes[a]!="undefined"){return this.vars.cache.nodes[a].CODE}else{return""}},whenLoaderToggle:function(a){BX[a?"show":"hide"](this.ctrls.loader)}})};