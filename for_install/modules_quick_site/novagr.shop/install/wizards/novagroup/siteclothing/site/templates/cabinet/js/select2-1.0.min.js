(function(f){var g,h,a,d,i,e,c;function b(k){var j=function(m){var l=this;if(k.attrs!==undefined){f.each(k.attrs,function(o,n){if(m[o]!==undefined){l[o]=m[o]}else{if(n.required===true){throw"Value for required attribute: "+o+" not defined"}if(n.init!==undefined){l[o]=typeof(n.init)==="function"?n.init.apply(l):n.init}}})}if(k.methods!==undefined&&k.methods.init!==undefined){l.init(m)}};if(k.methods!==undefined){if(k.methods.bind!==undefined){throw"Class cannot declare a method called 'bind'"}f.each(k.methods,function(m,l){j.prototype[m]=l});j.prototype.bind=function(m){var l=this;return function(){m.apply(l,arguments)}}}return j}g={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46};h={};h.debounce=function(j,k){var l;return function(){window.clearTimeout(l);l=window.setTimeout(k,j)}};h.debounceEvent=function(m,j,n,k,o){k=k||n+"-debounced";o=o||true;var l=h.debounce(j,function(p){m.trigger(k,p)});m.on(n,function(p){if(o&&m.get().indexOf(p.target)<0){return}l(p)})};(function(){var j;h.filterMouseEvent=function(l,m,k,n){k=k||m+"-filtered";n=n||false;l.on(m,"*",function(o){if(n&&l.get().indexOf(o.target)<0){return}if(j===undefined||j.x!==o.pageX||j.y!==o.pageY){f(o.target).trigger(k,o);j={x:o.pageX,y:o.pageY}}})}}());a=b({attrs:{container:{required:true},element:{required:true},bus:{required:true}},methods:{open:function(){if(this.isOpen()){return}this.container.addClass("select2-dropdown-open");f(document).on("mousedown.dropdown",this.bind(function(l){var j=false,k=this.container.get(0);f(l.target).parents().each(function(){return !(j=(this===k))});if(!j){this.close()}}));this.element.show();this.bus.trigger("opened")},close:function(){if(!this.isOpen()){return}this.container.removeClass("select2-dropdown-open");f(document).off("mousedown.dropdown");this.element.hide();this.bus.trigger("closed")},isOpen:function(){return this.container.hasClass("select2-dropdown-open")},toggle:function(){if(this.isOpen()){this.close()}else{this.open()}}}});d=b({attrs:{element:{required:true},bus:{required:true},formatInputTooShort:{required:true},formatNoMatches:{required:true},formatResult:{required:true},minimumInputLength:{required:true},query:{required:true},selection:{required:true}},methods:{init:function(){var j=this;this.search=this.element.find("input");this.results=this.element.find("ul");this.scrollPosition=0;this.vars={};this.search.on("keyup",function(k){if(k.which>=48||k.which===g.SPACE||k.which===g.BACKSPACE||k.which===g.DELETE){j.update()}});this.search.on("keydown",function(k){switch(k.which){case g.TAB:k.preventDefault();j.select();return;case g.ENTER:k.preventDefault();k.stopPropagation();j.select();return;case g.UP:j.moveSelection(-1);k.preventDefault();k.stopPropagation();return;case g.DOWN:j.moveSelection(1);k.preventDefault();k.stopPropagation();return;case g.ESC:k.preventDefault();k.stopPropagation();j.cancel();return}});h.filterMouseEvent(this.results,"mousemove");this.results.on("mousemove-filtered",this.bind(function(l){var k=f(l.target).closest("li.select2-result");if(k.length<1){return}this.setSelection(k.index())}));this.results.on("click",this.bind(function(l){var k=f(l.target).closest("li.select2-result");if(k.length<1){return}this.bus.trigger("selected",[k.data("select2-result")])}));h.debounceEvent(this.results,100,"scroll");this.results.on("scroll-debounced",this.bind(function(l){this.scrollPosition=this.results.scrollTop();var k=this.results.find("li.select2-more-results"),m;if(k.length===0){return}m=k.offset().top-this.results.offset().top-this.results.height();if(m<=0){k.addClass("select2-active");this.query({term:this.search.val(),vars:this.vars,callback:this.bind(this.append)})}}))},open:function(j){this.search.focus();this.results.scrollTop(this.scrollPosition);if(this.results.children().length===0){this.update()}},close:function(){},clear:function(){this.results.empty()},showInputTooShort:function(){this.show("<li class='select2-no-results'>"+this.formatInputTooShort(this.search.val(),this.minimumInputLength)+"</li>")},showNoMatches:function(){this.show("<li class='select2-no-results'>"+this.formatNoMatches(this.search.val())+"</li>")},show:function(j){this.results.html(j);this.results.scrollTop(0);this.search.removeClass("select2-active")},update:function(){var j="";if(this.search.val().length<this.minimumInputLength){this.showInputTooShort();return}this.search.addClass("select2-active");this.vars={};this.query({term:this.search.val(),vars:this.vars,callback:this.bind(this.process)})},process:function(m){if(m.results.length===0){this.showNoMatches();return}var l=this.stringizeResults(m.results),k=this.selection.val(),j=0;if(m.more===true){l+="<li class='select2-more-results'>Loading more results...</li>"}this.vars=m.vars||{};this.show(l);this.findChoices().each(function(n){if(k===m.results[n].id){j=n}f(this).data("select2-result",m.results[n])});this.setSelection(j)},append:function(l){var k=this.results.find("li.select2-more-results"),j,m;this.vars=l.vars||{};if(l.results.length===0){k.remove();return}j=this.stringizeResults(l.results);m=this.results.find("li.select2-result").length;k.before(j);this.results.find("li.select2-result").each(function(n){if(n>=m){f(this).data("select2-result",l.results[n-m])}});if(l.more!==true){k.remove()}else{k.removeClass("select2-active")}},stringizeResults:function(o,n){var m,j,k;n=n||"";for(m=0,j=o.length;m<j;m+=1){n+="<li class='select2-result'>";n+=this.formatResult(o[m]);n+="</li>"}return n},findChoices:function(){return this.results.children("li.select2-result")},removeSelection:function(){this.findChoices().each(function(){f(this).removeClass("select2-highlighted")})},setSelection:function(j){this.removeSelection();var l=this.findChoices(),p=f(l[j]),o,m,n,k;p.addClass("select2-highlighted");this.search.focus();o=p.offset().top+p.outerHeight();if(j===l.length-1){k=this.results.find("li.select2-more-results");if(k.length>0){o=k.offset().top+k.outerHeight()}}m=this.results.offset().top+this.results.outerHeight();if(o>m){this.results.scrollTop(this.results.scrollTop()+(o-m))}n=p.offset().top-this.results.offset().top;if(n<0){this.results.scrollTop(this.results.scrollTop()+n)}},getSelectionIndex:function(){var m=this.findChoices(),k=0,j=m.length;for(;k<j;k+=1){if(f(m[k]).hasClass("select2-highlighted")){return k}}return -1},moveSelection:function(m){var l=this.getSelectionIndex(),j=this.findChoices(),k=l+m;if(l>=0&&k>=0&&k<j.length){this.setSelection(k)}},select:function(){var j=this.results.find("li.select2-highlighted");if(j.length>0){this.bus.trigger("selected",[j.data("select2-result")])}},cancel:function(){this.bus.trigger("cancelled")},val:function(k){var l=this.findChoices(),j;l.each(function(m){if(f(this).data("select2-result").id===k){j=m;return false}});if(j===undefined&&k.id!==undefined){l.each(function(m){if(f(this).data("select2-result").id===k.id){j=m;return false}})}if(j!==undefined){this.setSelection(j);this.select();return}this.bus.trigger("selected",k)}}});i=b({attrs:{bus:{required:true},element:{required:true},display:{init:function(){return this.element.find("span")}},hidden:{required:true},formatSelection:{required:true},placeholder:{},dropdown:{required:true}},methods:{init:function(){if(this.placeholder){this.select(this.placeholder)}this.element.click(this.dropdown.bind(this.dropdown.toggle));var j=this;this.element.on("keydown",function(k){switch(k.which){case g.TAB:case g.SHIFT:case g.CTRL:case g.ALT:case g.LEFT:case g.RIGHT:return}j.dropdown.open()})},select:function(j){this.display.html(this.formatSelection(j));this.hidden.val(j.id)},focus:function(){this.element.focus()},val:function(){return this.hidden.val()}}});c={};c.select=function(k,l){var j=[];l.find("option").each(function(){var m=f(this);j.push({id:m.attr("value"),text:m.text()})});return function(n){var m={results:[],more:false},o=n.term.toUpperCase();f.each(j,function(p){if(this.text.toUpperCase().indexOf(o)>=0){m.results.push(this)}});n.callback(m)}};c.ajax=function(k,l){var m,j=0,n=k.ajax.quietMillis||100;return function(o){window.clearTimeout(m);m=window.setTimeout(function(){j+=1;var q=j,p=k.ajax,r=p.data;r=r.call(this,o.term,o.vars);f.ajax({url:p.url,dataType:p.dataType,data:r}).success(function(s){if(q<j){return}o.callback(p.results(s,o.vars))})},n)}};e=b({attrs:{el:{required:true},formatResult:{init:function(){return function(j){return j.text}}},formatSelection:{init:function(){return function(j){return j.text}}},formatNoMatches:{init:function(){return function(){return"No matches found"}}},formatInputTooShort:{init:function(){return function(j,k){return"Please enter "+(k-j.length)+"  more character"}}},minimumInputLength:{init:0},placeholder:{init:undefined},ajax:{init:undefined},query:{init:undefined}},methods:{init:function(){var k=this,n,q,l,m,j;this.el=f(this.el);n=this.el.outerWidth();this.container=f("<div></div>",{"class":"select2-container",style:"width: "+n+"px"});if(this.el.data("search-container")!=undefined&&this.el.data("add-mess")!=undefined){var o=this.el.data("search-container");var p="<div class='form-request'><a id='"+o+"' class='editable editable-click' href='#' data-type='text' data-pk='1' data-original-title='"+this.el.data("add-mess")+"'>"+this.el.data("add-label")+"</a></div>"}else{var p=""}this.container.html("   <a href='javascript:void(0)' class='select2-choice'>   <span></span>   <div><b></b></div></a><div class='select2-drop' style='display:none;'>   <div class='select2-search'>       <input type='text' autocomplete='off'/>   </div>   <ul class='select2-results'>   </ul>"+p+"</div><input type='hidden'/>");this.el.data("select2",this);this.el.hide();this.el.after(k.container);if(this.el.data("search-container")!=undefined&&this.el.data("add-mess")!=undefined){f("#"+o).editable({buttonValue:this.el.data("send-btn"),ajaxOptions:{dataType:"json"},url:this.el.data("ajax-handler"),type:"text",autotext:"never",display:false,name:this.el.data("search-container"),title:this.el.data("title-mess"),success:function(s,r){if(s&&s.result=="OK"){alert(s.message)}}})}if(this.el.attr("class")!==undefined){this.container.addClass(this.el.attr("class"))}this.container.data("select2",this);this.container.find("input[type=hidden]").attr("name",this.el.attr("name"));if(this.query===undefined&&this.el.get(0).tagName.toUpperCase()==="SELECT"){this.query="select";j=true}if(c[this.query]!==undefined){this.query=c[this.query](this,this.el)}(function(){var v,u,s,t;function r(w){return w.outerWidth()-w.width()}v=k.container.find("div.select2-drop");t=k.container.outerWidth()-r(v);v.css({top:k.container.height(),width:t});u=k.container.find(".select2-search");s=u.find("input");t=v.width();t-=r(u);t-=r(s);s.css({width:t})}());q=new a({element:this.container.find("div.select2-drop"),container:this.container,bus:this.el});this.selection=new i({bus:this.el,element:this.container.find(".select2-choice"),hidden:this.container.find("input[type=hidden]"),formatSelection:this.formatSelection,placeholder:this.placeholder,dropdown:q});this.results=new d({element:this.container.find("div.select2-drop"),bus:this.el,formatInputTooShort:this.formatInputTooShort,formatNoMatches:this.formatNoMatches,formatResult:this.formatResult,minimumInputLength:this.minimumInputLength,query:this.query,selection:this.selection});this.el.on("selected",function(s,r){q.close();k.selection.select(r)});this.el.on("cancelled",function(){q.close()});this.el.on("opened",this.bind(function(){this.results.open()}));this.el.on("closed",this.bind(function(){this.container.removeClass("select2-dropdown-open");this.results.close();this.selection.focus()}));if(j){this.results.update();m=this.el.find("option[selected]");if(m.length<1&&this.placeholder===undefined){m=f(this.el.find("option")[0])}if(m.length>0){this.val({id:m.attr("value"),text:m.text()})}}},val:function(){var j;if(arguments.length===0){return this.selection.val()}else{j=arguments[0];this.results.val(j)}}}});f.fn.select2=function(){var j=Array.prototype.slice.call(arguments,0),l,k;this.each(function(){if(j.length===0){k=new e({el:this})}else{if(typeof(j[0])==="object"){j[0].el=this;k=new e(j[0])}else{if(typeof(j[0])==="string"){var m=f(this).data("select2");l=m[j[0]].apply(m,j.slice(1));return false}else{throw"Invalid arguments to select2 plugin: "+j}}}});return(l===undefined)?this:l}}(jQuery));