(function(){if(window.jsDD){return}jsDD={arObjects:[],arDestinations:[],arDestinationsPriority:[],arContainers:[],arContainersPos:[],current_dest_index:false,current_node:null,wndSize:null,bStarted:false,bDisable:false,bDisableDestRefresh:false,bEscPressed:false,bScrollWindow:false,scrollViewTimer:null,scrollViewConfig:{checkerTimeout:30,scrollZone:25,scrollBy:25,scrollContainer:null,bScrollH:true,bScrollV:true,pos:null},setScrollWindow:function(d){jsDD.bScrollWindow=!!d;if(BX.type.isDomNode(d)){jsDD.scrollViewConfig.scrollContainer=d;jsDD.scrollViewConfig.pos=BX.pos(d);var c=BX.style(d,"overflow")||"visible",b=BX.style(d,"overflow-x")||"visible",a=BX.style(d,"overflow-y")||"visible";jsDD.scrollViewConfig.bScrollH=c!="visible"||b!="visible";jsDD.scrollViewConfig.bScrollV=c!="visible"||a!="visible"}},Reset:function(){jsDD.arObjects=[];jsDD.arDestinations=[];arDestinationsPriority=[];jsDD.bStarted=false;jsDD.current_node=null;jsDD.current_dest_index=false;jsDD.bDisableDestRefresh=false;jsDD.bDisable=false;jsDD.x=null;jsDD.y=null;jsDD.start_x=null;jsDD.start_y=null;jsDD.wndSize=null;jsDD.bEscPressed=false;clearInterval(jsDD.scrollViewTimer);jsDD.bScrollWindow=false;jsDD.scrollViewTimer=null;jsDD.scrollViewConfig.scrollContainer=null},registerObject:function(a){a.onmousedown=jsDD.startDrag;a.__bxddid=jsDD.arObjects.length;jsDD.arObjects[a.__bxddid]=a},registerDest:function(b,a){if(!a){a=100}b.__bxddeid=jsDD.arDestinations.length;b.__bxddpriority=a;jsDD.arDestinations[b.__bxddeid]=b;if(!jsDD.arDestinationsPriority[a]){jsDD.arDestinationsPriority[a]=[b.__bxddeid]}else{jsDD.arDestinationsPriority[a].push(b.__bxddeid)}jsDD.refreshDestArea(b.__bxddeid)},disableDest:function(a){if(a.__bxddeid){a.__bxdddisabled=true}},enableDest:function(a){if(a.__bxddeid){a.__bxdddisabled=false}},registerContainer:function(a){jsDD.arContainers[jsDD.arContainers.length]=a},getContainersScrollPos:function(a,e){var d={left:0,top:0};for(var b=0,c=jsDD.arContainers.length;b<c;b++){if(jsDD.arContainers[b]&&a>=jsDD.arContainersPos[b]["left"]&&a<=jsDD.arContainersPos[b]["right"]&&e>=jsDD.arContainersPos[b]["top"]&&e<=jsDD.arContainersPos[b]["bottom"]){d.left=jsDD.arContainers[b].scrollLeft;d.top=jsDD.arContainers[b].scrollTop}}return d},setContainersPos:function(){for(var a=0,b=jsDD.arContainers.length;a<b;a++){if(jsDD.arContainers[a]){jsDD.arContainersPos[a]=BX.pos(jsDD.arContainers[a])}}},refreshDestArea:function(d){if(d&&typeof(d)=="object"&&typeof(d.__bxddeid)!="undefined"){d=d.__bxddeid}if(typeof d=="undefined"){for(var c=0,b=jsDD.arDestinations.length;c<b;c++){jsDD.refreshDestArea(c)}}else{if(null==jsDD.arDestinations[d]){return}var a=BX.pos(jsDD.arDestinations[d]);jsDD.arDestinations[d].__bxpos=[a.left,a.top,a.right,a.bottom]}},_checkEsc:function(a){a=a||window.event;if(jsDD.bStarted&&a.keyCode==27){jsDD.stopCurrentDrag()}},stopCurrentDrag:function(){if(jsDD.bStarted){jsDD.bEscPressed=true;jsDD.stopDrag()}},_onscroll:function(){jsDD.wndSize=BX.GetWindowSize()},_checkScroll:function(){if(jsDD.bScrollWindow){var b={clientX:jsDD.x-jsDD.wndSize.scrollLeft,clientY:jsDD.y-jsDD.wndSize.scrollTop},f=false,a=jsDD.scrollViewConfig.scrollZone;if(b.clientY<a&&jsDD.wndSize.scrollTop>0){window.scrollBy(0,-jsDD.scrollViewConfig.scrollBy);f=true}if(b.clientY>jsDD.wndSize.innerHeight-a&&jsDD.wndSize.scrollTop<jsDD.wndSize.scrollHeight-jsDD.wndSize.innerHeight){window.scrollBy(0,jsDD.scrollViewConfig.scrollBy);f=true}if(b.clientX<a&&jsDD.wndSize.scrollLeft>0){window.scrollBy(-jsDD.scrollViewConfig.scrollBy,0);f=true}if(b.clientX>jsDD.wndSize.innerWidth-a&&jsDD.wndSize.scrollLeft<jsDD.wndSize.scrollWidth-jsDD.wndSize.innerWidth){window.scrollBy(jsDD.scrollViewConfig.scrollBy,0);f=true}if(jsDD.scrollViewConfig.scrollContainer){var e=jsDD.scrollViewConfig.scrollContainer;if(jsDD.scrollViewConfig.bScrollH){if(b.clientX+jsDD.wndSize.scrollLeft<jsDD.scrollViewConfig.pos.left+a&&e.scrollLeft>0){e.scrollLeft-=jsDD.scrollViewConfig.scrollBy;f=true}if(b.clientX+jsDD.wndSize.scrollLeft>jsDD.scrollViewConfig.pos.right-a&&e.scrollLeft<e.scrollWidth-e.offsetWidth){e.scrollLeft+=jsDD.scrollViewConfig.scrollBy;f=true}}if(jsDD.scrollViewConfig.bScrollV){if(b.clientY+jsDD.wndSize.scrollTop<jsDD.scrollViewConfig.pos.top+a&&e.scrollTop>0){e.scrollTop-=jsDD.scrollViewConfig.scrollBy;f=true}if(b.clientY+jsDD.wndSize.scrollTop>jsDD.scrollViewConfig.pos.bottom-a&&e.scrollTop<e.scrollHeight-e.offsetHeight){e.scrollTop+=jsDD.scrollViewConfig.scrollBy;f=true}}}if(f){jsDD._onscroll();jsDD.drag(b)}}},startDrag:function(a){if(jsDD.bDisable){return true}a=a||window.event;if(!(BX.getEventButton(a)&BX.MSLEFT)){return true}jsDD.current_node=null;if(a.currentTarget){jsDD.current_node=a.currentTarget;if(null==jsDD.current_node||null==jsDD.current_node.__bxddid){jsDD.current_node=null;return}}else{jsDD.current_node=a.srcElement;if(null==jsDD.current_node){return}while(null==jsDD.current_node.__bxddid){jsDD.current_node=jsDD.current_node.parentNode;if(jsDD.current_node.tagName=="BODY"){return}}}jsDD.bStarted=false;jsDD.bPreStarted=true;jsDD.wndSize=BX.GetWindowSize();jsDD.start_x=a.clientX+jsDD.wndSize.scrollLeft;jsDD.start_y=a.clientY+jsDD.wndSize.scrollTop;document.onmouseup=jsDD.stopDrag;BX.bind(document,"mousemove",jsDD.drag);BX.bind(window,"scroll",jsDD._onscroll);if(document.body.setCapture){document.body.setCapture()}jsDD.denySelection();if(!jsDD.bDisableDestRefresh){jsDD.refreshDestArea()}jsDD.setContainersPos();return BX.PreventDefault(a)},start:function(){if(jsDD.bDisable){return true}document.body.style.cursor="move";if(jsDD.current_node.onbxdragstart){jsDD.current_node.onbxdragstart()}for(var b=0,a=jsDD.arDestinations.length;b<a;b++){if(jsDD.arDestinations[b].onbxdestdragstart){jsDD.arDestinations[b].onbxdestdragstart(jsDD.current_node)}}jsDD.bStarted=true;jsDD.bPreStarted=false;if(jsDD.bScrollWindow){if(jsDD.scrollViewTimer){clearInterval(jsDD.scrollViewTimer)}jsDD.scrollViewTimer=setInterval(jsDD._checkScroll,jsDD.scrollViewConfig.checkerTimeout)}BX.bind(document,"keypress",this._checkEsc)},drag:function(c){if(jsDD.bDisable){return true}c=c||window.event;jsDD.x=c.clientX+jsDD.wndSize.scrollLeft;jsDD.y=c.clientY+jsDD.wndSize.scrollTop;var d=5;if(jsDD.x>=jsDD.start_x-d&&jsDD.x<=jsDD.start_x+d&&jsDD.y>=jsDD.start_y-d&&jsDD.y<=jsDD.start_y+d){return true}if(!jsDD.bStarted){jsDD.start()}if(jsDD.current_node.onbxdrag){jsDD.current_node.onbxdrag(jsDD.x,jsDD.y)}var a=jsDD.getContainersScrollPos(jsDD.x,jsDD.y);var b=jsDD.searchDest(jsDD.x+a.left,jsDD.y+a.top);if(b!==jsDD.current_dest_index){if(jsDD.current_dest_index!==false){if(jsDD.current_node.onbxdraghout){jsDD.current_node.onbxdraghout(jsDD.arDestinations[jsDD.current_dest_index],jsDD.x,jsDD.y)}if(jsDD.arDestinations[jsDD.current_dest_index].onbxdestdraghout){jsDD.arDestinations[jsDD.current_dest_index].onbxdestdraghout(jsDD.current_node,jsDD.x,jsDD.y)}}if(b!==false){if(jsDD.current_node.onbxdraghover){jsDD.current_node.onbxdraghover(jsDD.arDestinations[b],jsDD.x,jsDD.y)}if(jsDD.arDestinations[b].onbxdestdraghover){jsDD.arDestinations[b].onbxdestdraghover(jsDD.current_node,jsDD.x,jsDD.y)}}}jsDD.current_dest_index=b},stopDrag:function(d){BX.unbind(document,"keypress",jsDD._checkEsc);d=d||window.event;jsDD.bPreStarted=false;if(jsDD.bStarted){if(!jsDD.bEscPressed){jsDD.x=d.clientX+jsDD.wndSize.scrollLeft;jsDD.y=d.clientY+jsDD.wndSize.scrollTop}if(null!=jsDD.current_node.onbxdragstop){jsDD.current_node.onbxdragstop(jsDD.x,jsDD.y)}var a=jsDD.getContainersScrollPos(jsDD.x,jsDD.y);var f=jsDD.searchDest(jsDD.x+a.left,jsDD.y+a.top);if(false!==f){if(jsDD.bEscPressed){if(null!=jsDD.arDestinations[f].onbxdestdraghout){if(!jsDD.arDestinations[f].onbxdestdraghout(jsDD.current_node,jsDD.x,jsDD.y)){f=false}else{if(null!=jsDD.current_node.onbxdragfinish){jsDD.current_node.onbxdragfinish(jsDD.arDestinations[f],jsDD.x,jsDD.y)}}}}else{if(null!=jsDD.arDestinations[f].onbxdestdragfinish){if(!jsDD.arDestinations[f].onbxdestdragfinish(jsDD.current_node,jsDD.x,jsDD.y,d)){f=false}else{if(null!=jsDD.current_node.onbxdragfinish){jsDD.current_node.onbxdragfinish(jsDD.arDestinations[f],jsDD.x,jsDD.y)}}}}}if(false===f){if(null!=jsDD.current_node.onbxdragrelease){jsDD.current_node.onbxdragrelease(jsDD.x,jsDD.y)}}else{for(var c=0,b=jsDD.arDestinations.length;c<b;c++){if(c!=f&&null!=jsDD.arDestinations[c].onbxdestdragrelease){jsDD.arDestinations[c].onbxdestdragrelease(jsDD.current_node,jsDD.x,jsDD.y)}}}for(var c=0,b=jsDD.arDestinations.length;c<b;c++){if(null!=jsDD.arDestinations[c].onbxdestdragstop){jsDD.arDestinations[c].onbxdestdragstop(jsDD.current_node,jsDD.x,jsDD.y)}}}if(document.body.releaseCapture){document.body.releaseCapture()}BX.unbind(window,"scroll",jsDD._onscroll);BX.unbind(document,"mousemove",jsDD.drag);BX.unbind(document,"keypress",jsDD._checkEsc);document.onmouseup=null;jsDD.allowSelection();document.body.style.cursor="";jsDD.current_node=null;if(jsDD.bScrollWindow){if(jsDD.scrollViewTimer){clearInterval(jsDD.scrollViewTimer)}}if(jsDD.bStarted&&!jsDD.bDisableDestRefresh){jsDD.refreshDestArea()}jsDD.bStarted=false;jsDD.bEscPressed=false},searchDest:function(b,g){var e,a,f,c,d;for(e=0,a=jsDD.arDestinationsPriority.length;e<a;e++){if(jsDD.arDestinationsPriority[e]&&BX.type.isArray(jsDD.arDestinationsPriority[e])){for(f=0,c=jsDD.arDestinationsPriority[e].length;f<a;f++){d=jsDD.arDestinationsPriority[e][f];if(jsDD.arDestinations[d]&&!jsDD.arDestinations[d].__bxdddisabled){if(jsDD.arDestinations[d].__bxpos[0]<=b&&jsDD.arDestinations[d].__bxpos[2]>=b&&jsDD.arDestinations[d].__bxpos[1]<=g&&jsDD.arDestinations[d].__bxpos[3]>=g){return d}}}}}return false},allowSelection:function(){document.onmousedown=null;var a=document.body;a.ondrag=null;a.onselectstart=null;a.style.MozUserSelect="";if(jsDD.current_node){jsDD.current_node.ondrag=null;jsDD.current_node.onselectstart=null;jsDD.current_node.style.MozUserSelect=""}},denySelection:function(){document.onmousedown=BX.False;var a=document.body;a.ondrag=BX.False;a.onselectstart=BX.False;a.style.MozUserSelect="none";if(jsDD.current_node){jsDD.current_node.ondrag=BX.False;jsDD.current_node.onselectstart=BX.False;jsDD.current_node.style.MozUserSelect="none"}},Disable:function(){jsDD.bDisable=true},Enable:function(){jsDD.bDisable=false}}})();