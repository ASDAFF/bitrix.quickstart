BX.namespace("BX.Sale");BX.Sale.GiftMainProductsClass=(function(){var a=function(b){this.ajaxUrl="/bitrix/components/bitrix/sale.gift.main.products/ajax.php";this.contextAjaxData=b.contextAjaxData||{};this.mainProductState=b.mainProductState||null;this.injectId=b.injectId||null;this.isGift=!!b.isGift;this.productId=b.productId;this.offerId=b.offerId;this.offers=b.offers||[];this.setEvents();if(document.location.hash.match(/as_gift/g)){if(this.isGift){this.enableGift()}else{this.raiseNonGiftEvent()}}BX.bindDelegate(BX(this.injectId),"click",{tagName:"a"},BX.proxy(this.clickNavLink,this))};a.prototype.clickNavLink=function(b){if(this.onPageNavigationByLink(BX.proxy_context)){return BX.PreventDefault(b)}};a.prototype.setEvents=function(){BX.addCustomEvent("onCatalogStoreProductChange",BX.proxy(this.onCatalogStoreProductChange,this));BX.addCustomEvent("onAddToBasketMainProduct",BX.proxy(this.onAddToBasketMainProduct,this))};a.prototype.unsubscribeEvents=function(){BX.removeCustomEvent("onCatalogStoreProductChange",BX.proxy(this.onCatalogStoreProductChange,this))};a.prototype.onAddToBasketMainProduct=function(b){this.enableGift()};a.prototype.onCatalogStoreProductChange=function(b){if(b==this.offerId){return}BX.ajax({url:this.ajaxUrl,method:"POST",data:BX.merge(this.contextAjaxData,{offerId:b,mainProductState:this.mainProductState,SITE_ID:BX.message("SITE_ID")}),dataType:"html",processData:false,start:true,onsuccess:BX.delegate(function(d){this.offerId=b;var c=BX.processHTML(d);if(!c.HTML){if(document.location.hash.match(/as_gift/g)){if(this.isGift){this.raiseGiftEvent()}else{this.raiseNonGiftEvent()}}return}this.unsubscribeEvents();BX(this.injectId).innerHTML=c.HTML;BX.ajax.processScripts(c.SCRIPT)},this)})};a.prototype.onPageNavigationByLink=function(c){var b=BX.delegate(function(d){if(!BX.type.isElementNode(d)||!d.href){return false}if(d.href.indexOf(this.ajaxUrl)>=0){return true}return d.href.indexOf("PAGEN_")!==-1},this);if(!b(c)){return false}BX.ajax({url:c.href,method:"POST",data:BX.merge(this.contextAjaxData,{SITE_ID:BX.message("SITE_ID")}),dataType:"html",processData:false,start:true,onsuccess:BX.delegate(function(e){var d=BX.processHTML(e);if(!d.HTML){return}this.unsubscribeEvents();BX(this.injectId).innerHTML=d.HTML;BX.ajax.processScripts(d.SCRIPT)},this)});return true};a.prototype.enableGift=function(){this.isGift=true;this.raiseGiftEvent()};a.prototype.raiseGiftEvent=function(){BX.onCustomEvent("onSaleProductIsGift",[this.productId,this.offerId])};a.prototype.raiseNonGiftEvent=function(){BX.onCustomEvent("onSaleProductIsNotGift",[this.productId,this.offerId])};return a})();