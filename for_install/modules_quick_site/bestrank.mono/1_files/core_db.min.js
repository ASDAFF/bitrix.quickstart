(function(b){if(b.BX.dataBase){return}var a=b.BX;a.dataBase=function(c){this.tableList=[];if(typeof b.openDatabase!="undefined"){this.dbObject=b.openDatabase(c.name,c.version,c.displayName,c.capacity)}};a.dataBase.prototype.isTableExists=function(g,d){var c=this;var f=function(){var h=c.tableList.length;for(var e=0;e<h;e++){if(c.tableList[e].toUpperCase()==g.toUpperCase()){d(true);return}}d(false)};if(this.tableList.length<=0){this.getTableList(f)}else{f()}};a.dataBase.prototype.getTableList=function(f){var d=this;var c=f;this.query({query:"SELECT tbl_name from sqlite_master WHERE type = 'table'",values:{}},function(h){if(h.count>0){for(var g=0;g<h.items.length;g++){d.tableList[d.tableList.length]=h.items[g].tbl_name}}if(c!=null&&typeof c=="function"){c(d.tableList)}})};a.dataBase.prototype.createTable=function(f){f.action="create";if(f.success){var d=f.success;f.success=function(g){d(g);this.getTableList()}}var c=this.getQuery(f);this.query(c,f.success,f.fail)};a.dataBase.prototype.dropTable=function(f){f.action="drop";if(f.success){var d=f.success;f.success=function(g){d(g);this.getTableList()}}var c=this.getQuery(f);this.query(c,f.success,f.fail)};a.dataBase.prototype.addRow=function(c){c.action="insert";this.query(this.getQuery(c),c.success,c.fail)};a.dataBase.prototype.getRows=function(c){c.action="select";this.query(this.getQuery(c),c.success,c.fail)};a.dataBase.prototype.updateRows=function(d){d.action="update";var c=this.getQuery(d);this.query(c,d.success,d.fail)};a.dataBase.prototype.deleteRows=function(d){d.action="delete";var c=this.getQuery(d);this.query(c,d.success,d.fail)};a.dataBase.prototype.getQuery=function(v){var z=[];var x=v.filter;var d=v.fields;var A=v.insertFields;var m=v.updateFields;var h=v.tableName;var j="";switch(v.action){case"delete":j="DELETE FROM "+h.toUpperCase()+" "+this.getFilter(x);z=this.getValues([x]);break;case"update":j="UPDATE "+h.toUpperCase()+" "+this.getFieldPair(m,"SET ")+" "+this.getFilter(x);z=this.getValues([m,x]);break;case"create":var q="";if(typeof d=="object"){var y="";for(var k=0;k<d.length;k++){y="";if(typeof d[k]=="object"){if(d[k].name){y=d[k].name;if(d[k].unique&&d[k].unique==true){y+=" unique"}}}else{if(typeof d[k]=="string"&&d[k].length>0){y=d[k]}}if(y.length>0){if(q.length>0){q+=","+y.toUpperCase()}else{q=y.toUpperCase()}}}}j="CREATE TABLE IF NOT EXISTS "+h.toUpperCase()+" ("+q+") ";break;case"drop":j="DROP TABLE IF EXISTS "+h.toUpperCase();break;case"select":j="SELECT "+this.getValueArrayString(d,"*")+" FROM "+h.toUpperCase()+" "+this.getFilter(x);z=this.getValues([x]);break;case"insert":z=this.getValues([A]);j="INSERT INTO "+h.toUpperCase()+" ("+this.getKeyString(A)+") VALUES(%values%)";var g="";for(var w=0;w<z.length;w++){if(g.length>0){g+=",?"}else{g="?"}}j=j.replace("%values%",g);break}return{query:j,values:z}};a.dataBase.prototype.getFieldPair=function(j,f){var c="";var h=f||"";if(typeof j=="object"){var g=0;for(var d in j){var k=(g>0?", ":"")+(d.toUpperCase()+"=?");if(c.length==0&&h.length>0){c=h}c+=k;g++}}return c};a.dataBase.prototype.getFilter=function(j){var f="";var c="WHERE ";if(typeof j=="object"){var h=0;for(var g in j){var d="";var k=1;if(typeof j[g]=="object"){k=j[g].length}for(var l=0;l<k;l++){d=(l>0?d+" OR ":"(")+(g.toUpperCase()+"=?");if(l+1==k){d+=")"}}f+=d;h++}}return"WHERE "+f};a.dataBase.prototype.getKeyString=function(h,d){var c="";if(!d){d=""}if(typeof h=="array"){for(var g=0;g<valuesItem.length;g++){if(c.length>0){c+=","+valuesItem[g].toUpperCase()}else{c=valuesItem[g].toUpperCase()}}}else{if(typeof h=="object"){for(var f in h){if(c.length>0){c+=","+f.toUpperCase()}else{c=f.toUpperCase()}}}}if(c.length==0){c=d}return c};a.dataBase.prototype.getValueArrayString=function(g,d){var c="";if(!d){d=""}if(typeof g=="object"){for(var f=0;f<g.length;f++){if(c.length>0){c+=","+g[f].toUpperCase()}else{c=g[f].toUpperCase()}}}if(c.length==0){c=d}return c};a.dataBase.prototype.getValues=function(j){var f=[];for(var c=0;c<j.length;c++){var h=j[c];if(typeof h=="object"){for(var g in h){if(typeof h[g]!="object"){f[f.length]=h[g]}else{for(var d=0;d<h[g].length;d++){f[f.length]=h[g][d]}}}}else{if(typeof h=="array"){for(var d=0;d<h.length;d++){if(typeof h[d]!="object"){f[f.length]=h[d]}}}}}return f};a.dataBase.prototype.query=function(f,d,c){if(!this.dbObject){return}if(typeof d=="undefined"||typeof d!="function"){d=function(){}}if(typeof c=="undefined"||typeof c!="function"){c=function(){}}this.dbObject.transaction(function(e){e.executeSql(f.query,f.values,function(m,g){var k={originalResult:g};var j=g.rows.length;if(j>=0){k.count=j;k.items=[];for(var h=0;h<j;h++){var p={};var q=g.rows.item(h);for(var l in q){if(q.hasOwnProperty(l)){p[l]=q[l]}}k.items.push(p)}}if(d!=null){d(k,m)}},function(h,g){if(c!=null){c(g,h)}})})};a.dataBase.prototype.getResponseObject=function(g){var d=g.rows.length;var c=[];for(var f=0;f<d;f++){c[c.length]=g.rows.item(f)}return c}})(window);