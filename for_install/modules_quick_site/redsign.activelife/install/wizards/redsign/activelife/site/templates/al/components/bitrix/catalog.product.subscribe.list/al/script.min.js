(function(b){if(!!b.JCCatalogProductSubscribeList){return}var a=function(d){a.superclass.constructor.apply(this,arguments);this.nameNode=BX.create("span",{props:{className:"bx_medium bx_bt_button",id:this.id},text:d.text});this.buttonNode=BX.create("span",{attrs:{className:d.ownerClass},style:{marginBottom:"0",borderBottom:"0 none transparent"},children:[this.nameNode],events:this.contextEvents});if(BX.browser.IsIE()){this.buttonNode.setAttribute("hideFocus","hidefocus")}};BX.extend(a,BX.PopupWindowButton);var c=function(d){c.superclass.constructor.apply(this,arguments);this.nameNode=BX.create("span",{props:{id:this.id},style:typeof(d.style)==="object"?d.style:{},text:d.text});this.buttonNode=BX.create("span",{attrs:{className:d.className},style:{marginBottom:"0",borderBottom:"0 none transparent"},children:[this.nameNode],events:this.contextEvents});if(BX.browser.IsIE()){this.buttonNode.setAttribute("hideFocus","hidefocus")}};BX.extend(c,BX.PopupWindowButton);b.JCCatalogProductSubscribeList=function(d){this.productType=0;this.showQuantity=true;this.showAbsent=true;this.secondPict=false;this.showOldPrice=false;this.showPercent=false;this.showSkuProps=false;this.visual={ID:"",PICT_ID:"",SECOND_PICT_ID:"",QUANTITY_ID:"",QUANTITY_UP_ID:"",QUANTITY_DOWN_ID:"",PRICE_ID:"",DSC_PERC:"",SECOND_DSC_PERC:"",DISPLAY_PROP_DIV:"",BASKET_PROP_DIV:""};this.product={checkQuantity:false,maxQuantity:0,stepQuantity:1,isDblQuantity:false,canBuy:true,canSubscription:true,name:"",pict:{},id:0,addUrl:"",buyUrl:"",listSubscribeId:{}};this.basketData={useProps:false,emptyProps:false,quantity:"quantity",props:"prop",basketUrl:""};this.defaultPict={pict:null,secondPict:null};this.checkQuantity=false;this.maxQuantity=0;this.stepQuantity=1;this.isDblQuantity=false;this.canBuy=true;this.canSubscription=true;this.precision=6;this.precisionFactor=Math.pow(10,this.precision);this.offers=[];this.offerNum=0;this.treeProps=[];this.obTreeRows=[];this.showCount=[];this.showStart=[];this.selectedValues={};this.obProduct=null;this.obQuantity=null;this.obQuantityUp=null;this.obQuantityDown=null;this.obPict=null;this.obSecondPict=null;this.obPrice=null;this.obTree=null;this.obBuyBtn=null;this.deleteSubscribeBtn=null;this.obDscPerc=null;this.obSecondDscPerc=null;this.obSkuProps=null;this.obMeasure=null;this.obPopupWin=null;this.basketUrl="";this.basketParams={};this.treeRowShowSize=5;this.treeEnableArrow={display:"",cursor:"pointer",opacity:1};this.treeDisableArrow={display:"",cursor:"default",opacity:0.2};this.lastElement=false;this.containerHeight=0;this.errorCode=0;this.ajaxUrl="/bitrix/components/bitrix/catalog.product.subscribe.list/ajax.php";if("object"===typeof d){this.productType=parseInt(d.PRODUCT_TYPE,10);this.showQuantity=d.SHOW_QUANTITY;this.showAbsent=d.SHOW_ABSENT;this.secondPict=!!d.SECOND_PICT;this.showOldPrice=!!d.SHOW_OLD_PRICE;this.showPercent=!!d.SHOW_DISCOUNT_PERCENT;this.showSkuProps=!!d.SHOW_SKU_PROPS;this.notifyUser=Boolean(d.NOTIFY_USER);this.notifyPopupTitle=d.NOTIFY_POPUP_TITLE;this.notifySuccess=Boolean(d.NOTIFY_SUCCESS);this.notifyMessage=d.NOTIFY_MESSAGE;if(this.notifyUser){BX.ready(BX.delegate(this.showPopupNotifyingUser,this));return}this.visual=d.VISUAL;if(!!this.visual.DELETE_SUBSCRIBE_ID){this.deleteSubscribeBtn=BX(this.visual.DELETE_SUBSCRIBE_ID);if(!!this.deleteSubscribeBtn){BX.bind(this.deleteSubscribeBtn,"click",BX.delegate(this.deleteSubscribe,this))}this.product.listSubscribeId=d.PRODUCT.LIST_SUBSCRIBE_ID}switch(this.productType){case 1:case 2:if(!!d.PRODUCT&&"object"===typeof(d.PRODUCT)){if(this.showQuantity){this.product.checkQuantity=d.PRODUCT.CHECK_QUANTITY;this.product.isDblQuantity=d.PRODUCT.QUANTITY_FLOAT;if(this.product.checkQuantity){this.product.maxQuantity=(this.product.isDblQuantity?parseFloat(d.PRODUCT.MAX_QUANTITY):parseInt(d.PRODUCT.MAX_QUANTITY,10))}this.product.stepQuantity=(this.product.isDblQuantity?parseFloat(d.PRODUCT.STEP_QUANTITY):parseInt(d.PRODUCT.STEP_QUANTITY,10));this.checkQuantity=this.product.checkQuantity;this.isDblQuantity=this.product.isDblQuantity;this.maxQuantity=this.product.maxQuantity;this.stepQuantity=this.product.stepQuantity;if(this.isDblQuantity){this.stepQuantity=Math.round(this.stepQuantity*this.precisionFactor)/this.precisionFactor}}this.product.canBuy=d.PRODUCT.CAN_BUY;this.product.canSubscription=d.PRODUCT.SUBSCRIPTION;this.canBuy=this.product.canBuy;this.canSubscription=this.product.canSubscription;this.product.name=d.PRODUCT.NAME;this.product.pict=d.PRODUCT.PICT;this.product.id=d.PRODUCT.ID;if(!!d.PRODUCT.ADD_URL){this.product.addUrl=d.PRODUCT.ADD_URL}if(!!d.PRODUCT.BUY_URL){this.product.buyUrl=d.PRODUCT.BUY_URL}if(!!d.BASKET&&"object"===typeof(d.BASKET)){this.basketData.useProps=!!d.BASKET.ADD_PROPS;this.basketData.emptyProps=!!d.BASKET.EMPTY_PROPS}}else{this.errorCode=-1}break;case 3:if(!!d.PRODUCT&&"object"===typeof(d.PRODUCT)){this.product.name=d.PRODUCT.NAME;this.product.id=d.PRODUCT.ID}if(!!d.OFFERS&&BX.type.isArray(d.OFFERS)){this.offers=d.OFFERS;this.offerNum=0;if(!!d.OFFER_SELECTED){this.offerNum=parseInt(d.OFFER_SELECTED,10)}if(isNaN(this.offerNum)){this.offerNum=0}if(!!d.TREE_PROPS){this.treeProps=d.TREE_PROPS}if(!!d.DEFAULT_PICTURE){this.defaultPict.pict=d.DEFAULT_PICTURE.PICTURE;this.defaultPict.secondPict=d.DEFAULT_PICTURE.PICTURE_SECOND}}else{this.errorCode=-1}break;default:this.errorCode=-1}if(!!d.BASKET&&"object"===typeof(d.BASKET)){if(!!d.BASKET.QUANTITY){this.basketData.quantity=d.BASKET.QUANTITY}if(!!d.BASKET.PROPS){this.basketData.props=d.BASKET.PROPS}if(!!d.BASKET.BASKET_URL){this.basketData.basketUrl=d.BASKET.BASKET_URL}}this.lastElement=(!!d.LAST_ELEMENT&&"Y"===d.LAST_ELEMENT)}if(0===this.errorCode){BX.ready(BX.delegate(this.Init,this))}};b.JCCatalogProductSubscribeList.prototype.Init=function(){var d=0,f="",e=null;this.obProduct=BX(this.visual.ID);if(!this.obProduct){this.errorCode=-1}this.obPict=BX(this.visual.PICT_ID);if(!this.obPict){this.errorCode=-2}if(this.secondPict&&!!this.visual.SECOND_PICT_ID){this.obSecondPict=BX(this.visual.SECOND_PICT_ID)}this.obPrice=BX(this.visual.PRICE_ID);if(!this.obPrice){this.errorCode=-16}if(this.showQuantity&&!!this.visual.QUANTITY_ID){this.obQuantity=BX(this.visual.QUANTITY_ID);if(!!this.visual.QUANTITY_UP_ID){this.obQuantityUp=BX(this.visual.QUANTITY_UP_ID)}if(!!this.visual.QUANTITY_DOWN_ID){this.obQuantityDown=BX(this.visual.QUANTITY_DOWN_ID)}}if(3===this.productType){if(!!this.visual.TREE_ID){this.obTree=BX(this.visual.TREE_ID);if(!this.obTree){this.errorCode=-256}f=this.visual.TREE_ITEM_ID;for(d=0;d<this.treeProps.length;d++){this.obTreeRows[d]={LEFT:BX(f+this.treeProps[d].ID+"_left"),RIGHT:BX(f+this.treeProps[d].ID+"_right"),LIST:BX(f+this.treeProps[d].ID+"_list"),CONT:BX(f+this.treeProps[d].ID+"_cont")};if(!this.obTreeRows[d].LEFT||!this.obTreeRows[d].RIGHT||!this.obTreeRows[d].LIST||!this.obTreeRows[d].CONT){this.errorCode=-512;break}}}if(!!this.visual.QUANTITY_MEASURE){this.obMeasure=BX(this.visual.QUANTITY_MEASURE)}}if(!!this.visual.BUY_ID){this.obBuyBtn=BX(this.visual.BUY_ID)}if(this.showPercent){if(!!this.visual.DSC_PERC){this.obDscPerc=BX(this.visual.DSC_PERC)}if(this.secondPict&&!!this.visual.SECOND_DSC_PERC){this.obSecondDscPerc=BX(this.visual.SECOND_DSC_PERC)}}if(this.showSkuProps){if(!!this.visual.DISPLAY_PROP_DIV){this.obSkuProps=BX(this.visual.DISPLAY_PROP_DIV)}}if(0===this.errorCode){if(this.showQuantity){if(!!this.obQuantityUp){BX.bind(this.obQuantityUp,"click",BX.delegate(this.QuantityUp,this))}if(!!this.obQuantityDown){BX.bind(this.obQuantityDown,"click",BX.delegate(this.QuantityDown,this))}if(!!this.obQuantity){BX.bind(this.obQuantity,"change",BX.delegate(this.QuantityChange,this))}}switch(this.productType){case 1:break;case 3:e=BX.findChildren(this.obTree,{tagName:"li"},true);if(!!e&&0<e.length){for(d=0;d<e.length;d++){BX.bind(e[d],"click",BX.delegate(this.SelectOfferProp,this))}}for(d=0;d<this.obTreeRows.length;d++){BX.bind(this.obTreeRows[d].LEFT,"click",BX.delegate(this.RowLeft,this));BX.bind(this.obTreeRows[d].RIGHT,"click",BX.delegate(this.RowRight,this))}this.SetCurrent();break}if(!!this.obBuyBtn){BX.bind(this.obBuyBtn,"click",BX.delegate(this.Basket,this))}if(this.lastElement){this.containerHeight=parseInt(this.obProduct.parentNode.offsetHeight,10);if(isNaN(this.containerHeight)){this.containerHeight=0}this.setHeight();BX.bind(b,"resize",BX.delegate(this.checkHeight,this));BX.bind(this.obProduct.parentNode,"mouseover",BX.delegate(this.setHeight,this));BX.bind(this.obProduct.parentNode,"mouseout",BX.delegate(this.clearHeight,this))}}};b.JCCatalogProductSubscribeList.prototype.showPopupNotifyingUser=function(){this.InitPopupWindow();this.obPopupWin.setTitleBar(this.notifyPopupTitle);var d;if(this.notifySuccess){d="bx-cpsl-notify-content-success"}else{d="bx-cpsl-notify-content-error"}var e=BX.create("div",{props:{className:"bx-cpsl-popup-content"},children:[BX.create("p",{props:{className:d},text:this.notifyMessage})]});this.obPopupWin.setContent(e);this.obPopupWin.setButtons([new c({text:BX.message("CPSL_BTN_MESSAGE_CLOSE"),className:"btn btn-primary",events:{click:BX.delegate(function(){this.obPopupWin.close()},this)}})]);this.obPopupWin.show()};b.JCCatalogProductSubscribeList.prototype.checkHeight=function(){this.containerHeight=parseInt(this.obProduct.parentNode.offsetHeight,10);if(isNaN(this.containerHeight)){this.containerHeight=0}};b.JCCatalogProductSubscribeList.prototype.setHeight=function(){if(0<this.containerHeight){BX.adjust(this.obProduct.parentNode,{style:{height:this.containerHeight+"px"}})}};b.JCCatalogProductSubscribeList.prototype.clearHeight=function(){BX.adjust(this.obProduct.parentNode,{style:{height:"auto"}})};b.JCCatalogProductSubscribeList.prototype.QuantityUp=function(){var e=0,d=true;if(0===this.errorCode&&this.showQuantity&&this.canBuy){e=(this.isDblQuantity?parseFloat(this.obQuantity.value):parseInt(this.obQuantity.value,10));if(!isNaN(e)){e+=this.stepQuantity;if(this.checkQuantity){if(e>this.maxQuantity){d=false}}if(d){if(this.isDblQuantity){e=Math.round(e*this.precisionFactor)/this.precisionFactor}this.obQuantity.value=e}}}};b.JCCatalogProductSubscribeList.prototype.QuantityDown=function(){var e=0,d=true;if(0===this.errorCode&&this.showQuantity&&this.canBuy){e=(this.isDblQuantity?parseFloat(this.obQuantity.value):parseInt(this.obQuantity.value,10));if(!isNaN(e)){e-=this.stepQuantity;if(e<this.stepQuantity){d=false}if(d){if(this.isDblQuantity){e=Math.round(e*this.precisionFactor)/this.precisionFactor}this.obQuantity.value=e}}}};b.JCCatalogProductSubscribeList.prototype.QuantityChange=function(){var e=0,d=true;if(0===this.errorCode&&this.showQuantity){if(this.canBuy){e=(this.isDblQuantity?parseFloat(this.obQuantity.value):parseInt(this.obQuantity.value,10));if(!isNaN(e)){if(this.checkQuantity){if(e>this.maxQuantity){d=false;e=this.maxQuantity}else{if(e<this.stepQuantity){d=false;e=this.stepQuantity}}}if(!d){this.obQuantity.value=e}}else{this.obQuantity.value=this.stepQuantity}}else{this.obQuantity.value=this.stepQuantity}}};b.JCCatalogProductSubscribeList.prototype.QuantitySet=function(d){if(0===this.errorCode){if(this.showQuantity){this.isDblQuantity=this.offers[d].QUANTITY_FLOAT;this.checkQuantity=this.offers[d].CHECK_QUANTITY;if(this.isDblQuantity){this.maxQuantity=parseFloat(this.offers[d].MAX_QUANTITY);this.stepQuantity=Math.round(parseFloat(this.offers[d].STEP_QUANTITY)*this.precisionFactor)/this.precisionFactor}else{this.maxQuantity=parseInt(this.offers[d].MAX_QUANTITY,10);this.stepQuantity=parseInt(this.offers[d].STEP_QUANTITY,10)}this.obQuantity.value=this.stepQuantity;this.obQuantity.disabled=!this.canBuy;if(!!this.obMeasure){if(!!this.offers[d].MEASURE){BX.adjust(this.obMeasure,{html:this.offers[d].MEASURE})}else{BX.adjust(this.obMeasure,{html:""})}}}}};b.JCCatalogProductSubscribeList.prototype.SelectOfferProp=function(){var d=0,f="",e="",h=[],j=null,g=BX.proxy_context;if(!!g&&g.hasAttribute("data-treevalue")){e=g.getAttribute("data-treevalue");h=e.split("_");if(this.SearchOfferPropIndex(h[0],h[1])){j=BX.findChildren(g.parentNode,{tagName:"li"},false);if(!!j&&0<j.length){for(d=0;d<j.length;d++){f=j[d].getAttribute("data-onevalue");if(f===h[1]){BX.addClass(j[d],"bx_active")}else{BX.removeClass(j[d],"bx_active")}}}}}};b.JCCatalogProductSubscribeList.prototype.SearchOfferPropIndex=function(f,o){var l="",p=false,g,e,m=[],d=[],h=-1,k={},n=[];for(g=0;g<this.treeProps.length;g++){if(this.treeProps[g].ID===f){h=g;break}}if(-1<h){for(g=0;g<h;g++){l="PROP_"+this.treeProps[g].ID;k[l]=this.selectedValues[l]}l="PROP_"+this.treeProps[h].ID;p=this.GetRowValues(k,l);if(!p){return false}if(!BX.util.in_array(o,p)){return false}k[l]=o;for(g=h+1;g<this.treeProps.length;g++){l="PROP_"+this.treeProps[g].ID;p=this.GetRowValues(k,l);if(!p){return false}d=[];if(this.showAbsent){m=[];n=[];n=BX.clone(k,true);for(e=0;e<p.length;e++){n[l]=p[e];d[d.length]=p[e];if(this.GetCanBuy(n)){m[m.length]=p[e]}}}else{m=p}if(!!this.selectedValues[l]&&BX.util.in_array(this.selectedValues[l],m)){k[l]=this.selectedValues[l]}else{if(this.showAbsent){k[l]=(m.length>0?m[0]:d[0])}else{k[l]=m[0]}}this.UpdateRow(g,k[l],p,m)}this.selectedValues=k;this.ChangeInfo()}return true};b.JCCatalogProductSubscribeList.prototype.RowLeft=function(){var e=0,f="",d=-1,g=BX.proxy_context;if(!!g&&g.hasAttribute("data-treevalue")){f=g.getAttribute("data-treevalue");for(e=0;e<this.treeProps.length;e++){if(this.treeProps[e].ID===f){d=e;break}}if(-1<d&&this.treeRowShowSize<this.showCount[d]){if(0>this.showStart[d]){this.showStart[d]++;BX.adjust(this.obTreeRows[d].LIST,{style:{marginLeft:this.showStart[d]*20+"%"}});BX.adjust(this.obTreeRows[d].RIGHT,{style:this.treeEnableArrow})}if(0<=this.showStart[d]){BX.adjust(this.obTreeRows[d].LEFT,{style:this.treeDisableArrow})}}}};b.JCCatalogProductSubscribeList.prototype.RowRight=function(){var e=0,f="",d=-1,g=BX.proxy_context;if(!!g&&g.hasAttribute("data-treevalue")){f=g.getAttribute("data-treevalue");for(e=0;e<this.treeProps.length;e++){if(this.treeProps[e].ID===f){d=e;break}}if(-1<d&&this.treeRowShowSize<this.showCount[d]){if((this.treeRowShowSize-this.showStart[d])<this.showCount[d]){this.showStart[d]--;BX.adjust(this.obTreeRows[d].LIST,{style:{marginLeft:this.showStart[d]*20+"%"}});BX.adjust(this.obTreeRows[d].LEFT,{style:this.treeEnableArrow})}if((this.treeRowShowSize-this.showStart[d])>=this.showCount[d]){BX.adjust(this.obTreeRows[d].RIGHT,{style:this.treeDisableArrow})}}}};b.JCCatalogProductSubscribeList.prototype.UpdateRow=function(k,j,d,q){var s=0,t=0,p="",e=0,v="",g={},m=false,h=false,o=false,n=0,l=this.treeEnableArrow,u=this.treeEnableArrow,f=0,r=null;if(-1<k&&k<this.obTreeRows.length){r=BX.findChildren(this.obTreeRows[k].LIST,{tagName:"li"},false);if(!!r&&0<r.length){m=("PICT"===this.treeProps[k].SHOW_MODE);e=d.length;h=this.treeRowShowSize<e;v=(h?(100/e)+"%":"20%");g={props:{className:""},style:{width:v}};if(m){g.style.paddingTop=v}for(s=0;s<r.length;s++){p=r[s].getAttribute("data-onevalue");o=(p===j);g.props.className=(o?"bx_active":"");g.style.display="none";if(BX.util.in_array(p,d)){g.style.display="";if(o){n=t}t++}BX.adjust(r[s],g)}g={style:{width:(h?20*e:100)+"%",marginLeft:"0%"}};if(m){BX.adjust(this.obTreeRows[k].CONT,{props:{className:(h?"bx_item_detail_scu full":"bx_item_detail_scu")}})}else{BX.adjust(this.obTreeRows[k].CONT,{props:{className:(h?"bx_item_detail_size full":"bx_item_detail_size")}})}if(h){if(n+1===e){u=this.treeDisableArrow}if(this.treeRowShowSize<=n){f=this.treeRowShowSize-n-1;g.style.marginLeft=f*20+"%"}if(0===f){l=this.treeDisableArrow}BX.adjust(this.obTreeRows[k].LEFT,{style:l});BX.adjust(this.obTreeRows[k].RIGHT,{style:u})}else{BX.adjust(this.obTreeRows[k].LEFT,{style:{display:"none"}});BX.adjust(this.obTreeRows[k].RIGHT,{style:{display:"none"}})}BX.adjust(this.obTreeRows[k].LIST,g);this.showCount[k]=e;this.showStart[k]=f}}};b.JCCatalogProductSubscribeList.prototype.GetRowValues=function(e,g){var h=0,f,d=[],k=false,l=true;if(0===e.length){for(h=0;h<this.offers.length;h++){if(!BX.util.in_array(this.offers[h].TREE[g],d)){d[d.length]=this.offers[h].TREE[g]}}k=true}else{for(h=0;h<this.offers.length;h++){l=true;for(f in e){if(e[f]!==this.offers[h].TREE[f]){l=false;break}}if(l){if(!BX.util.in_array(this.offers[h].TREE[g],d)){d[d.length]=this.offers[h].TREE[g]}k=true}}}return(k?d:false)};b.JCCatalogProductSubscribeList.prototype.GetCanBuy=function(d){var f=0,e,g=false,h=true;for(f=0;f<this.offers.length;f++){h=true;for(e in d){if(d[e]!==this.offers[f].TREE[e]){h=false;break}}if(h){if(this.offers[f].CAN_BUY){g=true;break}}}return g};b.JCCatalogProductSubscribeList.prototype.SetCurrent=function(){var k=0,h=0,d=[],l="",g=false,f={},e=[],m=this.offers[this.offerNum].TREE;for(k=0;k<this.treeProps.length;k++){l="PROP_"+this.treeProps[k].ID;g=this.GetRowValues(f,l);if(!g){break}if(BX.util.in_array(m[l],g)){f[l]=m[l]}else{f[l]=g[0];this.offerNum=0}if(this.showAbsent){d=[];e=[];e=BX.clone(f,true);for(h=0;h<g.length;h++){e[l]=g[h];if(this.GetCanBuy(e)){d[d.length]=g[h]}}}else{d=g}this.UpdateRow(k,f[l],g,d)}this.selectedValues=f;this.ChangeInfo()};b.JCCatalogProductSubscribeList.prototype.ChangeInfo=function(){var f=0,e,d=-1,k={},g=true,h="";for(f=0;f<this.offers.length;f++){g=true;for(e in this.selectedValues){if(this.selectedValues[e]!==this.offers[f].TREE[e]){g=false;break}}if(g){d=f;break}}if(-1<d){if(!!this.obPict){if(!!this.offers[d].PREVIEW_PICTURE){BX.adjust(this.obPict,{style:{backgroundImage:"url("+this.offers[d].PREVIEW_PICTURE.SRC+")"}})}else{BX.adjust(this.obPict,{style:{backgroundImage:"url("+this.defaultPict.pict.SRC+")"}})}}if(this.secondPict&&!!this.obSecondPict){if(!!this.offers[d].PREVIEW_PICTURE_SECOND){BX.adjust(this.obSecondPict,{style:{backgroundImage:"url("+this.offers[d].PREVIEW_PICTURE_SECOND.SRC+")"}})}else{if(!!this.offers[d].PREVIEW_PICTURE.SRC){BX.adjust(this.obSecondPict,{style:{backgroundImage:"url("+this.offers[d].PREVIEW_PICTURE.SRC+")"}})}else{if(!!this.defaultPict.secondPict){BX.adjust(this.obSecondPict,{style:{backgroundImage:"url("+this.defaultPict.secondPict.SRC+")"}})}else{BX.adjust(this.obSecondPict,{style:{backgroundImage:"url("+this.defaultPict.pict.SRC+")"}})}}}}if(this.showSkuProps&&!!this.obSkuProps){BX.adjust(this.obSkuProps,{style:{display:"none"},html:""})}this.offerNum=d;this.QuantitySet(this.offerNum)}};b.JCCatalogProductSubscribeList.prototype.InitBasketUrl=function(){switch(this.productType){case 1:case 2:this.basketUrl=this.product.addUrl;break;case 3:this.basketUrl=this.offers[this.offerNum].ADD_URL;break}this.basketParams={ajax_basket:"Y"};if(this.showQuantity){this.basketParams[this.basketData.quantity]=this.obQuantity.value}};b.JCCatalogProductSubscribeList.prototype.FillBasketProps=function(){if(!this.visual.BASKET_PROP_DIV){return}var d=0,g=null,f=false,e=null;if(this.basketData.useProps&&!this.basketData.emptyProps){if(!!this.obPopupWin&&!!this.obPopupWin.contentContainer){e=this.obPopupWin.contentContainer}}else{e=BX(this.visual.BASKET_PROP_DIV)}if(!e){return}g=e.getElementsByTagName("select");if(!!g&&!!g.length){for(d=0;d<g.length;d++){if(!g[d].disabled){switch(g[d].type.toLowerCase()){case"select-one":this.basketParams[g[d].name]=g[d].value;f=true;break;default:break}}}}g=e.getElementsByTagName("input");if(!!g&&!!g.length){for(d=0;d<g.length;d++){if(!g[d].disabled){switch(g[d].type.toLowerCase()){case"hidden":this.basketParams[g[d].name]=g[d].value;f=true;break;case"radio":if(g[d].checked){this.basketParams[g[d].name]=g[d].value;f=true}break;default:break}}}}if(!f){this.basketParams[this.basketData.props]=[];this.basketParams[this.basketData.props][0]=0}};b.JCCatalogProductSubscribeList.prototype.SendToBasket=function(){if(!this.canBuy){return}this.InitBasketUrl();this.FillBasketProps();BX.ajax.loadJSON(this.basketUrl,this.basketParams,BX.delegate(this.BasketResult,this))};b.JCCatalogProductSubscribeList.prototype.Basket=function(){var d="";if(!this.canBuy){return}switch(this.productType){case 1:case 2:if(this.basketData.useProps&&!this.basketData.emptyProps){this.InitPopupWindow();this.obPopupWin.setTitleBar(BX.message("CPSL_TITLE_BASKET_PROPS"));if(BX(this.visual.BASKET_PROP_DIV)){d=BX(this.visual.BASKET_PROP_DIV).innerHTML}this.obPopupWin.setContent(d);this.obPopupWin.setButtons([new a({ownerClass:this.obProduct.parentNode.parentNode.parentNode.className,text:BX.message("CPSL_BTN_MESSAGE_SEND_PROPS"),events:{click:BX.delegate(this.SendToBasket,this)}})]);this.obPopupWin.show()}else{this.SendToBasket()}break;case 3:this.SendToBasket();break}};b.JCCatalogProductSubscribeList.prototype.BasketResult=function(g){var f="",d="",h="",i,e=[];if(!!this.obPopupWin){this.obPopupWin.close()}if(!BX.type.isPlainObject(g)){return}i=("OK"===g.STATUS);if(i){BX.onCustomEvent("OnBasketChange");d=this.product.name;switch(this.productType){case 1:case 2:h=this.product.pict.SRC;break;case 3:h=(!!this.offers[this.offerNum].PREVIEW_PICTURE?this.offers[this.offerNum].PREVIEW_PICTURE.SRC:this.defaultPict.pict.SRC);break}f='<div style="width: 100%; margin: 0; text-align: center;"><img src="'+h+'" height="130" style="max-height:130px"><p>'+d+"</p></div>";e=[new a({ownerClass:this.obProduct.parentNode.parentNode.parentNode.className,text:BX.message("CPSL_BTN_MESSAGE_BASKET_REDIRECT"),events:{click:BX.delegate(function(){location.href=(!!this.basketData.basketUrl?this.basketData.basketUrl:BX.message("CPSL_BASKET_URL"))},this)}})]}else{f=(!!g.MESSAGE?g.MESSAGE:BX.message("CPSL_BASKET_UNKNOWN_ERROR"));e=[new a({ownerClass:this.obProduct.parentNode.parentNode.parentNode.className,text:BX.message("CPSL_BTN_MESSAGE_CLOSE"),events:{click:BX.delegate(this.obPopupWin.close,this.obPopupWin)}})]}this.InitPopupWindow();this.obPopupWin.setTitleBar(BX.message("CPSL_TITLE_ERROR"));this.obPopupWin.setContent(f);this.obPopupWin.setButtons(e);this.obPopupWin.show()};b.JCCatalogProductSubscribeList.prototype.InitPopupWindow=function(){if(!!this.obPopupWin){return}this.obPopupWin=BX.PopupWindowManager.create("CatalogSectionBasket_"+this.visual.ID,null,{autoHide:false,offsetLeft:0,offsetTop:0,overlay:true,closeByEsc:true,titleBar:true,closeIcon:true,contentColor:"white"})};b.JCCatalogProductSubscribeList.prototype.deleteSubscribe=function(){var h,d;switch(this.productType){case 1:case 2:h=this.product.id;break;case 3:var f,e,g;if(!this.offers.length){h=this.product.id;break}for(f=0;f<this.offers.length;f++){g=true;for(e in this.selectedValues){if(this.selectedValues[e]!==this.offers[f].TREE[e]){g=false;break}}if(g){d=f;h=this.offers[f].ID;break}}break}if(!h||!this.product.listSubscribeId.hasOwnProperty(h)){return}BX.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:{sessid:BX.bitrix_sessid(),deleteSubscribe:"Y",itemId:h,listSubscribeId:this.product.listSubscribeId[h]},onsuccess:BX.delegate(function(i){if(i.success){this.showWindowWithAnswer({status:"success"})}else{this.showWindowWithAnswer({status:"error",message:i.message})}},this)})};b.JCCatalogProductSubscribeList.prototype.showWindowWithAnswer=function(f){f=f||{};if(!f.message){if(f.status=="success"){f.message=BX.message("CPSL_STATUS_SUCCESS")}else{f.message=BX.message("CPSL_STATUS_ERROR")}}var e=BX.create("div",{props:{className:"bx-catalog-subscribe-alert"},children:[BX.create("span",{props:{className:"bx-catalog-subscribe-aligner"}}),BX.create("span",{props:{className:"bx-catalog-subscribe-alert-text"},text:f.message}),BX.create("div",{props:{className:"bx-catalog-subscribe-alert-footer"}})]});var h=BX.PopupWindowManager.getCurrentPopup();if(h){h.destroy()}var d=setTimeout(function(){var i=BX.PopupWindowManager.getCurrentPopup();if(!i||i.uniquePopupId!="bx-catalog-subscribe-status-action"){return}i.close();i.destroy()},3500);var g=BX.PopupWindowManager.create("bx-catalog-subscribe-status-action",null,{content:e,onPopupClose:function(){this.destroy();clearTimeout(d)},autoHide:true,zIndex:2000,className:"bx-catalog-subscribe-alert-popup"});g.show();BX("bx-catalog-subscribe-status-action").onmouseover=function(i){clearTimeout(d)};BX("bx-catalog-subscribe-status-action").onmouseout=function(i){d=setTimeout(function(){var j=BX.PopupWindowManager.getCurrentPopup();if(!j||j.uniquePopupId!="bx-catalog-subscribe-status-action"){return}j.close();j.destroy()},3500)}}})(window);