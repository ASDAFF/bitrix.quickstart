BX.ready(function(){var a=BX.findChildren(BX("basket_items"),{tagName:"li",className:"sku_prop"},true);if(!!a&&a.length>0){for(i=0;a.length>i;i++){BX.bind(a[i],"click",BX.delegate(function(b){skuPropClickHandler(b)},this))}}});function skuPropClickHandler(h){if(!h){h=window.event}var j=BX.proxy_context;if(!!j&&j.hasAttribute("data-value-id")){BX.showWait();var l=j.getAttribute("data-element"),n=j.getAttribute("data-property"),k={},b={},f=BX("action_var").value;k[n]=j.getAttribute("data-value-id");if(BX.hasClass(j,"bx_active")){BX.closeWait();return}var a=BX.findChildren(BX(l),{tagName:"ul",className:"sku_prop_list"},true);if(!!a&&a.length>0){for(var g=0;a.length>g;g++){if(a[g].id=="prop_"+n+"_"+l){continue}else{var c=BX.findChildren(BX(a[g].id),{tagName:"li",className:"bx_active"},true);if(!!c&&c.length>0){for(var d=0;c.length>d;d++){if(c[d].hasAttribute("data-value-id")){k[c[d].getAttribute("data-property")]=c[d].getAttribute("data-value-id")}}}}}}b={basketItemId:l,sessid:BX.bitrix_sessid(),site_id:BX.message("SITE_ID"),props:k,action_var:f,select_props:BX("column_headers").value,offers_props:BX("offers_props").value,quantity_float:BX("quantity_float").value,count_discount_4_all_quantity:BX("count_discount_4_all_quantity").value,price_vat_show_value:BX("price_vat_show_value").value,hide_coupon:BX("hide_coupon").value,use_prepayment:BX("use_prepayment").value};b[f]="select_item";BX.ajax({url:"/bitrix/components/bejetstore/sale.basket.basket/ajax.php",method:"POST",data:b,dataType:"json",onsuccess:function(e){BX.closeWait();updateBasketTable(l,e)}})}}function updateBasketTable(S,O){var x=BX("basket_items");if(!x){return}var ad=x.rows,X=O.BASKET_ID,r=O.BASKET_DATA["GRID"]["ROWS"][X],F=ad[ad.length-1],b=document.createElement("tr"),C=O.COLUMNS.split(","),W=false,L=false,af=false,D=false,l=(O.PARAMS["QUANTITY_FLOAT"]=="Y")?true:false;if(S!==null){var H=BX(S);b.setAttribute("id",O.BASKET_ID);F.parentNode.insertBefore(b,H.nextSibling);if(O.DELETE_ORIGINAL=="Y"){H.parentNode.removeChild(H)}var V=b.insertCell(-1);V.setAttribute("class","margin");for(ac=0;ac<C.length;ac++){if(C[ac]=="DELETE"){W=true}if(C[ac]=="DELAY"){L=true}if(C[ac]=="PROPS"){af=true}if(C[ac]=="TYPE"){D=true}}for(ac=0;ac<C.length;ac++){if(C[ac]=="PROPS"||C[ac]=="DELAY"||C[ac]=="DELETE"||C[ac]=="TYPE"){continue}if(C[ac]=="NAME"){var g=b.insertCell(-1),y="",T="";g.setAttribute("class","itemphoto");if(r.PREVIEW_PICTURE_SRC.length>0){y=r.PREVIEW_PICTURE_SRC}else{if(r.DETAIL_PICTURE_SRC.length>0){y=r.DETAIL_PICTURE_SRC}else{y=basketJSParams.TEMPLATE_FOLDER+"/images/no_photo.png"}}if(r.DETAIL_PAGE_URL.length>0){T='<div class="bx_ordercart_photo_container">						<a href="'+r.DETAIL_PAGE_URL+'">							<div class="bx_ordercart_photo" style="background-image:url(\''+y+"')\"></div>						</a>					</div>"}else{T='<div class="bx_ordercart_photo_container">						<div class="bx_ordercart_photo" style="background-image:url(\''+y+"')\"></div>					</div>"}if(r.BRAND&&r.BRAND.length>0){T+='<div class="bx_ordercart_brand">						<img alt="" src="'+r.BRAND+'"/>					</div>'}g.innerHTML=T;var v=b.insertCell(-1),d="";v.setAttribute("class","item");if(r.DETAIL_PAGE_URL.length>0){d+='<h2 class="bx_ordercart_itemtitle"><a href="'+r.DETAIL_PAGE_URL+'">'+r.NAME+"</a></h2>"}else{d+='<h2 class="bx_ordercart_itemtitle">'+r.NAME+"</h2>"}d+='<div class="bx_ordercart_itemart">';if(af){var z;for(var ab=0;ab<r.PROPS.length;ab++){var J=r.PROPS[ab];if(r.SKU_DATA){z=false;for(var s in r.SKU_DATA){if(r.SKU_DATA.hasOwnProperty(s)){var e=r.SKU_DATA[s];if(e.CODE==J.CODE){z=true;break}}}if(z){continue}}d+=J.NAME+":&nbsp;<span>"+J.VALUE+"</span><br/>"}}d+="</div>";if(r.SKU_DATA){var e,Q,ag,G;for(var s in r.SKU_DATA){if(r.SKU_DATA.hasOwnProperty(s)){e=r.SKU_DATA[s];Q=false;ag=(Object.keys(e.VALUES).length>5)?"full":"";for(var h in e.VALUES){G=e.VALUES[h];if(G.PICT!==false){Q=true;break}}if(Q){d+='<div class="bx_item_detail_scu_small_noadaptive '+ag+'">';d+='<span class="bx_item_section_name_gray">'+e.NAME+"</span>";d+='<div class="bx_scu_scroller_container">';d+='<div class="bx_scu">';d+='<ul id="prop_'+e.CODE+"_"+r.ID+'" style="width: 200%; margin-left:0%;" class="sku_prop_list">';var u,K;for(var q in e.VALUES){u=e.VALUES[q];K="";for(var Y=0;Y<r.PROPS.length;Y++){var o=r.PROPS[Y];if(o.CODE==e.CODE){if(o.VALUE==u.NAME||o.VALUE==u.XML_ID){K="bx_active"}}}d+='<li style="width:10%;"														class="sku_prop '+K+'"														data-value-id="'+u.XML_ID+'"														data-element="'+r.ID+'"														data-property="'+e.CODE+'"														>														<a href="javascript:void(0);">															<span style="background-image:url('+u.PICT["SRC"]+')"></span>														</a>													</li>'}d+="</ul>";d+="</div>";d+='<div class="bx_slide_left" onclick="leftScroll(\''+e.CODE+"', "+r.ID+');"></div>';d+='<div class="bx_slide_right" onclick="rightScroll(\''+e.CODE+"', "+r.ID+');"></div>';d+="</div>";d+="</div>"}else{d+='<div class="bx_item_detail_size_small_noadaptive '+ag+'">';d+='<span class="bx_item_section_name_gray">'+e.NAME+"</span>";d+='<div class="bx_size_scroller_container">';d+='<div class="bx_size">';d+='<ul id="prop_'+e.CODE+"_"+r.ID+'" style="width: 200%; margin-left:0%;" class="sku_prop_list">';for(var q in e.VALUES){var u=e.VALUES[q],K="";for(var Y=0;Y<r.PROPS.length;Y++){var o=r.PROPS[Y];if(o.CODE==e.CODE){if(o.VALUE==u.NAME){K="bx_active"}}}d+='<li style="width:10%;"														class="sku_prop '+K+'"														data-value-id="'+u.NAME+'"														data-element="'+r.ID+'"														data-property="'+e.CODE+'"														>														<a href="javascript:void(0);">'+u.NAME+"</span></a>													</li>"}d+="</ul>";d+="</div>";d+='<div class="bx_slide_left" onclick="leftScroll(\''+e.CODE+"', "+r.ID+');"></div>';d+='<div class="bx_slide_right" onclick="rightScroll(\''+e.CODE+"', "+r.ID+');"></div>';d+="</div>";d+="</div>"}}}}v.innerHTML=d}else{if(C[ac]=="QUANTITY"){var t=b.insertCell(-1),aa="",U=(parseFloat(r.MEASURE_RATIO)>0)?r.MEASURE_RATIO:1,B=(parseFloat(r.AVAILABLE_QUANTITY)>0)?'max="'+r.AVAILABLE_QUANTITY+'"':"";var c=false;if(U!=0&&U!=""){var A=r.QUANTITY;r.QUANTITY=getCorrectRatioQuantity(r.QUANTITY,U,l);if(A!=r.QUANTITY){c=true}}t.setAttribute("class","custom");aa+="<span>"+getColumnName(O,C[ac])+":</span>";aa+='<div class="centered">';if(U!=0&&U!=""){aa+='<td id="" class="custom">						<div class="">';aa+='<a href="javascript:void(0);" class="bj-quantity-minus minus" onclick="setQuantity('+r.ID+", "+U+", 'down', "+l+');"></a>';aa+='<input										type="text"										size="3"										class="bj-quantity-input"										id="QUANTITY_INPUT_'+r.ID+'"										name="QUANTITY_INPUT_'+r.ID+'"										size="2"										maxlength="18"										min="0"										'+B+"										step="+U+'										style="max-width: 50px"										value="'+r.QUANTITY+'"										onchange="updateQuantity(\'QUANTITY_INPUT_'+r.ID+"','"+r.ID+"', "+U+","+l+')"										>';aa+='<a href="javascript:void(0);" class="bj-quantity-plus plus" onclick="setQuantity('+r.ID+", "+U+", 'up', "+l+');"></a></div></td>'}if(r.hasOwnProperty("MEASURE_TEXT")&&r.MEASURE_TEXT.length>0){aa+=""}aa+="</div>";aa+=getMobileQuantityControl("QUANTITY_SELECT_"+r.ID,"QUANTITY_SELECT_"+r.ID,r.QUANTITY,r.AVAILABLE_QUANTITY,r.MEASURE_RATIO,r.MEASURE_TEXT);aa+='<input type="hidden" id="QUANTITY_'+r.ID+'" name="QUANTITY_'+r.ID+'" value="'+r.QUANTITY+'" />';t.innerHTML=aa;if(c){updateQuantity("QUANTITY_INPUT_"+r.ID,r.ID,U,l)}}else{if(C[ac]=="PRICE"){var Z=b.insertCell(-1),a=(r.FULL_PRICE_FORMATED!=r.PRICE_FORMATED)?r.FULL_PRICE_FORMATED:"";Z.setAttribute("class","price");Z.innerHTML+='<div class="current_price" id="current_price_'+r.ID+'">'+r.PRICE_FORMATED+"</div>";Z.innerHTML+='<div class="old_price" id="old_price_'+r.ID+'">'+a+"</div>";if(D&&r.NOTES.length>0){Z.innerHTML+='<div class="type_price">'+basketJSParams.SALE_TYPE+"</div>";Z.innerHTML+='<div class="type_price_value">'+r.NOTES+"</div>"}}else{if(C[ac]=="DISCOUNT"){var m=b.insertCell(-1);m.setAttribute("class","custom");m.innerHTML="<span>"+getColumnName(O,C[ac])+":</span>";m.innerHTML+='<div id="discount_value_'+r.ID+'">'+r.DISCOUNT_PRICE_PERCENT_FORMATED+"</div>"}else{if(C[ac]=="WEIGHT"){var w=b.insertCell(-1);w.setAttribute("class","custom");w.innerHTML="<span>"+getColumnName(O,C[ac])+":</span>";w.innerHTML+=r.WEIGHT_FORMATED}else{var f=b.insertCell(-1),N="";f.setAttribute("class","custom");f.innerHTML="<span>"+getColumnName(O,C[ac])+":</span>";if(C[ac]=="SUM"){N+='<div id="sum_'+r.ID+'">'}if(typeof(r[C[ac]])!="undefined"){N+=r[C[ac]]}if(C[ac]=="SUM"){N+="</div>"}f.innerHTML+=N}}}}}}if(W||L){var ae=b.insertCell(-1);ae.setAttribute("class","control");if(W){ae.innerHTML='<a href="'+basketJSParams.DELETE_URL.replace("#ID#",r.ID)+'">'+basketJSParams.SALE_DELETE+"</a><br />"}if(L){ae.innerHTML+='<a href="'+basketJSParams.DELAY_URL.replace("#ID#",r.ID)+'">'+basketJSParams.SALE_DELAY+"</a>"}}var p=b.insertCell(-1);p.setAttribute("class","margin");var n=BX.findChildren(BX(X),{tagName:"li",className:"sku_prop"},true);if(!!n&&n.length>0){for(ac=0;n.length>ac;ac++){BX.bind(n[ac],"click",BX.delegate(function(j){skuPropClickHandler(j)},this))}}}for(var P in O.BASKET_DATA.GRID.ROWS){if(O.BASKET_DATA.GRID.ROWS.hasOwnProperty(P)){var M=O.BASKET_DATA.GRID.ROWS[P];if(BX("discount_value_"+P)){BX("discount_value_"+P).innerHTML=M.DISCOUNT_PRICE_PERCENT_FORMATED}if(BX("current_price_"+P)){BX("current_price_"+P).innerHTML=M.PRICE_FORMATED}if(BX("old_price_"+P)){BX("old_price_"+P).innerHTML=(M.FULL_PRICE_FORMATED!=M.PRICE_FORMATED)?M.FULL_PRICE_FORMATED:""}if(BX("sum_"+P)){BX("sum_"+P).innerHTML=M.SUM}if(BX("QUANTITY_"+P)){BX("QUANTITY_INPUT_"+P).value=M.QUANTITY;BX("QUANTITY_INPUT_"+P).defaultValue=M.QUANTITY;var R,E=BX("QUANTITY_SELECT_"+P).options,ac=E.length;while(ac--){R=E[ac];if(parseFloat(R.value).toFixed(2)==parseFloat(M.QUANTITY).toFixed(2)){R.selected=true}}BX("QUANTITY_"+P).value=M.QUANTITY}}}if(BX("coupon")){var ah="";if(BX("coupon_approved")&&BX("coupon").value.length==0){BX("coupon_approved").value="N"}if(O.hasOwnProperty("VALID_COUPON")){ah=(!!O.VALID_COUPON)?"good":"bad";if(BX("coupon_approved")){BX("coupon_approved").value=(!!O.VALID_COUPON)?"Y":"N"}}if(BX("coupon_approved")&&BX("coupon").value.length>0){ah=BX("coupon_approved").value=="Y"?"good":"bad"}else{ah=""}BX("coupon").className=ah}if(O.hasOwnProperty("WARNING_MESSAGE")){var I="";for(var ac=O.WARNING_MESSAGE.length-1;ac>=0;ac--){I+=O.WARNING_MESSAGE[ac]+"<br/>"}BX("warning_message").innerHTML=I}if(BX("allWeight_FORMATED")){BX("allWeight_FORMATED").innerHTML=O.BASKET_DATA["allWeight_FORMATED"].replace(/\s/g,"&nbsp;")}if(BX("allSum_wVAT_FORMATED")){BX("allSum_wVAT_FORMATED").innerHTML=O.BASKET_DATA["allSum_wVAT_FORMATED"].replace(/\s/g,"&nbsp;")}if(BX("allVATSum_FORMATED")){BX("allVATSum_FORMATED").innerHTML=O.BASKET_DATA["allVATSum_FORMATED"].replace(/\s/g,"&nbsp;")}if(BX("allSum_FORMATED")){BX("allSum_FORMATED").innerHTML=O.BASKET_DATA["allSum_FORMATED"].replace(/\s/g,"&nbsp;")}if(BX("PRICE_WITHOUT_DISCOUNT")){BX("PRICE_WITHOUT_DISCOUNT").innerHTML=(O.BASKET_DATA["PRICE_WITHOUT_DISCOUNT"]!=O.BASKET_DATA["allSum_FORMATED"])?O.BASKET_DATA["PRICE_WITHOUT_DISCOUNT"].replace(/\s/g,"&nbsp;"):""}}function getColumnName(a,b){return BX("col_"+b).innerHTML.trim()}function getMobileQuantityControl(b,a,n,g,m,e){var g=parseFloat(g),m=(parseFloat(m)!=0&&!isNaN(parseFloat(m)))?parseFloat(m):1,c=(m>0&&m!=1)?m:1,d=b.replace("QUANTITY_SELECT_",""),k="",l="";if(g===0){k="disabled";g=1}l='<div class="some-class" style="display:none">';l+='<select id="'+b+'" name="'+a+'" onchange="updateQuantity(\''+b+"', "+d+", "+m+');" '+k+">";for(var h=c;h<=g;h=h+m){var f=false;if(parseInt(h)!=parseFloat(h)){f=true}selected=(h==n)?"selected":"";l+="<option value="+h+" "+selected+">"+(f?parseFloat(h).toFixed(2):parseInt(h))+"</option>"}l+="</select>";if(e!==undefined){l+=e}l+="</div>";return l}function leftScroll(d,c){var b=BX("prop_"+d+"_"+c);if(b){var a=parseInt(b.style.marginLeft);if(a<0){b.style.marginLeft=a+20+"%"}}}function rightScroll(d,c){var b=BX("prop_"+d+"_"+c);if(b){var a=parseInt(b.style.marginLeft);if(a>=0){b.style.marginLeft=a-20+"%"}}}function checkOut(){BX("basket_form").submit();return true}function enterCoupon(){recalcBasketAjax()}function updateQuantity(o,d,m,c){var n=BX(o).defaultValue,b=parseFloat(BX(o).value)||0,h=false;if(m===0||m==1){h=true}else{var e=b*10000,f=m*10000,l=e%f,a=parseInt(b);if(l===0){h=true}}var g=false;if(parseInt(b)!=parseFloat(b)){g=true}b=(c===false&&g===false)?parseInt(b):parseFloat(b).toFixed(2);if(h){BX(o).defaultValue=b;BX("QUANTITY_INPUT_"+d).value=b;var k,p=BX("QUANTITY_SELECT_"+d).options,j=p.length;while(j--){k=p[j];if(parseFloat(k.value).toFixed(2)==parseFloat(b).toFixed(2)){k.selected=true}}BX("QUANTITY_"+d).value=b;recalcBasketAjax()}else{b=getCorrectRatioQuantity(b,m,c);if(b!=n){BX("QUANTITY_INPUT_"+d).value=b;BX("QUANTITY_"+d).value=b;recalcBasketAjax()}else{BX(o).value=n}}}function setQuantity(b,e,a,f){var d=parseFloat(BX("QUANTITY_INPUT_"+b).value),c;c=(a=="up")?d+e:d-e;if(c<0){c=0}if(f){c=c.toFixed(2)}if(e>0&&c<e){c=e}if(!f&&c!=c.toFixed(2)){c=c.toFixed(2)}c=getCorrectRatioQuantity(c,e,f);BX("QUANTITY_INPUT_"+b).value=c;BX("QUANTITY_INPUT_"+b).defaultValue=c;updateQuantity("QUANTITY_INPUT_"+b,b,e,f)}function getCorrectRatioQuantity(d,h,a){var b=d*10000,c=h*10000,g=b%c,k=d,e=false,h=parseFloat(h);if(g===0){return k}if(h!==0&&h!=1){for(var f=h,j=parseFloat(d)+parseFloat(h);f<=j;f=parseFloat(parseFloat(f)+parseFloat(h)).toFixed(2)){k=f}}else{if(h===1){k=d|0}}if(parseInt(k)!=parseFloat(k)){e=true}k=(a===false&&e===false)?parseInt(k):parseFloat(k).toFixed(2);return k}function recalcBasketAjax(){BX.showWait();var e={},d=BX("action_var").value,b=BX("basket_items"),f=BX("delayed_items");var a={sessid:BX.bitrix_sessid(),site_id:BX.message("SITE_ID"),props:e,action_var:d,select_props:BX("column_headers").value,offers_props:BX("offers_props").value,quantity_float:BX("quantity_float").value,count_discount_4_all_quantity:BX("count_discount_4_all_quantity").value,price_vat_show_value:BX("price_vat_show_value").value,hide_coupon:BX("hide_coupon").value,use_prepayment:BX("use_prepayment").value,coupon:!!BX("coupon")?BX("coupon").value:""};a[d]="recalculate";if(!!b&&b.rows.length>0){for(var c=1;b.rows.length>c;c++){a["QUANTITY_"+b.rows[c].id]=BX("QUANTITY_"+b.rows[c].id).value}}if(!!f&&f.rows.length>0){for(var c=1;f.rows.length>c;c++){a["DELAY_"+f.rows[c].id]="Y"}}BX.ajax({url:"/bitrix/components/bejetstore/sale.basket.basket/ajax.php",method:"POST",data:a,dataType:"json",onsuccess:function(g){BX.closeWait();updateBasketTable(null,g)}})}function showBasketItemsList(a){BX.removeClass(BX("basket_toolbar_button"),"current");BX.removeClass(BX("basket_toolbar_button_delayed"),"current");BX.removeClass(BX("basket_toolbar_button_subscribed"),"current");BX.removeClass(BX("basket_toolbar_button_not_available"),"current");BX("normal_count").style.display="inline-block";BX("delay_count").style.display="inline-block";BX("subscribe_count").style.display="inline-block";BX("not_available_count").style.display="inline-block";if(a==2){if(BX("basket_items_list")){BX("basket_items_list").style.display="none"}if(BX("basket_items_delayed")){BX("basket_items_delayed").style.display="block";BX.addClass(BX("basket_toolbar_button_delayed"),"current");BX("delay_count").style.display="none"}if(BX("basket_items_subscribed")){BX("basket_items_subscribed").style.display="none"}if(BX("basket_items_not_available")){BX("basket_items_not_available").style.display="none"}}else{if(a==3){if(BX("basket_items_list")){BX("basket_items_list").style.display="none"}if(BX("basket_items_delayed")){BX("basket_items_delayed").style.display="none"}if(BX("basket_items_subscribed")){BX("basket_items_subscribed").style.display="block";BX.addClass(BX("basket_toolbar_button_subscribed"),"current");BX("subscribe_count").style.display="none"}if(BX("basket_items_not_available")){BX("basket_items_not_available").style.display="none"}}else{if(a==4){if(BX("basket_items_list")){BX("basket_items_list").style.display="none"}if(BX("basket_items_delayed")){BX("basket_items_delayed").style.display="none"}if(BX("basket_items_subscribed")){BX("basket_items_subscribed").style.display="none"}if(BX("basket_items_not_available")){BX("basket_items_not_available").style.display="block";BX.addClass(BX("basket_toolbar_button_not_available"),"current");BX("not_available_count").style.display="none"}}else{if(BX("basket_items_list")){BX("basket_items_list").style.display="block";BX.addClass(BX("basket_toolbar_button"),"current");BX("normal_count").style.display="none"}if(BX("basket_items_delayed")){BX("basket_items_delayed").style.display="none"}if(BX("basket_items_subscribed")){BX("basket_items_subscribed").style.display="none"}if(BX("basket_items_not_available")){BX("basket_items_not_available").style.display="none"}}}}};