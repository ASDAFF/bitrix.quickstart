BX.namespace("BX.Sale.OrderAjaxComponent.Maps");(function(){"use strict";BX.Sale.OrderAjaxComponent.Maps={init:function(t){this.context=t||{};this.pickUpOptions=this.context.options.pickUpMap;this.propsOptions=this.context.options.propertyMap;this.maxWaitTimeExpired=false;this.icons={red:"http://maps.google.com/mapfiles/ms/icons/red-dot.png",green:"http://maps.google.com/mapfiles/ms/icons/green-dot.png"};return this},initializePickUpMap:function(t){if(!google)return;this.markers=[];this.bounds=new google.maps.LatLngBounds;var e=!!t?parseFloat(BX.util.trim(t.GPS_N)):this.pickUpOptions.defaultMapPosition.lat,s=!!t?parseFloat(BX.util.trim(t.GPS_S)):this.pickUpOptions.defaultMapPosition.lon;this.pickUpMap=new google.maps.Map(BX("pickUpMap"),{center:{lat:e,lng:s},zoom:this.pickUpOptions.defaultMapPosition.zoom,scrollwheel:false});google.maps.event.addListener(this.pickUpMap,"click",BX.proxy(this.closeAllBalloons,this))},canUseRecommendList:function(){return false},getRecommendedStoreIds:function(t,e){return[]},getDistance:function(t,e){return false},pickUpMapFocusWaiter:function(){if(this.pickUpMap&&this.markers.length){this.setPickUpMapFocus()}else{setTimeout(BX.proxy(this.pickUpMapFocusWaiter,this),100)}},setPickUpMapFocus:function(){google.maps.event.trigger(this.pickUpMap,"resize");this.pickUpMap.fitBounds(this.bounds)},showNearestPickups:function(t,e){},buildBalloons:function(t){if(!google)return;var e,s;var i=this;for(e=0;e<t.length;e++){s=new google.maps.Marker({position:{lat:parseFloat(t[e].GPS_N),lng:parseFloat(t[e].GPS_S)},map:this.pickUpMap,title:t[e].TITLE});s.info=new google.maps.InfoWindow({content:"<h3>"+BX.util.htmlspecialchars(t[e].TITLE)+"</h3>"+this.getStoreInfoHtml(t[e])+"<br />"+'<a class="btn btn-sm btn-default" data-store="'+t[e].ID+'">'+this.context.params.MESS_SELECT_PICKUP+"</a>"});s.storeId=t[e].ID;google.maps.event.addListener(s.info,"domready",function(){var t=document.querySelector("a[data-store]");if(t){BX.bind(t,"click",BX.proxy(i.selectStoreByClick,i))}});google.maps.event.addListener(s,"click",function(){i.closeAllBalloons();this.info.open(this.getMap(),this)});if(BX("BUYER_STORE").value===t[e].ID){s.setIcon(this.icons.green)}else{s.setIcon(this.icons.red)}this.markers.push(s);this.bounds.extend(s.getPosition())}},selectStoreByClick:function(t){var e=t.target||t.srcElement;this.context.selectStore(e.getAttribute("data-store"));this.context.clickNextAction(t);this.closeAllBalloons()},closeAllBalloons:function(){for(var t=0;t<this.markers.length;t++){this.markers[t].info.close()}},selectBalloon:function(t){if(!this.pickUpMap||!this.markers||!this.markers.length)return;for(var e=0;e<this.markers.length;e++){if(this.markers[e].storeId===t){this.markers[e].setIcon(this.icons.green);this.pickUpMap.panTo(this.markers[e].getPosition())}else{this.markers[e].setIcon(this.icons.red)}}},pickUpFinalAction:function(){},initializePropsMap:function(t){if(!google)return;this.propsMap=new google.maps.Map(BX("propsMap"),{center:{lat:t.lat,lng:t.lon},zoom:t.zoom,scrollwheel:false});this.currentPropsMapCenter=this.propsMap.getCenter();google.maps.event.addListener(this.propsMap,"click",BX.delegate(function(t){if(!this.propsMarker){this.propsMarker=new google.maps.Marker({position:t.latLng,map:this.propsMap,draggable:true});this.propsMarker.addListener("drag",BX.proxy(this.onPropsMarkerChanged,this));this.propsMarker.addListener("dragend",BX.proxy(this.onPropsMarkerChanged,this))}else{this.propsMarker.setPosition(t.latLng)}this.currentPropsMapCenter=t.latLng;this.onPropsMarkerChanged({latLng:t.latLng})},this))},onPropsMarkerChanged:function(t){var e=BX("orderDescription",true),s=t.latLng.lat(),i=t.latLng.lng(),o,r,a,n;if(e){o=e.value.indexOf(BX.message("SOA_MAP_COORDS")+":");if(o===-1){e.value=BX.message("SOA_MAP_COORDS")+": "+s+", "+i+"\r\n"+e.value}else{n=BX.message("SOA_MAP_COORDS")+": "+s+", "+i;r=e.value.substring(0,o);a=e.value.substring(o+n.length);e.value=r+n+a}}},propsMapFocusWaiter:function(){if(this.propsMap){this.setPropsMapFocus()}else{setTimeout(BX.proxy(this.propsMapFocusWaiter,this),100)}},setPropsMapFocus:function(){google.maps.event.trigger(this.propsMap,"resize");this.propsMap.setCenter(this.currentPropsMapCenter)},getStoreInfoHtml:function(t){var e="";if(t.ADDRESS)e+=BX.message("SOA_PICKUP_ADDRESS")+": "+BX.util.htmlspecialchars(t.ADDRESS)+"<br />";if(t.PHONE)e+=BX.message("SOA_PICKUP_PHONE")+": "+BX.util.htmlspecialchars(t.PHONE)+"<br />";if(t.SCHEDULE)e+=BX.message("SOA_PICKUP_WORK")+": "+BX.util.htmlspecialchars(t.SCHEDULE)+"<br />";if(t.DESCRIPTION)e+=BX.message("SOA_PICKUP_DESC")+": "+BX.util.htmlspecialchars(t.DESCRIPTION)+"<br />";return e}}})();
//# sourceMappingURL=google_maps.map.js