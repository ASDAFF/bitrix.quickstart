function JCAdminTitleSearch(a){var b=this;this.arParams={AJAX_PAGE:a.AJAX_PAGE,CONTAINER_ID:a.CONTAINER_ID,INPUT_ID:a.INPUT_ID,MIN_QUERY_LEN:parseInt(a.MIN_QUERY_LEN)};if(a.WAIT_IMAGE){this.arParams.WAIT_IMAGE=a.WAIT_IMAGE}if(a.MIN_QUERY_LEN<=0){a.MIN_QUERY_LEN=1}this.cache=[];this.cache_key=null;this.startText="";this.currentRow=-1;this.RESULT=null;this.CONTAINER=null;this.INPUT=null;this.WAIT=null;this.Hide=function(){b.RESULT.style.display="none";b.RESULT.innerHTML="";b.currentRow=-1;b.UnSelectAll();BX.removeClass(b.INPUT.parentNode,"adm-header-search-block-active-popup")};this.ShowResult=function(c){var d=BX.pos(b.CONTAINER);d.width=d.right-d.left;b.RESULT.style.position="absolute";b.RESULT.style.top="4px";b.RESULT.style.left=(d.left-7)+"px";b.RESULT.style.width=(d.width+14)+"px";if(c!=null){b.RESULT.innerHTML=c}if(b.RESULT.innerHTML.length>0){b.RESULT.style.display="block";BX.addClass(b.INPUT.parentNode,"adm-header-search-block-active-popup")}else{this.Hide()}};this.onKeyPress=function(h){var g=BX.findChild(b.RESULT,{tag:"table","class":"adm-search-result"},true);if(!g){return false}var e=g.rows.length;switch(h){case 27:b.Hide();return true;case 40:if(b.RESULT.style.display=="none"){b.RESULT.style.display="block"}var j=-1;for(var d=0;d<e;d++){if(j==-1){j=d}if(b.currentRow<d){b.currentRow=d;break}else{if(g.rows[d].className=="adm-search-selected"){g.rows[d].className=""}}}if(d==e&&b.currentRow!=d){b.currentRow=j}g.rows[b.currentRow].className="adm-search-selected";return true;case 38:if(b.RESULT.style.display=="none"){b.RESULT.style.display="block"}var f=-1;for(var d=e-1;d>=0;d--){if(f==-1){f=d}if(b.currentRow>d){b.currentRow=d;break}else{if(g.rows[d].className=="adm-search-selected"){g.rows[d].className=""}}}if(d<0){b.currentRow=f}g.rows[b.currentRow].className="adm-search-selected";return true;case 13:if(b.RESULT.style.display=="block"){for(var d=0;d<e;d++){if(b.currentRow==d){if(!BX.findChild(g.rows[d],{"class":"adm-search-separator"},true)){var c=BX.findChild(g.rows[d],{tag:"a"},true);if(c){window.location=c.href;return true}}}}}return false}return false};this.onTimeout=function(){if(b.INPUT.value!=b.oldValue&&b.INPUT.value!=b.startText){if(b.INPUT.value.length>=b.arParams.MIN_QUERY_LEN){b.oldValue=b.INPUT.value;b.cache_key=b.arParams.INPUT_ID+"|"+b.INPUT.value;if(b.cache[b.cache_key]==null){if(b.WAIT){var d=BX.pos(b.INPUT);var c=(d.bottom-d.top)-2;b.WAIT.style.top=(d.top+1)+"px";b.WAIT.style.height=c+"px";b.WAIT.style.width=c+"px";b.WAIT.style.left=(d.right-c+2)+"px";b.WAIT.style.display="block"}BX.ajax.post(b.arParams.AJAX_PAGE,{ajax_call:"y",INPUT_ID:b.arParams.INPUT_ID,q:b.INPUT.value},function(e){b.cache[b.cache_key]=e;b.ShowResult(e);b.currentRow=-1;b.EnableMouseEvents();if(b.WAIT){b.WAIT.style.display="none"}setTimeout(b.onTimeout,500)})}else{b.ShowResult(b.cache[b.cache_key]);b.currentRow=-1;b.EnableMouseEvents();setTimeout(b.onTimeout,500)}}else{b.Hide();setTimeout(b.onTimeout,500)}}else{setTimeout(b.onTimeout,500)}};this.UnSelectAll=function(){var e=BX.findChild(b.RESULT,{tag:"table","class":"adm-search-result"},true);if(e){var d=e.rows.length;for(var c=0;c<d;c++){e.rows[c].className=""}}};this.EnableMouseEvents=function(){var e=BX.findChild(b.RESULT,{tag:"table","class":"adm-search-result"},true);if(e){var d=e.rows.length;for(var c=0;c<d;c++){e.rows[c].id="row_"+c;e.rows[c].onmouseover=function(f){if(b.currentRow!=this.id.substr(4)){b.UnSelectAll();this.className="adm-search-selected";b.currentRow=this.id.substr(4)}};e.rows[c].onmouseout=function(f){this.className="";b.currentRow=-1}}}};this.onFocusLost=function(c){setTimeout(function(){b.Hide()},250)};this.onFocusGain=function(){if(b.RESULT.innerHTML.length){b.ShowResult()}};this.onKeyDown=function(c){if(!c){c=window.event}if(b.RESULT.style.display=="block"){if(b.onKeyPress(c.keyCode)){return BX.PreventDefault(c)}}};this.Init=function(){this.CONTAINER=document.getElementById(this.arParams.CONTAINER_ID);this.RESULT=document.getElementById("bx-panel").appendChild(document.createElement("DIV"));this.RESULT.className="adm-search-result-wrap";this.RESULT.style.display="none";this.INPUT=document.getElementById(this.arParams.INPUT_ID);this.startText=this.oldValue=this.INPUT.value;BX.bind(this.INPUT,"focus",function(){b.onFocusGain()});BX.bind(this.INPUT,"blur",function(){b.onFocusLost()});BX.bind(window,"resize",function(){b.onFocusGain()});if(BX.browser.IsSafari()||BX.browser.IsIE()){this.INPUT.onkeydown=this.onKeyDown}else{this.INPUT.onkeypress=this.onKeyDown}if(this.arParams.WAIT_IMAGE){this.WAIT=document.body.appendChild(document.createElement("DIV"));this.WAIT.style.backgroundImage="url('"+this.arParams.WAIT_IMAGE+"')";if(!BX.browser.IsIE()){this.WAIT.style.backgroundRepeat="none"}this.WAIT.style.display="none";this.WAIT.style.position="absolute";this.WAIT.style.zIndex="1100"}setTimeout(this.onTimeout,500)};BX.ready(function(){b.Init(a)})};