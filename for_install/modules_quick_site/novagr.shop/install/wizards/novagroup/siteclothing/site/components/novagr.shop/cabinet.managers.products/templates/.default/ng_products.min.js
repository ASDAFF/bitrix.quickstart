var dcProduct={ajaxHandler:"",catalogIblockID:"",offersIblockID:"",htmlNewSize:"",choosedPhotos:{},choosedSizes:{},offerCounter:0,errorScrollElemId:"",pictureCounter:0,selectColors:[],colors:[],messages:[],strReplace:function(c,b,a){return a.replace(new RegExp(c,"g"),b)},init:function(b,e,c,d){var a=this;a.messages=d;a.catalogIblockID=e;a.offersIblockID=c;a.ajaxHandler=b;$("#products-t a.pic_popup").popover({title:"",trigger:"hover",html:true});if($.cookie("show_foto")==1){$("#products-t a.pic_popup").popover("disable")}$("#optionsCheckbox").change(function(){if(this.checked==true){$.cookie("show_foto","1",{path:"/managers-cabinet"});$("#products-t td.photo-td").attr("class","photo-td");$("#products-t th.photo-td").attr("class","photo-td");$("#products-t a.pic_popup").popover("disable")}else{$.cookie("show_foto","0",{path:"/managers-cabinet"});$("#products-t td.photo-td").attr("class","photo-td hidden");$("#products-t th.photo-td").attr("class","photo-td hidden");$("#products-t a.pic_popup").popover("enable")}});$("#fileInput").live("change",function(){$("#show_picture").val("1");$("#productEditForm").submit()});$("#price_product").live("change",function(){var f=$(this).val();$(".priceOf").each(function(g){var h=$(this).val();if(h==""||h==0){$(this).val(f)}})});$("#saveProductBtn").live("click",function(){dcProduct.preSaveProduct()});$("#firstBtn").live("click",function(){$("#modal_div_confirm").modal("hide");location.reload();return false});$("#secondBtn").live("click",function(){dcProduct.addProductForm();$("#modal_div_confirm").modal("hide");return false});$("a.delPhoto").live("click",function(){var f=$(this).data("photo-id");for(var g in dcProduct.choosedPhotos){if(g==f){delete dcProduct.choosedPhotos[g];$(this).parents(".photo_block").remove();return}}a.showEditForm($(this).data("item-id"),$(this).data("iblock-id"));return false});$(".addForm").on("click",function(){dcProduct.addProductForm();return false});$(".set-active").change(function(){var f=$(this).data("product-id");$.ajax({type:"POST",url:a.ajaxHandler,data:{state:this.checked,action:"change_active",product_id:f},dataType:"JSON",beforeSend:function(){a.showAjaxLoader()},success:function(g){a.hideAjaxLoader();if(g.result=="OK"){if(g.state=="Y"){$("#price-s-"+f).removeClass("hidden");$("#snyat-s-"+f).addClass("hidden")}else{$("#price-s-"+f).addClass("hidden");$("#snyat-s-"+f).removeClass("hidden")}}}})});$("a.editlink").live("click",function(){a.showEditForm($(this).data("item-id"),$(this).data("iblock-id"));return false});$("#ListTree a").on("click",function(){$("#section_name").text($(this).text());$("#section").val($(this).data("section-id"));$("#ListTree").modal("hide");return false});$("#photo_block select").live("change",function(){var h=$(this).val();var f=$(this).data("photo-id");if(h!=0){for(var g in dcProduct.choosedPhotos){if(g==f){dcProduct.choosedPhotos[g].elem_color=h;return}}}});$("#navigate-size a.navig").live("click",function(){var f="";var g=$(this).attr("iblock");if(this.hasAttribute("secid")){f=$(this).attr("secid")}dcProduct.GetElementsAjax($(this).attr("nPageSize"),$(this).attr("inumpage"),g,f);return false});$("#size_select").live("click",function(){$.ajax({type:"POST",url:dcProduct.ajaxHandler,data:{action:"get_classificator_popup",name:"add_size",AJAX:"Y",iblid:$(this).attr("iblid"),secid:$(this).val(),currentValues:dcProduct.getCurrentSizesValues()},dataType:"json",success:function(f){if(f.result=="OK"){$("#modal_div").html(f.html)}}});return false});$("#way .btn-success, #way tr").live("click",function(){var f=$(this).data("size-id");var g=$("#btn"+f);$(g).toggleClass("active");if($(g).hasClass("active")){$(g).text(dcProduct.messages.RECONSIDER);dcProduct.choosedSizes[f]={};dcProduct.choosedSizes[f].id=f;dcProduct.choosedSizes[f].name=$(this).data("size-name")}else{$(g).text(dcProduct.messages.LABEL_CHOOSE);delete dcProduct.choosedSizes[f]}$("#size-tr-"+f+" td").toggleClass("selected");return false});$("#btnChoose").live("click",function(){$("#modal_div").modal("hide");var l="";for(var k in dcProduct.choosedSizes){var f=dcProduct.choosedSizes[k].id;var h=dcProduct.choosedSizes[k].name;var g=a.strReplace("###",f,a.htmlNewSize);l+='<tr id="tr-for-size-'+f+'" class="sizeTR" data-size-id="'+f+'"><td>'+h+'<input type="hidden" value="'+f+'" name="DIMENSION_STD['+f+']"></td> 			<td class="size_tabl">'+g+'</td> 			<td class="wrap-choice"> 				<div id="wrapchoice_'+f+'"> 				</div> 				<p class="valid-f "><span name="colorSizeInput'+f+'" id="colorSizeInput'+f+'" value="" data-val="true" data-val-required="'+dcProduct.messages.LABEL_FIL_FIELD+'"> 				<a class="colorAdd name-label" data-size-id="'+f+'" href="#">'+dcProduct.messages.LABEL_ADD_COLOR+' <span class="arrow-required">*</span></a><span class="field-validation-valid help-inline" data-valmsg-for="colorSizeInput'+f+'" data-valmsg-replace="true"></span></span></td> 				<td class="tooltip-demo"><a data-original-title="'+dcProduct.messages.LABEL_DEL+'" data-placement="top" rel="tooltip" class="btn btn-danger del-size" data-size-id="'+f+'" href="#"><i class="icon-remove icon-white"></i></a></td></tr>'}if(l!=""){var j=$(l).appendTo("#sizes_body");j.find(".colorAdd").each(function(m){$(this).trigger("click")})}if($("tr.sizeTR").length){dcProduct.addSizeButtonOk()}return false});$(".del-size").live("click",function(){$("#tr-for-size-"+$(this).data("size-id")).remove();dcProduct.selectColorsArrGenerate();return false});$(".dell-choice a").live("click",function(){$(this).parents(".table-choice").remove();dcProduct.selectColorsArrGenerate();return false});$("a.colorAdd").live("click",function(){var f=$(this).data("size-id");dcProduct.offerCounter++;var j=dcProduct.offerCounter;var k="";for(var h in dcProduct.colors){k+='<option value="'+dcProduct.colors[h].ID+'">'+dcProduct.colors[h].NAME+"</option>"}var g=$('<div class="table-choice"> 						<div class="dell-choice"><a class="btn btn-danger" href="#">x</a></div> 						<table class="my-table"> 						<tbody><tr> 						<td> 						<div class="control-group my-td"> 							<label>'+dcProduct.messages.AJAX_FORM_COLOR+'</label> 							<div class="controls"> 								 <select data-title-mess="'+dcProduct.messages.AJAX_FORM_TITLE_MESS+'" data-add-label="'+dcProduct.messages.ADD_VALUE_LABEL+'" data-send-btn="'+dcProduct.messages.LABEL_BTN_SEND+'" name="colorOffer['+f+"]["+j+']" class="span3 colorSelect" data-color-id="" data-color-name="" data-add-mess="'+dcProduct.messages.AJAX_FORM_ADD_COLOR+'" data-search-container="add_color'+j+'" data-ajax-handler="'+dcProduct.ajaxHandler+'">'+k+'</select></div> 						</div> 						<div class="control-group my-td"> 							<label>'+dcProduct.messages.AJAX_FORM_QUANTINY+'</label> 							<div class="controls"> 								<input type="text" value="" name="quantityOffer['+f+"]["+j+']" class="span1"> 							</div> 						</div> 							<div class="valid-f price-valid"> 							<div class="control-group my-td"> 								<label>'+dcProduct.messages.AJAX_FORM_PRICE+' 								<span class="arrow-required">*</span></label> 								<div class="controls"> 									<input class="span1 priceOf" type="text" data-val-required="'+dcProduct.messages.AJAX_FORM_FILL_FIELD+'" data-val="true" value="" name="priceOffer['+f+"]["+j+']"> 									</div> 							</div> 						</div></td></tr></tbody></table></div>').appendTo("#wrapchoice_"+f);g.find("select").select2({formatNoMatches:dcProduct.formatNoMatchesCustom}).on("selected",function(){dcProduct.selectColorsArrGenerate()});return false});$("#choose_size").live("click",function(){var f={name:"add_size",action:"get_classificator_popup",offersIblockID:a.offersIblockID,currentValues:dcProduct.getCurrentSizesValues()};$.post(a.ajaxHandler,f,function(g){if(g.result=="OK"){$("#modal_div").html(g.html);$("#modal_div").modal("show");dcProduct.htmlNewSize=g.htmlNewSize;dcProduct.choosedSizes={}}},"json");return false})},selectColorsArrGenerate:function(){dcProduct.selectColors=[];$("tr.sizeTR").each(function(a){$(this).find("select.colorSelect").each(function(b){var c=$(this).select2("val");if(c!=""){dcProduct.selectColors[c]=dcProduct.findColorNameById(c)}})})},findColorNameById:function(b){for(var a in dcProduct.colors){if(b==dcProduct.colors[a].ID){return dcProduct.colors[a].NAME}}return""},getCurrentSizesValues:function(){var a=[];$("tr.sizeTR").each(function(b){a.push($(this).data("size-id"))});return a.join(",")},getColorsOptions:function(){var a="";for(var b in dcProduct.selectColors){a+='<option value="'+b+'">'+dcProduct.selectColors[b]+"</option>"}return a},GetElementsAjax:function(b,d,c,a){$.ajax({type:"POST",url:dcProduct.ajaxHandler,data:{AJAX:"Y",nPageSize:b,iNumPage:d,iblid:c,secid:a,currentValues:dcProduct.getCurrentSizesValues()},dataType:"json",success:function(e){if(e.result=="OK"){$("#way").html(e.html);dcProduct.sizesButtonsCheck()}}})},sizesButtonsCheck:function(){var a=[];for(var b in dcProduct.choosedSizes){a.push(dcProduct.choosedSizes[b].id)}$("#way tr").each(function(e){var c=$(this).data("size-id");if(c&&jQuery.inArray(c,a)!=-1){var d=$("#btn"+c);$(d).text(dcProduct.messages.LABEL_CHANGE_MIND).addClass("active");$(this).find("td").addClass("selected")}})},showAjaxLoader:function(){var a=$(".page-container").height();var b='<div class="centerbg1" id="preloaderbg" style="display: block;height: '+a+'px"> 	      <div class="centerbg2"> 	        <div id="preloader"></div> 	      </div> 	    </div>';$(b).prependTo("body")},hideAjaxLoader:function(){$("#preloaderbg").remove()},preSaveProduct:function(){$("#show_picture").val("0");$("#photo_object").val(JSON.stringify(dcProduct.choosedPhotos))},fieldError:function(a,c){var b=$(a);b.parents(".control-group").attr("class","control-group error");var d="input-validation-error";if(c){d=c+" "+d}b.attr("class",d)},fieldOK:function(a,c){var b=$(a);b.parents(".control-group").removeClass("error");b.attr("class",c)},ValidateEditForm:function(){dcProduct.errorScrollElemId="";var e=$("#show_picture").val();var b="";var a=[];if(e==0){if($("#name_product").val()==""){dcProduct.makeErrorScrollElem("#name_product");dcProduct.fieldError("#name_product","span5");a.push(dcProduct.messages.WARNING_NAME)}else{dcProduct.fieldOK("#name_product","span5")}if($("#section").val()==""){$("#addGroup").addClass("error");$("#section").parents(".control-group").addClass("error");a.push(dcProduct.messages.WARNING_GROUP)}else{$("#addGroup").removeClass("error");$("#section").parents(".control-group").removeClass("error")}var g=$('.select2-container input[name="brand_id"]');if(g.val()==""){$("#brandLabel").addClass("error");a.push(dcProduct.messages.WARNING_BRAND)}else{$("#brandLabel").removeClass("error")}var d=$('.select2-container input[name="material_id"]');if(d.val()==""){$("#materLabel").addClass("error");a.push(dcProduct.messages.WARNING_MATERIAL)}else{$("#materLabel").removeClass("error")}if($("#photo_block select").length){$("#photo_block select.selectpicker").each(function(h){if($(this).val()==0){$(this).parents(".control-group").find(".lab-left").addClass("error");a.push(dcProduct.messages.WARNING_COLOR)}else{$(this).parents(".control-group").find(".lab-left").removeClass("error")}})}var c=dcProduct.getCurrentSizesValues();if(c==""){$("#choose_size").removeClass("btn-info").addClass("btn-danger").text(dcProduct.messages.OBLIGATORY_ADD_SIZE);a.push(dcProduct.messages.WARNING_SIZE)}else{dcProduct.addSizeButtonOk()}if($("tr.sizeTR").length){$("tr.sizeTR").each(function(h){var j=false;$(this).find("select.colorSelect").each(function(k){var l=$(this).select2("val");if(l==0||l==""){j=true;return false}});if(j==true){a.push(dcProduct.messages.WARNING_COLOR);$(this).find(".colorAdd").addClass("error")}else{$(this).find(".colorAdd").removeClass("error")}$(this).find(".priceOf").each(function(k){var l=$(this).val();if(l==""){a.push(dcProduct.messages.WARNING_PRICE_TP);$(this).parents(".control-group").addClass("error")}})})}if($("#photo_block img").length==0){$("#fileLabel").addClass("error");a.push(dcProduct.messages.WARNING_PHOTO)}else{$("#fileLabel").removeClass("error")}}var f=a.join("\n");if(f!=""){return false}dcProduct.showAjaxLoader();return true},makeErrorScrollElem:function(a){if(dcProduct.errorScrollElemId==""){dcProduct.errorScrollElemId=a}},addSizeButtonOk:function(){$("#choose_size").addClass("btn-info").removeClass("btn-danger").text(dcProduct.messages.LABEL_ADD_SIZE)},addProductForm:function(){dcProduct.showEditForm(0,dcProduct.catalogIblockID)},formatNoMatchesCustom:function(){return dcProduct.messages.NO_MATCHES_FOUND},showEditForm:function(b,a){var d="get_edit_form";if(b==0){d="get_add_form"}var c={action:d,product_id:b,iblid:a};dcProduct.showAjaxLoader();$.post(this.ajaxHandler,c,function(e){dcProduct.hideAjaxLoader();$("#editItem").html(e.html);$("#editItem").modal({keyboard:false}).modal("show");$(".selectpicker").selectpicker("hide");$("#brand_id").select2({formatNoMatches:dcProduct.formatNoMatchesCustom});if(e.brand.ID!=""){$("#brand_id").select2("val",e.brand.ID)}$("#material_id").select2({formatNoMatches:dcProduct.formatNoMatchesCustom});if(e.material.ID!=""){$("#material_id").select2("val",e.material.ID)}$(".table-choice select.colorSelect").each(function(g){$(this).select2({formatNoMatches:dcProduct.formatNoMatchesCustom}).on("selected",function(){dcProduct.selectColorsArrGenerate()})});dcProduct.choosedPhotos=e.photos;dcProduct.colors=e.colors;dcProduct.selectColorsArrGenerate();var f=dcProduct.getColorsOptions();$(".selectpickerP").each(function(g){var h=$(this).val();$(this).html(f).selectpicker("hide");if(h){$(this).selectpicker("val",h)}});tinymce.init({width:528,language:"ru",selector:"#DETAIL_TEXT",plugins:[" autolink lists link image charmap preview anchor searchreplace visualblocks code fullscreen table contextmenu paste jbimages"],toolbar:"insertfile undo redo | bold italic underline | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image jbimages",relative_urls:false});$("#productEditForm").ajaxForm({type:"post",dataType:"json",beforeSubmit:dcProduct.ValidateEditForm,complete:function(n){dcProduct.hideAjaxLoader();var k=JSON.parse(n.responseText);if(k.only_pic_flag==1){if(k.result!="FILE_EMPTY"){if(k.result=="OK"){dcProduct.pictureCounter++;var j=dcProduct.pictureCounter;var i=$('<div class="photo_block"> 												<div class="photo_l"> 													<div class="fl_photo"> 												<img width="101" height="135" src="'+k.tmp_name+'"></div> 											<div class="bot_sel"> 												<div class="control-group"> 													<label class="lab-left">'+dcProduct.messages.LABEL_CHOOSE_COLOR+' <span class="arrow-required">*</span></label> 													<div class="controls span"> 														<select style="display: none;" data-photo-id="'+j+'" class="selectpicker show-tick">'+dcProduct.getColorsOptions()+'</select> </div></div></div> 															<div class="bot_sel tooltip-demo"> 																<span class="span"><a data-original-title="'+dcProduct.messages.LABEL_DEL+'" data-placement="top" rel="tooltip" href="#" class="btn btn-danger delPhoto" data-photo-id="'+j+'"><i class="icon-remove icon-white"></i></a> 															</span></div></div></div>').prependTo("#photo_block");var g=i.find("select");g.selectpicker("hide");var h=g.selectpicker("val");dcProduct.choosedPhotos[j]={elem_id:j,elem_name:"elem_name",elem_pic:k.tmp_name,action_flag:"upload",elem_color:h}}else{if(k.result=="ERROR"){alert(k.message)}}}$("#show_picture").val("0")}else{var l=k.message.split("<br>").join("\n");if(k.result=="OK"){var m='<div class="modal-header"> 								<button class="close" data-dismiss="modal">x</button> 								<h3>'+k.zagolFormConfirm+'</h3> 								</div>								<div class="modal-body"> 								<p>'+k.textFormConfirm+'</p> 								</div> 								<div class="modal-footer"> 								<a href="#" id="firstBtn" class="btn">'+k.firstBtnText+'</a> 								<a href="#" id="secondBtn" class="btn btn-primary"> '+k.secondBtnText+"</a>								</div>";$("#modal_div_confirm").html(m);$("#modal_div_confirm").modal("show");$("#editItem").modal("hide")}else{alert(l)}}}})},"json")}};