$(document).ready(function(){var f=$(".js-sets-selected-items"),d=$(".js-sets-all-items"),e=15,h=debounce(k,1000),c=new CatalogElement($(".js-detail.js-element").data("elementid"));g();$(window).resize(debounce(g,250));$(document).on("click",".js-set-constructor .js-remove",m);$(document).on("change",".js-set-constructor .js-set-toggle",i);$(document).on("click",".js-set-constructor .js-set-add2basket",b);$(document).on("click",".js-set-constructor .js-set-buy1click",a);$(document).on("click",".js-set-constructor .js-myset",function(){$(this).toggle();$(this).siblings(".js-myset").toggle();$(this).closest(".js-set-constructor").find(".js-sets-all-items").slideToggle()});$(document).on("changeOffer.rs.flyaway",j);function i(n){if($(this).is(":checked")){l.apply(this,[n])}else{m.apply(this,[n])}}function l(p){var n=$(this).parents(".js-set-item"),q=f.filter(":visible").find(".js-set-item:not([data-elementid]):eq(0)"),o=n.clone();if(q.length>0){o.find(".js-set-toggle").closest(".gui-box").replaceWith('<a class="set-item__icon js-remove" href="javascript:;"><i class="fa fa-close"></i> </a>');q.replaceWith(o)}else{$(this).prop("checked",false)}h()}function m(p){p.preventDefault();var o=$(this).closest(".js-set-item"),n=o.data("elementid");f.filter(":visible").find("[data-elementid="+n+"]").each(function(q,r){$(r).replaceWith('<div class="set-item js-set-item hidden-xs"><div class="set-item__cart"></div></div>')});f.filter(":visible").closest(".js-set-constructor").find(".js-sets-all-items [data-elementid="+n+"] .js-set-toggle").prop("checked",false);h()}function k(){var o=0,q=0,s=0,n=$(".js-set-constructor:visible"),p=n.data("ajaxpath"),r={};f.filter(":visible").find(".js-set-item[data-elementid]").each(function(t,u){o+=parseInt($(u).data("price"));q+=parseInt($(u).data("oldprice"));s+=parseInt($(u).data("discount"))});r={sessid:BX.bitrix_sessid(),action:"ajax_recount_prices",sumPrice:o,sumOldPrice:q,sumDiffDiscountPrice:s,currency:n.data("currency")};return $.post(p,r).then(function(t){return BX?BX.parseJSON(t):$.parseJSON(t)}).then(function(t){var u="";if(s>0){u+='<div class="prices__val prices__val_cool prices__val_new big">'+t.formatSum+"</div>";u+='<div class="prices__val prices__val_old">'+t.formatOldSum+"</div>";u+='<div class="set-buyblock__profit">'+BX.message("YOUR_PROFIT")+"</div>";u+='<div class="prices__val prices__val_cool prices__val_new">'+t.formatDiscDiffSum+"</div>"}else{u+='<div class="prices__val prices__val_cool">'+t.formatSum+"</div>"}n.find(".js-buyblock-prices").html(u)})}function a(p){var n=$(this).closest(".js-set-constructor"),o=n.find(".js-sets-selected-items .js-set-item[data-elementid]"),q="";if($(window).width()>=rsFlyaway.breakpoints.sm){$(document).one("RSFLYAWAY_fancyBeforeShow",function(){$(".fancybox-wrap [name=RS_EXT_FIELD_0]").val(q)})}else{window.localStorage.setItem("insertdata",$.parseJSON({RS_EXT_FIELD_0:q}))}o.each(function(r,s){q+="["+$(s).data("elementid")+"] "+$(s).find(".set-item__name").text().trim()+", "})}function b(r){var n=$(this).closest(".js-set-constructor"),p=n.find(".js-sets-selected-items .js-set-item[data-elementid]"),o=[],q={};p.each(function(s,t){if($.inArray($(t).data("elementid"),o)===-1){o.push($(t).data("elementid"))}});q={sessid:BX.bitrix_sessid(),action:"catalogSetAdd2Basket",set_ids:o,lid:n.data("lid"),iblockId:n.data("iblockid"),setOffersCartProps:n.data("setOffersCartProps")};rsFlyaway.darken(n);$.post(n.data("ajaxpath"),q,function(s){BX.onCustomEvent("OnBasketChange");rsFlyaway.darken(n)},"json")}function j(o){var n=$("#set_"+c.getProductId());if(n.length>0){$("[id^=set]").hide();n.show()}}function g(){if($(window).width()>=rsFlyaway.breakpoints.sm-1){f.each(function(n,p){var o=$(p);if(!o.data("owl.carousel")){f.addClass("owl-theme owl-carousel");f.owlCarousel({loop:false,items:4,margin:e,responsive:{0:{items:2},740:{items:3},1080:{items:4}}})}});d.each(function(o,p){var n=$(p);if(!n.data("owl.carousel")){n.addClass("owl-theme owl-carousel");n.owlCarousel({loop:false,items:4,margin:e,responsive:{0:{items:3},740:{items:4},1080:{items:5}}})}})}else{f.each(function(n,o){if($(o).data("owl.carousel")){$(o).data("owl.carousel").destroy();$(o).removeClass("owl-theme owl-hidden owl-carousel")}});d.each(function(n,o){if($(o).data("owl.carousel")){$(o).data("owl.carousel").destroy();$(o).removeClass("owl-theme owl-hidden owl-carousel")}})}}});