var rootFolder="/bitrix/components/citrus/realty.favourites/templates/block/";var popupOnOpen=function(){$(".closebutton").click(function(){$.fancybox.close()});$("button[data-url]").click(function(){window.location=$(this).data("url")})};$(function(){function a(c){var b=$(c).get(0);var d={x:b.offsetLeft,y:b.offsetTop};while(b.offsetParent){b=b.offsetParent;d.x+=b.offsetLeft;d.y+=b.offsetTop;if(b!=document.body&&b!=document.documentElement){d.x-=b.scrollLeft;d.y-=b.scrollTop}}return d}window.citrusRealtyFavUpdateCount=function(b){if(b>0){$(".realty-favourites").html(BX.message("CITRUS_REALTY_FAV")+" ("+b.toString()+")")}else{$(".realty-favourites").html(BX.message("CITRUS_REALTY_FAV")+" (0)")}};window.citrusRealtyMark=function(b,c){if(c=="add"){var d="CITRUS_REALTY_FAV_REMOVE";if(b.parents(".case-add").length){d="CITRUS_REALTY_FAV_REMOVE_FROM"}b.addClass("added").html(BX.message(d)).attr("title",BX.message("CITRUS_REALTY_FAV_REMOVE_TITLE"))}else{var d="CITRUS_REALTY_2FAV";if(b.parents(".case-add").length){d="CITRUS_REALTY_ADD_TO_FAV"}b.removeClass("added").html(BX.message(d)).removeAttr("title")}};$(".add2favourites[data-id]").on("click",function(h){h.preventDefault();var i=$(this),b=i.data("id"),j=i.hasClass("added")?"remove":"add",m=$(this).parents(".td-price").siblings(".td-img").find("img"),g=$(".realty-favourites");if(b<=0){return}if(m.length<=0){m=i}var o=a(m),c=a(g);var f=c.x,d=c.y,n=o.x,l=o.y,k=m.width();if(j=="add"){f=o.x;d=o.y;n=c.x;l=c.y;k=150}$(m).clone(true).appendTo("body").css({top:d+"px",position:"absolute",left:f+"px",opacity:0.75,"white-space":"nowrap"}).animate({width:k+"px",top:l+"px",left:n+"px"},700).fadeOut(500,function(){$(this).remove()});$.getJSON(rootFolder+"json.php",{type:j,id:b},function(e){if(typeof(e)!=="object"){return}if(typeof(e.error)!=="undefined"){alert(e.error)}else{window.citrusRealtyFavUpdateCount(e.count);window.citrusRealtyMark(i,e.type);if(typeof(e.popup)!=="undefined"){$.fancybox.open(e.popup,{autoSize:false,fitToView:false,scrolling:"no",closeBtn:false,width:750,minHeight:666,margin:0,padding:0,afterShow:popupOnOpen})}}})});if("object"===typeof(window.citrusRealtyFav)){$("a[data-id]").each(function(){var b=$(this),c=b.data("id");if(window.citrusRealtyFav.indexOf(c)!=-1){window.citrusRealtyMark(b,"add")}})}});