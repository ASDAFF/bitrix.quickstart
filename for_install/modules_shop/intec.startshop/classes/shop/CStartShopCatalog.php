<? $GLOBALS['_472042134_']=Array('intva' .'l','' .'in' .'tva' .'l','i' .'ntval','is' .'_nume' .'ric','in_' .'a' .'r' .'ra' .'y','is_a' .'rr' .'ay','in' .'tval','is_ar' .'r' .'ay','' .'intval','intval','i' .'n_arr' .'ay','is_array','i' .'ntval','' .'i' .'n_arr' .'ay','in_a' .'r' .'ray','preg_re' .'p' .'lac' .'e','arr' .'ay_keys','i' .'ntv' .'al','' .'intval'); ?><? function _1812324582($i){$a=Array('OFFERS_PROPERTIES','OFFERS_IBLOCK','IBLOCK','OFFERS_IBLOCK','IBLOCK','OFFERS_PROPERTIES','IBLOCK','IBLOCK','IBLOCK','IBLOCK','IBLOCK','IBLOCK','IBLOCK','IBLOCK','OFFERS_IBLOCK','OFFERS_IBLOCK','OFFERS_IBLOCK','OFFERS_IBLOCK','OFFERS_IBLOCK','startshop_catalog','/^(>=|<=|=|!|>|<)/','','OFFERS_PROPERTIES','CATALOG','OFFERS_PROPERTIES','PROPERTY','USE_QUANTITY');return $a[$i];} ?><? class CStartShopCatalog extends CStartShop implements CStartShopInterface{private static $arFieldsEditable=array('IBLOCK','USE_QUANTITY','OFFERS_IBLOCK','OFFERS_LINK_PROPERTY');public static function getArFieldsEditable(){return static::$arFieldsEditable;}private static $arFieldsFiltering=array('IBLOCK','USE_QUANTITY','OFFERS_IBLOCK','OFFERS_LINK_PROPERTY');public static function getArFieldsFiltering(){return static::$arFieldsFiltering;}private static function AddOffersProperty($_0,$_1){$_0=$GLOBALS['_472042134_'][0]($_0);$_1=$GLOBALS['_472042134_'][1]($_1);if($_0>round(0)&& $_1>round(0)){CStartShopDBQueryBX::Insert()->Into('startshop_catalog_properties')->Values(array('CATALOG'=> $_0,'PROPERTY'=> $_1))->Execute();return true;}return false;}private static function DeleteOffersProperties($_0){CStartShopDBQueryBX::Delete()->From('startshop_catalog_properties')->Where(array('CATALOG'=> $GLOBALS['_472042134_'][2]($_0)))->Execute();return true;}private static function DeleteOffersPropertiesAll(){CStartShopDBQueryBX::Delete()->From('startshop_catalog_properties')->Execute();return true;}public static function Add($_2){if(empty($_2['IBLOCK'])||!$GLOBALS['_472042134_'][3]($_2['IBLOCK']))return false;global $DB;if(!CModule::IncludeModule('iblock'))return false;if(!CIBlock::GetByID($_2['IBLOCK'])->Fetch())return false;$_3=$_2[_1812324582(0)];$_2=CStartShopUtil::ArrayFilter($_2,function($_4){return $GLOBALS['_472042134_'][4]($_4,CStartShopCatalog::getArFieldsEditable());},STARTSHOP_UTIL_ARRAY_FILTER_USE_KEY);if(!$GLOBALS['_472042134_'][5]($_3))$_3=array();$_5=(bool)static::GetByIBlock($_2['IBLOCK'])->Fetch();if(!$_5)$_5=(bool)static::GetByOffersIBlock($_2['IBLOCK'])->Fetch();if(!$_5)if(isset($_2[_1812324582(1)])){$_5=(bool)(static::GetByIBlock($_2['OFFERS_IBLOCK'])->Fetch());if(!$_5)$_5=(bool)(static::GetByOffersIBlock($_2['OFFERS_IBLOCK'])->Fetch());if(!$_5)$_5=$_2[_1812324582(2)]== $_2[_1812324582(3)];}if($_5)return false;CStartShopDBQueryBX::Insert()->Into('startshop_catalog')->Values($_2)->Execute();static::DeleteOffersProperties($_2['IBLOCK']);if(!empty($_3))foreach($_3 as $_6)static::AddOffersProperty($_2['IBLOCK'],$_6);static::ResetCacheByIBlock($_2['IBLOCK']);CStartShopToolsIBlock::UpdateProperties($_2['IBLOCK']);CStartShopToolsIBlock::UpdateProperties($_2['OFFERS_IBLOCK']);return $_2[_1812324582(4)];}public static function Update($_7,$_2){if(!CModule::IncludeModule('iblock'))return false;$_7=$GLOBALS['_472042134_'][6]($_7);$_5=false;$_3=$_2[_1812324582(5)];if(!$GLOBALS['_472042134_'][7]($_3))$_3=false;$_8=static::GetByIBlock($_7)->GetNext();if(empty($_8))return false;if(isset($_2[_1812324582(6)])&& empty($_2[_1812324582(7)]))unset($_2[_1812324582(8)]);$_9=$GLOBALS['_472042134_'][8]($_8[_1812324582(9)]);if(isset($_2[_1812324582(10)]))if($_2[_1812324582(11)]!= $_8[_1812324582(12)]){$_5=(bool)(static::GetByIBlock($_2['IBLOCK'])->Fetch());if(!$_5)$_5=(bool)(static::GetByOffersIBlock($_2['IBLOCK'])->Fetch());$_9=$GLOBALS['_472042134_'][9]($_2[_1812324582(13)]);static::DeleteOffersProperties($_9);}if(!$_5)if(isset($_2[_1812324582(14)]))if($_2[_1812324582(15)]!= $_8[_1812324582(16)]){$_5=(bool)(static::GetByIBlock($_2['OFFERS_IBLOCK'])->Fetch());if(!$_5)$_5=(bool)(static::GetByOffersIBlock($_2['OFFERS_IBLOCK'])->Fetch());if(!$_5)$_5=$_9 == $_2[_1812324582(17)];}if($_5)return false;if(!CIBlock::GetByID($_9)->Fetch())return false;$_2=CStartShopUtil::ArrayFilter($_2,function($_4){return $GLOBALS['_472042134_'][10]($_4,CStartShopCatalog::getArFieldsEditable());},STARTSHOP_UTIL_ARRAY_FILTER_USE_KEY);static::ResetCacheByIBlock($_7);static::ResetCacheByOffersIBlock($_8[_1812324582(18)]);if(!empty($_2)){CStartShopDBQueryBX::Update()->Tables(_1812324582(19))->Values($_2)->Where(array('IBLOCK'=> $_7))->Execute();CStartShopToolsIBlock::UpdateProperties($_9);CStartShopToolsIBlock::UpdateProperties($_2['OFFERS_IBLOCK']);}if($GLOBALS['_472042134_'][11]($_3)){static::DeleteOffersProperties($_9);foreach($_3 as $_6)static::AddOffersProperty($_9,$_6);}return $_9;}public static function Delete($_7){$_7=$GLOBALS['_472042134_'][12]($_7);CStartShopDBQueryBX::Delete()->From('startshop_catalog')->Where(array('IBLOCK'=> $_7))->Execute();static::ResetCacheByIBlock($_7);return true;}public static function DeleteAll(){CStartShopDBQueryBX::Delete()->From('startshop_catalog')->Execute();static::DeleteOffersPropertiesAll();static::ResetCache();return true;}public static function GetList($_10=array(),$_11=array()){$_10=CStartShopUtil::ArrayFilter($_10,function($_4){return $GLOBALS['_472042134_'][13]($_4,CStartShopCatalog::getArFieldsFiltering());},STARTSHOP_UTIL_ARRAY_FILTER_USE_KEY);$_11=CStartShopUtil::ArrayFilter($_11,function($_4){return $GLOBALS['_472042134_'][14]($GLOBALS['_472042134_'][15](_1812324582(20),_1812324582(21),$_4),CStartShopCatalog::getArFieldsFiltering());},STARTSHOP_UTIL_ARRAY_FILTER_USE_KEY);$_12=CStartShopUtil::DBResultToArray(CStartShopDBQueryBX::Select()->From('startshop_catalog')->Where($_11)->OrderBy($_10)->Execute(),'IBLOCK');foreach($_12 as $_0 => $_8)$_12[$_0][_1812324582(22)]=array();if(!empty($_12)){$_13=CStartShopDBQueryBX::Select()->From('startshop_catalog_properties')->Where(array('CATALOG'=> $GLOBALS['_472042134_'][16]($_12)))->Execute();while($_14=$_13->Fetch())$_12[$_14[_1812324582(23)]][_1812324582(24)][]=$_14[_1812324582(25)];}return CStartShopUtil::ArrayToDBResult($_12);}public static function GetByOffersIBlock($_7){$_7=$GLOBALS['_472042134_'][17]($_7);if(!CStartShopCache::IsExists('CStartShopCatalog.Offers',$_7)){$_15=static::GetList(array(),array('OFFERS_IBLOCK'=> $_7));$_15->NavStart();$_16=$_15->SelectedRowsCount();if($_16>round(0)){$_15=CStartShopCache::CreateFromResult('CStartShopCatalog.Offers',array('OFFERS_IBLOCK'),$_15);}else{CStartShopCache::Create('CStartShopCatalog.Offers',$_7,false);$_15=new CDBResult();$_15->InitFromArray(array());}}else{$_15=CStartShopCache::GetAsResult('CStartShopCatalog.Offers',$_7);}return $_15;}public static function GetByIBlock($_7){$_7=$GLOBALS['_472042134_'][18]($_7);if(!CStartShopCache::IsExists('CStartShopCatalog',$_7)){$_15=static::GetList(array(),array('IBLOCK'=> $_7));$_15->NavStart();$_16=$_15->SelectedRowsCount();if($_16>round(0)){$_15=CStartShopCache::CreateFromResult('CStartShopCatalog',array('IBLOCK'),$_15);}else{CStartShopCache::Create('CStartShopCatalog',$_7,false);$_15=new CDBResult();$_15->InitFromArray(array());}}else{$_15=CStartShopCache::GetAsResult('CStartShopCatalog',$_7);}return $_15;}public static function IsValid($_7){$_17=false;if(!CModule::IncludeModule('iblock'))return $_17;if(static::IsCatalog($_7)|| static::IsCatalogOffers($_7))$_17=(bool)CIBlock::GetByID($_7)->Fetch();return $_17;}public static function IsCatalog($_7){$_5=(bool)static::GetByIBlock($_7)->Fetch();return $_5;}public static function IsCatalogOffers($_7){$_5=(bool)static::GetByOffersIBlock($_7)->Fetch();return $_5;}public static function IsUseQuantity($_7){$_8=static::GetByIBlock($_7)->Fetch();if(empty($_8))$_8=static::GetByOffersIBlock($_7)->Fetch();return (bool)$_8[_1812324582(26)];}public static function ResetCacheByIBlock($_7){CStartShopCache::Clear('CStartShopCatalog',$_7);}public static function ResetCacheByOffersIBlock($_7){CStartShopCache::Clear('CStartShopCatalog.Offers',$_7);}public static function ResetCache(){CStartShopCache::ClearPath('CStartShopCatalog');CStartShopCache::ClearPath('CStartShopCatalog.Offers');}} ?>
