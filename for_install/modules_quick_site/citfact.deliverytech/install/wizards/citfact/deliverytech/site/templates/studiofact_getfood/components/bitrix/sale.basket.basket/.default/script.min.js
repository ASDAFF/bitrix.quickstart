BX.ready(function(){var a=BX.findChildren(BX("basket_items_list"),{tagName:"li",className:"sku_prop"},true);if(!!a&&a.length>0){for(i=0;a.length>i;i++){BX.bind(a[i],"click",BX.delegate(function(b){skuPropClickHandler(b)},this))}}});function skuPropClickHandler(h){if(!h){h=window.event}var j=BX.proxy_context;if(!!j&&j.hasAttribute("data-value-id")){BX.showWait();var l=j.getAttribute("data-element"),n=j.getAttribute("data-property"),k={},b={},f=BX("action_var").value;k[n]=j.getAttribute("data-value-id");if(BX.hasClass(j,"bx_active")){BX.closeWait();return}var a=BX.findChildren(BX(l),{tagName:"ul",className:"sku_prop_list"},true);if(!!a&&a.length>0){for(var g=0;a.length>g;g++){if(a[g].id=="prop_"+n+"_"+l){continue}else{var c=BX.findChildren(BX(a[g].id),{tagName:"li",className:"bx_active"},true);if(!!c&&c.length>0){for(var d=0;c.length>d;d++){if(c[d].hasAttribute("data-value-id")){k[c[d].getAttribute("data-property")]=c[d].getAttribute("data-value-id")}}}}}}b={basketItemId:l,sessid:BX.bitrix_sessid(),site_id:BX.message("SITE_ID"),props:k,action_var:f,select_props:BX("column_headers").value,offers_props:BX("offers_props").value,quantity_float:BX("quantity_float").value,count_discount_4_all_quantity:BX("count_discount_4_all_quantity").value,price_vat_show_value:BX("price_vat_show_value").value,hide_coupon:BX("hide_coupon").value,use_prepayment:BX("use_prepayment").value};b[f]="select_item";BX.ajax({url:"/bitrix/components/bitrix/sale.basket.basket/ajax.php",method:"POST",data:b,dataType:"json",onsuccess:function(e){updateBasketTable(e)}})}}function updateBasketTable(a){BX.ajax({url:location.pathname,method:"POST",data:"UPDATE_BIG_BASKET_AJAX=Y",onsuccess:function(d){var b=BX("coupon").value;$("#update_big_basket_ajax").html(d);BX("coupon").value=b;updateBasketTable2(a);BX.closeWait();var c=BX.findChildren(BX("basket_items_list"),{tagName:"li",className:"sku_prop"},true);if(!!c&&c.length>0){for(i=0;c.length>i;i++){BX.bind(c[i],"click",BX.delegate(function(f){skuPropClickHandler(f)},this))}}}})}function updateBasketTable2(c){if(BX("coupon")){var d="";if(BX("coupon_approved")&&BX("coupon").value.length==0){BX("coupon_approved").value="N"}if(c.hasOwnProperty("VALID_COUPON")){d=(!!c.VALID_COUPON)?"good":"bad";if(BX("coupon_approved")){BX("coupon_approved").value=(!!c.VALID_COUPON)?"Y":"N"}}if(BX("coupon_approved")&&BX("coupon").value.length>0){d=BX("coupon_approved").value=="Y"?"good":"bad"}else{d=""}BX("coupon").className=d}if(c.hasOwnProperty("WARNING_MESSAGE")){var a="";for(var b=c.WARNING_MESSAGE.length-1;b>=0;b--){a+=c.WARNING_MESSAGE[b]+"<br/>"}BX("warning_message").innerHTML=a}}function leftScroll(d,c){var b=BX("prop_"+d+"_"+c);if(b){var a=parseInt(b.style.marginLeft);if(a<0){b.style.marginLeft=a+20+"%"}}}function rightScroll(d,c){var b=BX("prop_"+d+"_"+c);if(b){var a=parseInt(b.style.marginLeft);if(a>=0){b.style.marginLeft=a-20+"%"}}}function checkOut(){BX("basket_form").submit();return true}function enterCoupon(){recalcBasketAjax()}function recalcBasketAjax(){BX.showWait();var d={},c=BX("action_var").value,b=BX("basket_items_list"),e=BX("basket_items_delayed");var a={sessid:BX.bitrix_sessid(),site_id:BX.message("SITE_ID"),props:d,action_var:c,select_props:BX("column_headers").value,offers_props:BX("offers_props").value,quantity_float:BX("quantity_float").value,count_discount_4_all_quantity:BX("count_discount_4_all_quantity").value,price_vat_show_value:BX("price_vat_show_value").value,hide_coupon:BX("hide_coupon").value,use_prepayment:BX("use_prepayment").value,coupon:!!BX("coupon")?BX("coupon").value:""};a[c]="recalculate";if(!!b&&$("#basket_items_list").find(".item_quantity").length>0){$("#basket_items_list").find(".item_quantity").each(function(){a[$(this).find("input").attr("name")]=$(this).find("input").val()})}if(!!e&&$("#basket_items_delayed").find(".delay_input").length>0){$("#basket_items_delayed").find(".delay_input").each(function(){a[$(this).attr("name")]="Y"})}BX.ajax({url:"/bitrix/components/bitrix/sale.basket.basket/ajax.php",method:"POST",data:a,dataType:"json",onsuccess:function(f){updateBasketTable(f)}})}$(document).on("click",".show_basket_sku_props",function(){$(this).closest(".basket_items_blocks_item").find(".text_sku_props").slideUp("fast");$(this).closest(".basket_items_blocks_item").find(".hidden_sku_props").slideDown("fast");$(this).closest(".itemName").find(".text_sku_props").slideUp("fast");$(this).closest(".itemName").find(".hidden_sku_props").slideDown("fast");return false});