var iesa=iesa||{};iesa.Banner=function(c,b,d){var a=this;a.el=c;a.url=b||"";a.data=[];a.running=false;a.playing=null;a.delay=d;a.current_slide=-1;a.current_frame=null;a.next_frame=null;a.control=null;a.next_button=null;a.prev_button=null;a.change_timer=null;a.play_pause=null;$(window).load(function(){a.init()})};iesa.Banner.prototype={toString:function(){return"[object iesa.Banner]"},init:function(){var T=this;if(!T.url){var data=$(".data",T.el);var data=eval(data.text())}else{$.ajaxSetup({async:false});$.getJSON(T.url,null,function(data){T.data=data})}T.data=data;if(data.length){for(var i=0,l=data.length;i<l;++i){var x=new Image;x.src=T.url+data[i].image}var code='<div class="banner_content"><div class="frame"></div><div class="overframe"></div></div><div class="control_overlay"><i class="c t l"><i></i></i><i class="c t r"><i></i></i><i class="c b l"><i></i></i><i class="c b r"><i></i></i><div class="play_pause pause"></div><div class="left"><</div><ul>';for(var i=0,l=T.data.length;i<l;++i){code+="<li>"+(i+1)+"</li>"}code+='</ul><div class="right">></div></div>';$(code).appendTo(T.el);T.current_frame=$(".frame",T.el).get(0);T.next_frame=$(".overframe",T.el).get(0);$(".control_overlay li",T.el).click(function(){T.show(parseInt($(this).text())-1);T.stop()});$(".frame",T.el).click(function(){location.href=T.data[T.current_slide].link});(T.play_pause=$(".play_pause",T.el)).click(function(){if(T.playing){T.stop()}else{T.start()}});T.show(0);T.start()}else{T.show_error()}},start:function(b){var a=this;if(b){a.delay=b}if(a.playing){return}a.change_timer=setInterval(function(){a.next.call(a)},a.delay);a.playing=true;a.play_pause.removeClass("paused")},stop:function(){var a=this;clearInterval(a.change_timer);a.playing=false;a.play_pause.addClass("paused")},show:function(b){var d=this;if(d.current_slide==b){return}if(d.running){return}var f=false;if(d.playing){f=true;d.stop()}var c=$(".control_overlay li:eq("+d.current_slide+")",d.el);d.current_slide=b;var a=$(".control_overlay li:eq("+b+")",d.el);var e="url('"+d.url+d.data[b].image+"')";$(c).removeClass("active");$(a).addClass("active");d.next_frame.style.display="none";d.next_frame.style.backgroundImage=e;d.running=true;$(d.next_frame).fadeIn("slow",function(){d.current_frame.style.backgroundImage=e;d.next_frame.style.display="none";d.running=false});if(f){d.start()}},show_error:function(b){var a="������ �������� ������";if(b){a+=":<br/>"+b}this.el.innerHTML=a},next:function(){this.show((this.current_slide+this.data.length+1)%this.data.length)},prev:function(){this.show((this.current_slide+this.data.length-1)%this.data.length)}};