function CBXSession(){var a=this;this.mess={};this.timeout=null;this.sessid=null;this.bShowMess=true;this.dateStart=new Date();this.dateInput=new Date();this.dateCheck=new Date();this.activityInterval=0;this.notifier=null;this.Expand=function(e,d,c,b){this.timeout=e;this.sessid=d;this.bShowMess=c;this.key=b;BX.ready(function(){BX.bind(document,"keypress",a.OnUserInput);BX.bind(document.body,"mousemove",a.OnUserInput);BX.bind(document.body,"click",a.OnUserInput);setTimeout(a.CheckSession,(a.timeout-60)*1000)})},this.OnUserInput=function(){var b=new Date();a.dateInput.setTime(b.valueOf())};this.CheckSession=function(){var c=new Date();if(c.valueOf()-a.dateCheck.valueOf()<30000){return}a.activityInterval=Math.round((a.dateInput.valueOf()-a.dateStart.valueOf())/1000);a.dateStart.setTime(a.dateInput.valueOf());var b=(a.activityInterval>a.timeout?(a.timeout-60):a.activityInterval);BX.ajax.get("/bitrix/tools/public_session.php?sessid="+a.sessid+"&interval="+b+"&k="+a.key,function(d){a.CheckResult(d)})};this.CheckResult=function(e){if(e=="SESSION_EXPIRED"){if(a.bShowMess){a.notifier=document.body.appendChild(BX.create("DIV",{props:{className:"bx-session-message"},style:{top:"-1000px"},html:'<a class="bx-session-message-close" href="javascript:bxSession.Close()"></a>'+a.mess.messSessExpired}));var h=BX.GetWindowScrollPos();var b=BX.GetWindowInnerSize();a.notifier.style.left=parseInt(h.scrollLeft+b.innerWidth/2-parseInt(a.notifier.clientWidth)/2)+"px";var g=h.scrollTop-a.notifier.offsetHeight;var c=h.scrollTop;(new BX.fx({time:0.5,step:0.01,type:"accelerated",start:g,finish:c,callback:function(i){a.notifier.style.top=i+"px"},callback_complete:function(){if(BX.browser.IsIE()){BX.bind(window,"scroll",function(){var i=BX.GetWindowScrollPos();a.notifier.style.top=i.scrollTop+"px"})}else{a.notifier.style.top="0px";a.notifier.style.position="fixed"}}})).start()}}else{var d;if(e=="SESSION_CHANGED"){d=(a.timeout-60)}else{d=(a.activityInterval<60?60:(a.activityInterval>a.timeout?(a.timeout-60):a.activityInterval))}var f=new Date();a.dateCheck.setTime(f.valueOf());setTimeout(a.CheckSession,d*1000)}};this.Close=function(){this.notifier.style.display="none"}}var bxSession=new CBXSession();