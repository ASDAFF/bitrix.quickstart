var RSGoPro_tamautID=0,RSGoPro_timeoutDelay=1200,RSGoPro_inputter,RSGoPro_modef_delay_hide=4000,RSGoPro_modef_posFix=0;var RSGoPro_filtren,RSGoPro_offsetTopFilter=0,RSGoPro_offsetTopFilterH=0,RSGoPro_content,RSGoPro_offsetTopContent=0,RSGoPro_offsetTopContentH=0;function RSGoPro_priceGoupClick(){if($(".filtren").hasClass("ajaxfilter")){RSGoPro_FilterAjax()}}function RSGoPro_SeachProp(c){var b=c.val();var a=c.parents(".lvl1");if(b.length<1){a.find(".lvl2").css("display","block")}else{a.find(".lvl2").each(function(){var d=$(this).find(".val").html().substr(0,b.length);if(b.toLowerCase()==d.toLowerCase()){$(this).css("display","block")}else{$(this).css("display","none")}})}if(c.parents(".lvl1").hasClass("scrolable")){RSGoPro_FilterJScrollPaneReinitialize()}}function RSGoPro_FilterSetPropHide(){if($.cookie(BX_COOKIE_PREFIX+"RSGOPRO_SMARTFILTER_SHOW_ALL")=="Y"){$(".filtren").addClass("opened")}}function RSGoPro_FilterJScrollPaneReinitialize(){var a;$(".f_jscrollpane").each(function(b){a=$(this).data("jsp");a.reinitialise()})}function RSGoPro_FixedFilterWinScroll(){if(RSGoPro_filtren&&RSGoPro_filtren.length>0){RSGoPro_offsetTopFilterH=RSGoPro_offsetTopFilter+RSGoPro_filtren.outerHeight(true);RSGoPro_offsetTopContentH=RSGoPro_content.offset().top+RSGoPro_content.outerHeight(true);if(window.pageYOffset>RSGoPro_offsetTopFilter){RSGoPro_filtren.addClass("fixed")}else{RSGoPro_filtren.removeClass("fixed")}if(window.pageYOffset+RSGoPro_filtren.outerHeight(true)>RSGoPro_content.offset().top+RSGoPro_content.outerHeight(true)){RSGoPro_filtren.addClass("stop").css("top",(RSGoPro_offsetTopContentH-RSGoPro_offsetTopFilterH)+"px")}else{RSGoPro_filtren.removeClass("stop").css("top","0px")}}}function RSGoPro_FixedFilter(){if(RSGoPro_filtren&&RSGoPro_filtren.length>0){RSGoPro_offsetTopFilter=RSGoPro_filtren.offset().top;RSGoPro_offsetTopFilterH=RSGoPro_offsetTopFilter+RSGoPro_filtren.outerHeight(true);RSGoPro_offsetTopContent=RSGoPro_content.offset().top;RSGoPro_offsetTopContentH=RSGoPro_offsetTopContent+RSGoPro_content.outerHeight(true);window.onscroll=RSGoPro_FixedFilterWinScroll}}function RSGoPro_FilterAjax(){clearTimeout(RSGoPro_tamautID);RSGoPro_tamautID=setTimeout(function(){RSGoPro_Area2Darken($("#catalog"),"animashka");var c=$("form.smartfilter");var b=c.serialize(),a=c.attr("action");if(a.indexOf("?")<1){a=a+"?"+b+"&AJAX_CALL=Y&get=catalog&set_filter=Y"}else{a=a+"&"+b+"&AJAX_CALL=Y&get=catalog&set_filter=Y"}BX.ajax({url:a,method:"GET",dataType:"html",scriptsRunFirst:false,emulateOnload:false,start:true,cache:false,onsuccess:function(d){$("#catalog").html(d);RSGoPro_ScrollInit(".prices_jscrollpane");RSGoPro_Area2Darken($("#catalog"));RSGoPro_FilterOnDocumentReady()},onfailure:function(){RSGoPro_Area2Darken($("#catalog"));RSGoPro_FilterOnDocumentReady();console.warn("FILTER -> ajax load failed")}})},RSGoPro_timeoutDelay)}function RSGoPro_FilterOnDocumentReady(){RSGoPro_FilterSetPropHide();$(document).on("click",".filtren .title a.shhi",function(){if($(".filtren").hasClass("opened")){$.removeCookie(BX_COOKIE_PREFIX+"RSGOPRO_SMARTFILTER_SHOW_ALL");$(".filtren").removeClass("opened")}else{$.cookie(BX_COOKIE_PREFIX+"RSGOPRO_SMARTFILTER_SHOW_ALL","Y","/");$(".filtren").addClass("opened")}RSGoPro_FilterJScrollPaneReinitialize();RSGoPro_FixedFilterWinScroll();return false});$(document).on("click",".filtren .showchild",function(){var b=$(this).parents("li.lvl1");var a=b.data("propcode");if(b.hasClass("closed")){b.removeClass("closed")}else{b.addClass("closed")}RSGoPro_FilterJScrollPaneReinitialize();RSGoPro_FixedFilterWinScroll();return false});$(document).on("click",".lvl2 .disabled input, .lvl2 .disabled label",function(a){a.stopPropagation();return false});$(".f_jscrollpane").jScrollPane();RSGoPro_FilterJScrollPaneReinitialize();$(window).resize(function(){RSGoPro_FilterJScrollPaneReinitialize()});$(document).on("keyup",".f_search",function(){var a=$(this);RSGoPro_SeachProp(a)});$(document).on("click",".filtren .buttons .set_filter, .filtren .buttons .del_filter",function(){if($(this).hasClass("set_filter")){$("#set_filter").click()}else{$("#del_filter").click()}return false});$(document).on("click","#modef a",function(){$("#set_filter").click();return false});if(!RSDevFunc_PHONETABLET){RSGoPro_filtren=$(".filtren.filterfixed"),RSGoPro_offsetTopFilter=0,RSGoPro_offsetTopFilterH=0,RSGoPro_content=$(".content"),RSGoPro_offsetTopContent=0,RSGoPro_offsetTopContentH=0;RSGoPro_FixedFilter()}}function JCSmartFilter(a){this.ajaxURL=a;this.form=null;this.timer=null}JCSmartFilter.prototype.keyup=function(a){$(a).toggleClass("active");$(a).parents("div").toggleClass("active");if($(".filtren").hasClass("ajaxfilter")){RSGoPro_FilterAjax()}else{if(this.timer){clearTimeout(this.timer)}this.timer=setTimeout(BX.delegate(function(){this.reload(a)},this),RSGoPro_timeoutDelay)}};JCSmartFilter.prototype.click=function(b){if($(b).parents("ul.dropdown").length>0){var c=$(b).parents(".lvl2").find(".val").html();$(b).parents("ul.dd").removeClass("open").find(".name.select").find("span").html(c);if($(b).parents("ul.dd").find(".pic.select").find("span").length>0){if($(b).parents(".lvl2").find(".pic span").hasClass("nopic")){$(b).parents("ul.dd").find(".pic.select").find("span").addClass("nopic").css("backgroundImage","")}else{var a=$(b).parents(".lvl2").find(".pic span").css("backgroundImage");$(b).parents("ul.dd").find(".pic.select").find("span").removeClass("nopic").css("backgroundImage",a)}}}if($(".filtren").hasClass("ajaxfilter")){RSGoPro_FilterAjax()}else{if(this.timer){clearTimeout(this.timer)}this.timer=setTimeout(BX.delegate(function(){this.reload(b)},this),RSGoPro_timeoutDelay)}};JCSmartFilter.prototype.reload=function(b){if(!RSDevFunc_PHONETABLET){RSGoPro_inputter=b;var c=BX.pos(BX.findParent(b,{"class":"property"}),true);RSGoPro_Area2Darken($(b).closest(".filtren"),"animashka",{progressTop:c.top+c.height/2});var a=[];this.position=BX.pos(b,true);this.form=BX.findParent(b,{tag:"form"});if(this.form){a[0]={name:"ajax",value:"y"};this.gatherInputsValues(a,BX.findChildren(this.form,{tag:new RegExp("^(input|select)$","i")},true));this.curFilterinput=b;BX.ajax.loadJSON(this.ajaxURL,this.values2post(a),BX.delegate(this.postHandler,this))}}};JCSmartFilter.prototype.postHandler=function(p){clearInterval(RSGoPro_tamautID);RSGoPro_Area2Darken($(".filtren"));var a,f,l,h,k,g,c,e,o;var m=BX("modef");var j=BX("modef_num");if(!!p&&!!p.ITEMS){for(a in p.ITEMS){if(p.ITEMS.hasOwnProperty(a)){f=p.ITEMS[a];if(f.PROPERTY_TYPE==="N"||f.PRICE){o=window["trackBar"+a];if(!o&&f.ENCODED_ID){o=window["trackBar"+f.ENCODED_ID]}if(o&&f.VALUES){if(f.VALUES.MIN&&f.VALUES.MIN.FILTERED_VALUE){o.setMinFilteredValue(f.VALUES.MIN.FILTERED_VALUE)}if(f.VALUES.MAX&&f.VALUES.MAX.FILTERED_VALUE){o.setMaxFilteredValue(f.VALUES.MAX.FILTERED_VALUE)}}}else{if(f.VALUES){for(l in f.VALUES){if(f.VALUES.hasOwnProperty(l)){h=f.VALUES[l];k=BX(h.CONTROL_ID);if(!!k){var n=document.querySelector('[data-role="label_'+h.CONTROL_ID+'"]');if(h.DISABLED){if(n){BX.addClass(n,"disabled")}if(k.parentNode){BX.addClass(k.parentNode,"disabled")}if($(RSGoPro_inputter).parents("div").length>0){$(RSGoPro_inputter).parents("div").addClass("disabled")}}else{if(n){BX.removeClass(n,"disabled")}if(k.parentNode){BX.removeClass(k.parentNode,"disabled")}if($(RSGoPro_inputter).parents("div").length>0){$(RSGoPro_inputter).parents("div").removeClass("disabled")}}}}}}}}}if(!!m&&!!j){j.innerHTML=p.ELEMENT_COUNT;g=BX.findChildren(m,{tag:"A"},true);if(p.FILTER_URL&&g){g[0].href=BX.util.htmlspecialcharsback(p.FILTER_URL)}if(p.FILTER_AJAX_URL&&p.COMPONENT_CONTAINER_ID){BX.bind(g[0],"click",function(q){var i=BX.util.htmlspecialcharsback(p.FILTER_AJAX_URL);BX.ajax.insertToNode(i,p.COMPONENT_CONTAINER_ID);return BX.PreventDefault(q)})}if(p.INSTANT_RELOAD&&p.COMPONENT_CONTAINER_ID){c=BX.util.htmlspecialcharsback(p.FILTER_AJAX_URL);BX.ajax.insertToNode(c,p.COMPONENT_CONTAINER_ID)}else{if(m.style.display==="none"){m.style.display="inline-block"}var b=this.position.top;if($(RSGoPro_inputter).hasClass("min")||$(RSGoPro_inputter).hasClass("max")){b=b+RSGoPro_modef_posFix+1}else{if($(RSGoPro_inputter).parents(".f_jscrollpane").length>0){var d=$(RSGoPro_inputter).parents(".f_jscrollpane").attr("id");b=b+RSGoPro_modef_posFix+BX(d).offsetTop-$("#"+d).data("jsp").getContentPositionY();if($(RSGoPro_inputter).parents(".cwpal").length>0){b=b+RSGoPro_modef_posFix+7}}else{if($(RSGoPro_inputter).parents(".dropdown").length>0){var d=$(RSGoPro_inputter).parents("li.dropdown").attr("id");b=b+BX(d).offsetTop;if($(RSGoPro_inputter).parents(".dd").hasClass("wpal")){b=b+7}}else{if($(RSGoPro_inputter).parents(".cwpal").length>0){b=b+RSGoPro_modef_posFix+7}else{if($(RSGoPro_inputter).parents(".cwp").length>0){b=b+RSGoPro_modef_posFix+6}else{b=b+RSGoPro_modef_posFix}}}}}m.style.top=b+"px";if(this.viewMode=="vertical"){e=BX.findChild(BX.findParent(this.curFilterinput,{"class":"bx_filter_parameters_box"}),{"class":"bx_filter_container_modef"},true,false);e.appendChild(m)}}RSGoPro_tamautID=setInterval(function(){m.style.display="none";clearInterval(RSGoPro_tamautID)},RSGoPro_modef_delay_hide);if($(RSGoPro_inputter).parents(".lvl1").hasClass("scrolable")){RSGoPro_FilterJScrollPaneReinitialize()}}}};JCSmartFilter.prototype.gatherInputsValues=function(a,e){if(e){for(var c=0;c<e.length;c++){var d=e[c];if(d.disabled||!d.type){continue}switch(d.type.toLowerCase()){case"text":case"textarea":case"password":case"hidden":case"select-one":if(d.value.length){a[a.length]={name:d.name,value:d.value}}break;case"radio":case"checkbox":if(d.checked){a[a.length]={name:d.name,value:d.value}}break;case"select-multiple":for(var b=0;b<d.options.length;b++){if(d.options[b].selected){a[a.length]={name:d.name,value:d.options[b].value}}}break;default:break}}}};JCSmartFilter.prototype.values2post=function(b){var e=new Array;var h=e;var d=0;while(d<b.length){var g=b[d].name.indexOf("[");if(g==-1){h[b[d].name]=b[d].value;h=e;d++}else{var c=b[d].name.substring(0,g);var f=b[d].name.substring(g+1);if(!h[c]){h[c]=new Array}var a=f.indexOf("]");if(a==-1){h=e;d++}else{if(a==0){h=h[c];b[d].name=""+h.length}else{h=h[c];b[d].name=f.substring(0,a)+f.substring(a+1)}}}}return e};BX.namespace("BX.Iblock.SmartFilter");BX.Iblock.SmartFilter=(function(){var a=function(b){if(typeof b==="object"){this.leftSlider=BX(b.leftSlider);this.rightSlider=BX(b.rightSlider);this.tracker=BX(b.tracker);this.trackerWrap=BX(b.trackerWrap);this.minInput=BX(b.minInputId);this.maxInput=BX(b.maxInputId);this.minPrice=parseFloat(b.minPrice);this.maxPrice=parseFloat(b.maxPrice);this.curMinPrice=parseFloat(b.curMinPrice);this.curMaxPrice=parseFloat(b.curMaxPrice);this.fltMinPrice=b.fltMinPrice?parseFloat(b.fltMinPrice):parseFloat(b.curMinPrice);this.fltMaxPrice=b.fltMaxPrice?parseFloat(b.fltMaxPrice):parseFloat(b.curMaxPrice);this.precision=b.precision||0;this.priceDiff=this.maxPrice-this.minPrice;this.leftPercent=0;this.rightPercent=0;this.fltMinPercent=0;this.fltMaxPercent=0;this.colorUnavailableActive=BX(b.colorUnavailableActive);this.colorAvailableActive=BX(b.colorAvailableActive);this.colorAvailableInactive=BX(b.colorAvailableInactive);this.isTouch=false;this.init();if("ontouchstart" in document.documentElement){this.isTouch=true;BX.bind(this.leftSlider,"touchstart",BX.proxy(function(c){this.onMoveLeftSlider(c)},this));BX.bind(this.rightSlider,"touchstart",BX.proxy(function(c){this.onMoveRightSlider(c)},this))}else{BX.bind(this.leftSlider,"mousedown",BX.proxy(function(c){this.onMoveLeftSlider(c)},this));BX.bind(this.rightSlider,"mousedown",BX.proxy(function(c){this.onMoveRightSlider(c)},this))}BX.bind(this.minInput,"keyup",BX.proxy(function(c){this.onInputChange()},this));BX.bind(this.maxInput,"keyup",BX.proxy(function(c){this.onInputChange()},this))}};a.prototype.init=function(){var b;if(this.curMinPrice>this.minPrice){b=this.curMinPrice-this.minPrice;this.leftPercent=(b*100)/this.priceDiff;this.leftSlider.style.left=this.leftPercent+"%";this.colorUnavailableActive.style.left=this.leftPercent+"%"}this.setMinFilteredValue(this.fltMinPrice);if(this.curMaxPrice<this.maxPrice){b=this.maxPrice-this.curMaxPrice;this.rightPercent=(b*100)/this.priceDiff;this.rightSlider.style.right=this.rightPercent+"%";this.colorUnavailableActive.style.right=this.rightPercent+"%"}this.setMaxFilteredValue(this.fltMaxPrice)};a.prototype.setMinFilteredValue=function(b){this.fltMinPrice=parseFloat(b);if(this.fltMinPrice>=this.minPrice){var c=this.fltMinPrice-this.minPrice;this.fltMinPercent=(c*100)/this.priceDiff;if(this.leftPercent>this.fltMinPercent){this.colorAvailableActive.style.left=this.leftPercent+"%"}else{this.colorAvailableActive.style.left=this.fltMinPercent+"%"}this.colorAvailableInactive.style.left=this.fltMinPercent+"%"}else{this.colorAvailableActive.style.left="0%";this.colorAvailableInactive.style.left="0%"}};a.prototype.setMaxFilteredValue=function(b){this.fltMaxPrice=parseFloat(b);if(this.fltMaxPrice<=this.maxPrice){var c=this.maxPrice-this.fltMaxPrice;this.fltMaxPercent=(c*100)/this.priceDiff;if(this.rightPercent>this.fltMaxPercent){this.colorAvailableActive.style.right=this.rightPercent+"%"}else{this.colorAvailableActive.style.right=this.fltMaxPercent+"%"}this.colorAvailableInactive.style.right=this.fltMaxPercent+"%"}else{this.colorAvailableActive.style.right="0%";this.colorAvailableInactive.style.right="0%"}};a.prototype.getXCoord=function(e){var d=e.getBoundingClientRect();var c=document.body;var b=document.documentElement;var g=window.pageXOffset||b.scrollLeft||c.scrollLeft;var h=b.clientLeft||c.clientLeft||0;var f=d.left+g-h;return Math.round(f)};a.prototype.getPageX=function(f){f=f||window.event;var d=null;if(this.isTouch&&event.targetTouches[0]!=null){d=f.targetTouches[0].pageX}else{if(f.pageX!=null){d=f.pageX}else{if(f.clientX!=null){var c=document.documentElement;var b=document.body;d=f.clientX+(c.scrollLeft||b&&b.scrollLeft||0);d-=c.clientLeft||0}}}return d};a.prototype.recountMinPrice=function(){var b=(this.priceDiff*this.leftPercent)/100;b=(this.minPrice+b).toFixed(this.precision);if(b!=this.minPrice){this.minInput.value=b}else{this.minInput.value=""}smartFilter.keyup(this.minInput)};a.prototype.recountMaxPrice=function(){var b=(this.priceDiff*this.rightPercent)/100;b=(this.maxPrice-b).toFixed(this.precision);if(b!=this.maxPrice){this.maxInput.value=b}else{this.maxInput.value=""}smartFilter.keyup(this.maxInput)};a.prototype.onInputChange=function(){var d;if(this.minInput.value){var b=this.minInput.value;if(b<this.minPrice){b=this.minPrice}if(b>this.maxPrice){b=this.maxPrice}d=b-this.minPrice;this.leftPercent=(d*100)/this.priceDiff;this.makeLeftSliderMove(false)}if(this.maxInput.value){var c=this.maxInput.value;if(c<this.minPrice){c=this.minPrice}if(c>this.maxPrice){c=this.maxPrice}d=this.maxPrice-c;this.rightPercent=(d*100)/this.priceDiff;this.makeRightSliderMove(false)}};a.prototype.makeLeftSliderMove=function(c){c=(c===false)?false:true;this.leftSlider.style.left=this.leftPercent+"%";this.colorUnavailableActive.style.left=this.leftPercent+"%";var b=false;if(this.leftPercent+this.rightPercent>=100){b=true;this.rightPercent=100-this.leftPercent;this.rightSlider.style.right=this.rightPercent+"%";this.colorUnavailableActive.style.right=this.rightPercent+"%"}if(this.leftPercent>=this.fltMinPercent&&this.leftPercent<=(100-this.fltMaxPercent)){this.colorAvailableActive.style.left=this.leftPercent+"%";if(b){this.colorAvailableActive.style.right=100-this.leftPercent+"%"}}else{if(this.leftPercent<=this.fltMinPercent){this.colorAvailableActive.style.left=this.fltMinPercent+"%";if(b){this.colorAvailableActive.style.right=100-this.fltMinPercent+"%"}}else{if(this.leftPercent>=this.fltMaxPercent){this.colorAvailableActive.style.left=100-this.fltMaxPercent+"%";if(b){this.colorAvailableActive.style.right=this.fltMaxPercent+"%"}}}}if(c){this.recountMinPrice();if(b){this.recountMaxPrice()}}};a.prototype.countNewLeft=function(e){pageX=this.getPageX(e);var c=this.getXCoord(this.trackerWrap);var b=this.trackerWrap.offsetWidth;var d=pageX-c;if(d<0){d=0}else{if(d>b){d=b}}return d};a.prototype.onMoveLeftSlider=function(b){if(!this.isTouch){this.leftSlider.ondragstart=function(){return false}}if(!this.isTouch){document.onmousemove=BX.proxy(function(c){this.leftPercent=((this.countNewLeft(c)*100)/this.trackerWrap.offsetWidth);this.makeLeftSliderMove()},this);document.onmouseup=function(){document.onmousemove=document.onmouseup=null}}else{document.ontouchmove=BX.proxy(function(c){this.leftPercent=((this.countNewLeft(c)*100)/this.trackerWrap.offsetWidth);this.makeLeftSliderMove()},this);document.ontouchend=function(){document.ontouchmove=document.touchend=null}}return false};a.prototype.makeRightSliderMove=function(c){c=(c===false)?false:true;this.rightSlider.style.right=this.rightPercent+"%";this.colorUnavailableActive.style.right=this.rightPercent+"%";var b=false;if(this.leftPercent+this.rightPercent>=100){b=true;this.leftPercent=100-this.rightPercent;this.leftSlider.style.left=this.leftPercent+"%";this.colorUnavailableActive.style.left=this.leftPercent+"%"}if((100-this.rightPercent)>=this.fltMinPercent&&this.rightPercent>=this.fltMaxPercent){this.colorAvailableActive.style.right=this.rightPercent+"%";if(b){this.colorAvailableActive.style.left=100-this.rightPercent+"%"}}else{if(this.rightPercent<=this.fltMaxPercent){this.colorAvailableActive.style.right=this.fltMaxPercent+"%";if(b){this.colorAvailableActive.style.left=100-this.fltMaxPercent+"%"}}else{if((100-this.rightPercent)<=this.fltMinPercent){this.colorAvailableActive.style.right=100-this.fltMinPercent+"%";if(b){this.colorAvailableActive.style.left=this.fltMinPercent+"%"}}}}if(c){this.recountMaxPrice();if(b){this.recountMinPrice()}}};a.prototype.onMoveRightSlider=function(b){if(!this.isTouch){this.rightSlider.ondragstart=function(){return false}}if(!this.isTouch){document.onmousemove=BX.proxy(function(c){this.rightPercent=100-(((this.countNewLeft(c))*100)/(this.trackerWrap.offsetWidth));this.makeRightSliderMove()},this);document.onmouseup=function(){document.onmousemove=document.onmouseup=null}}else{document.ontouchmove=BX.proxy(function(c){this.rightPercent=100-(((this.countNewLeft(c))*100)/(this.trackerWrap.offsetWidth));this.makeRightSliderMove()},this);document.ontouchend=function(){document.ontouchmove=document.ontouchend=null}}return false};return a})();$(document).ready(function(){RSGoPro_FilterOnDocumentReady();$(document).on("click",function(a){if($(a.target).parents(".dd.open").length>0){}else{$(".filtren .dd").removeClass("open")}});$(document).on("click",".filtren label.select",function(){$(this).parents(".filtren").find(".dd.open").removeClass("open");$(this).parents(".dd").toggleClass("open")})});