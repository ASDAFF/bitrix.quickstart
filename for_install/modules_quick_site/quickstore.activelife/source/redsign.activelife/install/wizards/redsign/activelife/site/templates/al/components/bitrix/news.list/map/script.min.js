function drawPlacemark(b,a){b.each(function(){if(!$(this).is(":visible")){a[$(this).data("id")].options.set("visible",false)}else{a[$(this).data("id")].options.set("visible",true)}})}$(document).ready(function(){var e=$(".js-shops_list").find(".js-item"),f=[0,0],d={},c,a="active";e.each(function(){var g=$(this).data("coords").split(",");f[0]=f[0]+parseFloat(g[0]);f[1]=f[1]+parseFloat(g[1])});f[0]=f[0]/e.length;f[1]=f[1]/e.length;var d={},c;ymaps.ready(function(){c=new ymaps.Map("rsYMapShops",{center:f,zoom:14,type:"yandex#publicMap",behaviors:["default","scrollZoom"]});e.each(function(){var g=$(this).data("coords").split(","),h=$(this).data("id");g[0]=parseFloat(g[0]);g[1]=parseFloat(g[1]);d[h]=new ymaps.Placemark(g,{balloonContentHeader:$(this).find(".js-item__name").html(),balloonContentBody:$(this).find(".js-item__descr").html()});c.geoObjects.add(d[h])});c.setBounds(c.geoObjects.getBounds(),{checkZoomRange:true})});e.on("mouseenter",function(){d[$(this).data("id")].options.set("preset","twirl#redDotIcon")}).on("mouseleave",function(){d[$(this).data("id")].options.set("preset","twirl#blueIcon")});$(document).on("keyup",".js-search_city input",function(){var g=$(this),m=g.val(),k=$(".js-filter .js-btn.active").data("filter"),l,i=$([]),j,n,h;l=k?$(".js-shops_list .js-item[data-type="+k+"]"):$(".js-shops_list .js-item");if(!m||m.trim()==""){i=l;$(".js-clear-shops-input").removeClass("active")}else{$(".js-clear-shops-input").addClass("active");$.each(l,function(o,p){j=$(p);n=j.find(".js-item__name").text();h=j.find(".js-item__descr").text();if((n&&n.toLowerCase().indexOf(m.toLowerCase())!==-1)||(h&&h.toLowerCase().indexOf(m.toLowerCase())!==-1)){i=i.add(j)}})}l.addClass("hidden");if(i.length>0){i.removeClass("hidden");$(".js-not-found:visible").hide()}else{$(".js-not-found:hidden").show()}b(i,m)});$(document).on("click",".js-shops_list .js-item",function(){var g=$(this).data("coords");if(!g){return}g=g.split(",");g=$.map(g,function(h){return parseFloat(h,10)});c.setCenter(g,18);if(appSLine.getPageWidth()<=appSLine.grid.md){$(window).scrollTop($("#rsYMapShops").offset().top)}});$(document).on("blur",".js-search_city input",function(){var g=$(this).val();if(g.length<1){$(".js-shops_list").find(".js-item").show()}else{$(".js-search_city input").trigger("keyup")}drawPlacemark(e,d)});$(document).on("click",".js-filter .js-btn",function(){$(".js-shops .js-filter").find(".js-btn").removeClass(a);$(this).addClass(a);var g=$(this).data("filter");if(g.length>0){$(".js-shops_list").find(".js-item").hide();$(".js-shops_list").find('.js-item[data-type="'+g+'"]').show()}else{$(".js-shops_list").find(".js-item").show()}$(".js-search_city input").trigger("keyup");drawPlacemark(e,d)});$(document).on("click",".js-clear-shops-input",function(){$(".js-search_city .shops-input").val("").keyup()});function b(h,i){var g=function(j,k){return k.replace(new RegExp("("+j+")","gi"),"<span>$1</span>")};h.each(function(l,m){var k=$(m);var n=k.find(".js-item__name").html();var j=k.find(".js-item__descr").html();n=n.replace(new RegExp("<span>(.*?)</span>","gi"),"$1");j=j.replace(new RegExp("<span>(.*?)</span>","gi"),"$1");if(!i){k.find(".js-item__name").html(n.replace(new RegExp("<span>(.*?)</span>","gi"),"$1"));k.find(".js-item__descr").html(j.replace(new RegExp("<span>(.*?)</span>","gi"),"$1"));return}if(n){n.replace(new RegExp("<span>(.*?)</span>","gi"),"$1");k.find(".js-item__name").html(g(i,n))}if(j){j.replace(new RegExp("<span>(.*?)</span>","gi"),"$1");k.find(".js-item__descr").html(g(i,j))}})}});