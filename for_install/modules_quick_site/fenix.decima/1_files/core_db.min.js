(function(a){if(a.BX.dataBase){return}var b=a.BX;b.dataBase=function(c){this.tableList=[];if(typeof a.openDatabase!="undefined"){this.dbObject=a.openDatabase(c.name,c.version,c.displayName,c.capacity)}};b.dataBase.prototype.isTableExists=function(c,f){var e=this;var d=function(){var h=e.tableList.length;for(var g=0;g<h;g++){if(e.tableList[g].toUpperCase()==c.toUpperCase()){f(true);return}}f(false)};if(this.tableList.length<=0){this.getTableList(d)}else{d()}};b.dataBase.prototype.getTableList=function(e){var d=this;var c=e;this.query({query:"SELECT tbl_name from sqlite_master WHERE type = 'table'",values:{}},function(g){if(g.count>0){for(var f=0;f<g.items.length;f++){d.tableList[d.tableList.length]=g.items[f].tbl_name}}if(c!=null&&typeof(c)=="function"){c(d.tableList)}})};b.dataBase.prototype.createTable=function(e){e.action="create";if(e.success){var c=e.success;e.success=function(f){c(f);this.getTableList()}}var d=this.getQuery(e);this.query(d,e.success,e.fail)};b.dataBase.prototype.dropTable=function(e){e.action="drop";if(e.success){var c=e.success;e.success=function(f){c(f);this.getTableList()}}var d=this.getQuery(e);this.query(d,e.success,e)};b.dataBase.prototype.addRow=function(c){c.action="insert";this.query(this.getQuery(c),c.success,c.fail)};b.dataBase.prototype.getRows=function(c){c.action="select";this.query(this.getQuery(c),c.success,c.fail)};b.dataBase.prototype.updateRows=function(d){d.action="update";var c=this.getQuery(d);this.query(c,d.success,d)};b.dataBase.prototype.deleteRows=function(d){d.action="delete";var c=this.getQuery(d);this.query(c,d.success,d)};b.dataBase.prototype.getQuery=function(e){var p=[];var h=e.filter;var m=e.fields;var q=e.insertFields;var n=e.updateFields;var o=e.tableName;var k="";switch(e.action){case"delete":k="DELETE FROM "+o.toUpperCase()+" "+this.getFilter(h);p=this.getValues([h]);break;case"update":k="UPDATE "+o.toUpperCase()+" "+this.getFieldPair(n,"SET ")+" "+this.getFilter(h);p=this.getValues([n,h]);break;case"create":var c="";if(typeof(m)=="object"){var l="";for(var f=0;f<m.length;f++){l="";if(typeof(m[f])=="object"){if(m[f].name){l=m[f].name;if(m[f].unique&&m[f].unique==true){l+=" unique"}}}else{if(typeof(m[f])=="string"&&m[f].length>0){l=m[f]}}if(l.length>0){if(c.length>0){c+=","+l.toUpperCase()}else{c=l.toUpperCase()}}}}k="CREATE TABLE IF NOT EXISTS "+o.toUpperCase()+" ("+c+") ";break;case"drop":k="DROP TABLE IF EXISTS "+o.toUpperCase();break;case"select":k="SELECT "+this.getValueArrayString(m,"*")+" FROM "+o.toUpperCase()+" "+this.getFilter(h);p=this.getValues([h]);break;case"insert":p=this.getValues([q]);k="INSERT INTO "+o.toUpperCase()+" ("+this.getKeyString(q)+") VALUES(%values%)";var d="";for(var g=0;g<p.length;g++){if(d.length>0){d+=",?"}else{d="?"}}k=k.replace("%values%",d);break}return{query:k,values:p}};b.dataBase.prototype.getFieldPair=function(d,e){var c="";var j=e||"";if(typeof(d)=="object"){var g=0;for(var f in d){var h=((g>0)?", ":"")+(f.toUpperCase()+"=?");if(c.length==0&&j.length>0){c=j}c+=h;g++}}return c};b.dataBase.prototype.getFilter=function(d){var c="";var l="WHERE ";if(typeof(d)=="object"){var g=0;for(var f in d){var k="";var h=1;if(typeof(d[f])=="object"){h=d[f].length}for(var e=0;e<h;e++){k=((e>0)?k+" OR ":"(")+(f.toUpperCase()+"=?");if((e+1)==h){k+=")"}}c+=k;g++}}return"WHERE "+c};b.dataBase.prototype.getKeyString=function(d,g){var c="";if(!g){g=""}if(typeof(d)=="array"){for(var f=0;f<valuesItem.length;f++){if(c.length>0){c+=","+valuesItem[f].toUpperCase()}else{c=valuesItem[f].toUpperCase()}}}else{if(typeof(d)=="object"){for(var e in d){if(c.length>0){c+=","+e.toUpperCase()}else{c=e.toUpperCase()}}}}if(c.length==0){c=g}return c};b.dataBase.prototype.getValueArrayString=function(d,f){var c="";if(!f){f=""}if(typeof(d)=="object"){for(var e=0;e<d.length;e++){if(c.length>0){c+=","+d[e].toUpperCase()}else{c=d[e].toUpperCase()}}}if(c.length==0){c=f}return c};b.dataBase.prototype.getValues=function(d){var g=[];for(var e=0;e<d.length;e++){var c=d[e];if(typeof(c)=="object"){for(var h in c){if(typeof(c[h])!="object"){g[g.length]=c[h]}else{for(var f=0;f<c[h].length;f++){g[g.length]=c[h][f]}}}}else{if(typeof(c)=="array"){for(var f=0;f<c.length;f++){if(typeof(c[f])!="object"){g[g.length]=c[f]}}}}}return g};b.dataBase.prototype.query=function(d,e,c){if(!this.dbObject){return}if(typeof e=="undefined"||typeof e!="function"){e=function(){}}if(typeof c=="undefined"||typeof c!="function"){c=function(){}}this.dbObject.transaction(function(f){f.executeSql(d.query,d.values,function(j,m){var h={originalResult:m};var g=m.rows.length;if(g>=0){h.count=g;h.items=[];for(var l=0;l<g;l++){var n={};var o=m.rows.item(l);for(var k in o){if(o.hasOwnProperty(k)){n[k]=o[k]}}h.items.push(n)}}if(e!=null){e(h,j)}},function(g,h){if(c!=null){c(h,g)}})})};b.dataBase.prototype.getResponseObject=function(f){var d=f.rows.length;var c=[];for(var e=0;e<d;e++){c[c.length]=f.rows.item(e)}return c}})(window);