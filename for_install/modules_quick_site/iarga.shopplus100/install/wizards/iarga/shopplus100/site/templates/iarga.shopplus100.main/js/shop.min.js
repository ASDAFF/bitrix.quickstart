$(function(){init_props();init_delivery();$(".unitooltip").blur(function(){if(tooltip!=0){tooltip.abort()}var a=$(this);if(a.parents("label").length>0){a=a.parents("label").eq(0)}if(a.next().hasClass("tooltip_open")){a.next().fadeOut()}});jQuery(".PERSON_TYPE .input").bind("click",function(){var a=$(this).find("input");preloader_start(a);$.post(jQuery("#b_template").val()+"/props.php",{person_type:a.val()},function(b){preloader_stop(a);jQuery(".order_props").html(b);Custom.init();init_delivery();init_props()})});jQuery(".PERSON_TYPE input").bind("change keyup",function(){preloader_start(this);$.post(jQuery("#b_template").val()+"/props.php",{person_type:this.value},function(a){preloader_stop(this);jQuery(".order_props").html(a);Custom.init();init_delivery();init_props()})});$(".bt_del-cart").click(function(){$(".info-amount").load(SITE_DIR+"inc/ajax/basket.php",{add:$(this).parents(".cell").find(".in_cart").attr("rel"),num:0},b_loaded);$(this).parents(".cell").remove();$(".four-columns .clr").remove();for(var a=0;a<=$(".four-columns .cell").length;a+=4){$(".four-columns .cell").eq(a).addClass("first").before('<div class="clr"></div>')}return false});$.post(SITE_DIR+"inc/ajax/basket.php",{},function(a){if(a.length<1000){$(".info-amount").html(a)}b_loaded()});$.post(SITE_DIR+"inc/ajax/compare.php",{},function(a){if(a.length<1000){$(".info-favorites").html(a)}c_loaded()});$(".to_fav").live("click",function(){if(!$(this).hasClass("in-favorites")){act=1}else{act=0}$(".info-favorites").load(SITE_DIR+"inc/ajax/compare.php",{add:$(this).attr("data-rel"),act:act},c_loaded);return false});$(".remove-favorites").bind("click",function(){$(".info-favorites").load(SITE_DIR+"inc/ajax/compare.php",{add:$(this).attr("data-rel"),act:"0"},c_loaded);$(this).parents(".item").remove();if($(".item").length<1){location.href="/favorite/"}return false});$(".to_cart").live("click",function(){$(this).addClass("active").next().find("input").val(1).addClass("focus");$(".info-amount").load(SITE_DIR+"inc/ajax/basket.php",{add:$(this).attr("data-rel"),num:1},b_loaded);return false});setInterval(function(){$.post(SITE_DIR+"inc/ajax/basket.php",{},function(a){if(a.length<1000){$(".info-amount").html(a)}b_loaded()});$.post(SITE_DIR+"inc/ajax/compare.php",{},function(a){if(a.length<1000){$(".info-favorites").html(a)}c_loaded()})},10000);$(".amount-card input, .manipulation input").bind("focus",function(){$(this).addClass("focus")});$(".amount-card input, .manipulation input").bind("blur",function(){$(this).removeClass("focus")});$(".amount-card input, .manipulation input").bind("keyup mouseup",function(a){if(a.keyCode==38||a.keyCode==187){$(this).val(getval($(this).val())+1)}else{if(a.keyCode==40||a.keyCode==189){$(this).val($(this).val()>1?$(this).val()-1:1)}}var b=$(this).attr("data-rel");if(b==undefined){b=$(this).parents(".amount-card").attr("data-rel")}$(".info-amount").load(SITE_DIR+"inc/ajax/basket.php",{add:b,num:$(this).val()},b_loaded)});$(".select-number .plus, .select-number .minus").click(function(){var a=$(this).parent().find("input").val();if($(this).hasClass("plus")){a++}else{if($(this).hasClass("minus")){a--}}if(a<1){a=1}$(this).parent().find("input").val(a).keyup();return false});$(".remove-card, .link-remove-card").bind("click",function(){$(this).parent().find("input").val("-1").removeClass("focus").keyup();if($(this).closest(".card").length>0){$(this).closest(".item").remove()}return false});if($("input.location").val()!=""){$("input.location").click()}});function init_props(){jQuery(".location select").change(function(a){preloader_start(this);$.post(jQuery("#b_template").val()+"/delivery.php",{city:$(this).val()},function(b){preloader_stop(this);jQuery(".delivery_ajax").html(b);Custom.init()})});jQuery(".location select").change();jQuery(".discount_code").on("keyup",function(){preloader_start(this);jQuery(".info-amount").load(SITE_DIR+"inc/ajax/basket.php",{discount_code:jQuery(this).val()},function(){b_loaded();preloader_stop()})})}function init_delivery(){$("input[name='delivery']").live("change",function(){$(".info-amount").load(SITE_DIR+"inc/ajax/basket.php",{delivery_price:$(this).attr("data-rel"),delivery:$(this).val()},b_loaded)})}function b_loaded(){$(".to_cart").show();$(".amount-card input:not(.focus)").each(function(){$(this).parent().hide()});$(".info-amount input").each(function(){var a=$(".to_cart[data-rel="+$(this).attr("name")+"]").hide();var b=$(".amount-card[data-rel="+$(this).attr("name")+"]");var c=b.show().find("input:not(.focus)").val($(this).val())});$(".numgoods").html($(".info-amount input[name=numgoods]").val());$("span.discount_value").html(jQuery(".info-amount input[name=discount_value]").val());$(".allgoods").html($(".info-amount input[name=allgoods]").val());$(".total-pay strong").html(($(".info-amount input[name=allsumm]").val())+$(".info-amount input[name=valute]").val());$(".amount-card input.focus").focus().parent().show().prev().hide();if($(".info-amount input").length>6){$(".total-pay, .info-amount").show()}else{$(".total-pay, .info-amount").hide()}if($(".card").length>0){$(".info-amount").hide()}if($(".card .item").length<1){$(".card, .checkout, .total-pay, .checkout-button").hide();$(".nocard").show()}else{$(".card, .checkout, .total-pay, .checkout-button").show();$(".nocard").hide()}if($("input.location").val()!=""){$("input.location").click()}}function c_loaded(){$("a.to_fav").text($(".to_fav_lang").val()).removeClass("in-favorites");if($(".info-favorites input").length>2){$(".info-favorites").show()}else{$(".info-favorites").hide()}$(".info-favorites input").each(function(){var a=$(".to_fav[data-rel="+$(this).attr("name")+"]");if(a.length>0){a.text($(".in_fav_lang").val()).addClass("in-favorites")}});if($(".send-mail-favorites").length>0){$(".info-favorites").hide()}}function city_keyup(b){if(tooltip!=0){tooltip.abort()}var a=$(b);if(a.parents("label").length>0){a=a.parents("label").eq(0)}if(a.next().hasClass("tooltip_open")){var c=a.next()}else{var c=$("<div class='tooltip_open'></div>").insertAfter(a).hide()}if(ttload!=false){ttload.abort();ttload=false}ttload=$.post($(b).attr("data-rel"),{q:$(b).val()},function(d){c.html(d);if(c.find("a").length>0&&$(".location").hasClass("focus")){c.stop().fadeIn(200,function(){c.css({opacity:"1",display:"block"})})}else{c.stop().fadeOut()}c.find("a").click(function(){$(this).parents(".tooltip_open").prev().val($(this).html()).keyup();$(this).parents(".tooltip_open").fadeOut()})})};