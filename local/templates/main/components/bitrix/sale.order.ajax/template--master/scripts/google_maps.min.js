BX.namespace("BX.Sale.OrderAjaxComponent.Maps");(function(){BX.Sale.OrderAjaxComponent.Maps={init:function(a){this.context=a||{};this.pickUpOptions=this.context.options.pickUpMap;this.propsOptions=this.context.options.propertyMap;this.maxWaitTimeExpired=false;this.scheme=this.context.isHttps?"https":"http";this.icons={red:this.scheme+"://maps.google.com/mapfiles/ms/icons/red-dot.png",green:this.scheme+"://maps.google.com/mapfiles/ms/icons/green-dot.png"};return this},initializePickUpMap:function(b){if(!google){return}this.markers=[];this.bounds=new google.maps.LatLngBounds();var c=!!b?parseFloat(BX.util.trim(b.GPS_N)):this.pickUpOptions.defaultMapPosition.lat,a=!!b?parseFloat(BX.util.trim(b.GPS_S)):this.pickUpOptions.defaultMapPosition.lon;this.pickUpMap=new google.maps.Map(BX("pickUpMap"),{center:{lat:c,lng:a},zoom:this.pickUpOptions.defaultMapPosition.zoom,scrollwheel:false});google.maps.event.addListener(this.pickUpMap,"click",BX.proxy(this.closeAllBalloons,this))},canUseRecommendList:function(){return false},getRecommendedStoreIds:function(a,b){return[]},getDistance:function(b,a){return false},pickUpMapFocusWaiter:function(){if(this.pickUpMap&&this.markers.length){this.setPickUpMapFocus()}else{setTimeout(BX.proxy(this.pickUpMapFocusWaiter,this),100)}},setPickUpMapFocus:function(){google.maps.event.trigger(this.pickUpMap,"resize");this.pickUpMap.fitBounds(this.bounds)},showNearestPickups:function(b,a){},buildBalloons:function(b){if(!google){return}var c,a;var d=this;for(c=0;c<b.length;c++){a=new google.maps.Marker({position:{lat:parseFloat(b[c].GPS_N),lng:parseFloat(b[c].GPS_S)},map:this.pickUpMap,title:b[c].TITLE});a.info=new google.maps.InfoWindow({content:"<h3>"+BX.util.htmlspecialchars(b[c].TITLE)+"</h3>"+this.getStoreInfoHtml(b[c])+'<br /><a class="btn btn-sm btn-default" data-store="'+b[c].ID+'">'+this.context.params.MESS_SELECT_PICKUP+"</a>"});a.storeId=b[c].ID;google.maps.event.addListener(a.info,"domready",function(){var e=document.querySelector("a[data-store]");if(e){BX.bind(e,"click",BX.proxy(d.selectStoreByClick,d))}});google.maps.event.addListener(a,"click",function(){d.closeAllBalloons();this.info.open(this.getMap(),this)});if(BX("BUYER_STORE").value===b[c].ID){a.setIcon(this.icons.green)}else{a.setIcon(this.icons.red)}this.markers.push(a);this.bounds.extend(a.getPosition())}},selectStoreByClick:function(b){var a=b.target||b.srcElement;this.context.selectStore(a.getAttribute("data-store"));this.context.clickNextAction(b);this.closeAllBalloons()},closeAllBalloons:function(){for(var a=0;a<this.markers.length;a++){this.markers[a].info.close()}},selectBalloon:function(a){if(!this.pickUpMap||!this.markers||!this.markers.length){return}for(var b=0;b<this.markers.length;b++){if(this.markers[b].storeId===a){this.markers[b].setIcon(this.icons.green);this.pickUpMap.panTo(this.markers[b].getPosition())}else{this.markers[b].setIcon(this.icons.red)}}},pickUpFinalAction:function(){},initializePropsMap:function(a){if(!google){return}this.propsMap=new google.maps.Map(BX("propsMap"),{center:{lat:a.lat,lng:a.lon},zoom:a.zoom,scrollwheel:false});this.currentPropsMapCenter=this.propsMap.getCenter();google.maps.event.addListener(this.propsMap,"click",BX.delegate(function(b){if(!this.propsMarker){this.propsMarker=new google.maps.Marker({position:b.latLng,map:this.propsMap,draggable:true});this.propsMarker.addListener("drag",BX.proxy(this.onPropsMarkerChanged,this));this.propsMarker.addListener("dragend",BX.proxy(this.onPropsMarkerChanged,this))}else{this.propsMarker.setPosition(b.latLng)}this.currentPropsMapCenter=b.latLng;this.onPropsMarkerChanged({latLng:b.latLng})},this))},onPropsMarkerChanged:function(d){var c=BX("orderDescription",true),g=d.latLng.lat(),b=d.latLng.lng(),f,e,h,a;if(c){f=c.value.indexOf(BX.message("SOA_MAP_COORDS")+":");if(f===-1){c.value=BX.message("SOA_MAP_COORDS")+": "+g+", "+b+"\r\n"+c.value}else{a=BX.message("SOA_MAP_COORDS")+": "+g+", "+b;e=c.value.substring(0,f);h=c.value.substring(f+a.length);c.value=e+a+h}}},propsMapFocusWaiter:function(){if(this.propsMap){this.setPropsMapFocus()}else{setTimeout(BX.proxy(this.propsMapFocusWaiter,this),100)}},setPropsMapFocus:function(){google.maps.event.trigger(this.propsMap,"resize");this.propsMap.setCenter(this.currentPropsMapCenter)},getStoreInfoHtml:function(a){var b="";if(a.ADDRESS){b+=BX.message("SOA_PICKUP_ADDRESS")+": "+BX.util.htmlspecialchars(a.ADDRESS)+"<br />"}if(a.PHONE){b+=BX.message("SOA_PICKUP_PHONE")+": "+BX.util.htmlspecialchars(a.PHONE)+"<br />"}if(a.SCHEDULE){b+=BX.message("SOA_PICKUP_WORK")+": "+BX.util.htmlspecialchars(a.SCHEDULE)+"<br />"}if(a.DESCRIPTION){b+=BX.message("SOA_PICKUP_DESC")+": "+BX.util.htmlspecialchars(a.DESCRIPTION)+"<br />"}return b}}})();