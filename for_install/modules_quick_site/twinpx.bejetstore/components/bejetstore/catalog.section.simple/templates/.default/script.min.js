(function(b){if(!!b.JCCatalogSection){return}var a=function(c){a.superclass.constructor.apply(this,arguments);this.nameNode=BX.create("span",{props:{className:"bx_medium bx_bt_button",id:this.id},style:typeof(c.style)==="object"?c.style:{},text:c.text});this.buttonNode=BX.create("span",{attrs:{className:c.ownerClass},style:{marginBottom:"0",borderBottom:"0 none transparent"},children:[this.nameNode],events:this.contextEvents});if(BX.browser.IsIE()){this.buttonNode.setAttribute("hideFocus","hidefocus")}};BX.extend(a,BX.PopupWindowButton);b.JCCatalogSection=function(c){this.productType=0;this.showQuantity=true;this.showAbsent=true;this.secondPict=false;this.showOldPrice=false;this.showPercent=false;this.showSkuProps=false;this.basketAction="ADD";this.showClosePopup=false;this.useCompare=false;this.visual={ID:"",PICT_ID:"",SECOND_PICT_ID:"",QUANTITY_ID:"",QUANTITY_UP_ID:"",QUANTITY_DOWN_ID:"",PRICE_ID:"",DSC_PERC:"",SECOND_DSC_PERC:"",DISPLAY_PROP_DIV:"",BASKET_PROP_DIV:""};this.product={checkQuantity:false,maxQuantity:0,stepQuantity:1,isDblQuantity:false,canBuy:true,canSubscription:true,name:"",pict:{},id:0,addUrl:"",buyUrl:""};this.basketMode="";this.basketData={useProps:false,emptyProps:false,quantity:"quantity",props:"prop",basketUrl:"",sku_props:"",sku_props_var:"basket_props",add_url:"",buy_url:""};this.compareData={compareUrl:"",comparePath:""};this.defaultPict={pict:null,secondPict:null};this.checkQuantity=false;this.maxQuantity=0;this.stepQuantity=1;this.isDblQuantity=false;this.canBuy=true;this.currentBasisPrice={};this.canSubscription=true;this.precision=6;this.precisionFactor=Math.pow(10,this.precision);this.offers=[];this.offerNum=0;this.treeProps=[];this.obTreeRows=[];this.showCount=[];this.showStart=[];this.selectedValues={};this.obProduct=null;this.obQuantity=null;this.obQuantityUp=null;this.obQuantityDown=null;this.obPict=null;this.obSecondPict=null;this.obPrice=null;this.obTree=null;this.obBuyBtn=null;this.obBasketActions=null;this.obNotAvail=null;this.obDscPerc=null;this.obSecondDscPerc=null;this.obSkuProps=null;this.obMeasure=null;this.obCompare=null;this.obPopupWin=null;this.basketUrl="";this.basketParams={};this.treeRowShowSize=5;this.treeEnableArrow={display:"",cursor:"pointer",opacity:1};this.treeDisableArrow={display:"",cursor:"default",opacity:0.2};this.lastElement=false;this.containerHeight=0;this.errorCode=0;if("object"===typeof c){this.productType=parseInt(c.PRODUCT_TYPE,10);this.showQuantity=c.SHOW_QUANTITY;this.showAbsent=c.SHOW_ABSENT;this.secondPict=!!c.SECOND_PICT;this.showOldPrice=!!c.SHOW_OLD_PRICE;this.showPercent=!!c.SHOW_DISCOUNT_PERCENT;this.showSkuProps=!!c.SHOW_SKU_PROPS;if(!!c.ADD_TO_BASKET_ACTION){this.basketAction=c.ADD_TO_BASKET_ACTION}this.showClosePopup=!!c.SHOW_CLOSE_POPUP;this.useCompare=!!c.DISPLAY_COMPARE;this.visual=c.VISUAL;switch(this.productType){case 0:case 1:case 2:if(!!c.PRODUCT&&"object"===typeof(c.PRODUCT)){if(this.showQuantity){this.product.checkQuantity=c.PRODUCT.CHECK_QUANTITY;this.product.isDblQuantity=c.PRODUCT.QUANTITY_FLOAT;if(this.product.checkQuantity){this.product.maxQuantity=(this.product.isDblQuantity?parseFloat(c.PRODUCT.MAX_QUANTITY):parseInt(c.PRODUCT.MAX_QUANTITY,10))}this.product.stepQuantity=(this.product.isDblQuantity?parseFloat(c.PRODUCT.STEP_QUANTITY):parseInt(c.PRODUCT.STEP_QUANTITY,10));this.checkQuantity=this.product.checkQuantity;this.isDblQuantity=this.product.isDblQuantity;this.maxQuantity=this.product.maxQuantity;this.stepQuantity=this.product.stepQuantity;if(this.isDblQuantity){this.stepQuantity=Math.round(this.stepQuantity*this.precisionFactor)/this.precisionFactor}}this.product.canBuy=c.PRODUCT.CAN_BUY;this.product.canSubscription=c.PRODUCT.SUBSCRIPTION;if(!!c.PRODUCT.BASIS_PRICE){this.currentBasisPrice=c.PRODUCT.BASIS_PRICE}this.canBuy=this.product.canBuy;this.canSubscription=this.product.canSubscription;this.product.name=c.PRODUCT.NAME;this.product.pict=c.PRODUCT.PICT;this.product.id=c.PRODUCT.ID;if(!!c.PRODUCT.ADD_URL){this.product.addUrl=c.PRODUCT.ADD_URL}if(!!c.PRODUCT.BUY_URL){this.product.buyUrl=c.PRODUCT.BUY_URL}if(!!c.BASKET&&"object"===typeof(c.BASKET)){this.basketData.useProps=!!c.BASKET.ADD_PROPS;this.basketData.emptyProps=!!c.BASKET.EMPTY_PROPS}}else{this.errorCode=-1}break;case 3:if(!!c.OFFERS&&BX.type.isArray(c.OFFERS)){if(!!c.PRODUCT&&"object"===typeof(c.PRODUCT)){this.product.name=c.PRODUCT.NAME;this.product.id=c.PRODUCT.ID}this.offers=c.OFFERS;this.offerNum=0;if(!!c.OFFER_SELECTED){this.offerNum=parseInt(c.OFFER_SELECTED,10)}if(isNaN(this.offerNum)){this.offerNum=0}if(!!c.TREE_PROPS){this.treeProps=c.TREE_PROPS}if(!!c.DEFAULT_PICTURE){this.defaultPict.pict=c.DEFAULT_PICTURE.PICTURE;this.defaultPict.secondPict=c.DEFAULT_PICTURE.PICTURE_SECOND}}break;default:this.errorCode=-1}if(!!c.BASKET&&"object"===typeof(c.BASKET)){if(!!c.BASKET.QUANTITY){this.basketData.quantity=c.BASKET.QUANTITY}if(!!c.BASKET.PROPS){this.basketData.props=c.BASKET.PROPS}if(!!c.BASKET.BASKET_URL){this.basketData.basketUrl=c.BASKET.BASKET_URL}if(3===this.productType){if(!!c.BASKET.SKU_PROPS){this.basketData.sku_props=c.BASKET.SKU_PROPS}}if(!!c.BASKET.ADD_URL_TEMPLATE){this.basketData.add_url=c.BASKET.ADD_URL_TEMPLATE}if(!!c.BASKET.BUY_URL_TEMPLATE){this.basketData.buy_url=c.BASKET.BUY_URL_TEMPLATE}if(this.basketData.add_url===""&&this.basketData.buy_url===""){this.errorCode=-1024}}if(this.useCompare){if(!!c.COMPARE&&typeof(c.COMPARE)==="object"){if(!!c.COMPARE.COMPARE_PATH){this.compareData.comparePath=c.COMPARE.COMPARE_PATH}if(!!c.COMPARE.COMPARE_URL_TEMPLATE){this.compareData.compareUrl=c.COMPARE.COMPARE_URL_TEMPLATE}else{this.useCompare=false}}else{this.useCompare=false}}this.lastElement=(!!c.LAST_ELEMENT&&"Y"===c.LAST_ELEMENT)}if(0===this.errorCode){BX.ready(BX.delegate(this.Init,this))}};b.JCCatalogSection.prototype.Init=function(){var c=0,e="",d=null;this.obProduct=BX(this.visual.ID);if(!this.obProduct){this.errorCode=-1}this.obPict=BX(this.visual.PICT_ID);if(!this.obPict){this.errorCode=-2}if(this.secondPict&&!!this.visual.SECOND_PICT_ID){this.obSecondPict=BX(this.visual.SECOND_PICT_ID)}this.obPrice=BX(this.visual.PRICE_ID);if(!this.obPrice){this.errorCode=-16}if(this.showQuantity&&!!this.visual.QUANTITY_ID){this.obQuantity=BX(this.visual.QUANTITY_ID);if(!!this.visual.QUANTITY_UP_ID){this.obQuantityUp=BX(this.visual.QUANTITY_UP_ID)}if(!!this.visual.QUANTITY_DOWN_ID){this.obQuantityDown=BX(this.visual.QUANTITY_DOWN_ID)}}if(3===this.productType&&this.offers.length>0){if(!!this.visual.TREE_ID){this.obTree=BX(this.visual.TREE_ID);if(!this.obTree){this.errorCode=-256}e=this.visual.TREE_ITEM_ID;for(c=0;c<this.treeProps.length;c++){this.obTreeRows[c]={LEFT:BX(e+this.treeProps[c].ID+"_left"),RIGHT:BX(e+this.treeProps[c].ID+"_right"),LIST:BX(e+this.treeProps[c].ID+"_list"),CONT:BX(e+this.treeProps[c].ID+"_cont")};if(!this.obTreeRows[c].LEFT||!this.obTreeRows[c].RIGHT||!this.obTreeRows[c].LIST||!this.obTreeRows[c].CONT){this.errorCode=-512;break}}}if(!!this.visual.QUANTITY_MEASURE){this.obMeasure=BX(this.visual.QUANTITY_MEASURE)}}this.obBasketActions=BX(this.visual.BASKET_ACTIONS_ID);if(!!this.obBasketActions){if(!!this.visual.BUY_ID){this.obBuyBtn=BX(this.visual.BUY_ID)}}this.obNotAvail=BX(this.visual.NOT_AVAILABLE_MESS);if(this.showPercent){if(!!this.visual.DSC_PERC){this.obDscPerc=BX(this.visual.DSC_PERC)}if(this.secondPict&&!!this.visual.SECOND_DSC_PERC){this.obSecondDscPerc=BX(this.visual.SECOND_DSC_PERC)}}if(this.showSkuProps){if(!!this.visual.DISPLAY_PROP_DIV){this.obSkuProps=BX(this.visual.DISPLAY_PROP_DIV)}}if(0===this.errorCode){if(this.showQuantity){if(!!this.obQuantityUp){BX.bind(this.obQuantityUp,"click",BX.delegate(this.QuantityUp,this))}if(!!this.obQuantityDown){BX.bind(this.obQuantityDown,"click",BX.delegate(this.QuantityDown,this))}if(!!this.obQuantity){BX.bind(this.obQuantity,"change",BX.delegate(this.QuantityChange,this))}}switch(this.productType){case 1:break;case 3:if(this.offers.length>0){d=BX.findChildren(this.obTree,{tagName:"li"},true);if(!!d&&0<d.length){for(c=0;c<d.length;c++){BX.bind(d[c],"click",BX.delegate(this.SelectOfferProp,this))}}for(c=0;c<this.obTreeRows.length;c++){BX.bind(this.obTreeRows[c].LEFT,"click",BX.delegate(this.RowLeft,this));BX.bind(this.obTreeRows[c].RIGHT,"click",BX.delegate(this.RowRight,this))}this.SetCurrent()}break}if(!!this.obBuyBtn){if(this.basketAction==="ADD"){BX.bind(this.obBuyBtn,"click",BX.delegate(this.Add2Basket,this))}else{BX.bind(this.obBuyBtn,"click",BX.delegate(this.BuyBasket,this))}}if(this.lastElement){this.containerHeight=parseInt(this.obProduct.parentNode.offsetHeight,10);if(isNaN(this.containerHeight)){this.containerHeight=0}this.setHeight();BX.bind(b,"resize",BX.delegate(this.checkHeight,this));BX.bind(this.obProduct.parentNode,"mouseover",BX.delegate(this.setHeight,this));BX.bind(this.obProduct.parentNode,"mouseout",BX.delegate(this.clearHeight,this))}if(this.useCompare){this.obCompare=BX(this.visual.COMPARE_LINK_ID);if(!!this.obCompare){BX.bind(this.obCompare,"click",BX.proxy(this.Compare,this))}}}};b.JCCatalogSection.prototype.checkHeight=function(){this.containerHeight=parseInt(this.obProduct.parentNode.offsetHeight,10);if(isNaN(this.containerHeight)){this.containerHeight=0}};b.JCCatalogSection.prototype.setHeight=function(){if(0<this.containerHeight){BX.adjust(this.obProduct.parentNode,{style:{height:this.containerHeight+"px"}})}};b.JCCatalogSection.prototype.clearHeight=function(){BX.adjust(this.obProduct.parentNode,{style:{height:"auto"}})};b.JCCatalogSection.prototype.QuantityUp=function(){var e=0,c=true,d;if(0===this.errorCode&&this.showQuantity&&this.canBuy){e=(this.isDblQuantity?parseFloat(this.obQuantity.value):parseInt(this.obQuantity.value,10));if(!isNaN(e)){e+=this.stepQuantity;if(this.checkQuantity){if(e>this.maxQuantity){c=false}}if(c){if(this.isDblQuantity){e=Math.round(e*this.precisionFactor)/this.precisionFactor}this.obQuantity.value=e;d={DISCOUNT_VALUE:this.currentBasisPrice.DISCOUNT_VALUE*e,VALUE:this.currentBasisPrice.VALUE*e,DISCOUNT_DIFF:this.currentBasisPrice.DISCOUNT_DIFF*e,DISCOUNT_DIFF_PERCENT:this.currentBasisPrice.DISCOUNT_DIFF_PERCENT,CURRENCY:this.currentBasisPrice.CURRENCY};this.setPrice(d)}}}};b.JCCatalogSection.prototype.QuantityDown=function(){var e=0,c=true,d;if(0===this.errorCode&&this.showQuantity&&this.canBuy){e=(this.isDblQuantity?parseFloat(this.obQuantity.value):parseInt(this.obQuantity.value,10));if(!isNaN(e)){e-=this.stepQuantity;if(e<this.stepQuantity){c=false}if(c){if(this.isDblQuantity){e=Math.round(e*this.precisionFactor)/this.precisionFactor}this.obQuantity.value=e;d={DISCOUNT_VALUE:this.currentBasisPrice.DISCOUNT_VALUE*e,VALUE:this.currentBasisPrice.VALUE*e,DISCOUNT_DIFF:this.currentBasisPrice.DISCOUNT_DIFF*e,DISCOUNT_DIFF_PERCENT:this.currentBasisPrice.DISCOUNT_DIFF_PERCENT,CURRENCY:this.currentBasisPrice.CURRENCY};this.setPrice(d)}}}};b.JCCatalogSection.prototype.QuantityChange=function(){var f=0,e,c,d;if(0===this.errorCode&&this.showQuantity){if(this.canBuy){f=(this.isDblQuantity?parseFloat(this.obQuantity.value):parseInt(this.obQuantity.value,10));if(!isNaN(f)){if(this.checkQuantity){if(f>this.maxQuantity){f=this.maxQuantity}}if(f<this.stepQuantity){f=this.stepQuantity}else{d=Math.round((f*this.precisionFactor)/this.stepQuantity)/this.precisionFactor;c=parseInt(d,10);if(isNaN(c)){c=1;d=1.1}if(d>c){f=(c<=1?this.stepQuantity:c*this.stepQuantity);f=Math.round(f*this.precisionFactor)/this.precisionFactor}}this.obQuantity.value=f}else{this.obQuantity.value=this.stepQuantity}}else{this.obQuantity.value=this.stepQuantity}e={DISCOUNT_VALUE:this.currentBasisPrice.DISCOUNT_VALUE*this.obQuantity.value,VALUE:this.currentBasisPrice.VALUE*this.obQuantity.value,DISCOUNT_DIFF:this.currentBasisPrice.DISCOUNT_DIFF*this.obQuantity.value,DISCOUNT_DIFF_PERCENT:this.currentBasisPrice.DISCOUNT_DIFF_PERCENT,CURRENCY:this.currentBasisPrice.CURRENCY};this.setPrice(e)}};b.JCCatalogSection.prototype.QuantitySet=function(c){if(0===this.errorCode){this.canBuy=this.offers[c].CAN_BUY;if(this.canBuy){if(!!this.obBasketActions){BX.style(this.obBasketActions,"display","")}if(!!this.obNotAvail){BX.style(this.obNotAvail,"display","none")}}else{if(!!this.obBasketActions){BX.style(this.obBasketActions,"display","none")}if(!!this.obNotAvail){BX.style(this.obNotAvail,"display","")}}if(this.showQuantity){this.isDblQuantity=this.offers[c].QUANTITY_FLOAT;this.checkQuantity=this.offers[c].CHECK_QUANTITY;if(this.isDblQuantity){this.maxQuantity=parseFloat(this.offers[c].MAX_QUANTITY);this.stepQuantity=Math.round(parseFloat(this.offers[c].STEP_QUANTITY)*this.precisionFactor)/this.precisionFactor}else{this.maxQuantity=parseInt(this.offers[c].MAX_QUANTITY,10);this.stepQuantity=parseInt(this.offers[c].STEP_QUANTITY,10)}this.obQuantity.value=this.stepQuantity;this.obQuantity.disabled=!this.canBuy;if(!!this.obMeasure){if(!!this.offers[c].MEASURE){BX.adjust(this.obMeasure,{html:this.offers[c].MEASURE})}else{BX.adjust(this.obMeasure,{html:""})}}}this.currentBasisPrice=this.offers[c].BASIS_PRICE}};b.JCCatalogSection.prototype.SelectOfferProp=function(){var c=0,e="",d="",g=[],h=null,f=BX.proxy_context;if(!!f&&f.hasAttribute("data-treevalue")){d=f.getAttribute("data-treevalue");g=d.split("_");if(this.SearchOfferPropIndex(g[0],g[1])){h=BX.findChildren(f.parentNode,{tagName:"li"},false);if(!!h&&0<h.length){for(c=0;c<h.length;c++){e=h[c].getAttribute("data-onevalue");if(e===g[1]){BX.addClass(h[c],"bx_active")}else{BX.removeClass(h[c],"bx_active")}}}}}};b.JCCatalogSection.prototype.SearchOfferPropIndex=function(e,n){var k="",o=false,f,d,l=[],c=[],g=-1,h={},m=[];for(f=0;f<this.treeProps.length;f++){if(this.treeProps[f].ID===e){g=f;break}}if(-1<g){for(f=0;f<g;f++){k="PROP_"+this.treeProps[f].ID;h[k]=this.selectedValues[k]}k="PROP_"+this.treeProps[g].ID;o=this.GetRowValues(h,k);if(!o){return false}if(!BX.util.in_array(n,o)){return false}h[k]=n;for(f=g+1;f<this.treeProps.length;f++){k="PROP_"+this.treeProps[f].ID;o=this.GetRowValues(h,k);if(!o){return false}c=[];if(this.showAbsent){l=[];m=[];m=BX.clone(h,true);for(d=0;d<o.length;d++){m[k]=o[d];c[c.length]=o[d];if(this.GetCanBuy(m)){l[l.length]=o[d]}}}else{l=o}if(!!this.selectedValues[k]&&BX.util.in_array(this.selectedValues[k],l)){h[k]=this.selectedValues[k]}else{if(this.showAbsent){h[k]=(l.length>0?l[0]:c[0])}else{h[k]=l[0]}}this.UpdateRow(f,h[k],o,l)}this.selectedValues=h;this.ChangeInfo()}return true};b.JCCatalogSection.prototype.RowLeft=function(){var d=0,e="",c=-1,f=BX.proxy_context;if(!!f&&f.hasAttribute("data-treevalue")){e=f.getAttribute("data-treevalue");for(d=0;d<this.treeProps.length;d++){if(this.treeProps[d].ID===e){c=d;break}}if(-1<c&&this.treeRowShowSize<this.showCount[c]){if(0>this.showStart[c]){this.showStart[c]++;BX.adjust(this.obTreeRows[c].LIST,{style:{marginLeft:this.showStart[c]*20+"%"}});BX.adjust(this.obTreeRows[c].RIGHT,{style:this.treeEnableArrow})}if(0<=this.showStart[c]){BX.adjust(this.obTreeRows[c].LEFT,{style:this.treeDisableArrow})}}}};b.JCCatalogSection.prototype.RowRight=function(){var d=0,e="",c=-1,f=BX.proxy_context;if(!!f&&f.hasAttribute("data-treevalue")){e=f.getAttribute("data-treevalue");for(d=0;d<this.treeProps.length;d++){if(this.treeProps[d].ID===e){c=d;break}}if(-1<c&&this.treeRowShowSize<this.showCount[c]){if((this.treeRowShowSize-this.showStart[c])<this.showCount[c]){this.showStart[c]--;BX.adjust(this.obTreeRows[c].LIST,{style:{marginLeft:this.showStart[c]*20+"%"}});BX.adjust(this.obTreeRows[c].LEFT,{style:this.treeEnableArrow})}if((this.treeRowShowSize-this.showStart[c])>=this.showCount[c]){BX.adjust(this.obTreeRows[c].RIGHT,{style:this.treeDisableArrow})}}}};b.JCCatalogSection.prototype.UpdateRow=function(j,h,c,p){var r=0,s=0,o="",d=0,u="",f={},l=false,g=false,n=false,m=0,k=this.treeEnableArrow,t=this.treeEnableArrow,e=0,q=null;if(-1<j&&j<this.obTreeRows.length){q=BX.findChildren(this.obTreeRows[j].LIST,{tagName:"li"},false);if(!!q&&0<q.length){l=("PICT"===this.treeProps[j].SHOW_MODE);d=c.length;g=this.treeRowShowSize<d;u=(g?(100/d)+"%":"20%");f={props:{className:""},style:{width:u}};if(l){f.style.paddingTop=u}for(r=0;r<q.length;r++){o=q[r].getAttribute("data-onevalue");n=(o===h);if(BX.util.in_array(o,p)){f.props.className=(n?"bx_active":"")}else{f.props.className=(n?"bx_active bx_missing":"bx_missing")}f.style.display="none";if(BX.util.in_array(o,c)){f.style.display="";if(n){m=s}s++}BX.adjust(q[r],f)}f={style:{width:(g?20*d:100)+"%",marginLeft:"0%"}};if(l){BX.adjust(this.obTreeRows[j].CONT,{props:{className:(g?"bx_item_detail_scu full":"bx_item_detail_scu")}})}else{BX.adjust(this.obTreeRows[j].CONT,{props:{className:(g?"bx_item_detail_size full":"bx_item_detail_size")}})}if(g){if(m+1===d){t=this.treeDisableArrow}if(this.treeRowShowSize<=m){e=this.treeRowShowSize-m-1;f.style.marginLeft=e*20+"%"}if(0===e){k=this.treeDisableArrow}BX.adjust(this.obTreeRows[j].LEFT,{style:k});BX.adjust(this.obTreeRows[j].RIGHT,{style:t})}else{BX.adjust(this.obTreeRows[j].LEFT,{style:{display:"none"}});BX.adjust(this.obTreeRows[j].RIGHT,{style:{display:"none"}})}BX.adjust(this.obTreeRows[j].LIST,f);this.showCount[j]=d;this.showStart[j]=e}}};b.JCCatalogSection.prototype.GetRowValues=function(d,f){var g=0,e,c=[],h=false,k=true;if(0===d.length){for(g=0;g<this.offers.length;g++){if(!BX.util.in_array(this.offers[g].TREE[f],c)){c[c.length]=this.offers[g].TREE[f]}}h=true}else{for(g=0;g<this.offers.length;g++){k=true;for(e in d){if(d[e]!==this.offers[g].TREE[e]){k=false;break}}if(k){if(!BX.util.in_array(this.offers[g].TREE[f],c)){c[c.length]=this.offers[g].TREE[f]}h=true}}}return(h?c:false)};b.JCCatalogSection.prototype.GetCanBuy=function(c){var e=0,d,f=false,g=true;for(e=0;e<this.offers.length;e++){g=true;for(d in c){if(c[d]!==this.offers[e].TREE[d]){g=false;break}}if(g){if(this.offers[e].CAN_BUY){f=true;break}}}return f};b.JCCatalogSection.prototype.SetCurrent=function(){var h=0,g=0,c=[],k="",f=false,e={},d=[],l=this.offers[this.offerNum].TREE;for(h=0;h<this.treeProps.length;h++){k="PROP_"+this.treeProps[h].ID;f=this.GetRowValues(e,k);if(!f){break}if(BX.util.in_array(l[k],f)){e[k]=l[k]}else{e[k]=f[0];this.offerNum=0}if(this.showAbsent){c=[];d=[];d=BX.clone(e,true);for(g=0;g<f.length;g++){d[k]=f[g];if(this.GetCanBuy(d)){c[c.length]=f[g]}}}else{c=f}this.UpdateRow(h,e[k],f,c)}this.selectedValues=e;this.ChangeInfo()};b.JCCatalogSection.prototype.ChangeInfo=function(){var e=0,d,c=-1,f=true;for(e=0;e<this.offers.length;e++){f=true;for(d in this.selectedValues){if(this.selectedValues[d]!==this.offers[e].TREE[d]){f=false;break}}if(f){c=e;break}}if(-1<c){if(!!this.obPict){if(!!this.offers[c].PREVIEW_PICTURE){BX.adjust(this.obPict,{style:{backgroundImage:"url("+this.offers[c].PREVIEW_PICTURE.SRC+")"}})}else{BX.adjust(this.obPict,{style:{backgroundImage:"url("+this.defaultPict.pict.SRC+")"}})}}if(this.secondPict&&!!this.obSecondPict){if(!!this.offers[c].PREVIEW_PICTURE_SECOND){BX.adjust(this.obSecondPict,{style:{backgroundImage:"url("+this.offers[c].PREVIEW_PICTURE_SECOND.SRC+")"}})}else{if(!!this.offers[c].PREVIEW_PICTURE.SRC){BX.adjust(this.obSecondPict,{style:{backgroundImage:"url("+this.offers[c].PREVIEW_PICTURE.SRC+")"}})}else{if(!!this.defaultPict.secondPict){BX.adjust(this.obSecondPict,{style:{backgroundImage:"url("+this.defaultPict.secondPict.SRC+")"}})}else{BX.adjust(this.obSecondPict,{style:{backgroundImage:"url("+this.defaultPict.pict.SRC+")"}})}}}}if(this.showSkuProps&&!!this.obSkuProps){if(0===this.offers[c].DISPLAY_PROPERTIES.length){BX.adjust(this.obSkuProps,{style:{display:"none"},html:""})}else{BX.adjust(this.obSkuProps,{style:{display:""},html:this.offers[c].DISPLAY_PROPERTIES})}}this.setPrice(this.offers[c].PRICE);this.offerNum=c;this.QuantitySet(this.offerNum)}};b.JCCatalogSection.prototype.setPrice=function(c){var d,e;if(!!this.obPrice){d=BX.Currency.currencyFormat(c.DISCOUNT_VALUE,c.CURRENCY,true);if(this.showOldPrice&&(c.DISCOUNT_VALUE!==c.VALUE)){d+=" <span>"+BX.Currency.currencyFormat(c.VALUE,c.CURRENCY,true)+"</span>"}BX.adjust(this.obPrice,{html:d});if(this.showPercent){if(c.DISCOUNT_VALUE!==c.VALUE){e={style:{display:""},html:c.DISCOUNT_DIFF_PERCENT}}else{e={style:{display:"none"},html:""}}if(!!this.obDscPerc){BX.adjust(this.obDscPerc,e)}if(!!this.obSecondDscPerc){BX.adjust(this.obSecondDscPerc,e)}}}};b.JCCatalogSection.prototype.Compare=function(){var c,d;if(!!this.compareData.compareUrl){switch(this.productType){case 0:case 1:case 2:d=this.compareData.compareUrl.replace("#ID#",this.product.id.toString());break;case 3:d=this.compareData.compareUrl.replace("#ID#",this.offers[this.offerNum].ID);break}c={ajax_action:"Y"};BX.ajax.loadJSON(d,c,BX.proxy(this.CompareResult,this))}};b.JCCatalogSection.prototype.CompareResult=function(c){var e,f,d;if(!!this.obPopupWin){this.obPopupWin.close()}if(typeof c!=="object"){return false}this.InitPopupWindow();d={content:BX.create("div",{style:{marginRight:"30px",whiteSpace:"nowrap"},text:BX.message("COMPARE_TITLE")})};if(c.STATUS==="OK"){BX.onCustomEvent("OnCompareChange");e='<div style="width: 96%; margin: 10px 2%; text-align: center;"><p>'+BX.message("COMPARE_MESSAGE_OK")+"</p></div>";if(this.showClosePopup){f=[new a({ownerClass:this.obProduct.parentNode.parentNode.className,text:BX.message("BTN_MESSAGE_COMPARE_REDIRECT"),events:{click:BX.delegate(this.CompareRedirect,this)},style:{marginRight:"10px"}}),new a({ownerClass:this.obProduct.parentNode.parentNode.className,text:BX.message("BTN_MESSAGE_CLOSE_POPUP"),events:{click:BX.delegate(this.obPopupWin.close,this.obPopupWin)}})]}else{f=[new a({ownerClass:this.obProduct.parentNode.parentNode.className,text:BX.message("BTN_MESSAGE_COMPARE_REDIRECT"),events:{click:BX.delegate(this.CompareRedirect,this)}})]}}else{e='<div style="width: 96%; margin: 10px 2%; text-align: center;"><p>'+(!!c.MESSAGE?c.MESSAGE:BX.message("COMPARE_UNKNOWN_ERROR"))+"</p></div>";f=[new a({ownerClass:this.obProduct.parentNode.parentNode.className,text:BX.message("BTN_MESSAGE_CLOSE"),events:{click:BX.delegate(this.obPopupWin.close,this.obPopupWin)}})]}this.obPopupWin.setTitleBar(d);this.obPopupWin.setContent(e);this.obPopupWin.setButtons(f);this.obPopupWin.show();return false};b.JCCatalogSection.prototype.CompareRedirect=function(){if(!!this.compareData.comparePath){location.href=this.compareData.comparePath}else{this.obPopupWin.close()}};b.JCCatalogSection.prototype.InitBasketUrl=function(){this.basketUrl=(this.basketMode==="ADD"?this.basketData.add_url:this.basketData.buy_url);switch(this.productType){case 1:case 2:this.basketUrl=this.basketUrl.replace("#ID#",this.product.id.toString());break;case 3:this.basketUrl=this.basketUrl.replace("#ID#",this.offers[this.offerNum].ID);break}this.basketParams={ajax_basket:"Y"};if(this.showQuantity){this.basketParams[this.basketData.quantity]=this.obQuantity.value}if(!!this.basketData.sku_props){this.basketParams[this.basketData.sku_props_var]=this.basketData.sku_props}};b.JCCatalogSection.prototype.FillBasketProps=function(){if(!this.visual.BASKET_PROP_DIV){return}var c=0,f=null,e=false,d=null;if(this.basketData.useProps&&!this.basketData.emptyProps){if(!!this.obPopupWin&&!!this.obPopupWin.contentContainer){d=this.obPopupWin.contentContainer}}else{d=BX(this.visual.BASKET_PROP_DIV)}if(!!d){f=d.getElementsByTagName("select");if(!!f&&!!f.length){for(c=0;c<f.length;c++){if(!f[c].disabled){switch(f[c].type.toLowerCase()){case"select-one":this.basketParams[f[c].name]=f[c].value;e=true;break;default:break}}}}f=d.getElementsByTagName("input");if(!!f&&!!f.length){for(c=0;c<f.length;c++){if(!f[c].disabled){switch(f[c].type.toLowerCase()){case"hidden":this.basketParams[f[c].name]=f[c].value;e=true;break;case"radio":if(f[c].checked){this.basketParams[f[c].name]=f[c].value;e=true}break;default:break}}}}}if(!e){this.basketParams[this.basketData.props]=[];this.basketParams[this.basketData.props][0]=0}};b.JCCatalogSection.prototype.Add2Basket=function(){this.basketMode="ADD";this.Basket()};b.JCCatalogSection.prototype.BuyBasket=function(){this.basketMode="BUY";this.Basket()};b.JCCatalogSection.prototype.SendToBasket=function(){if(!this.canBuy){return}this.InitBasketUrl();this.FillBasketProps();BX.ajax.loadJSON(this.basketUrl,this.basketParams,BX.delegate(this.BasketResult,this))};b.JCCatalogSection.prototype.Basket=function(){var c="";if(!this.canBuy){return}switch(this.productType){case 1:case 2:if(this.basketData.useProps&&!this.basketData.emptyProps){this.InitPopupWindow();this.obPopupWin.setTitleBar({content:BX.create("div",{style:{marginRight:"30px",whiteSpace:"nowrap"},text:BX.message("TITLE_BASKET_PROPS")})});if(BX(this.visual.BASKET_PROP_DIV)){c=BX(this.visual.BASKET_PROP_DIV).innerHTML}this.obPopupWin.setContent(c);this.obPopupWin.setButtons([new a({ownerClass:this.obProduct.parentNode.parentNode.className,text:BX.message("BTN_MESSAGE_SEND_PROPS"),events:{click:BX.delegate(this.SendToBasket,this)}})]);this.obPopupWin.show()}else{this.SendToBasket()}break;case 3:this.SendToBasket();break}};b.JCCatalogSection.prototype.BasketResult=function(e){var d="",f="",g,c=[];if(!!this.obPopupWin){this.obPopupWin.close()}if("object"!==typeof e){return false}g=(e.STATUS==="OK");if(g&&this.basketAction==="BUY"){this.BasketRedirect()}else{this.InitPopupWindow();if(g){BX.onCustomEvent("OnBasketChange");switch(this.productType){case 1:case 2:f=this.product.pict.SRC;break;case 3:f=(!!this.offers[this.offerNum].PREVIEW_PICTURE?this.offers[this.offerNum].PREVIEW_PICTURE.SRC:this.defaultPict.pict.SRC);break}d='<div style="width: 96%; margin: 10px 2%; text-align: center;"><img src="'+f+'" height="130" style="max-height:130px"><p>'+this.product.name+"</p></div>";if(this.showClosePopup){c=[new a({ownerClass:this.obProduct.parentNode.parentNode.className,text:BX.message("BTN_MESSAGE_BASKET_REDIRECT"),events:{click:BX.delegate(this.BasketRedirect,this)},style:{marginRight:"10px"}}),new a({ownerClass:this.obProduct.parentNode.parentNode.className,text:BX.message("BTN_MESSAGE_CLOSE_POPUP"),events:{click:BX.delegate(this.obPopupWin.close,this.obPopupWin)}})]}else{c=[new a({ownerClass:this.obProduct.parentNode.parentNode.className,text:BX.message("BTN_MESSAGE_BASKET_REDIRECT"),events:{click:BX.delegate(this.BasketRedirect,this)}})]}}else{d='<div style="width: 96%; margin: 10px 2%; text-align: center;"><p>'+(!!e.MESSAGE?e.MESSAGE:BX.message("BASKET_UNKNOWN_ERROR"))+"</p></div>";c=[new a({ownerClass:this.obProduct.parentNode.parentNode.className,text:BX.message("BTN_MESSAGE_CLOSE"),events:{click:BX.delegate(this.obPopupWin.close,this.obPopupWin)}})]}this.obPopupWin.setTitleBar({content:BX.create("div",{style:{marginRight:"30px",whiteSpace:"nowrap"},text:(g?BX.message("TITLE_SUCCESSFUL"):BX.message("TITLE_ERROR"))})});this.obPopupWin.setContent(d);this.obPopupWin.setButtons(c);this.obPopupWin.show()}};b.JCCatalogSection.prototype.BasketRedirect=function(){location.href=(!!this.basketData.basketUrl?this.basketData.basketUrl:BX.message("BASKET_URL"))};b.JCCatalogSection.prototype.InitPopupWindow=function(){if(!!this.obPopupWin){return}this.obPopupWin=BX.PopupWindowManager.create("CatalogSectionBasket_"+this.visual.ID,null,{autoHide:false,offsetLeft:0,offsetTop:0,overlay:true,closeByEsc:true,titleBar:true,closeIcon:{top:"10px",right:"10px"}})}})(window);