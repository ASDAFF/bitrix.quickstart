BX.saleOrderAjax={BXCallAllowed:false,options:{},indexCache:{},controls:{},modes:{},properties:{},init:function(b){var a=this;this.options=b;window.submitFormProxy=BX.proxy(function(){a.submitFormProxy.apply(a,arguments)},this);BX(function(){a.initDeferredControl()});BX(function(){a.BXCallAllowed=true});this.controls.scope=BX("order_form_div");BX.bindDelegate(this.controls.scope,"click",{className:"-bx-popup-set-mode-add-loc"},function(){var c=BX.create("input",{attrs:{type:"hidden",name:"PERMANENT_MODE_STEPS",value:"1"}});BX.prepend(c,BX("ORDER_FORM"));a.BXCallAllowed=false;submitForm()})},cleanUp:function(){for(var a in this.properties){if(typeof this.properties[a].input!="undefined"){BX.unbindAll(this.properties[a].input);this.properties[a].input=null}if(typeof this.properties[a].control!="undefined"){BX.unbindAll(this.properties[a].control)}}this.properties={}},addPropertyDesc:function(a){this.properties[a.id]=a.attributes;this.properties[a.id].id=a.id},initDeferredControl:function(){var j=this;if(typeof window.BX.locationsDeferred!="undefined"){this.BXCallAllowed=false;for(var c in window.BX.locationsDeferred){window.BX.locationsDeferred[c].call(this);window.BX.locationsDeferred[c]=null;delete (window.BX.locationsDeferred[c]);this.properties[c].control=window.BX.locationSelectors[c];delete (window.BX.locationSelectors[c])}}for(var c in this.properties){if(this.properties[c].isZip){var l=this.controls.scope.querySelector('[data-property-id-row="'+c+'"]');if(BX.type.isElementNode(l)){var f=l.querySelector('input[type="text"]');if(BX.type.isElementNode(f)){this.properties[c].input=f;var g=false;for(var b in this.properties){if(this.properties[b].type=="LOCATION"){g=b;break}}if(g!==false){BX.bindDebouncedChange(f,function(k){f=null;l=null;if(/^\s*\d{6}\s*$/.test(k)){j.getLocationByZip(k,function(m){j.properties[g].control.setValueById(m)},function(){try{j.properties[g].control.clearSelected(locationId)}catch(m){}})}})}}}}if(this.checkAbility(c,"canHaveAltLocation")){var d=this.properties[c].control;d.setOption("pseudoValues",["other"]);d.bindEvent("before-control-item-discover-done",function(n,k){d=null;var m=k.getParentValue();if(m==this.getOption("rootNodeValue")||!this.checkCanSelectItem(m)){return}n.unshift({DISPLAY:j.options.messages.otherLocation,VALUE:"other",CODE:"other",IS_PARENT:false})});if(this.checkMode(c,"altLocationChoosen")){var i=this.getAltLocPropByRealLocProp(c);this.toggleProperty(i.id,true);var e=d.getAdapterAtPosition(d.getStackSize()-1);if(typeof e!="undefined"&&e!==null){e.setValuePair("other",j.options.messages.otherLocation)}}else{var i=this.getAltLocPropByRealLocProp(c);this.toggleProperty(i.id,false)}}else{var i=this.getAltLocPropByRealLocProp(c);if(i!==false){if(this.properties[c].type=="LOCATION"&&typeof this.properties[c].control!="undefined"&&this.properties[c].control.getSysCode()=="sls"){this.properties[c].control.replaceTemplate("nothing-found",this.options.messages.notFoundPrompt)}this.toggleProperty(i.id,false)}}if(typeof this.properties[c].control!="undefined"&&this.properties[c].control.getSysCode()=="slst"){var d=this.properties[c].control;var e=d.getAdapterAtPosition(d.getStackSize()-1);var a=this.getPreviousAdapterSelectedNode(d,e);if(a!==false&&a.TYPE_ID==j.options.cityTypeId){var h=e.getControl();if(h.getValue()==false){e.getControl().replaceMessage("notSelected",j.options.messages.moreInfoLocation);e.setValuePair("",j.options.messages.moreInfoLocation)}}}}this.BXCallAllowed=true},checkMode:function(c,d){if(d=="altLocationChoosen"){if(this.checkAbility(c,"canHaveAltLocation")){var a=this.getInputByPropId(this.properties[c].altLocationPropId);var b=this.properties[c].altLocationPropId;if(a!==false&&a.value.length>0&&!a.disabled&&this.properties[b].valueSource!="default"){return true}}}return false},checkAbility:function(a,c){if(typeof this.properties[a]=="undefined"){this.properties[a]={}}if(typeof this.properties[a].abilities=="undefined"){this.properties[a].abilities={}}if(typeof this.properties[a].abilities!="undefined"&&this.properties[a].abilities[c]){return true}if(c=="canHaveAltLocation"){if(this.properties[a].type=="LOCATION"){if(typeof this.properties[a].altLocationPropId!="undefined"&&typeof this.properties[this.properties[a].altLocationPropId]){var b=this.properties[a].altLocationPropId;if(typeof this.properties[a].control!="undefined"&&this.properties[a].control.getSysCode()=="slst"){if(this.getInputByPropId(b)!==false){this.properties[a].abilities[c]=true;return true}}}}}return false},getInputByPropId:function(b){if(typeof this.properties[b].input!="undefined"){return this.properties[b].input}var c=this.getRowByPropId(b);if(BX.type.isElementNode(c)){var a=c.querySelector('input[type="text"]');if(BX.type.isElementNode(a)){this.properties[b].input=a;return a}}return false},getRowByPropId:function(a){if(typeof this.properties[a].row!="undefined"){return this.properties[a].row}var b=this.controls.scope.querySelector('[data-property-id-row="'+a+'"]');if(BX.type.isElementNode(b)){this.properties[a].row=b;return b}return false},getAltLocPropByRealLocProp:function(a){if(typeof this.properties[a].altLocationPropId!="undefined"){return this.properties[this.properties[a].altLocationPropId]}return false},toggleProperty:function(b,a,c){var d=this.properties[b];if(typeof d.row=="undefined"){d.row=this.getRowByPropId(b)}if(typeof d.input=="undefined"){d.input=this.getInputByPropId(b)}if(!a){if(!c){BX.hide(d.row)}d.input.disabled=true}else{if(!c){BX.show(d.row)}d.input.disabled=false}},submitFormProxy:function(d,f){var c=false;for(var b in this.properties){if(typeof this.properties[b].control!="undefined"&&this.properties[b].control==f){c=b;break}}if(d!="other"){if(this.BXCallAllowed){if(c!=false){if(this.checkAbility(c,"canHaveAltLocation")){if(typeof this.modes[c]=="undefined"){this.modes[c]={}}this.modes[c]["altLocationChoosen"]=false;var g=this.getAltLocPropByRealLocProp(c);if(g!==false){this.toggleProperty(g.id,false)}}}this.BXCallAllowed=false;submitForm()}}else{if(this.checkAbility(c,"canHaveAltLocation")){var a=f.getAdapterAtPosition(f.getStackSize()-2);if(a!==null){var e=a.getValue();f.setTargetInputValue(e);if(typeof this.modes[c]=="undefined"){this.modes[c]={}}this.modes[c]["altLocationChoosen"]=true;var g=this.getAltLocPropByRealLocProp(c);if(g!==false){this.toggleProperty(g.id,true,true)}this.BXCallAllowed=false;submitForm()}}}},getPreviousAdapterSelectedNode:function(e,a){var b=a.getIndex();var f=e.getAdapterAtPosition(b-1);if(typeof f!=="undefined"&&f!=null){var d=f.getControl().getValue();if(typeof d!="undefined"){var c=e.getNodeByValue(d);if(typeof c!="undefined"){return c}return false}}return false},getLocationByZip:function(c,a,d){if(typeof this.indexCache[c]!="undefined"){a.apply(this,[this.indexCache[c]]);return}ShowWaitWindow();var b=this;BX.ajax({url:this.options.source,method:"post",dataType:"json",async:true,processData:true,emulateOnload:true,start:true,data:{ACT:"GET_LOC_BY_ZIP",ZIP:c},onsuccess:function(e){CloseWaitWindow();if(e.result){b.indexCache[c]=e.data.ID;a.apply(b,[e.data.ID])}else{d.call(b)}},onfailure:function(f,g){CloseWaitWindow()}})}};$(document).ready(function(){$(document).on("focus",'.f_text input[type="text"], .f_textarea input[type="text"], .f_text textarea, .f_textarea textarea',function(){$vl=$(this).parents(".vl");if($vl.find(".description").length>0){$vl.find(".description").fadeIn(150)}}).on("blur",'.f_text input[type="text"], .f_textarea input[type="text"], .f_text textarea, .f_textarea textarea',function(){$vl=$(this).parents(".vl");if($vl.find(".description").length>0){$vl.find(".description").fadeOut(150)}});if($(".line.f_location").find(".search-suggest").val()!=""&&parseInt($(".line.f_location").find('input[type="hidden"]').val())>0){if($(".section.paysystem").length<1||$(".section.delivery").length<1){submitForm()}}RSGoPro_InitMaskPhone()});