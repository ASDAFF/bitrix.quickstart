<? $GLOBALS['_269798253_']=Array('def' .'ine','define','' .'define','' .'de' .'fine','' .'defi' .'ne','fi' .'le_put_co' .'n' .'te' .'nts','' .'array_k' .'ey_e' .'xists','' .'is' .'_' .'arr' .'ay','array_merge','is_' .'array','p' .'reg_q' .'uote','pre' .'g_quo' .'t' .'e','preg_q' .'uote','a' .'r' .'r' .'ay_' .'key_exists','i' .'n_array','preg_ma' .'tch','ar' .'ray_key_e' .'xi' .'sts','intval','int' .'va' .'l','ar' .'ray_slice','arra' .'y_' .'s' .'lice','array_' .'shift','' .'arr' .'a' .'y' .'_sh' .'i' .'ft','is_' .'file','unlink','ar' .'ray_k' .'ey_exis' .'ts','in_ar' .'ray','in' .'_a' .'rra' .'y','array_s' .'lic' .'e','arra' .'y_sl' .'i' .'ce','i' .'n_ar' .'r' .'ay','count','c' .'oun' .'t'); ?><? function _2016952461($i){$a=Array("STARTSHOP_EXCHANGE_1C_CATALOG_IMPORT_ACTION_NOTHING","STARTSHOP_EXCHANGE_1C_CATALOG_IMPORT_ACTION_DEACTIVATE","STARTSHOP_EXCHANGE_1C_CATALOG_IMPORT_ACTION_DELETE","STARTSHOP_EXCHANGE_1C_CATALOG_TYPE_PRODUCTS","STARTSHOP_EXCHANGE_1C_CATALOG_TYPE_OFFERS","sort","asc","ID","IBLOCK_TYPE_ID","EXTERNAL_ID","NAME","SITE_ID","ACTIVE","Y","IBLOCK_TYPE_ID","EXTERNAL_ID","_offers","NAME"," (",'DOCUMENT_ROOT','/log.txt',"SITE_ID","ID","SITE_ID","ID","EXTERNAL_ID","EXTERNAL_ID","EXTERNAL_ID","EXTERNAL_ID","IBLOCK_TYPE_ID","IBLOCK_TYPE_ID","IBLOCK_TYPE_ID","IBLOCK_TYPE_ID","NAME","NAME","NAME","NAME","ID","IBLOCK_TYPE_ID","IBLOCK_TYPE_ID","IBLOCK_TYPE_ID","IBLOCK_TYPE_ID","NAME","NAME","NAME","NAME","ID","EXTERNAL_ID","EXTERNAL_ID","EXTERNAL_ID","EXTERNAL_ID","ID","ID","OFFERS_IBLOCK","ID","IBLOCK","ID","USE_QUANTITY","OFFERS_IBLOCK","ID","ID","ID","CATALOG","CATALOG_OFFERS","IBLOCK_ID","ID",'EXTERNAL_ID',"IBLOCK_ID","ID",'ID',"EXTERNAL_ID","EXTERNAL_ID","ID","ID","ACTIVE","N","ID","ID","IBLOCK_ID","ID",'ID',"IBLOCK_SECTION_ID","ID","NAME","NAME","ID","IBLOCK_ID","ID","EXTERNAL_ID","NAME","IBLOCK_SECTION_ID","ID","IBLOCK_ID","ID",'EXTERNAL_ID',"IBLOCK_ID","ID","XML_ID","PROPERTY_TYPE","S","USER_TYPE","PROPERTY_TYPE","N","USER_TYPE","PROPERTY_TYPE","S","USER_TYPE","DateTime","PROPERTY_TYPE","L","USER_TYPE",'NAME','NAME',"ID","ID","IBLOCK_ID","ID","XML_ID","NAME",'^','$',"IBLOCK_ID","ID","CODE","ID","PROPERTY_TYPE","F","USER_TYPE","MULTIPLE","Y","IBLOCK_ID","ID","CODE","PROPERTY_TYPE","F","USER_TYPE","MULTIPLE","Y","ACTIVE","Y","NAME",'^','$',"IBLOCK_ID","ID","CODE","ID","PROPERTY_TYPE","S","USER_TYPE","MULTIPLE","N","IBLOCK_ID","ID","CODE","PROPERTY_TYPE","S","USER_TYPE","MULTIPLE","N","ACTIVE","Y","NAME",'^','$',"IBLOCK_ID","ID","CODE","ID","PROPERTY_TYPE","S","USER_TYPE","MULTIPLE","Y","WITH_DESCRIPTION","Y","IBLOCK_ID","ID","CODE","PROPERTY_TYPE","S","USER_TYPE","MULTIPLE","Y","ACTIVE","Y","NAME","IBLOCK_ID","ID","ID","XML_ID","XML_ID",'ID','CODE','/','/','CODE',"ID","ID","ACTIVE","N","IBLOCK_ID","ID","ID","ID","VALUE","PROPERTY_ID","ID","EXTERNAL_ID","PROPERTY_ID","ID","VALUE","PROPERTY_ID","ID","ID","EXTERNAL_ID","EXTERNAL_ID",'ID',"IBLOCK_ID","ID",'EXTERNAL_ID','IBLOCK_ID','ID','XML_ID','IBLOCK_ID','ID','ID','ID','PROPERTY_ID','EXTERNAL_ID','VALUES','EXTERNAL_ID',"IBLOCK_ID","ID","EXTERNAL_ID",'NAME',"NAME","DETAIL_TEXT","DETAIL_TEXT","","IBLOCK_SECTION","IBLOCK_SECTION","ID","IBLOCK_SECTION","DETAIL_PICTURE","/","DETAIL_PICTURE","del","Y","VALUE","/","VALUE","del","Y","DETAIL_PICTURE","del","Y","VALUE","del","Y","VALUE","DESCRIPTION",'PROPERTY_TYPE','L',"ID","ID","VALUES","ID",'ID','ID','IBLOCK_ID',"ID","IBLOCK_ID","ID","EXTERNAL_ID","NAME","PROPERTY_VALUES","DETAIL_TEXT","IBLOCK_SECTION","IBLOCK_SECTION","ID","PROPERTY_VALUES","DETAIL_PICTURE","/","VALUE","/","PROPERTY_VALUES","VALUE","DESCRIPTION","PROPERTY_TYPE","L","PROPERTY_VALUES","ID","PROPERTY_VALUES","ID","VALUES","ID","/","/","IBLOCK_ID","ID","ID","EXTERNAL_ID","EXTERNAL_ID","ID","ID","ACTIVE","N","IBLOCK_ID","ID","ID","CODE",'ID',"LANG","NAME","CODE","LANG","NAME","ID","CODE","CODE","RATE","RATING","ID",'OFFERS_IBLOCK','OFFERS_IBLOCK',"IBLOCK_ID",'ID',"XML_ID","NAME","CODE","ru","change_case","U","max_len","48","VALUES","VALUES","NAME","CODE","ru","change_case","U","max_len","48",'CODE','CODE',"NAME","NAME","PROPERTY_TYPE","L","USER_TYPE","VALUES","VALUE","NAME","XML_ID","CODE","ID","ID","ID","IBLOCK_ID",'ID',"NAME","NAME","CODE","CODE","XML_ID","CODE","PROPERTY_TYPE","L","USER_TYPE","VALUES","VALUE","NAME","XML_ID","CODE",'ID',"OFFERS_PROPERTIES",'ID',"IBLOCK_ID","ID","EXTERNAL_ID",'OFFERS_IBLOCK',"IBLOCK_ID","ID","EXTERNAL_ID","IBLOCK_ID",'ID',"XML_ID",'IBLOCK_ID','ID','ID','ID','PROPERTY_ID','XML_ID','VALUES','XML_ID','ID','ID','ID',"ID",'ID',"NAME","NAME","ID","IBLOCK_ID",'ID',"EXTERNAL_ID","NAME","ru","change_case","U","max_len","48","ru","change_case","U","max_len","48","ID","VALUES","ID","ID",'ID','ID',"IBLOCK_ID","ID","ID","EXTERNAL_ID","EXTERNAL_ID","ID","ID","ACTIVE","N","/КоммерческаяИнформация/Каталог/Товары","/КоммерческаяИнформация/ПакетПредложений/Предложения","/КоммерческаяИнформация/ПакетПредложений","/КоммерческаяИнформация/Каталог","СодержитТолькоИзменения","true","/КоммерческаяИнформация/ПакетПредложений","СодержитТолькоИзменения","true");return $a[$i];} ?><? IncludeModuleLangFile(__FILE__);$GLOBALS['_269798253_'][0](_2016952461(0),round(0));$GLOBALS['_269798253_'][1](_2016952461(1),round(0+0.25+0.25+0.25+0.25));$GLOBALS['_269798253_'][2](_2016952461(2),round(0+0.5+0.5+0.5+0.5));$GLOBALS['_269798253_'][3](_2016952461(3),round(0));$GLOBALS['_269798253_'][4](_2016952461(4),round(0+0.33333333333333+0.33333333333333+0.33333333333333));class CStartShopExchange1CCatalog{public static function ImportIBlocks(&$_0,$_1,$_2=true){$_3=CStartShopExchange1CCatalogIBlock::GetByXml($_0);$_4=CStartShopExchange1CCatalog::IsOnlyChanges($_0);if($_3 != null &&!empty($_1)){$_5=CStartShopUtil::DBResultToArray(CSite::GetList($_6=_2016952461(5),$_7=_2016952461(6)),_2016952461(7));$_8=array(_2016952461(8)=> $_1,_2016952461(9)=> $_3->Id,_2016952461(10)=> $_3->Name,_2016952461(11)=> array(),_2016952461(12)=> _2016952461(13));$_9=array(_2016952461(14)=> $_1,_2016952461(15)=> $_3->Id ._2016952461(16),_2016952461(17)=> $_3->Name ._2016952461(18) .GetMessage("IBLOCK_OFFERS_PREFIX") .")","SITE_ID"=> array(),"ACTIVE"=> "Y");$GLOBALS['_269798253_'][5]($_SERVER[_2016952461(19)] ._2016952461(20),GetMessage("IBLOCK_OFFERS_PREFIX"));foreach($_5 as $_10){$_8[_2016952461(21)][]=$_10[_2016952461(22)];$_9[_2016952461(23)][]=$_10[_2016952461(24)];}$_11=CIBlock::GetList(array(),array(_2016952461(25)=> $_8[_2016952461(26)]))->Fetch();$_12=CIBlock::GetList(array(),array(_2016952461(27)=> $_9[_2016952461(28)]))->Fetch();$_13=new CIBlock();if(empty($_11)){$_13->Add($_8);}else{$_14=array();if($_8[_2016952461(29)]!= $_11[_2016952461(30)])$_14[_2016952461(31)]=$_8[_2016952461(32)];if($_2 && $_8[_2016952461(33)]!= $_11[_2016952461(34)])$_14[_2016952461(35)]=$_8[_2016952461(36)];if(!empty($_14))$_13->Update($_11[_2016952461(37)],$_14);unset($_14);}if(empty($_12)){$_13->Add($_9);}else{$_15=array();if($_9[_2016952461(38)]!= $_12[_2016952461(39)])$_15[_2016952461(40)]=$_9[_2016952461(41)];if($_2 && $_9[_2016952461(42)]!= $_12[_2016952461(43)])$_15[_2016952461(44)]=$_9[_2016952461(45)];if(!empty($_15))$_13->Update($_11[_2016952461(46)],$_15);unset($_15);}$_11=CIBlock::GetList(array(),array(_2016952461(47)=> $_8[_2016952461(48)]))->Fetch();$_12=CIBlock::GetList(array(),array(_2016952461(49)=> $_9[_2016952461(50)]))->Fetch();unset($_8,$_9);if(empty($_11)|| empty($_12))return null;if(CStartShopCatalog::GetByIBlock($_11[_2016952461(51)])->Fetch()){CStartShopCatalog::Update($_11[_2016952461(52)],array(_2016952461(53)=> $_12[_2016952461(54)]));}else{CStartShopCatalog::Add(array(_2016952461(55)=> $_11[_2016952461(56)],_2016952461(57)=> round(0+1),_2016952461(58)=> $_12[_2016952461(59)]));}$_16=CStartShopCatalog::GetByIBlock($_11[_2016952461(60)])->Fetch();if(empty($_16))return null;CStartShopToolsIBlock::CheckOffersLink($_11[_2016952461(61)],true);return array(_2016952461(62)=> $_11,_2016952461(63)=> $_12);}return null;}public static function ImportSections(&$_0,&$_11,$_17=STARTSHOP_EXCHANGE_1C_CATALOG_IMPORT_ACTION_NOTHING,$_2=true){if($_0 instanceof CDataXML &&!empty($_11)){$_4=CStartShopExchange1CCatalog::IsOnlyChanges($_0);$_18=CStartShopExchange1CCatalogSection::GetListByXml($_0);$_19=array();$_20=CStartShopUtil::DBResultToArray(CIBlockSection::GetList(array(),array(_2016952461(64)=> $_11[_2016952461(65)])),_2016952461(66));if($_18 != null)$_19=static::ImportXmlSections($_11,$_20,$_18,null,$_2);if($_4)$_17=STARTSHOP_EXCHANGE_1C_CATALOG_IMPORT_ACTION_NOTHING;if($_17 != STARTSHOP_EXCHANGE_1C_CATALOG_IMPORT_ACTION_NOTHING){$_20=CStartShopUtil::DBResultToArray(CIBlockSection::GetList(array(),array(_2016952461(67)=> $_11[_2016952461(68)])),_2016952461(69));$_21=new CIBlockSection();foreach($_20 as $_22){if(!empty($_22[_2016952461(70)]))if($GLOBALS['_269798253_'][6]($_22[_2016952461(71)],$_19))continue;if($_17 == STARTSHOP_EXCHANGE_1C_CATALOG_IMPORT_ACTION_DELETE){$_21->Delete($_22[_2016952461(72)]);}else{$_21->Update($_22[_2016952461(73)],array(_2016952461(74)=> _2016952461(75)));}}unset($_21);}$_21=new CIBlockSection();$_21->ReSort($_11[_2016952461(76)]);$_21->TreeReSort($_11[_2016952461(77)]);unset($_21);return CStartShopUtil::DBResultToArray(CIBlockSection::GetList(array(),array(_2016952461(78)=> $_11[_2016952461(79)])),_2016952461(80));}return null;}public static function ImportXmlSections(&$_11,&$_20,&$_18,$_23=null,$_2=true){$_19=array();if($GLOBALS['_269798253_'][7]($_18))foreach($_18 as $_24)if($_24 instanceof CStartShopExchange1CCatalogSection){$_22=$_20[$_24->Id];$_25=array();if($_23 instanceof CStartShopExchange1CCatalogSection){$_25=$_20[$_23->Id];}$_21=new CIBlockSection();if(!empty($_22)){$_26=array();if(!empty($_25))$_26[_2016952461(81)]=$_25[_2016952461(82)];if($_24->Name != $_22[_2016952461(83)]&& $_2)$_26[_2016952461(84)]=$_24->Name;if(empty($_22['CODE']))$_26['CODE']=CUtil::translit($_24->Name, 'ru', array());if(!empty($_26))$_21->Update($_22[_2016952461(85)],$_26);unset($_26);}else{$_26=array(_2016952461(86)=> $_11[_2016952461(87)],_2016952461(88)=> $_24->Id,_2016952461(89)=> $_24->Name, "CODE"=>CUtil::translit($_24->Name, 'ru', array()));if(!empty($_25))$_26[_2016952461(90)]=$_25[_2016952461(91)];$_21->Add($_26,false,false);unset($_26);}$_19[$_24->Id]=$_24;unset($_21,$_22);if($_24->Groups != null){$_20=CStartShopUtil::DBResultToArray(CIBlockSection::GetList(array(),array(_2016952461(92)=> $_11[_2016952461(93)])),_2016952461(94));$_19=$GLOBALS['_269798253_'][8]($_19,static::ImportXmlSections($_11,$_20,$_24->Groups,$_24,$_2));}}return $_19;}public static function ImportProperties(&$_0,&$_11,$_27=STARTSHOP_EXCHANGE_1C_CATALOG_IMPORT_ACTION_NOTHING,$_2=true,$_28=array(),$_29=null,$_30=null,$_31=null){if($_0 instanceof CDataXML &&!empty($_11)){$_4=CStartShopExchange1CCatalog::IsOnlyChanges($_0);$_32=CStartShopExchange1CCatalogProperty::GetListByXml($_0);$_33=array();$_34=CStartShopUtil::DBResultToArray(CIBlockProperty::GetList(array(),array(_2016952461(95)=> $_11[_2016952461(96)])),_2016952461(97));if($_32 != null)foreach($_32 as $_35)if($_35 instanceof CStartShopExchange1CCatalogProperty){$_36=new CIBlockProperty();$_37=$_34[$_35->Id];$_38=array();if($_35->Type == STARTSHOP_EXCHANGE_1C_CATALOG_PROPERTY_TYPE_STRING){$_38=array(_2016952461(98)=> _2016952461(99),_2016952461(100)=> false);}else if($_35->Type == STARTSHOP_EXCHANGE_1C_CATALOG_PROPERTY_TYPE_NUMBER){$_38=array(_2016952461(101)=> _2016952461(102),_2016952461(103)=> false);}else if($_35->Type == STARTSHOP_EXCHANGE_1C_CATALOG_PROPERTY_TYPE_DATETIME){$_38=array(_2016952461(104)=> _2016952461(105),_2016952461(106)=> _2016952461(107));}else if($_35->Type == STARTSHOP_EXCHANGE_1C_CATALOG_PROPERTY_TYPE_LIST){$_38=array(_2016952461(108)=> _2016952461(109),_2016952461(110)=> false);}if(!empty($_37)){if($_37[_2016952461(111)]!= $_35->Name && $_2)$_38[_2016952461(112)]=$_35->Name;$_36->Update($_37[_2016952461(113)],$_38);$_37=CIBlockProperty::GetByID($_37[_2016952461(114)])->Fetch();}else{$_38[_2016952461(115)]=$_11[_2016952461(116)];$_38[_2016952461(117)]=$_35->Id;$_38[_2016952461(118)]=$_35->Name;$_39=$_36->Add($_38);$_37=CIBlockProperty::GetByID($_39)->Fetch();unset($_39);}if(empty($_37))continue;static::ImportPropertyValues($_37,$_35,$_4);$_33[$_35->Id]=$_35;}$_36=new CIBlockProperty();if(!$GLOBALS['_269798253_'][9]($_28))$_28=array();if(!empty($_30)){$_28[]=_2016952461(119) .$GLOBALS['_269798253_'][10]($_30) ._2016952461(120);$_40=CIBlockProperty::GetList(array(),array(_2016952461(121)=> $_11[_2016952461(122)],_2016952461(123)=> $_30))->Fetch();if(!empty($_40)){$_36->Update($_40[_2016952461(124)],array(_2016952461(125)=> _2016952461(126),_2016952461(127)=> false,_2016952461(128)=> _2016952461(129)));}else{$_36->Add(array(_2016952461(130)=> $_11[_2016952461(131)],_2016952461(132)=> $_30,_2016952461(133)=> _2016952461(134),_2016952461(135)=> false,_2016952461(136)=> _2016952461(137),_2016952461(138)=> _2016952461(139),_2016952461(140)=> GetMessage("IBLOCK_PROPERTY_PICTURES")));}unset($_40);}if(!empty($_29)){$_28[]=_2016952461(141) .$GLOBALS['_269798253_'][11]($_29) ._2016952461(142);$_41=CIBlockProperty::GetList(array(),array(_2016952461(143)=> $_11[_2016952461(144)],_2016952461(145)=> $_29))->Fetch();if(!empty($_41)){$_36->Update($_41[_2016952461(146)],array(_2016952461(147)=> _2016952461(148),_2016952461(149)=> false,_2016952461(150)=> _2016952461(151)));}else{$_36->Add(array(_2016952461(152)=> $_11[_2016952461(153)],_2016952461(154)=> $_29,_2016952461(155)=> _2016952461(156),_2016952461(157)=> false,_2016952461(158)=> _2016952461(159),_2016952461(160)=> _2016952461(161),_2016952461(162)=> GetMessage("IBLOCK_PROPERTY_ARTICLE")));}unset($_41);}if(!empty($_31)){$_28[]=_2016952461(163) .$GLOBALS['_269798253_'][12]($_31) ._2016952461(164);$_42=CIBlockProperty::GetList(array(),array(_2016952461(165)=> $_11[_2016952461(166)],_2016952461(167)=> $_31))->Fetch();if(!empty($_42)){$_36->Update($_42[_2016952461(168)],array(_2016952461(169)=> _2016952461(170),_2016952461(171)=> false,_2016952461(172)=> _2016952461(173),_2016952461(174)=> _2016952461(175)));}else{$_36->Add(array(_2016952461(176)=> $_11[_2016952461(177)],_2016952461(178)=> $_31,_2016952461(179)=> _2016952461(180),_2016952461(181)=> false,_2016952461(182)=> _2016952461(183),_2016952461(184)=> _2016952461(185),_2016952461(186)=> GetMessage("IBLOCK_PROPERTY_TRAITS"),"WITH_DESCRIPTION"=> "Y"));}unset($_42);}if($_4)$_27=STARTSHOP_EXCHANGE_1C_CATALOG_IMPORT_ACTION_NOTHING;if($_27 != STARTSHOP_EXCHANGE_1C_CATALOG_IMPORT_ACTION_NOTHING){$_34=CStartShopUtil::DBResultToArray(CIBlockProperty::GetList(array(),array(_2016952461(187)=> $_11[_2016952461(188)])),_2016952461(189));foreach($_34 as $_37){if(!empty($_37[_2016952461(190)]))if($GLOBALS['_269798253_'][13]($_37[_2016952461(191)],$_33))continue;if($GLOBALS['_269798253_'][14]($_37[_2016952461(192)],$_28))continue;if(!empty($_37[_2016952461(193)])){$_43=false;foreach($_28 as $_44){if($GLOBALS['_269798253_'][15](_2016952461(194) .$_44 ._2016952461(195),$_37[_2016952461(196)])){$_43=true;break;}}if($_43)continue;unset($_43);}if($_27 == STARTSHOP_EXCHANGE_1C_CATALOG_IMPORT_ACTION_DELETE){$_36->Delete($_37[_2016952461(197)]);}else{$_36->Update($_37[_2016952461(198)],array(_2016952461(199)=> _2016952461(200)));}}}unset($_36);return CStartShopUtil::DBResultToArray(CIBlockProperty::GetList(array(),array(_2016952461(201)=> $_11[_2016952461(202)])),_2016952461(203));}return null;}public static function ImportPropertyValues(&$_37,&$_35,$_4=false){if($_35->Type == STARTSHOP_EXCHANGE_1C_CATALOG_PROPERTY_TYPE_LIST){$_45=CStartShopUtil::DBResultToArray(CIBlockPropertyEnum::GetList(array(),array("PROPERTY_ID"=> $_37["ID"])),"EXTERNAL_ID");$_46=array();$_47=new CIBlockPropertyEnum();if(!empty($_35->Values))foreach($_35->Values as $_48){$_49=$_45[$_48->Id];if(!empty($_49)){$_47->Update($_49[_2016952461(204)],array(_2016952461(205)=> $_48->Value,_2016952461(206)=> $_37[_2016952461(207)],));}else{$_47->Add(array(_2016952461(208)=> $_48->Id,_2016952461(209)=> $_37[_2016952461(210)],_2016952461(211)=> $_48->Value));}$_46[$_48->Id]=$_48;unset($_49);}unset($_50);if(!$_4){$_45=CStartShopUtil::DBResultToArray(CIBlockPropertyEnum::GetList(array(),array(_2016952461(212)=> $_37[_2016952461(213)])),_2016952461(214));foreach($_45 as $_49){if(!empty($_49[_2016952461(215)]))if($GLOBALS['_269798253_'][16]($_49[_2016952461(216)],$_46))continue;$_47->Delete($_49[_2016952461(217)]);}}unset($_46,$_45,$_49,$_47);}}public static function ImportItems(&$_0,&$_11,$_51,$_2,$_52,$_53,$_54,$_29=null,$_30=null,$_31=null){$_52=$GLOBALS['_269798253_'][17]($_52);$_53=$GLOBALS['_269798253_'][18]($_53);if($_0 instanceof CDataXML &&!empty($_11)){$_55=null;$_56=CStartShopExchange1CCatalogItem::GetListByXml($_0);$_32=CStartShopExchange1CCatalogProperty::GetListByXml($_0);$_4=CStartShopExchange1CCatalog::IsOnlyChanges($_0);if($_56 != null)if($_52>round(0)&& $_53 == round(0)){$_55=$GLOBALS['_269798253_'][19]($_56,$_52);}else if($_53>round(0)){$_55=$GLOBALS['_269798253_'][20]($_56,$_52,$_53);}if(!empty($_55)){$_20=CStartShopUtil::DBResultToArray(CIBlockSection::GetList(array(),array(_2016952461(218)=> $_11[_2016952461(219)])),_2016952461(220));$_34=CStartShopUtil::DBResultToArray(CIBlockProperty::GetList(array(),array(_2016952461(221)=> $_11[_2016952461(222)])),_2016952461(223));$_57=CStartShopUtil::DBResultToArray(CIBlockPropertyEnum::GetList(array(),array(_2016952461(224)=> $_11[_2016952461(225)])),_2016952461(226));$_58=array();foreach($_34 as $_59 => $_37)$_58[$_37[_2016952461(227)]]=$_59;foreach($_57 as $_60 => $_61){$_62=$_58[$_61[_2016952461(228)]];if(!empty($_62)&&!empty($_61[_2016952461(229)]))$_34[$_62][_2016952461(230)][$_61[_2016952461(231)]]=$_61;}unset($_58,$_57,$_61,$_59,$_60,$_62);$_63=CStartShopUtil::DBResultToArray(CIBlockElement::GetList(array(),array(_2016952461(232)=> $_11[_2016952461(233)])),_2016952461(234));foreach($_55 as $_64){$_65=new CIBlockElement();$_66=$_63[$_64->Id];if(!empty($_66)){$_67=array();$_68=array();if($_2 && $_66[_2016952461(235)]!= $_64->Name)$_67[_2016952461(236)]=$_64->Name;if(empty($_66['CODE']))$_67['CODE']=CUtil::translit($_64->Name, 'ru', array());if(!empty($_64->Description)){$_67[_2016952461(237)]=$_64->Description;}else{$_67[_2016952461(238)]=_2016952461(239);}if(!empty($_64->Groups)){$_67[_2016952461(240)]=array();foreach($_64->Groups as $_69)$_67[_2016952461(241)][]=$_20[$_69][_2016952461(242)];}else{$_67[_2016952461(243)]=false;}if($_64->Pictures != null){$_70=$_64->Pictures;$_71=$GLOBALS['_269798253_'][21]($_70);if(!empty($_71)){$_67[_2016952461(244)]=CFile::MakeFileArray($_54 ._2016952461(245) .$_71);}else{$_67[_2016952461(246)]=array(_2016952461(247)=> _2016952461(248));}unset($_71);if(!empty($_30))if(!empty($_70)){$_72=array();foreach($_70 as $_71)$_72[]=array(_2016952461(249)=> CFile::MakeFileArray($_54 ._2016952461(250) .$_71));$_68[$_30]=$_72;unset($_72);}else{$_68[$_30]=array(_2016952461(251)=> array(_2016952461(252)=> _2016952461(253)));}}else{$_67[_2016952461(254)]=array(_2016952461(255)=> _2016952461(256));if(!empty($_30))$_68[$_30]=array(_2016952461(257)=> array(_2016952461(258)=> _2016952461(259)));}if(!empty($_29))if(!empty($_64->Article)){$_68[$_29]=$_64->Article;}else{$_68[$_29]=false;}if(!empty($_31))if(!empty($_64->Traits)){$_68[$_31]=array();foreach($_64->Traits as $_73)if($_73 instanceof CStartShopExchange1CCatalogItemTrait)$_68[$_31][]=array(_2016952461(260)=> $_73->Value,_2016952461(261)=> $_73->Name);}else{$_68[$_31]=false;}if(!empty($_32))foreach($_32 as $_35){$_74=$_64->Properties[$_35->Id];$_37=$_34[$_35->Id];if(!empty($_74)&&!empty($_37)){if($_37[_2016952461(262)]!= _2016952461(263)){$_68[$_37[_2016952461(264)]]=$_74->Value;}else{$_68[$_37[_2016952461(265)]]=$_37[_2016952461(266)][$_74->Value][_2016952461(267)];}}else{$_68[$_37[_2016952461(268)]]=false;}unset($_74,$_37);}if(!empty($_68))CIBlockElement::SetPropertyValuesEx($_66[_2016952461(269)],$_66[_2016952461(270)],$_68);if(!empty($_67))$_65->Update($_66[_2016952461(271)],$_67);}else{$_67=array(_2016952461(272)=> $_11[_2016952461(273)],_2016952461(274)=> $_64->Id,_2016952461(275)=> $_64->Name,"CODE"=>CUtil::translit($_64->Name, 'ru', array()),_2016952461(276)=> array(),);if(!empty($_64->Description))$_67[_2016952461(277)]=$_64->Description;if(!empty($_64->Groups)){$_67[_2016952461(278)]=array();foreach($_64->Groups as $_69)$_67[_2016952461(279)][]=$_20[$_69][_2016952461(280)];}if(!empty($_64->Article)&&!empty($_29))$_67[_2016952461(281)][$_29]=$_64->Article;if($_64->Pictures != null){$_70=$_64->Pictures;$_71=$GLOBALS['_269798253_'][22]($_70);if(!empty($_71))$_67[_2016952461(282)]=CFile::MakeFileArray($_54 ._2016952461(283) .$_71);unset($_71);if(!empty($_70)&&!empty($_30)){$_72=array();foreach($_70 as $_71)$_72[]=array(_2016952461(284)=> CFile::MakeFileArray($_54 ._2016952461(285) .$_71));$_67[_2016952461(286)][$_30]=$_72;unset($_72);}unset($_70);}if(!empty($_31))if(!empty($_64->Traits)){$_68[$_31]=array();foreach($_64->Traits as $_73)if($_73 instanceof CStartShopExchange1CCatalogItemTrait)$_68[$_31][]=array(_2016952461(287)=> $_73->Value,_2016952461(288)=> $_73->Name);}if(!empty($_64->Properties)){foreach($_64->Properties as $_74){$_37=$_34[$_74->Id];if($_37[_2016952461(289)]!= _2016952461(290)){$_67[_2016952461(291)][$_37[_2016952461(292)]]=$_74->Value;}else{$_67[_2016952461(293)][$_37[_2016952461(294)]]=$_37[_2016952461(295)][$_74->Value][_2016952461(296)];}}}$_65->Add($_67);}if($_64->Pictures != null)foreach($_64->Pictures as $_71)if($GLOBALS['_269798253_'][23]($_54 ._2016952461(297) .$_71))$GLOBALS['_269798253_'][24]($_54 ._2016952461(298) .$_71);}}$_65=new CIBlockElement();if($_4)$_51=STARTSHOP_EXCHANGE_1C_CATALOG_IMPORT_ACTION_NOTHING;if($_51 != STARTSHOP_EXCHANGE_1C_CATALOG_IMPORT_ACTION_NOTHING){$_63=CStartShopUtil::DBResultToArray(CIBlockElement::GetList(array(),array(_2016952461(299)=> $_11[_2016952461(300)])),_2016952461(301));foreach($_63 as $_66){if(!empty($_66[_2016952461(302)]))if($GLOBALS['_269798253_'][25]($_66[_2016952461(303)],$_56))continue;if($_51 == STARTSHOP_EXCHANGE_1C_CATALOG_IMPORT_ACTION_DELETE){$_65->Delete($_66[_2016952461(304)]);}else{$_65->Update($_66[_2016952461(305)],array(_2016952461(306)=> _2016952461(307)));}}}unset($_65);return CStartShopUtil::DBResultToArray(CIBlockElement::GetList(array(),array(_2016952461(308)=> $_11[_2016952461(309)])),_2016952461(310));}return null;}public static function ImportPricesTypes(&$_0){$_75=CStartShopExchange1CCatalogOfferPriceType::GetListByXml($_0);$_4=CStartShopExchange1CCatalog::IsOnlyChanges($_0);if(!empty($_75)){$_76=CStartShopUtil::DBResultToArray(CStartShopPrice::GetList(),_2016952461(311));foreach($_75 as $_77)if($_77 instanceof CStartShopExchange1CCatalogOfferPriceType){$_78=$_76[$_77->Id];if(!empty($_78)){CStartShopPrice::Update($_78[_2016952461(312)],array(_2016952461(313)=> array(LANGUAGE_ID => array(_2016952461(314)=> $_77->Name))));}else{CStartShopPrice::Add(array(_2016952461(315)=> $_77->Id,_2016952461(316)=> array(LANGUAGE_ID => array(_2016952461(317)=> $_77->Name))));}}return CStartShopUtil::DBResultToArray(CStartShopPrice::GetList(),_2016952461(318));}return null;}public static function ImportCurrencies(&$_0){$_79=CStartShopExchange1CCatalogOffer::GetListByXml($_0);$_4=CStartShopExchange1CCatalog::IsOnlyChanges($_0);if(!empty($_79)){$_80=CStartShopUtil::DBResultToArray(CStartShopCurrency::GetList(),_2016952461(319));$_81=array();foreach($_79 as $_82)if($_82 instanceof CStartShopExchange1CCatalogOffer)if($_82->Prices != null)foreach($_82->Prices as $_83)if($_83 instanceof CStartShopExchange1CCatalogOfferPrice)if(!$GLOBALS['_269798253_'][26]($_83->Currency,$_81))$_81[]=$_83->Currency;if(!empty($_81))foreach($_81 as $_84)if(empty($_80[$_84]))CStartShopCurrency::Add(array(_2016952461(320)=> $_84,_2016952461(321)=> round(0+0.2+0.2+0.2+0.2+0.2),_2016952461(322)=> round(0+0.5+0.5)));return CStartShopUtil::DBResultToArray(CStartShopCurrency::GetList(),_2016952461(323));}return null;}public static function ImportOffersProperties(&$_0,&$_11){$_16=CStartShopCatalog::GetByIBlock($_11['ID'])->Fetch();$_79=CStartShopExchange1CCatalogOffer::GetListByXml($_0);$_4=CStartShopExchange1CCatalog::IsOnlyChanges($_0);if(!empty($_79)&&!empty($_16)&&!empty($_16[_2016952461(324)])){$_12=CIBlock::GetByID($_16[_2016952461(325)])->Fetch();if(!empty($_12)){$_85=CStartShopUtil::DBResultToArray(CIBlockProperty::GetList(array(),array(_2016952461(326)=> $_12[_2016952461(327)])),_2016952461(328));$_86=array();$_32=array();foreach($_79 as $_82)if($_82 instanceof CStartShopExchange1CCatalogOffer)if($_82->IsOffer())if($_82->Characteristics != null)foreach($_82->Characteristics as $_87)if($_87 instanceof CStartShopExchange1CCatalogOfferCharacteristic){if(isset($_32[$_87->Name])){if(!$GLOBALS['_269798253_'][27]($_87->Value,$_32[$_87->Name]))$_32[$_87->Name][]=$_87->Value;}else{$_32[$_87->Name]=array($_87->Value);}}foreach($_32 as $_88 => $_89){$_90=array(_2016952461(329)=> $_88,_2016952461(330)=> CUtil::translit($_88,_2016952461(331),array(_2016952461(332)=> _2016952461(333),_2016952461(334)=> _2016952461(335))),_2016952461(336)=> array());foreach($_89 as $_91)$_90[_2016952461(337)][]=array(_2016952461(338)=> $_91,_2016952461(339)=> CUtil::translit($_91,_2016952461(340),array(_2016952461(341)=> _2016952461(342),_2016952461(343)=> _2016952461(344))));$_86[$_90[_2016952461(345)]]=$_90;}$_92=array();foreach($_86 as $_90){$_93=$_85[$_90[_2016952461(346)]];$_36=new CIBlockProperty();if(!empty($_93)){$_38=array(_2016952461(347)=> $_90[_2016952461(348)],_2016952461(349)=> _2016952461(350),_2016952461(351)=> false);$_45=array();foreach($_90[_2016952461(352)]as $_94)$_45[]=array(_2016952461(353)=> $_94[_2016952461(354)],_2016952461(355)=> $_94[_2016952461(356)]);$_36->Update($_93[_2016952461(357)],$_38,true);$_36->UpdateEnum($_93[_2016952461(358)],$_45,true);$_92[]=$_93[_2016952461(359)];}else{$_38=array(_2016952461(360)=> $_12[_2016952461(361)],_2016952461(362)=> $_90[_2016952461(363)],_2016952461(364)=> $_90[_2016952461(365)],_2016952461(366)=> $_90[_2016952461(367)],_2016952461(368)=> _2016952461(369),_2016952461(370)=> false);$_45=array();foreach($_90[_2016952461(371)]as $_94)$_45[]=array(_2016952461(372)=> $_94[_2016952461(373)],_2016952461(374)=> $_94[_2016952461(375)]);$_39=$_36->Add($_38);if(!empty($_39)){$_36->UpdateEnum($_39,$_45);$_92[]=$_39;}}unset($_36);}CStartShopCatalog::Update($_11[_2016952461(376)],array(_2016952461(377)=> $_92));}}}public static function ImportOffers(&$_0,&$_11,$_95=STARTSHOP_EXCHANGE_1C_CATALOG_IMPORT_ACTION_NOTHING,$_2=true,$_52=0,$_53=0){if($_0 instanceof CDataXML &&!empty($_11)){$_96=CStartShopExchange1CCatalogOffer::GetListByXml($_0);$_79=array();$_97=array();$_16=CStartShopCatalog::GetByIBlock($_11[_2016952461(378)])->Fetch();$_4=CStartShopExchange1CCatalog::IsOnlyChanges($_0);if($_96 != null)if($_52>round(0)&& $_53 == round(0)){$_79=$GLOBALS['_269798253_'][28]($_96,$_52);}else if($_53>round(0)){$_79=$GLOBALS['_269798253_'][29]($_96,$_52,$_53);}if(!empty($_16)&&!empty($_79)){$_63=CStartShopUtil::DBResultToArray(CIBlockElement::GetList(array(),array(_2016952461(379)=> $_11[_2016952461(380)])),_2016952461(381));$_98=array();$_12=CIBlock::GetByID($_16[_2016952461(382)])->Fetch();$_85=array();if(!empty($_12)){$_98=CStartShopUtil::DBResultToArray(CIBlockElement::GetList(array(),array(_2016952461(383)=> $_12[_2016952461(384)])),_2016952461(385));$_85=CStartShopUtil::DBResultToArray(CIBlockProperty::GetList(array(),array(_2016952461(386)=> $_12[_2016952461(387)])),_2016952461(388));$_99=CStartShopUtil::DBResultToArray(CIBlockPropertyEnum::GetList(array(),array(_2016952461(389)=> $_12[_2016952461(390)])),_2016952461(391));$_100=array();foreach($_85 as $_59 => $_93)$_100[$_93[_2016952461(392)]]=$_59;foreach($_99 as $_60 => $_101){$_102=$_100[$_101[_2016952461(393)]];if(!empty($_102)&&!empty($_101[_2016952461(394)]))$_85[$_102][_2016952461(395)][$_101[_2016952461(396)]]=$_101;}}foreach($_96 as $_82)if($_82 instanceof CStartShopExchange1CCatalogOffer)if($_82->IsOffer()&&!empty($_12))$_97[]=$_82->Id;foreach($_79 as $_82){if($_82 instanceof CStartShopExchange1CCatalogOffer){$_66=$_63[$_82->GetCatalogItemID()];if(!empty($_66))if(!$_82->IsOffer()){CStartShopToolsIBlock::SetQuantityRatio($_66[_2016952461(397)],round(0+0.5+0.5));CStartShopToolsIBlock::SetQuantity($_66[_2016952461(398)],$_82->Quantity);CStartShopToolsIBlock::SetPrices($_66[_2016952461(399)],null,null,null);if($_82->Prices != null){foreach($_82->Prices as $_103)if($_103 instanceof CStartShopExchange1CCatalogOfferPrice)CStartShopToolsIBlock::SetPrice($_66[_2016952461(400)],$_103->Type,$_103->Value,$_103->Currency);}}else if(!empty($_12)){$_104=$_98[$_82->Id];$_105=array();$_65=new CIBlockElement();$_106=null;if(!empty($_104)){$_106=$_104[_2016952461(401)];if($_2 && $_104[_2016952461(402)]!= $_82->Name)$_105[_2016952461(403)]=$_82->Name;if(!empty($_105))$_65->Update($_104[_2016952461(404)],$_105);CStartShopToolsIBlock::SetPrices($_106,null,null,null);}else{$_105=array(_2016952461(405)=> $_12[_2016952461(406)],_2016952461(407)=> $_82->Id,_2016952461(408)=> $_82->Name);$_106=$_65->Add($_105);}if(!empty($_106)){$_107=array();if(!empty($_82->Characteristics))foreach($_82->Characteristics as $_87)if($_87 instanceof CStartShopExchange1CCatalogOfferCharacteristic){$_108=CUtil::translit($_87->Name,_2016952461(409),array(_2016952461(410)=> _2016952461(411),_2016952461(412)=> _2016952461(413)));$_109=CUtil::translit($_87->Value,_2016952461(414),array(_2016952461(415)=> _2016952461(416),_2016952461(417)=> _2016952461(418)));$_107[$_85[$_108][_2016952461(419)]]=$_85[$_108][_2016952461(420)][$_109][_2016952461(421)];}if(!empty($_107))CIBlockElement::SetPropertyValuesEx($_106,$_12[_2016952461(422)],$_107);CStartShopToolsIBlock::SetQuantityRatio($_106,round(0+0.5+0.5));CStartShopToolsIBlock::SetQuantity($_106,$_82->Quantity);CStartShopToolsIBlock::SetOffersLinkByIBlock($_11[_2016952461(423)],$_106,$_66[_2016952461(424)]);if($_82->Prices != null)foreach($_82->Prices as $_103)if($_103 instanceof CStartShopExchange1CCatalogOfferPrice)CStartShopToolsIBlock::SetPrice($_106,$_103->Type,$_103->Value,$_103->Currency);}unset($_65);unset($_105);unset($_104);}unset($_66);}}$_65=new CIBlockElement();if($_4)$_95=STARTSHOP_EXCHANGE_1C_CATALOG_IMPORT_ACTION_NOTHING;if($_95 != STARTSHOP_EXCHANGE_1C_CATALOG_IMPORT_ACTION_NOTHING){$_63=CStartShopUtil::DBResultToArray(CIBlockElement::GetList(array(),array(_2016952461(425)=> $_11[_2016952461(426)])),_2016952461(427));foreach($_98 as $_110){if(!empty($_110[_2016952461(428)]))if($GLOBALS['_269798253_'][30]($_110[_2016952461(429)],$_97))continue;if($_95 == STARTSHOP_EXCHANGE_1C_CATALOG_IMPORT_ACTION_DELETE){$_65->Delete($_110[_2016952461(430)]);}else{$_65->Update($_110[_2016952461(431)],array(_2016952461(432)=> _2016952461(433)));}}}unset($_65);return true;}}return null;}public static function GetItemsCount(&$_0){if($_0 instanceof CDataXML){$_111=static::GetType($_0);if($_111 == STARTSHOP_EXCHANGE_1C_CATALOG_TYPE_PRODUCTS){if($_112=$_0->SelectNodes(_2016952461(434)))return $GLOBALS['_269798253_'][31]($_112->children());}else if($_111 == STARTSHOP_EXCHANGE_1C_CATALOG_TYPE_OFFERS){if($_112=$_0->SelectNodes(_2016952461(435)))return $GLOBALS['_269798253_'][32]($_112->children());}}return round(0);}public static function GetType(&$_0){if($_0 instanceof CDataXML){if($_112=$_0->SelectNodes("/КоммерческаяИнформация/Каталог"))return STARTSHOP_EXCHANGE_1C_CATALOG_TYPE_PRODUCTS;if($_112=$_0->SelectNodes(_2016952461(436)))return STARTSHOP_EXCHANGE_1C_CATALOG_TYPE_OFFERS;}return null;}public static function IsOnlyChanges(&$_0){if($_0 instanceof CDataXML){$_111=static::GetType($_0);if($_111 == STARTSHOP_EXCHANGE_1C_CATALOG_TYPE_PRODUCTS){if($_112=$_0->SelectNodes(_2016952461(437)))if($_112->getAttribute(_2016952461(438))== _2016952461(439)){return true;}else{return false;}}else if($_111 == STARTSHOP_EXCHANGE_1C_CATALOG_TYPE_OFFERS){if($_112=$_0->SelectNodes(_2016952461(440)))if($_112->getAttribute(_2016952461(441))== _2016952461(442)){return true;}else{return false;}}}return false;}} ?>