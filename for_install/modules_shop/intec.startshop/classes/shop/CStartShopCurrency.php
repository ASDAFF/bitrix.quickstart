<? $GLOBALS['_485875154_']=Array('in' .'tval','in_' .'a' .'rray','i' .'s_ar' .'ray','is_arra' .'y','i' .'ntval','i' .'s_ar' .'ray','i' .'s_array','' .'in_arra' .'y','is_' .'array','' .'is_arr' .'ay','intval','' .'in' .'_a' .'rray','in_array','p' .'reg' .'_' .'repla' .'ce','ar' .'ray_ke' .'ys','fl' .'o' .'atval','f' .'lo' .'at' .'val','intval','f' .'l' .'oatval','floa' .'tval','' .'intval','float' .'val','' .'fm' .'od','st' .'r_re' .'plac' .'e','number_f' .'o' .'rmat','intval'); ?><? function _33786358($i){$a=Array('FORMAT','LANG','startshop_currency','BASE','Y','FORMAT','LANG','CODE','CODE','CODE','CODE','CODE','CODE','BASE','Y','BASE','RATE','RATING','BASE','N','BASE','Y','RATE','RATING','/^(>=|<=|=|!|>|<)/','','FORMAT','ID','RATE','RATING','RATE','RATING','RATE','RATING','PRINT_VALUE','FORMAT','VALUE','VALUE','DECIMALS_DISPLAY_ZERO','Y','CURRENCY','CODE','PRINT_VALUE','#','VALUE','DECIMALS_COUNT','DELIMITER_DECIMAL','DELIMITER_THOUSANDS','FORMAT','CURRENCY','PRINT_VALUE','VALUE','PRINT_VALUE');return $a[$i];} ?><? class CStartShopCurrency extends CStartShop implements CStartShopInterface{private static $arFieldsEditable=array('CODE','SORT','ACTIVE','BASE','RATE','RATING');public static function getArFieldsEditable(){return static::$arFieldsEditable;}private static $arFieldsFiltering=array('ID','CODE','SORT','ACTIVE','BASE','RATE','RATING');public static function getArFieldsFiltering(){return static::$arFieldsFiltering;}private static $Language;private static $Format;private static function Language(){if(!(static::$Language instanceof CStartShopDBTableModule)){static::$Language=new CStartShopDBTableModule('startshop_currency_language','CURRENCY','LID',array('NAME'));}return static::$Language;}private static function Format(){if(!(static::$Format instanceof CStartShopDBTableModule)){static::$Format=new CStartShopDBTableModule('startshop_currency_format','CURRENCY','LID',array('FORMAT','DELIMITER_DECIMAL','DELIMITER_THOUSANDS','DECIMALS_COUNT','DECIMALS_DISPLAY_ZERO'));}return static::$Format;}public static function SetBase($_0){$_0=$GLOBALS['_485875154_'][0]($_0);$_1=static::GetBase()->Fetch();$_2=static::GetByID($_0)->Fetch();if($_2){CStartShopDBQueryBX::Update()->Tables('startshop_currency')->Values(array('BASE'=> 'N'))->Execute();CStartShopDBQueryBX::Update()->Tables('startshop_currency')->Values(array('BASE'=> 'Y','RATE'=> '1','RATING'=> '1'))->Where(array('ID'=> $_0))->Execute();static::ResetCacheByUnique($_1['ID']);static::ResetCacheByUnique($_2['ID']);static::ResetCacheBase();}}public static function Add($_3){if(empty($_3['CODE']))return false;$_4=$_3[_33786358(0)];$_5=$_3[_33786358(1)];$_3=CStartShopUtil::ArrayFilter($_3,function($_6){return $GLOBALS['_485875154_'][1]($_6,CStartShopCurrency::getArFieldsEditable());},STARTSHOP_UTIL_ARRAY_FILTER_USE_KEY);if(!$GLOBALS['_485875154_'][2]($_4))$_4=array();if(!$GLOBALS['_485875154_'][3]($_5))$_5=array();$_7=(bool)static::GetList(array(),array('CODE'=> $_3['CODE']))->Fetch();if($_7)return false;$_8=CStartShopDBQueryBX::Insert()->Into(_33786358(2))->Values($_3)->Execute();if($_8){if($_3[_33786358(3)]== _33786358(4))static::SetBase($_8);static::Language()->Set($_8,$_5);static::Format()->Set($_8,$_4);CStartShopToolsIBlock::UpdatePropertiesAll();return $_8;}return false;}public static function Update($_0,$_3){$_0=$GLOBALS['_485875154_'][4]($_0);$_4=$_3[_33786358(5)];$_5=$_3[_33786358(6)];$_7=false;$_2=static::GetByID($_0)->Fetch();if(empty($_2))return false;if(!$GLOBALS['_485875154_'][5]($_4))$_4=false;if(!$GLOBALS['_485875154_'][6]($_5))$_5=false;if(isset($_3[_33786358(7)])&& empty($_3[_33786358(8)]))unset($_3[_33786358(9)]);if(isset($_3[_33786358(10)]))if($_3[_33786358(11)]!= $_2[_33786358(12)])$_7=(bool)static::GetList(array(),array('CODE'=> $_3['CODE']))->Fetch();if($_7)return false;$_3=CStartShopUtil::ArrayFilter($_3,function($_6){return $GLOBALS['_485875154_'][7]($_6,CStartShopCurrency::getArFieldsEditable());},STARTSHOP_UTIL_ARRAY_FILTER_USE_KEY);if(!empty($_3)){if($_3[_33786358(13)]== _33786358(14)){static::SetBase($_0);unset($_3[_33786358(15)]);unset($_3[_33786358(16)]);unset($_3[_33786358(17)]);}if($_3[_33786358(18)]!= _33786358(19))if($_2[_33786358(20)]== _33786358(21)){unset($_3[_33786358(22)]);unset($_3[_33786358(23)]);}CStartShopDBQueryBX::Update()->Tables('startshop_currency')->Values($_3)->Where(array('ID'=> $_0))->Execute();}if($GLOBALS['_485875154_'][8]($_5))static::Language()->Set($_0,$_5);if($GLOBALS['_485875154_'][9]($_4))static::Format()->Set($_0,$_4);static::ResetCacheByUnique($_0);CStartShopToolsIBlock::UpdatePropertiesAll();return true;}public static function Delete($_0){$_0=$GLOBALS['_485875154_'][10]($_0);CStartShopDBQueryBX::Delete()->From('startshop_currency')->Where(array('ID'=> $_0))->Execute();static::Language()->Set($_0);static::Format()->Set($_0);static::ResetCacheByUnique($_0);CStartShopToolsIBlock::UpdatePropertiesAll();return true;}public static function DeleteAll(){CStartShopDBQueryBX::Delete()->From('startshop_currency')->Execute();static::Language()->Set();static::Format()->Set();static::ResetCache();CStartShopToolsIBlock::UpdatePropertiesAll();return true;}public static function GetList($_9=array(),$_10=array()){$_11=array();$_9=CStartShopUtil::ArrayFilter($_9,function($_6){return $GLOBALS['_485875154_'][11]($_6,CStartShopCurrency::getArFieldsFiltering());},STARTSHOP_UTIL_ARRAY_FILTER_USE_KEY);$_10=CStartShopUtil::ArrayFilter($_10,function($_6){return $GLOBALS['_485875154_'][12]($GLOBALS['_485875154_'][13](_33786358(24),_33786358(25),$_6),CStartShopCurrency::getArFieldsFiltering());},STARTSHOP_UTIL_ARRAY_FILTER_USE_KEY);$_12=CStartShopDBQueryBX::Select()->From('startshop_currency')->Where($_10)->OrderBy($_9)->Execute();while($_2=$_12->Fetch()){$_2['LANG']=array();$_2[_33786358(26)]=array();$_11[$_2[_33786358(27)]]=$_2;}if(!empty($_11)){$_13=$GLOBALS['_485875154_'][14]($_11);$_14=static::Language()->Get(array('LID'=> 'ASC'),$_13);$_15=static::Format()->Get(array('LID'=> 'ASC'),$_13);while($_16=$_14->Fetch())$_11[$_16['CURRENCY']]['LANG'][$_16['LID']]=array("NAME"=> $_16['NAME']);while($_17=$_15->Fetch())$_11[$_17['CURRENCY']]['FORMAT'][$_17['LID']]=array("FORMAT"=> $_17["FORMAT"],'DELIMITER_DECIMAL'=> $_17["DELIMITER_DECIMAL"],'DELIMITER_THOUSANDS'=> $_17["DELIMITER_THOUSANDS"],'DECIMALS_COUNT'=> $_17["DECIMALS_COUNT"],'DECIMALS_DISPLAY_ZERO'=> $_17["DECIMALS_DISPLAY_ZERO"]);}return CStartShopUtil::ArrayToDBResult($_11);}public static function GetBase(){if(!CStartShopCache::IsExists('CStartShopCurrency.Common','BASE')){$_12=static::GetList(array(),array('BASE'=> 'Y'));$_12=CStartShopCache::CreateFromResult('CStartShopCurrency.Common','BASE',$_12);}else{$_12=CStartShopCache::GetAsResult('CStartShopCurrency.Common','BASE');}return $_12;}public static function GetByID($_0){if(!CStartShopCache::IsExists('CStartShopCurrency.Items',$_0)){$_12=self::GetList(array(),array("ID"=> $_0));$_12=CStartShopCache::CreateFromResult('CStartShopCurrency.Items',array('ID','CODE'),$_12);}else{$_12=CStartShopCache::GetAsResult('CStartShopCurrency.Items',$_0);}return $_12;}public static function GetByCode($_18){if(!CStartShopCache::IsExists('CStartShopCurrency.Items',$_18)){$_12=self::GetList(array(),array("CODE"=> $_18));$_12=CStartShopCache::CreateFromResult('CStartShopCurrency.Items',array('ID','CODE'),$_12);}else{$_12=CStartShopCache::GetAsResult('CStartShopCurrency.Items',$_18);}return $_12;}public static function ResetCacheBase(){CStartShopCache::Clear('CStartShopCurrency.Common','BASE');}public static function ResetCacheByUnique($_19){if(CStartShopCache::IsExists('CStartShopCurrency.Items',$_19)){$_20=CStartShopCache::Get('CStartShopCurrency.Items',$_19);CStartShopCache::Clear('CStartShopCurrency.Items',$_20['ID']);CStartShopCache::Clear('CStartShopCurrency.Items',$_20['CODE']);}}public static function ResetCache(){CStartShopCache::ClearPath('CStartShopCurrency.Items');CStartShopCache::ClearPath('CStartShopCurrency.Common');}public static function Convert($_21,$_22=l__0,$_23=l__0){if($_22 == $_23)return $_21;if(!empty($_22)){$_24=static::GetByCode($_22)->Fetch();}else{$_24=static::GetBase()->Fetch();}if(!empty($_23)){$_25=static::GetByCode($_23)->Fetch();}else{$_25=static::GetBase()->Fetch();}if(empty($_25)){$_25=array();$_25[_33786358(28)]=round(0+0.33333333333333+0.33333333333333+0.33333333333333);$_25[_33786358(29)]=round(0+0.33333333333333+0.33333333333333+0.33333333333333);}if(!empty($_24)&&!empty($_25)){return($_21*$GLOBALS['_485875154_'][15]($GLOBALS['_485875154_'][16]($_24[_33786358(30)])/$GLOBALS['_485875154_'][17]($_24[_33786358(31)])))/$GLOBALS['_485875154_'][18]($GLOBALS['_485875154_'][19]($_25[_33786358(32)])/$GLOBALS['_485875154_'][20]($_25[_33786358(33)]));}return $_21;}public static function FormatAsString($_21,$_18=l__0,$_26=l__1){$_27=static::FormatAsArray($_21,$_18,$_26);return $_27[_33786358(34)];}public static function FormatAsArray($_21,$_18=l__0,$_26=l__1){$_27=array();$_2=l__0;if(!empty($_18)){$_2=static::GetByCode($_18)->Fetch();}else{$_2=static::GetBase()->Fetch();}$_17=$_2[_33786358(35)][$_26];$_27[_33786358(36)]=$GLOBALS['_485875154_'][21]($_21);if(!empty($_17)){$_28=$GLOBALS['_485875154_'][22]($_27[_33786358(37)],round(0+0.33333333333333+0.33333333333333+0.33333333333333))!= round(0)|| $_17[_33786358(38)]== _33786358(39);$_27[_33786358(40)]=$_2[_33786358(41)];$_27[_33786358(42)]=$GLOBALS['_485875154_'][23](_33786358(43),$GLOBALS['_485875154_'][24]($_27[_33786358(44)],$_28?$GLOBALS['_485875154_'][25]($_17[_33786358(45)]):round(0),$_17[_33786358(46)],$_17[_33786358(47)]),$_17[_33786358(48)]);}else{$_27[_33786358(49)]=l__0;$_27[_33786358(50)]=$_27[_33786358(51)];}return $_27;}public static function ConvertAndFormatAsArray($_21,$_22=l__0,$_23=l__0,$_26=l__1){return static::FormatAsArray(static::Convert($_21,$_22,$_23),$_23,$_26);}public static function ConvertAndFormatAsString($_21,$_22=l__0,$_23=l__0,$_26=l__1){$_27=static::ConvertAndFormatAsArray($_21,$_22,$_23,$_26);return $_27[_33786358(52)];}} ?>
