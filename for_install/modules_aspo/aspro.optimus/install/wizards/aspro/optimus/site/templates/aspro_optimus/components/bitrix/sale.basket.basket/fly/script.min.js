var basketTimeout;var totalSum;var timerBasketUpdate=false;function setQuantity(a,e,f){var d=BX("QUANTITY_INPUT_"+a).value,c;var b=$("#QUANTITY_INPUT_"+a).data("float_ratio"),e=(b?parseFloat(e):parseInt(e,10));if(b){e=Math.round(e*arOptimusOptions.JS_ITEM_CLICK.precisionFactor)/arOptimusOptions.JS_ITEM_CLICK.precisionFactor}curValue=(b?parseFloat(d):parseInt(d,10));curValue=(f=="up")?curValue+e:curValue-e;if(b){curValue=Math.round(curValue*arOptimusOptions.JS_ITEM_CLICK.precisionFactor)/arOptimusOptions.JS_ITEM_CLICK.precisionFactor}if(curValue<0){curValue=0}if(curValue>0){BX("QUANTITY_INPUT_"+a).value=curValue;BX("QUANTITY_INPUT_"+a).defaultValue=d;totalSum=0;$("#basket_line .basket_fly tr[data-id="+a+"]").closest("table").find("tbody tr[data-id]").each(function(h,g){id=$(g).attr("data-id");count=BX("QUANTITY_INPUT_"+id).value;price=$(document).find("#basket_form input[name=item_price_"+id+"]").val();sum=count*price;totalSum+=sum;$(document).find("#basket_form [data-id="+id+"] .summ-cell .price").html(jsPriceFormat(sum))});$("#basket_form .itog span.price").html(jsPriceFormat(totalSum));$("#basket_form .itog div.discount").fadeTo("slow",0.2);if(timerBasketUpdate){clearTimeout(timerBasketUpdate);timerBasketUpdate=false}timerBasketUpdate=setTimeout(function(){updateQuantity("QUANTITY_INPUT_"+a,a,e);timerBasketUpdate=false},700)}}function updateQuantity(j,c,g,a){var h=BX(j).defaultValue,b=parseFloat(BX(j).value)||0;bValidChange=false;if(!b){bValidChange=false;BX(j).value=h}if($("#"+j).hasClass("focus")){b-=b%g}var d=(g%1==0);b=d?parseInt(b):parseFloat(b).toFixed(1);if(isRealValue(BX("QUANTITY_SELECT_"+c))){var f,k=BX("QUANTITY_SELECT_"+c).options,e=k.length}while(e--){f=k[e];if(parseFloat(f.value).toFixed(2)==parseFloat(b).toFixed(2)){f.selected=true}}BX("QUANTITY_"+c).value=b;BX("QUANTITY_INPUT_"+c).value=b;$("form[name^=basket_form]").prepend('<input type="hidden" name="BasketRefresh" value="Y" />');$.post(arOptimusOptions.SITE_DIR+"ajax/basket_fly.php",$("form[name^=basket_form]").serialize(),$.proxy(function(i){if(timerBasketUpdate==false){basketFly("open")}$("form[name^=basket_form] input[name=BasketRefresh]").remove()}))}function delete_all_items(b,c,d){var a=(b=="delay"?"2":"1");$.post(arOptimusOptions.SITE_DIR+"ajax/show_basket_fly.php","PARAMS="+$("#basket_form").find("input#fly_basket_params").val()+"&TYPE="+a+"&CLEAR_ALL=Y",$.proxy(function(e){basketFly("open");$(".in-cart").hide();$(".in-cart").closest(".button_block").removeClass("wide");$(".to-cart").show();$(".counter_block").show();$(".wish_item").removeClass("added");$(".wish_item").find(".value").show();$(".wish_item").find(".value.added").hide();getActualBasket()}))}function deleteProduct(a,f,d,c){function e(g,i,h){$.post(arOptimusOptions.SITE_DIR+"ajax/item.php","delete_item=Y&item="+h,$.proxy(function(j){basketFly("open");getActualBasket()}))}var b=c.attr("product-id");if(checkCounters()){delFromBasketCounter(d);setTimeout(function(){e(a,f,b)},100)}else{e(a,f,b)}}function delayProduct(a,d,c){var b=c.attr("product-id");$.post(arOptimusOptions.SITE_DIR+"ajax/item.php","wish_item=Y&item="+b+"&quantity="+c.find("#QUANTITY_"+a).val(),$.proxy(function(e){basketFly("open");getActualBasket(c.attr("data-iblockid"))}))}function addProduct(a,d,c){var b=c.attr("product-id");$.post(arOptimusOptions.SITE_DIR+"ajax/item.php","add_item=Y&item="+b+"&quantity="+c.find("#QUANTITY_"+a).val(),$.proxy(function(e){basketFly("open");getActualBasket(c.attr("data-iblockid"))}))}function checkOut(b){b=b||window.event;var a=$(b.target).parent();if(checkCounters("google")){checkoutCounter(1,a.data("text"),a.data("href"))}else{location.href=a.data("href")}return true};