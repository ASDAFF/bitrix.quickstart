(window.jivo_init=function(){var config=window.jivo_config;function getElementsByClassName(e){var t;try{t=document.getElementsByClassName(e)}catch(i){t=[];var n=new RegExp("\\b"+e+"\\b");var o=document.getElementsByTagName("*");for(var s=0;s<o.length;s++){var r=o[s].className;if(n.test(r)){t.push(o[s])}}}return t}(function(){var e=this;var t=e._;var i={};var n=Array.prototype,o=Object.prototype,s=Function.prototype;var r=n.push,a=n.slice,c=n.concat,l=o.toString,u=o.hasOwnProperty;var f=n.forEach,d=n.map,h=n.reduce,g=n.reduceRight,m=n.filter,_=n.every,v=n.some,p=n.indexOf,b=n.lastIndexOf,w=Array.isArray,y=Object.keys,E=false;var C=function(e){if(e instanceof C){return e}if(!(this instanceof C)){return new C(e)}this._wrapped=e};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=C}exports._=C}else{e._=C}C.VERSION="1.4.4";var j=C.each=C.forEach=function(e,t,n){if(e==null){return}if(f&&e.forEach===f){e.forEach(t,n)}else{if(e.length===+e.length){for(var o=0,s=e.length;o<s;o++){if(t.call(n,e[o],o,e)===i){return}}}else{for(var r in e){if(C.has(e,r)){if(t.call(n,e[r],r,e)===i){return}}}}}};C.map=C.collect=function(e,t,i){var n=[];if(e==null){return n}if(d&&e.map===d){return e.map(t,i)}j(e,function(e,o,s){n[n.length]=t.call(i,e,o,s)});return n};var k="Reduce of empty array with no initial value";C.reduce=C.foldl=C.inject=function(e,t,i,n){var o=arguments.length>2;if(e==null){e=[]}if(h&&e.reduce===h){if(n){t=C.bind(t,n)}return o?e.reduce(t,i):e.reduce(t)}j(e,function(e,s,r){if(!o){i=e;o=true}else{i=t.call(n,i,e,s,r)}});if(!o){throw new TypeError(k)}return i};C.reduceRight=C.foldr=function(e,t,i,n){var o=arguments.length>2;if(e==null){e=[]}if(g&&e.reduceRight===g){if(n){t=C.bind(t,n)}return o?e.reduceRight(t,i):e.reduceRight(t)}var s=e.length;if(s!==+s){var r=C.keys(e);s=r.length}j(e,function(a,c,l){c=r?r[--s]:--s;if(!o){i=e[c];o=true}else{i=t.call(n,i,e[c],c,l)}});if(!o){throw new TypeError(k)}return i};C.find=C.detect=function(e,t,i){var n;T(e,function(e,o,s){if(t.call(i,e,o,s)){n=e;return true}});return n};C.filter=C.select=function(e,t,i){var n=[];if(e==null){return n}if(m&&e.filter===m){return e.filter(t,i)}j(e,function(e,o,s){if(t.call(i,e,o,s)){n[n.length]=e}});return n};C.reject=function(e,t,i){return C.filter(e,function(e,n,o){return !t.call(i,e,n,o)},i)};C.every=C.all=function(e,t,n){t||(t=C.identity);var o=true;if(e==null){return o}if(_&&e.every===_){return e.every(t,n)}j(e,function(e,s,r){if(!(o=o&&t.call(n,e,s,r))){return i}});return !!o};var T=C.some=C.any=function(e,t,n){t||(t=C.identity);var o=false;if(e==null){return o}if(v&&e.some===v){return e.some(t,n)}j(e,function(e,s,r){if(o||(o=t.call(n,e,s,r))){return i}});return !!o};C.contains=C.include=function(e,t){if(e==null){return false}if(p&&e.indexOf===p){return e.indexOf(t)!=-1}return T(e,function(e){return e===t})};C.invoke=function(e,t){var i=a.call(arguments,2);var n=C.isFunction(t);return C.map(e,function(e){return(n?t:e[t]).apply(e,i)})};C.pluck=function(e,t){return C.map(e,function(e){return e[t]})};C.where=function(e,t,i){if(C.isEmpty(t)){return i?null:[]}return C[i?"find":"filter"](e,function(e){for(var i in t){if(t[i]!==e[i]){return false}}return true})};C.findWhere=function(e,t){return C.where(e,t,true)};C.max=function(e,t,i){if(!t&&C.isArray(e)&&e[0]===+e[0]&&e.length<65535){return Math.max.apply(Math,e)}if(!t&&C.isEmpty(e)){return -Infinity}var n={computed:-Infinity,value:-Infinity};j(e,function(e,o,s){var r=t?t.call(i,e,o,s):e;r>=n.computed&&(n={value:e,computed:r})});return n.value};C.min=function(e,t,i){if(!t&&C.isArray(e)&&e[0]===+e[0]&&e.length<65535){return Math.min.apply(Math,e)}if(!t&&C.isEmpty(e)){return Infinity}var n={computed:Infinity,value:Infinity};j(e,function(e,o,s){var r=t?t.call(i,e,o,s):e;r<n.computed&&(n={value:e,computed:r})});return n.value};C.shuffle=function(e){var t;var i=0;var n=[];j(e,function(e){t=C.random(i++);n[i-1]=n[t];n[t]=e});return n};var I=function(e){return C.isFunction(e)?e:function(t){return t[e]}};C.sortBy=function(e,t,i){var n=I(t);return C.pluck(C.map(e,function(e,t,o){return{value:e,index:t,criteria:n.call(i,e,t,o)}}).sort(function(e,t){var i=e.criteria;var n=t.criteria;if(i!==n){if(i>n||i===void 0){return 1}if(i<n||n===void 0){return -1}}return e.index<t.index?-1:1}),"value")};var S=function(e,t,i,n){var o={};var s=I(t||C.identity);j(e,function(t,r){var a=s.call(i,t,r,e);n(o,a,t)});return o};C.groupBy=function(e,t,i){return S(e,t,i,function(e,t,i){(C.has(e,t)?e[t]:e[t]=[]).push(i)})};C.countBy=function(e,t,i){return S(e,t,i,function(e,t){if(!C.has(e,t)){e[t]=0}e[t]++})};C.sortedIndex=function(e,t,i,n){i=i==null?C.identity:I(i);var o=i.call(n,t);var s=0,r=e.length;while(s<r){var a=s+r>>>1;i.call(n,e[a])<o?s=a+1:r=a}return s};C.toArray=function(e){if(!e){return[]}if(C.isArray(e)){return a.call(e)}if(e.length===+e.length){return C.map(e,C.identity)}return C.values(e)};C.size=function(e){if(e==null){return 0}return e.length===+e.length?e.length:C.keys(e).length};C.first=C.head=C.take=function(e,t,i){if(e==null){return void 0}return t!=null&&!i?a.call(e,0,t):e[0]};C.initial=function(e,t,i){return a.call(e,0,e.length-(t==null||i?1:t))};C.last=function(e,t,i){if(e==null){return void 0}if(t!=null&&!i){return a.call(e,Math.max(e.length-t,0))}else{return e[e.length-1]}};C.rest=C.tail=C.drop=function(e,t,i){return a.call(e,t==null||i?1:t)};C.compact=function(e){return C.filter(e,C.identity)};var N=function(e,t,i){j(e,function(e){if(C.isArray(e)){t?r.apply(i,e):N(e,t,i)}else{i.push(e)}});return i};C.flatten=function(e,t){return N(e,t,[])};C.without=function(e){return C.difference(e,a.call(arguments,1))};C.uniq=C.unique=function(e,t,i,n){if(C.isFunction(t)){n=i;i=t;t=false}var o=i?C.map(e,i,n):e;var s=[];var r=[];j(o,function(i,n){if(t?!n||r[r.length-1]!==i:!C.contains(r,i)){r.push(i);s.push(e[n])}});return s};C.union=function(){return C.uniq(c.apply(n,arguments))};C.intersection=function(e){var t=a.call(arguments,1);return C.filter(C.uniq(e),function(e){return C.every(t,function(t){return C.indexOf(t,e)>=0})})};C.difference=function(e){var t=c.apply(n,a.call(arguments,1));return C.filter(e,function(e){return !C.contains(t,e)})};C.zip=function(){var e=a.call(arguments);var t=C.max(C.pluck(e,"length"));var i=new Array(t);for(var n=0;n<t;n++){i[n]=C.pluck(e,""+n)}return i};C.object=function(e,t){if(e==null){return{}}var i={};for(var n=0,o=e.length;n<o;n++){if(t){i[e[n]]=t[n]}else{i[e[n][0]]=e[n][1]}}return i};C.indexOf=function(e,t,i){if(e==null){return -1}var n=0,o=e.length;if(i){if(typeof i=="number"){n=i<0?Math.max(0,o+i):i}else{n=C.sortedIndex(e,t);return e[n]===t?n:-1}}if(p&&e.indexOf===p){return e.indexOf(t,i)}for(;n<o;n++){if(e[n]===t){return n}}return -1};C.lastIndexOf=function(e,t,i){if(e==null){return -1}var n=i!=null;if(b&&e.lastIndexOf===b){return n?e.lastIndexOf(t,i):e.lastIndexOf(t)}var o=n?i:e.length;while(o--){if(e[o]===t){return o}}return -1};C.range=function(e,t,i){if(arguments.length<=1){t=e||0;e=0}i=arguments[2]||1;var n=Math.max(Math.ceil((t-e)/i),0);var o=0;var s=new Array(n);while(o<n){s[o++]=e;e+=i}return s};C.bind=function(e,t){if(e.bind===E&&E){return E.apply(e,a.call(arguments,1))}var i=a.call(arguments,2);return function(){return e.apply(t,i.concat(a.call(arguments)))}};C.partial=function(e){var t=a.call(arguments,1);return function(){return e.apply(this,t.concat(a.call(arguments)))}};C.bindAll=function(e){var t=a.call(arguments,1);if(t.length===0){t=C.functions(e)}j(t,function(t){e[t]=C.bind(e[t],e)});return e};C.memoize=function(e,t){var i={};t||(t=C.identity);return function(){var n=t.apply(this,arguments);return C.has(i,n)?i[n]:i[n]=e.apply(this,arguments)}};C.delay=function(e,t){var i=a.call(arguments,2);return setTimeout(function(){return e.apply(null,i)},t)};C.defer=function(e){return C.delay.apply(C,[e,1].concat(a.call(arguments,1)))};C.throttle=function(e,t){var i,n,o,s;var r=0;var a=function(){r=new Date;o=null;s=e.apply(i,n)};return function(){var c=new Date;var l=t-(c-r);i=this;n=arguments;if(l<=0){clearTimeout(o);o=null;r=c;s=e.apply(i,n)}else{if(!o){o=setTimeout(a,l)}}return s}};C.debounce=function(e,t,i){var n,o;return function(){var s=this,r=arguments;var a=function(){n=null;if(!i){o=e.apply(s,r)}};var c=i&&!n;clearTimeout(n);n=setTimeout(a,t);if(c){o=e.apply(s,r)}return o}};C.once=function(e){var t=false,i;return function(){if(t){return i}t=true;i=e.apply(this,arguments);e=null;return i}};C.wrap=function(e,t){return function(){var i=[e];r.apply(i,arguments);return t.apply(this,i)}};C.compose=function(){var e=arguments;return function(){var t=arguments;for(var i=e.length-1;i>=0;i--){t=[e[i].apply(this,t)]}return t[0]}};C.after=function(e,t){if(e<=0){return t()}return function(){if(--e<1){return t.apply(this,arguments)}}};C.keys=y||function(e){if(e!==Object(e)){throw new TypeError("Invalid object")}var t=[];for(var i in e){if(C.has(e,i)){t[t.length]=i}}return t};C.values=function(e){var t=[];for(var i in e){if(C.has(e,i)){t.push(e[i])}}return t};C.pairs=function(e){var t=[];for(var i in e){if(C.has(e,i)){t.push([i,e[i]])}}return t};C.invert=function(e){var t={};for(var i in e){if(C.has(e,i)){t[e[i]]=i}}return t};C.functions=C.methods=function(e){var t=[];for(var i in e){if(C.isFunction(e[i])){t.push(i)}}return t.sort()};C.extend=function(e){j(a.call(arguments,1),function(t){if(t){for(var i in t){e[i]=t[i]}}});return e};C.pick=function(e){var t={};var i=c.apply(n,a.call(arguments,1));j(i,function(i){if(i in e){t[i]=e[i]}});return t};C.omit=function(e){var t={};var i=c.apply(n,a.call(arguments,1));for(var o in e){if(!C.contains(i,o)){t[o]=e[o]}}return t};C.defaults=function(e){j(a.call(arguments,1),function(t){if(t){for(var i in t){if(e[i]==null){e[i]=t[i]}}}});return e};C.clone=function(e){if(!C.isObject(e)){return e}return C.isArray(e)?e.slice():C.extend({},e)};C.tap=function(e,t){t(e);return e};var x=function(e,t,i,n){if(e===t){return e!==0||1/e==1/t}if(e==null||t==null){return e===t}if(e instanceof C){e=e._wrapped}if(t instanceof C){t=t._wrapped}var o=l.call(e);if(o!=l.call(t)){return false}switch(o){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return +e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object"){return false}var s=i.length;while(s--){if(i[s]==e){return n[s]==t}}i.push(e);n.push(t);var r=0,a=true;if(o=="[object Array]"){r=e.length;a=r==t.length;if(a){while(r--){if(!(a=x(e[r],t[r],i,n))){break}}}}else{var c=e.constructor,u=t.constructor;if(c!==u&&!(C.isFunction(c)&&c instanceof c&&C.isFunction(u)&&u instanceof u)){return false}for(var f in e){if(C.has(e,f)){r++;if(!(a=C.has(t,f)&&x(e[f],t[f],i,n))){break}}}if(a){for(f in t){if(C.has(t,f)&&!r--){break}}a=!r}}i.pop();n.pop();return a};C.isEqual=function(e,t){return x(e,t,[],[])};C.isEmpty=function(e){if(e==null){return true}if(C.isArray(e)||C.isString(e)){return e.length===0}for(var t in e){if(C.has(e,t)){return false}}return true};C.isElement=function(e){return !!(e&&e.nodeType===1)};C.isArray=w||function(e){return l.call(e)=="[object Array]"};C.isObject=function(e){return e===Object(e)};j(["Arguments","Function","String","Number","Date","RegExp"],function(e){C["is"+e]=function(t){return l.call(t)=="[object "+e+"]"}});if(!C.isArguments(arguments)){C.isArguments=function(e){return !!(e&&C.has(e,"callee"))}}if(typeof/./!=="function"){C.isFunction=function(e){return typeof e==="function"}}C.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))};C.isNaN=function(e){return C.isNumber(e)&&e!=+e};C.isBoolean=function(e){return e===true||e===false||l.call(e)=="[object Boolean]"};C.isNull=function(e){return e===null};C.isUndefined=function(e){return e===void 0};C.has=function(e,t){return u.call(e,t)};C.noConflict=function(){e._=t;return this};C.identity=function(e){return e};C.times=function(e,t,i){var n=Array(e);for(var o=0;o<e;o++){n[o]=t.call(i,o)}return n};C.random=function(e,t){if(t==null){t=e;e=0}return e+Math.floor(Math.random()*(t-e+1))};var O={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};O.unescape=C.invert(O.escape);var A={escape:new RegExp("["+C.keys(O.escape).join("")+"]","g"),unescape:new RegExp("("+C.keys(O.unescape).join("|")+")","g")};C.each(["escape","unescape"],function(e){C[e]=function(t){if(t==null){return""}return(""+t).replace(A[e],function(t){return O[e][t]})}});C.result=function(e,t){if(e==null){return null}var i=e[t];return C.isFunction(i)?i.call(e):i};C.mixin=function(e){j(C.functions(e),function(t){var i=C[t]=e[t];C.prototype[t]=function(){var e=[this._wrapped];r.apply(e,arguments);return H.call(this,i.apply(C,e))}})};var D=0;C.uniqueId=function(e){var t=++D+"";return e?e+t:t};C.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/;var M={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"};var P=/\\|'|\r|\n|\t|\u2028|\u2029/g;C.template=function(e,t,i){var n;i=C.defaults({},i,C.templateSettings);var o=new RegExp([(i.escape||L).source,(i.interpolate||L).source,(i.evaluate||L).source].join("|")+"|$","g");var s=0;var r="__p+='";e.replace(o,function(t,i,n,o,a){r+=e.slice(s,a).replace(P,function(e){return"\\"+M[e]});if(i){r+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"}if(n){r+="'+\n((__t=("+n+"))==null?'':__t)+\n'"}if(o){r+="';\n"+o+"\n__p+='"}s=a+t.length;return t});r+="';\n";if(!i.variable){r="with(obj||{}){\n"+r+"}\n"}r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{n=new Function(i.variable||"obj","_",r)}catch(a){a.source=r;throw a}if(t){return n(t,C)}var c=function(e){return n.call(this,e,C)};c.source="function("+(i.variable||"obj")+"){\n"+r+"}";return c};C.chain=function(e){return C(e).chain()};var H=function(e){return this._chain?C(e).chain():e};C.mixin(C);j(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];C.prototype[e]=function(){var i=this._wrapped;t.apply(i,arguments);if((e=="shift"||e=="splice")&&i.length===0){delete i[0]}return H.call(this,i)}});j(["concat","join","slice"],function(e){var t=n[e];C.prototype[e]=function(){return H.call(this,t.apply(this._wrapped,arguments))}});C.extend(C.prototype,{chain:function(){this._chain=true;return this},value:function(){return this._wrapped}})}).call(this);var machina=function(e,t){var i=[].slice;var n="transition";var o="handler";var s="handling";var r="handled";var a="nohandler";var c="transition";var l="invalidstate";var u="deferred";var f="newfsm";var d={makeFsmNamespace:function(){var e=0;return function(){return"fsm."+e++}}(),getDefaultOptions:function(){return{initialState:"uninitialized",eventListeners:{"*":[]},states:{},eventQueue:[],namespace:d.makeFsmNamespace(),targetReplayState:"",state:t,priorState:t,_priorAction:"",_currentAction:""}}};if(!e.deepExtend){var h={"*":function(e,t,i){e[t]=i},object:function(e,t,i){e[t]=_({},e[t]||{},i)},array:function(t,i,n){t[i]=[];e.each(n,function(e,n){h[m(e)](t[i],n,e)},this)}},g=function(t){if(e.isArray(t)){return"array"}if(e.isDate(t)){return"date"}if(e.isRegExp(t)){return"regex"}return typeof t},m=function(e){var t=g(e);return h[t]?t:"*"},_=function(t){e.each(i.call(arguments,1),function(i){e.each(i,function(e,i){h[m(e)](t,i,e)})});return t};e.mixin({deepExtend:_})}var v=function(t){e.extend(this,t);e.defaults(this,d.getDefaultOptions());this.initialize.apply(this,arguments);w.emit(f,this);if(this.initialState){this.transition(this.initialState)}};e.extend(v.prototype,{initialize:function(){},emit:function(t){var n=arguments;if(this.eventListeners["*"]){e.each(this.eventListeners["*"],function(e){try{e.apply(this,i.call(n,0))}catch(t){reportException(t);log(t.message)}},this)}if(this.eventListeners[t]){e.each(this.eventListeners[t],function(e){try{e.apply(this,i.call(n,1))}catch(t){reportException(t);log(t.message)}},this)}},handle:function(n){if(!this.inExitHandler){var c=this.states,l=this.state,u=i.call(arguments,0),f,d,h,g;this.currentActionArgs=u;if(c[l][n]||c[l]["*"]||this["*"]){f=c[l][n]?n:"*";h=f==="*";if(c[l][f]){d=c[l][f];g=l+"."+f}else{d=this["*"];g="*"}if(!this._currentAction){this._currentAction=g}this.emit.call(this,s,{inputType:n,args:u.slice(1)});if(e.isFunction(d)){d=d.apply(this,h?u:u.slice(1))}if(e.isString(d)){this.transition(d)}this.emit.call(this,r,{inputType:n,args:u.slice(1)});this._priorAction=this._currentAction;this._currentAction="";this.processQueue(o)}else{this.emit.call(this,a,{inputType:n,args:u.slice(1)})}this.currentActionArgs=t}},transition:function(e){if(!this.inExitHandler&&e!==this.state){var t;if(this.states[e]){this.targetReplayState=e;this.priorState=this.state;this.state=e;t=this.priorState;if(this.states[t]&&this.states[t]._onExit){this.inExitHandler=true;this.states[t]._onExit.call(this);this.inExitHandler=false}this.emit.call(this,c,{fromState:t,action:this._currentAction,toState:e});if(this.states[e]._onEnter){try{this.states[e]._onEnter.call(this)}catch(i){reportException(i);log(i.message)}}if(this.targetReplayState===e){this.processQueue(n)}return}this.emit.call(this,l,{state:this.state,attemptedState:e})}},processQueue:function(t){var i=t===n?function(e){return e.type===n&&(!e.untilState||e.untilState===this.state)}:function(e){return e.type===o};var s=e.filter(this.eventQueue,i,this);this.eventQueue=e.difference(this.eventQueue,s);e.each(s,function(e){this.handle.apply(this,e.args)},this)},clearQueue:function(t,i){if(!t){this.eventQueue=[]}else{var s;if(t===n){s=function(e){return e.type===n&&(i?e.untilState===i:true)}}else{if(t===o){s=function(e){return e.type===o}}}this.eventQueue=e.filter(this.eventQueue,s)}},deferUntilTransition:function(e){if(this.currentActionArgs){var t={type:n,untilState:e,args:this.currentActionArgs};this.eventQueue.push(t);this.emit.call(this,u,{state:this.state,queuedArgs:t})}},deferUntilNextHandler:function(){if(this.currentActionArgs){var e={type:n,args:this.currentActionArgs};this.eventQueue.push(e);this.emit.call(this,u,{state:this.state,queuedArgs:e})}},on:function(e,t){var i=this;if(!i.eventListeners[e]){i.eventListeners[e]=[]}i.eventListeners[e].push(t);return{eventName:e,callback:t,off:function(){i.off(e,t)}}},off:function(t,i){if(!t){this.eventListeners={}}else{if(this.eventListeners[t]){if(i){this.eventListeners[t]=e.without(this.eventListeners[t],i)}else{this.eventListeners[t]=[]}}}}});v.prototype.trigger=v.prototype.emit;var p=function(){};var b=function(t,i,n){var o;if(i&&i.hasOwnProperty("constructor")){o=i.constructor}else{o=function(){t.apply(this,arguments)}}e.deepExtend(o,t);p.prototype=t.prototype;o.prototype=new p;if(i){e.deepExtend(o.prototype,i)}if(n){e.deepExtend(o,n)}o.prototype.constructor=o;o.__super__=t.prototype;return o};v.extend=function(e,t){var i=b(this,e,t);i.extend=this.extend;return i};var w={Fsm:v,utils:d,on:function(e,t){if(!this.eventListeners[e]){this.eventListeners[e]=[]}this.eventListeners[e].push(t);return t},off:function(t,i){if(this.eventListeners[t]){this.eventListeners[t]=e.without(this.eventListeners[t],i)}},trigger:function(t){var n=0,o,s=arguments,r=this.eventListeners[t]||[];if(r&&r.length){e.each(r,function(e){e.apply(null,i.call(s,1))})}},eventListeners:{newFsm:[]}};w.emit=w.trigger;return w}(_);(function(){var e,t,i,n;t=window.device;e={};window.device=e;n=window.navigator.userAgent.toLowerCase();e.safari=function(){return i("safari")&&!e.chrome()};e.chrome=function(){return i("chrome")};e.ios=function(){return e.iphone()||e.ipod()||e.ipad()};e.iphone=function(){return !e.windows()&&i("iphone")};e.ipod=function(){return i("ipod")};e.ipad=function(){return i("ipad")};e.chromeIOS=function(){return i("crios")};e.android=function(){return !e.windows()&&i("android")};e.androidPhone=function(){return e.android()&&i("mobile")};e.androidTablet=function(){return e.android()&&!i("mobile")};e.blackberry=function(){return i("blackberry")||i("bb10")||i("rim")};e.blackberryPhone=function(){return e.blackberry()&&!i("tablet")};e.blackberryTablet=function(){return e.blackberry()&&i("tablet")};e.windows=function(){return i("windows")};e.windowsPhone=function(){return e.windows()&&i("phone")};e.windowsTablet=function(){return e.windows()&&(i("touch")&&!e.windowsPhone())};e.fxos=function(){return(i("(mobile;")||i("(tablet;"))&&i("; rv:")};e.fxosPhone=function(){return e.fxos()&&i("mobile")};e.fxosTablet=function(){return e.fxos()&&i("tablet")};e.meego=function(){return i("meego")};e.cordova=function(){return window.cordova&&location.protocol==="file:"};e.nodeWebkit=function(){return typeof window.process==="object"};e.mobile=function(){return e.androidPhone()||e.iphone()||e.ipod()||e.windowsPhone()||e.blackberryPhone()||e.fxosPhone()||e.meego()};e.tablet=function(){return e.ipad()||e.androidTablet()||e.blackberryTablet()||e.windowsTablet()||e.fxosTablet()};e.desktop=function(){return !e.tablet()&&!e.mobile()};e.television=function(){var e;var t=["googletv","viera","smarttv","internet.tv","netcast","nettv","appletv","boxee","kylo","roku","dlnadoc","roku","pov_tv","hbbtv","ce-html"];e=0;while(e<t.length){if(i(t[e])){return true}e++}return false};e.portrait=function(){return window.innerHeight/window.innerWidth>1};e.landscape=function(){return window.innerHeight/window.innerWidth<1};e.noConflict=function(){window.device=t;return this};i=function(e){return n.indexOf(e)!==-1}}).call(this);function log(){if(!("logs" in config)){return}var e=Array.prototype.slice.call(arguments);if(typeof console!="undefined"&&typeof console.log=="function"){if(window.opera){var t=0;while(t<arguments.length){console.log("Item "+(t+1)+": "+arguments[t]);t++}}else{if(e.length==1&&typeof e[0]=="string"){console.log(e.toString())}else{console.log(e)}}}else{if(typeof console!="undefined"&&typeof console.log=="object"){Function.prototype.call.call(console.log,console,e)}}}var underscore=_.noConflict(),devicejs=device.noConflict();underscore.templateSettings.interpolate=/\{\{(.+?)\}\}/g;var ie8=navigator.appVersion.indexOf("MSIE 8.")==-1?false:true;var ie9=navigator.appVersion.indexOf("MSIE 9.")==-1?false:true;var ie=navigator.appVersion.indexOf("MSIE")==-1?false:true;function addListener(e,t,i){if(e.addEventListener){e.addEventListener(t,i,false)}else{if(e.attachEvent){e.attachEvent("on"+t,function(e){return function(){i.call(e,window.event)}}(e));e=null}}}function removeEvent(e,t,i){if(window.removeEventListener){e.removeEventListener(t,i,false)}else{if(window.detachEvent){var n=function(){i.call(e)};e.detachEvent("on"+t,n)}else{return false}}}function loadScript(e,t,i){var n=document.createElement("script");n.type="text/javascript";if(n.readyState){n.onreadystatechange=function(){if(n.readyState=="loaded"||n.readyState=="complete"){n.onreadystatechange=null;t()}else{i({target:n,readyState:readyState})}}}else{n.onload=function(e){t()};n.onerror=function(e){i(e)}}n.src=e;if(typeof log!="undefined"){log("adding script "+e)}document.getElementsByTagName("head")[0].appendChild(n)}function setIframeLoadCallback(e,t){if(e.readyState){log("Using readyState callback");e.onreadystatechange=function(){if(e.readyState=="loaded"||e.readyState=="complete"){e.onreadystatechange=null;t()}}}else{log("Using onload callback");e.onload=function(){if(e.contentWindow.location.href!="about:blank"){t();e.onload=null}}}}var dateFormat=function(){var e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,t=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,i=/[^-+\dA-Z]/g,n=function(e,t){e=String(e);t=t||2;while(e.length<t){e="0"+e}return e};return function(o,s,r){var a=dateFormat;if(arguments.length==1&&Object.prototype.toString.call(o)=="[object String]"&&!/\d/.test(o)){s=o;o=undefined}if(typeof o==="string"&&isNaN(new Date(o))){o=o.replace(/-/g,"/").replace("T"," ").split(".").shift()+"Z"}o=o?new Date(o):new Date;if(isNaN(o)){throw SyntaxError("invalid date")}s=String(a.masks[s]||s||a.masks["default"]);if(s.slice(0,4)=="UTC:"){s=s.slice(4);r=true}var c=r?"getUTC":"get",l=o[c+"Date"](),u=o[c+"Day"](),f=o[c+"Month"](),d=o[c+"FullYear"](),h=o[c+"Hours"](),g=o[c+"Minutes"](),m=o[c+"Seconds"](),_=o[c+"Milliseconds"](),v=r?0:o.getTimezoneOffset(),p={d:l,dd:n(l),ddd:a.i18n.dayNames[u],dddd:a.i18n.dayNames[u+7],m:f+1,mm:n(f+1),mmm:a.i18n.monthNames[f],mmmm:a.i18n.monthNames[f+12],yy:String(d).slice(2),yyyy:d,h:h%12||12,hh:n(h%12||12),H:h,HH:n(h),M:g,MM:n(g),s:m,ss:n(m),l:n(_,3),L:n(_>99?Math.round(_/10):_),t:h<12?"a":"p",tt:h<12?"am":"pm",T:h<12?"A":"P",TT:h<12?"AM":"PM",Z:r?"UTC":(String(o).match(t)||[""]).pop().replace(i,""),o:(v>0?"-":"+")+n(Math.floor(Math.abs(v)/60)*100+Math.abs(v)%60,4),S:["th","st","nd","rd"][l%10>3?0:(l%100-l%10!=10)*l%10]};return s.replace(e,function(e){return e in p?p[e]:e.slice(1,e.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};function installF9ReloadCss(){$("body").keydown(function(e){if(e.keyCode=="120"){log("reloading css");var t,i,n;i=document.getElementsByTagName("link");for(t=0;t<i.length;t++){n=i[t];if(n.rel.toLowerCase().indexOf("stylesheet")>=0&&n.href){var o=n.href.replace(/(&|%5C?)forceReload=\d+/,"");n.href=o+(o.indexOf("?")>=0?"&":"?")+"forceReload="+(new Date).valueOf()}}}})}var base_langpack={b_onlineCallDefaultText:"\u041f\u043e\u0437\u0432\u043e\u043d\u0438\u0442\u044c \u043d\u0430\u043c \u0431\u0435\u0441\u043f\u043b\u0430\u0442\u043d\u043e!",cw_callAfter:"\u0417\u0432\u043e\u043d\u043e\u043a \u0447\u0435\u0440\u0435\u0437",cw_callButtonText:"\u041f\u0435\u0440\u0435\u0437\u0432\u043e\u043d\u0438\u0442\u044c \u043c\u043d\u0435",cw_callFree:"\u0417\u0432\u043e\u043d\u043e\u043a \u0431\u0435\u0441\u043f\u043b\u0430\u0442\u043d\u044b\u0439. \u0421\u0435\u0440\u0432\u0438\u0441 \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d",cw_chat:"\u0427\u0430\u0442",cw_chatWithOperator:"\u0447\u0430\u0442 \u0441 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u043e\u043c",cw_close:"\u0417\u0430\u043a\u0440\u044b\u0442\u044c",cw_connecting:"\u0421\u043e\u0435\u0434\u0438\u043d\u044f\u0435\u043c",cw_enterPhonePlaceholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448 \u0442\u0435\u043b\u0435\u0444\u043e\u043d",cw_errInfoText:"\u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043f\u043e\u0437\u0432\u043e\u043d\u0438\u0442\u044c \u0435\u0449\u0435 \u0440\u0430\u0437, \u0438\u043b\u0438 \u043d\u0430\u043f\u0438\u0448\u0438\u0442\u0435 \u043d\u0430\u043c \u0432 \u0447\u0430\u0442.",cw_formCenterText:"\u041d\u0435 \u043d\u0430\u0448\u043b\u0438, \u0447\u0442\u043e \u0438\u0441\u043a\u0430\u043b\u0438?",cw_form_second:"\u0441\u0435\u043a\u0443\u043d\u0434\u0443",cw_form_secondd:"\u0441\u0435\u043a\u0443\u043d\u0434",cw_form_seconds:"\u0441\u0435\u043a\u0443\u043d\u0434\u044b",cw_pickUpPhone:"\u0412\u043e\u0437\u044c\u043c\u0438\u0442\u0435 \u0442\u0440\u0443\u0431\u043a\u0443",cw_repeatCall:"\u043f\u0435\u0440\u0435\u0437\u0432\u043e\u043d\u0438\u0442\u044c",cw_repeatCallAgain:"\u041f\u0435\u0440\u0435\u0437\u0432\u043e\u043d\u0438\u0442\u044c \u0435\u0449\u0435 \u0440\u0430\u0437",cw_reportPlaceholder:"\u0421\u043e\u043e\u0431\u0449\u0438\u0442\u0435 \u043e \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0435, \u043c\u044b \u0440\u0430\u0437\u0431\u0435\u0440\u0435\u043c\u0441\u044f!",cw_reportProblem:"\u0441\u043e\u043e\u0431\u0449\u0438\u0442\u044c \u043e \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0435",cw_seconds:"\u0441\u0435\u043a\u0443\u043d\u0434",cw_textSend:"\u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c",cw_thxForCall:"\u0421\u043f\u0430\u0441\u0438\u0431\u043e \u0412\u0430\u043c \u0437\u0430 \u0437\u0432\u043e\u043d\u043e\u043a!",cw_typeInChat:"\u043d\u0430\u043f\u0438\u0441\u0430\u0442\u044c \u0432 \u0447\u0430\u0442",cw_unableToConnect:"\u041d\u0435 \u0441\u043c\u043e\u0433\u043b\u0438 \u0441\u043e\u0435\u0434\u0438\u043d\u0438\u0442\u044c\u0441\u044f?",cw_weCalling:"\u041c\u044b \u0432\u0430\u043c \u0437\u0432\u043e\u043d\u0438\u043c",cw_weRecallAfter:"\u041c\u044b \u043f\u0435\u0440\u0435\u0437\u0432\u043e\u043d\u0438\u043c \u0432\u0430\u043c \u0447\u0435\u0440\u0435\u0437",c_callConnected:"\u0412\u044b\u0437\u043e\u0432 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d",c_callDisconnected:"\u0412\u044b\u0437\u043e\u0432 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d",c_callProcessing:"\u0412\u044b\u0437\u044b\u0432\u0430\u0435\u043c \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0430...",defCallformTitle:"\u041e\u0441\u0442\u0430\u0432\u044c\u0442\u0435 \u0441\u0432\u043e\u0439 \u043d\u043e\u043c\u0435\u0440, \u0438 \u043c\u044b \u043f\u0435\u0440\u0435\u0437\u0432\u043e\u043d\u0438\u043c \u0432\u0430\u043c",defOfflineFormText:"\u041e\u0441\u0442\u0430\u0432\u044c\u0442\u0435 \u0441\u0432\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0432 \u044d\u0442\u043e\u0439 \u0444\u043e\u0440\u043c\u0435, \u0438 \u043c\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u043c \u0435\u0433\u043e \u043d\u0430 e-mail \u0438 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u043e\u0442\u0432\u0435\u0442\u0438\u043c!",defOfflineWidgetLabel:"\u041e\u0442\u043f\u0440\u0430\u0432\u044c\u0442\u0435 \u043d\u0430\u043c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",defOfflineWidgetLabelMobile:"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",defOnlineWidgetLabel:"\u041d\u0430\u043f\u0438\u0448\u0438\u0442\u0435 \u043d\u0430\u043c, \u043c\u044b \u043e\u043d\u043b\u0430\u0439\u043d!",defOnlineWidgetLabelMobile:"\u041a\u043e\u043d\u0441\u0443\u043b\u044c\u0442\u0430\u043d\u0442",defRuleInvitationText:"\u0417\u0434\u0440\u0430\u0432\u0441\u0442\u0432\u0443\u0439\u0442\u0435! \u042f \u043c\u043e\u0433\u0443 \u0432\u0430\u043c \u0447\u0435\u043c-\u0442\u043e \u043f\u043e\u043c\u043e\u0447\u044c?",defRuleRetaining:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435. \u0421\u0435\u0439\u0447\u0430\u0441 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u044b \u0437\u0430\u043d\u044f\u0442\u044b, \u043d\u043e \u0441\u043a\u043e\u0440\u043e \u043a\u0442\u043e-\u043d\u0438\u0431\u0443\u0434\u044c \u043e\u0441\u0432\u043e\u0431\u043e\u0434\u0438\u0442\u0441\u044f \u0438 \u043e\u0442\u0432\u0435\u0442\u0438\u0442 \u0432\u0430\u043c!",lblAgentDisconnected:"\u041e\u043f\u0435\u0440\u0430\u0442\u043e\u0440 \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u043b\u0441\u044f",lblCallMe:"\u041f\u043e\u0437\u0432\u043e\u043d\u0438\u0442\u044c",lblCaptcha:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u043e\u0434 \u0441 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0438",lblCaptchaError:"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u043a\u043e\u0434, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u0435\u0449\u0435 \u0440\u0430\u0437",lblChatEnded:"\u0414\u0438\u0430\u043b\u043e\u0433 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d",lblChatIsOnline:"\u041a\u043e\u043d\u0441\u0443\u043b\u044c\u0442\u0430\u043d\u0442 \u043e\u043d\u043b\u0430\u0439\u043d",lblConnectedToAgent:"\u041d\u0430\u043f\u0438\u0448\u0438\u0442\u0435 \u0412\u0430\u0448\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435!",lblConnectionLost:"\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u043f\u043e\u0442\u0435\u0440\u044f\u043d\u043e. \u0412\u043e\u0441\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u043c...",lblDeclineFile:"\u041e\u0442\u043a\u043b\u043e\u043d\u0438\u0442\u044c",lblDefaultCobrowseComment:"\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435",lblEnterMessageHere:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0436\u043c\u0438\u0442\u0435 Enter",lblEvaluateCancel:"\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c",lblEvaluatePlease:"\u041e\u0446\u0435\u043d\u0438\u0442\u0435 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u043e \u043e\u0431\u0441\u043b\u0443\u0436\u0438\u0432\u0430\u043d\u0438\u044f",lblEvaluateThanks:"\u0421\u043f\u0430\u0441\u0438\u0431\u043e \u0437\u0430 \u043e\u0446\u0435\u043d\u043a\u0443!",lblHangUp:"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435",lblHangUpShort:"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c",lblIntroduceButton:"\u041f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u0438\u0442\u044c\u0441\u044f",lblIntroduceName:"\u0412\u0430\u0448\u0435 \u0438\u043c\u044f",lblIntroduceRequest:"\u041f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u044c\u0442\u0435\u0441\u044c, \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430",lblIntroduceRequestBefore:"\u041f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u044c\u0442\u0435\u0441\u044c \u0438 \u043d\u0430\u0447\u043d\u0438\u0442\u0435 \u0447\u0430\u0442!",lblLeaveMessage:"\u041e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",lblLookingForFreeAgent:"\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0435\u043c\u0441\u044f...",lblMessageError:"\u041a \u0441\u043e\u0436\u0430\u043b\u0435\u043d\u0438\u044e, \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043d\u0435 \u0431\u044b\u043b\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e \u043f\u043e \u0442\u0435\u0445\u043d\u0438\u0447\u0435\u0441\u043a\u0438\u043c \u043f\u0440\u0438\u0447\u0438\u043d\u0430\u043c",lblMessageHere:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",lblNegative:"\u041f\u043b\u043e\u0445\u043e",lblNewMessage:"\u041d\u043e\u0432\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435!",lblNoOperators:"\u041a \u0441\u043e\u0436\u0430\u043b\u0435\u043d\u0438\u044e, \u0441\u0435\u0439\u0447\u0430\u0441 \u043d\u0438\u043a\u0442\u043e \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u043e\u0442\u0432\u0435\u0442\u0438\u0442\u044c",lblOfflineMessageSend:"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e",lblOperatorsOnline:"\u041e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u044b \u043e\u043d\u043b\u0430\u0439\u043d",lblPencilHint:"\u041e\u043f\u0435\u0440\u0430\u0442\u043e\u0440 \u043d\u0430\u0431\u0438\u0440\u0430\u0435\u0442 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",lblPhoneHint:"\u041d\u0430\u0436\u043c\u0438\u0442\u0435 \u00ab\u0420\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c\u00bb, \u0447\u0442\u043e\u0431\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043c\u0438\u043a\u0440\u043e\u0444\u043e\u043d \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430 \u0434\u043b\u044f \u0440\u0430\u0437\u0433\u043e\u0432\u043e\u0440\u0430.\r\n\u0412\u0430\u0448\u0430 \u0432\u0435\u0431-\u043a\u0430\u043c\u0435\u0440\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u043d\u0435 \u0431\u0443\u0434\u0435\u0442",lblPositive:"\u0425\u043e\u0440\u043e\u0448\u043e",lblPwrBy:'\u0427\u0430\u0442 \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d <a href="http://jivosite.ru/_URL_" target="_blank"><span class="j1">Jivo</span><span class="j2">Site</span></a>',lblReceiveFile:"\u041f\u0440\u0438\u043d\u044f\u0442\u044c",lblReopenedElseWhere:"\u0414\u0438\u0430\u043b\u043e\u0433 \u043e\u0442\u043a\u0440\u044b\u0442 \u0432 \u0434\u0440\u0443\u0433\u043e\u043c \u043e\u043a\u043d\u0435",lblReply:"\u041e\u0442\u0432\u0435\u0442\u0438\u0442\u044c",lblSelectDep:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0442\u0434\u0435\u043b",lblSend:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c",lblSendBefore:"\u041d\u0430\u0447\u0430\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433",lblSendingFile:"_AGENT_ \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0442 \u0412\u0430\u043c \u0444\u0430\u0439\u043b: _FILE_",lblThanks:"\u0421\u043f\u0430\u0441\u0438\u0431\u043e!",lblThankYouMessage:"\u0421\u043f\u0430\u0441\u0438\u0431\u043e \u0437\u0430 \u0432\u0430\u0448\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435! \u041c\u044b&nbsp;\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0441\u0432\u044f\u0436\u0435\u043c\u0441\u044f \u0441&nbsp;\u0412\u0430\u043c\u0438 \u0432 \u0431\u043b\u0438\u0436\u0430\u0439\u0448\u0435\u0435 \u0432\u0440\u0435\u043c\u044f",lblTransferred:"\u0414\u0438\u0430\u043b\u043e\u0433 \u043f\u0435\u0440\u0435\u0434\u0430\u043d \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0443 _AGENT_",lblView:"\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c",lblWaitForOperator:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430 \u043e\u0436\u0438\u0434\u0430\u0439\u0442\u0435 \u043e\u0442\u0432\u0435\u0442\u0430 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0430...",lblWebPhoneFlashError:"\u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u0430\u044f \u0432\u0435\u0440\u0441\u0438\u044f Flash \u043d\u0435 \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0441\u043e\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u044b\u0437\u043e\u0432. \u0412\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0432\u043e\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0447\u0430\u0442\u043e\u043c",lblWebPhoneMicError:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043c\u0438\u043a\u0440\u043e\u0444\u043e\u043d. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u043e\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435\u0441\u044c \u0447\u0430\u0442\u043e\u043c",lblWebPhoneNotAvail:"\u0412\u044b\u0437\u043e\u0432 \u043d\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u0435\u043d \u0438\u0437-\u0437\u0430 \u043f\u0440\u043e\u0431\u043b\u0435\u043c \u0441 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435\u043c. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u043e\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435\u0441\u044c \u0447\u0430\u0442\u043e\u043c",lblWebPhoneNotConnected:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0433\u043e\u043b\u043e\u0441\u043e\u0432\u043e\u0435 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u043e\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435\u0441\u044c \u0447\u0430\u0442\u043e\u043c",lblYourEmail:"\u0412\u0430\u0448 E-mail",lblYourMessage:"\u0412\u0430\u0448\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",lblYourPhone:"\u0412\u0430\u0448 \u0442\u0435\u043b\u0435\u0444\u043e\u043d",lnkCloseThisWindow:"\u0417\u0430\u043a\u0440\u044b\u0442\u044c",lnkRestartChat:"\u0412\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c",ofl_enterEmail:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 e-mail",ofl_enterMessage:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",ofl_enterName:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u0438\u043c\u044f",ofl_enterValidEmail:"\u0423\u043a\u0430\u0437\u0430\u043d \u043d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 e-mail",ofl_enterValidPhone:"\u0423\u043a\u0430\u0437\u0430\u043d \u043d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u0442\u0435\u043b\u0435\u0444\u043e\u043d",seo_copyrightTextNew:"\u0427\u0430\u0442 \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d _JIVOSITE_"};function translate(e){if("custom_langpack" in config&&e in config.custom_langpack){return config.custom_langpack[e].replace(/\n/g,"<br />").replace(/'/g,"&#039;")}return translate_basic(e)}function translate_basic(e){if(e in base_langpack){return base_langpack[e].replace(/\n/g,"<br />")}return e}function reductionTranslate(e){if(config.locale="ru_RU"){return e.substr(0,4)}return e}function cookie(e,t,i){if(e!="__utmz"){e=["jv",e,config.widget_id].join("_")}if(arguments.length>1&&String(t)!=="[object Object]"){if(typeof i==="undefined"){i={}}if(t===null||t===undefined){log("Clearing COOKIE "+e);i.expires=-1}else{log("Set COOKIE "+e+" with value "+t)}if(typeof i.expires==="number"){var n=i.expires,o=i.expires=new Date;o.setDate(o.getDate()+n)}t=String(t);return document.cookie=[encodeURIComponent(e),"=",encodeURIComponent(t),i.expires?"; expires="+i.expires.toUTCString():"",config.cookie_domain&&!jivo.isSeparateWindow()?"; domain="+config.cookie_domain:"","; path=/"].join("")}i=t||{};var s,r=i.raw?function(e){return e}:decodeURIComponent;return(s=new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)").exec(document.cookie))?r(s[1]):null}function getJSONP(e,t){var i=new jivoXHR;i.open("GET",e);i.onload=t;i.send()}function getJSONPWithData(e,t,i){e+="?cb=?";t.t=(new Date).getTime();for(var n in t){e+="&"+n+"="+encodeURIComponent(t[n])}return getJSONP(e,i)}var error_sent_cnt=0;function reportException(e){if("production"=="production"){if(++error_sent_cnt>3){return}try{getJSONPWithData("//err.jivosite.com/widget",{widget_id:config.widget_id,message:e.message,url:window.top.location.href,lineNumber:e.lineNumber,fileName:e.fileName},function(e){log(e)})}catch(e){log(e.message)}}else{log("REPORT",e)}}function setUTMParams(e){var t=e.substr(e.indexOf("?")+1),i=t.split("&"),n,o,s="";for(o=i.length;o--;){n=i[o].split("=");if(n[0].indexOf("utm_")>=0){n=i[o];s+=(s.length>0?"|":"")+n.substr(n.indexOf("utm_")+4)}}if(s){cookie("utm",s)}}function createXPathFromElement(e){var t=document.getElementsByTagName("*");for(segs=[];e&&e.nodeType==1;e=e.parentNode){if(e.hasAttribute("id")){var n=0;for(var o=0;o<t.length;o++){if(t[o].hasAttribute("id")&&t[o].id==e.id){n++}if(n>1){break}}if(n==1){segs.unshift('id("'+e.getAttribute("id")+'")');return segs.join("/")}else{segs.unshift(e.localName.toLowerCase()+'[@id="'+e.getAttribute("id")+'"]')}}else{if(e.hasAttribute("class")){segs.unshift(e.localName.toLowerCase()+'[@class="'+e.getAttribute("class")+'"]')}else{for(i=1,sib=e.previousSibling;sib;sib=sib.previousSibling){if(sib.localName==e.localName){i++}}segs.unshift(e.localName.toLowerCase()+"["+i+"]")}}}return segs.length?"/"+segs.join("/"):null}function highlightUrls(e){var t=/(\s|"|'|^)((?:(?:http|https|ftp|ftps|mailto):\/\/)?)((?:[a-zA-Zа-яА-Я0-9]|[\~\!\#$\%\^\&\*\(\)\+\=\_\-\:\;?\/\[\]\{\}\`\.]|(?:,(?!\s)))*\.(?:рф|com|aero|biz|com|coop|edu|eu|gov|info|int|mil|museum|name|net|org|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tm|tn|to|tp|tr|tt|tv|tw|tz|travel|xxx|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw)(?:[a-zA-Zа-яА-Я0-9]|[\~\!\#$\%\^\&\*\(\)\+\=\_\-\:\;?\/\[\]\{\}\`\.]|(?:,(?!\s)))*)/gim;return stripBrackets(e).replace(t,function(e,t,i,n){if(!i){i="http://"}var o=document.domain;o=o.replace("www.","");if(n.indexOf(o,0)==-1){var s="_blank"}else{var s="col_old_page"}return t+"<a href='"+i+n+"' target='"+s+"'>"+n+"</a>"})}function nl2br(e){return e.replace(/\n/g,"<br />")}function stripBrackets(e){if(underscore.isUndefined(e)){return""}else{return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}}var CLASS_LIST_SUPPORTED="classList" in document.documentElement;function splitClasses(e){return underscore.isArray(e)?e:e.replace(/^\s+|\s+$/g,"").split(/\s+/)}function forseRedraw(e){e.offsetHeight}function getClasses(e){return splitClasses(e.className)}function setClasses(e,t){var i=t.join(" ");if(e.className!==i){e.className=i;forseRedraw(e)}}var hasClass=CLASS_LIST_SUPPORTED?function e(t,i){return t.classList.contains(i)}:function t(e,i){return e.className!==""&&underscore.contains(getClasses(e),i)};var addClass=CLASS_LIST_SUPPORTED?function n(e,t){underscore.each(splitClasses(t),function(t){e.classList.add(t)});forseRedraw(e)}:function o(e,t){var i=getClasses(e),n=underscore.union(i,splitClasses(t));setClasses(e,n)};var removeClass=CLASS_LIST_SUPPORTED?function s(e,t){underscore.each(splitClasses(t),function(t){e.classList.remove(t)});forseRedraw(e)}:function r(e,t){var i=getClasses(e),n=underscore.difference(i,splitClasses(t));setClasses(e,n)};var toggleClass=CLASS_LIST_SUPPORTED?function a(e,t,i){t=underscore.uniq(splitClasses(t));underscore.each(t,function(t){e.classList.toggle(t,i)});forseRedraw(e)}:function c(e,t,i){var n=getClasses(e),o=[],s=[],r;underscore.each(splitClasses(t),function(e){var t=underscore.contains(n,e)?i!==true&&s:i!==false&&o;if(t){t.push(e)}});r=underscore.union(underscore.difference(n,s),o);setClasses(e,r)};function removeProperty(e,t){if(e.style.removeProperty){e.style.removeProperty(t)}else{e.style.removeAttribute(t)}}function removeElement(e){e.parentNode.removeChild(e)}function prefixedEvent(e,t,i){var n=["webkit","moz","MS","o",""];for(var o=0;o<n.length;o++){if(!n[o]){t=t.toLowerCase()}e.addEventListener(n[o]+t,i,false)}}function css3AnimationIsSupported(){var e=utils.browser,t=e.name;return !!(t==="Firefox"&&e.mV>23||t==="Chrome"&&e.mV>28||t==="Safari"&&e.mV>5)}function switchClasses(e,t,i){removeClass(e,t);addClass(e,i)}function getOffsetRect(e){var t=e.getBoundingClientRect();var i=document.body;var n=document.documentElement;var o=window.pageYOffset||n.scrollTop||i.scrollTop;var s=window.pageXOffset||n.scrollLeft||i.scrollLeft;var r=n.clientTop||i.clientTop||0;var a=n.clientLeft||i.clientLeft||0;var c=t.top+o-r;var l=t.left+s-a;return{top:Math.round(c),left:Math.round(l)}}function getElementPosition(e){function t(e){return e.compatMode&&e.compatMode!="BackCompat"?e.documentElement:e.body}var i=e.ownerDocument,n=i.all&&!window.opera,o=n?t(i):i.defaultView||i.parentWindow,s={left:0,top:0},r;if(e.getBoundingClientRect){s=underscore.extend(s,e.getBoundingClientRect())}else{r=e;while(r){s.left+=r.offsetLeft;s.top+=r.offsetTop;r=r.offsetParent}}s.width=e.offsetWidth;s.height=e.offsetHeight;s.windowWidth=n?o.clientWidth:o.innerWidth;s.windowHeight=n?o.clientHeight:o.innerHeight;return s}function setElementPosition(e,t){e.style.cssText+="; top: "+t.top+"px; left : "+t.left+"px; width : "+t.width+"px; height: "+t.height+"px";return this}function setSubstrTitle(e){return e.substr(0,255)}function getConfigContactsAsk(){var e=true;underscore.each(["name","phone","email"],function(t){if(config.contacts_settings[t].show){e=false}},this);if(e){config.contacts_ask=2}}function getIconLocale(){if(config.iconLocale===undefined){var e=underscore.find(["ru_RU","be","kk","uk"],function(e){return e===config.locale});config.iconLocale=e?e:"en"}return config.iconLocale}function getURLParam(e,t){var i=(t||window.location||"").search.substring(1);var n=i.split("&");for(var o=0;o<n.length;o++){var s=n[o].split("=");if(s[0]==e){return decodeURIComponent(s[1])}}}function getByIdFromParent(e){var t=window.parent.document,i=t.getElementById(e);return i&&$(i)}var utils={fields:["client_name","phone","email"],showAd:function(){return !(config.options&8&&config.hide_ad)},hideOffline:function(){return config.hide_offline>0&&config.options&512},isValidValue_phone:function(e){return e.replace(/\D+/g,"").length>=5&&/^\+?[0-9() -]+$/i.test(e)},isValidValue_email:function(e){return e.length>=4&&/^.+@.+\..+$/i.test(e)},isValidValue_name:function(e){return e.length>0}};(function(e){if(e.browser){return}e.browser={};e.browser.mozilla=false;e.browser.webkit=false;e.browser.opera=false;e.browser.msie=false;var t=navigator.userAgent;e.browser.ua=t;e.browser.name=navigator.appName;e.browser.fV=""+parseFloat(navigator.appVersion);e.browser.mV=parseInt(navigator.appVersion,10);var i,n,o;if((n=t.indexOf("Opera"))!=-1){e.browser.opera=true;e.browser.name="Opera";e.browser.fV=t.substring(n+6);if((n=t.indexOf("Version"))!=-1){e.browser.fV=t.substring(n+8)}}else{if((n=t.indexOf("MSIE"))!=-1){e.browser.msie=true;e.browser.name="Microsoft Internet Explorer";e.browser.fV=t.substring(n+5)}else{if(t.indexOf("Trident")!=-1){e.browser.msie=true;e.browser.name="Microsoft Internet Explorer";var s=t.indexOf("rv:")+3;var r=s+4;e.browser.fV=t.substring(s,r)}else{if((n=t.indexOf("Chrome"))!=-1){e.browser.webkit=true;e.browser.name="Chrome";e.browser.fV=t.substring(n+7)}else{if((n=t.indexOf("Safari"))!=-1){e.browser.webkit=true;e.browser.name="Safari";e.browser.fV=t.substring(n+7);if((n=t.indexOf("Version"))!=-1){e.browser.fV=t.substring(n+8)}}else{if((n=t.indexOf("AppleWebkit"))!=-1){e.browser.webkit=true;e.browser.name="Safari";e.browser.fV=t.substring(n+7);if((n=t.indexOf("Version"))!=-1){e.browser.fV=t.substring(n+8)}}else{if((n=t.indexOf("Firefox"))!=-1){e.browser.mozilla=true;e.browser.name="Firefox";e.browser.fV=t.substring(n+8)}else{if((i=t.lastIndexOf(" ")+1)<(n=t.lastIndexOf("/"))){e.browser.name=t.substring(i,n);e.browser.fV=t.substring(n+1);if(e.browser.name.toLowerCase()==e.browser.name.toUpperCase()){e.browser.name=navigator.appName}}}}}}}}}if((o=e.browser.fV.indexOf(";"))!=-1){e.browser.fV=e.browser.fV.substring(0,o)}if((o=e.browser.fV.indexOf(" "))!=-1){e.browser.fV=e.browser.fV.substring(0,o)}e.browser.mV=parseInt(""+e.browser.fV,10);if(isNaN(e.browser.mV)){e.browser.fV=""+parseFloat(navigator.appVersion);e.browser.mV=parseInt(navigator.appVersion,10)}e.browser.version=e.browser.mV})(utils);function staticUrl(e,t){if(!t){e+="?rnd=100637"}if(config.static_host){return"//"+config.static_host+e}return config.base_url+e}function chatServerUrl(){var e=window.location.protocol+"//";if("comet" in config){e+=config.comet.host;if(window.location.protocol=="https:"){if("secure_port" in config.comet){e+=":"+config.comet.secure_port}}else{if("plain_port" in config.comet){e+=":"+config.comet.plain_port}}}else{e+="node.jivosite.com"}return e+"/jsonp/"+underscore.toArray(arguments).join("/")}function hexToR(e){return parseInt(cutHex(e).substring(0,2),16)}function hexToG(e){return parseInt(cutHex(e).substring(2,4),16)}function hexToB(e){return parseInt(cutHex(e).substring(4,6),16)}function cutHex(e){return e.charAt(0)=="#"?e.substring(1,7):e}function rgbToHex(e,t,i){return toHex(e)+toHex(t)+toHex(i)}function toHex(e){e=parseInt(e,10);if(isNaN(e)){return"00"}e=Math.max(0,Math.min(e,255));return"0123456789ABCDEF".charAt((e-e%16)/16)+"0123456789ABCDEF".charAt(e%16)}function adjustLightness(e,t,i){var n=hexToR(e);var o=hexToG(e);var s=hexToB(e);log("r="+n+" g="+o+" b="+s);var r=ColorConverter.toHSV(new RGB(n,o,s));if(r.v>0){r.v=r.v*t}else{r.v=100*(t-1)}r.s=r.s*i;var a=ColorConverter.toRGB(r);var c=rgbToHex(a.r,a.g,a.b);return"#"+c}function getLightness(e){var t=hexToR(e);var i=hexToG(e);var n=hexToB(e);var o=ColorConverter.toHSV(new RGB(t,i,n));log("hsv.v="+o.v);return o.v}function isLightColor(e){return getLightness(e)>65}function HSV(e,t,i){if(e<=0){e=0}if(t<=0){t=0}if(i<=0){i=0}if(e>360){e=360}if(t>100){t=100}if(i>100){i=100}this.h=e;this.s=t;this.v=i}function RGB(e,t,i){if(e<=0){e=0}if(t<=0){t=0}if(i<=0){i=0}if(e>255){e=255}if(t>255){t=255}if(i>255){i=255}this.r=e;this.g=t;this.b=i}function CMYK(e,t,i,n){if(e<=0){e=0}if(t<=0){t=0}if(i<=0){i=0}if(n<=0){n=0}if(e>100){e=100}if(t>100){t=100}if(i>100){i=100}if(n>100){n=100}this.c=e;this.m=t;this.y=i;this.k=n}var ColorConverter={_RGBtoHSV:function(e){var t=new HSV(0,0,0);var i=e.r/255;var n=e.g/255;var o=e.b/255;var s=Math.min(i,n,o);var r=Math.max(i,n,o);var a=r-s;t.v=r;if(a==0){t.h=0;t.s=0}else{t.s=a/r;var c=((r-i)/6+a/2)/a;var l=((r-n)/6+a/2)/a;var u=((r-o)/6+a/2)/a;if(i==r){t.h=u-l}else{if(n==r){t.h=1/3+c-u}else{if(o==r){t.h=2/3+l-c}}}if(t.h<0){t.h+=1}if(t.h>1){t.h-=1}}t.h=Math.round(t.h*360);t.s=Math.round(t.s*100);t.v=Math.round(t.v*100);return t},_HSVtoRGB:function(e){var t=new RGB(0,0,0);var i=e.h/360;var n=e.s/100;var o=e.v/100;if(n==0){t.r=o*255;t.g=o*255;t.b=o*255}else{var s=i*6;var r=Math.floor(s);var a=o*(1-n);var c=o*(1-n*(s-r));var l=o*(1-n*(1-(s-r)));if(r==0){var_r=o;var_g=l;var_b=a}else{if(r==1){var_r=c;var_g=o;var_b=a}else{if(r==2){var_r=a;var_g=o;var_b=l}else{if(r==3){var_r=a;var_g=c;var_b=o}else{if(r==4){var_r=l;var_g=a;var_b=o}else{var_r=o;var_g=a;var_b=c}}}}}t.r=var_r*255;t.g=var_g*255;t.b=var_b*255;t.r=Math.round(t.r);t.g=Math.round(t.g);t.b=Math.round(t.b)}return t},_CMYKtoRGB:function(e){var t=new RGB(0,0,0);var i=e.c/100;var n=e.m/100;var o=e.y/100;var s=e.k/100;t.r=1-Math.min(1,i*(1-s)+s);t.g=1-Math.min(1,n*(1-s)+s);t.b=1-Math.min(1,o*(1-s)+s);t.r=Math.round(t.r*255);t.g=Math.round(t.g*255);t.b=Math.round(t.b*255);return t},_RGBtoCMYK:function(e){var t=new CMYK(0,0,0,0);var i=e.r/255;var n=e.g/255;var o=e.b/255;t.k=Math.min(1-i,1-n,1-o);t.c=(1-i-t.k)/(1-t.k);t.m=(1-n-t.k)/(1-t.k);t.y=(1-o-t.k)/(1-t.k);t.c=Math.round(t.c*100);t.m=Math.round(t.m*100);t.y=Math.round(t.y*100);t.k=Math.round(t.k*100);return t},toRGB:function(e){if(e instanceof RGB){return e}if(e instanceof HSV){return this._HSVtoRGB(e)}if(e instanceof CMYK){return this._CMYKtoRGB(e)}},toHSV:function(e){if(e instanceof HSV){return e}if(e instanceof RGB){return this._RGBtoHSV(e)}if(e instanceof CMYK){return this._RGBtoHSV(this._CMYKtoRGB(e))}},toCMYK:function(e){if(e instanceof CMYK){return e}if(e instanceof RGB){return this._RGBtoCMYK(e)}if(e instanceof HSV){return this._RGBtoCMYK(this._HSVtoRGB(e))}}};machina.on("newfsm",function(e){e.on("handling",function(e){log(this.namespace+": handling "+e.inputType+" in state "+this.state)});e.on("nohandler",function(e){log(this.namespace+": unhandled "+e.inputType+" in state "+this.state)});e.on("transition",function(e){log([this.namespace+":","transition from:",e.fromState,"to:",e.toState,"action:",e.action].join(" "))})});var TimeMachine=machina.Fsm.extend({_fireEvent:function(e){delete this._scheduled_events[e];this.handle(e)},_scheduleEvent:function(e,t){if(!(e in this._scheduled_events)){log(this.namespace+": scheduling "+e+" for "+t);this._scheduled_events[e]=setTimeout(underscore.bind(this._fireEvent,this,e),t)}else{log(this.namespace+": attempt to re-schedule event"+e)}},_cancelEvent:function(e){if(e in this._scheduled_events){clearTimeout(this._scheduled_events[e]);delete this._scheduled_events[e]}else{log(this.namespace+": attempt to cancel not scheduled event",e)}},constructor:function(){this._scheduled_events={};machina.Fsm.apply(this,arguments)}});var Rule=TimeMachine.extend({initialize:function(){this.namespace="RULE#"+this.name.replace(" ","_");this.initialState="unreachable";var e=[],t=false,i;while(i=this.conditions.pop()){if(this.isTimeCondition(i)){e.push(i)}else{if(this.isABTestCondition(i)){this.ab_test_group=i.value;if(!cookie("ab_test_group")){var n=Math.round(Math.random()),o=i.group_name?i.group_name:"JivoSite A/B Group";cookie("ab_test_group",n?"group_a":"group_b");analytics.setABTestGroupContacts(o,n?"Group A":"Group B")}}else{if(i.condition==="page_url"){i.value=i.value.replace("http://","").replace("https://","")}if(this.checkCondition(i)){t=true}else{if(this.type==="all"){return}}}}}if(e.length>0){this.conditions=e;if(this.checkTimeConditions()){this.initialState="triggered"}else{this.initialState="time_wait"}return}if(t){this.initialState="triggered"}},checkTimeConditions:function(){var e=false;for(var t=0;t<this.conditions.length;t++){if(this.checkCondition(this.conditions[t])){e=true}else{if(this.type==="all"){return false}}}return e},isTimeCondition:function(e){return e.condition.indexOf("time")>=0},isABTestCondition:function(e){return e.condition==="ab_test_group"},checkCondition:function(e){var t=this.getValue(e.condition);var i=this.compare(t,e.value,e.comparator);if(!i){log(this.namespace+": failed condition "+e.condition+"; expected="+e.value+"; actual="+t)}return i},getValue:function(e){switch(e){case"online":return config.chat_mode==="online";case"page_url":return window.location.href.replace("http://","").replace("https://","");case"hour":return(new Date).getHours();case"page_title":return document.title;case"week_day":return(new Date).getDay();case"time_after_close":var t=cookie("close_time");return t===null?Number.MAX_VALUE:this.timeDiff(t);case"time_after_first_message":return ruleManager.firstMessageTime!==null?this.timeDiff(ruleManager.firstMessageTime.getTime()):NaN;case"time_after_invitation":var i=cookie("invitation_time");return i===null||i===""?Number.MAX_VALUE:this.timeDiff(i);case"time_on_page":return this.timeDiff(ruleManager.pageEnterTime);case"time_on_site":return this.timeDiff(cookie("enter_ts"));default:return cookie(e)}},timeDiff:function(e){return Math.round(((new Date).getTime()-e)/1000)},compare:function(e,t,i){switch(i){case"contain":return e.toLowerCase().indexOf(t.toLowerCase())!=-1;case"greater":return e>t;case"greater_equal":return e>=t;case"lower":return e<t;case"lower_equal":return e<=t;case"not_contain":return e.toLowerCase().indexOf(t.toLowerCase())===-1;case"not_equal":return t!=e;case"regexp":return new RegExp(e,"i").test(t);default:return t===e}},states:{time_wait:{_onEnter:function(){this._scheduleEvent("tick",1000)},tick:function(){if(this.checkTimeConditions()){this.transition("triggered")}else{this._scheduleEvent("tick",1000)}},cancel:"unreachable"},unreachable:{},triggered:{_onEnter:function(){var e=this.commands[0];if(!this.ab_test_group||this.ab_test_group&&this.ab_test_group===cookie("ab_test_group")){switch(e.command){case"proactive":ruleManager.showProactive(e.params.message,e.params.department,this.name);break;case"open_offline":if(config.chat_mode==="online"){return}cookie("invitation_time",(new Date).getTime());if(e.params){if(e.params.title){config.offline_form_title=e.params.title}if(e.params.message){config.offline_form_text=e.params.message}}if(!jivo.isMobileOrTablet()){setTimeout(underscore.bind(jivo.handle,jivo,"gui_maximize"),0)}break;case"hide":jivo.handle("hide");break;case"system_message":jivo.handle("system_message",{message:e.params.message});break}}}}}});var ruleManager=new TimeMachine({initialState:false,isInited:false,namespace:"ruleManager",rules:[],init:function(){underscore.defaults(config,{rules:[]});this.pageEnterTime=(new Date).getTime();if(!cookie("pages_count")){cookie("pages_count",1)}else{cookie("pages_count",parseInt(cookie("pages_count"))+1)}jivo.on("handling",underscore.bind(this.onJivoHandling,this));if(config.rules.length==0&&underscore.isArray(config.proactive_rules)&&config.proactive_rules.length>0){this.importLegacy();this.transition("ready");return}if(this.needGeo()){this.transition("fetch_geo");return}this.isInited=true;this.transition("ready")},needGeo:function(){var e,t;for(var i=0;i<config.rules.length;i++){e=config.rules[i];for(var n=0;n<e.conditions.length;n++){t=e.conditions[n];if(t.condition=="country"||t.condition=="city"){if(cookie("country")==null){return true}}}}return false},states:{fetch_geo:{_onEnter:function(){getJSONP(config.base_url+"/script/geo?cb=?",underscore.bind(this.handle,this,"geo_data"))},geo_data:function(e){cookie("country",e.country,{expires:1});cookie("city",e.city,{expires:1});this.transition("ready")}},ready:{_onEnter:function(){for(var e=0;e<config.rules.length;e++){this.rules.push(new Rule(config.rules[e]))}log(this.namespace+": rules count="+this.rules.length+"; wait count="+underscore.where(this.rules,{state:"time_wait"}).length);this.emit("ready")}}},firstMessageTime:null,canInvite:true,importLegacy:function(){log(this.namespace+": importing from proactive_rules");var e;var t=["contain","equal","regexp"];for(var i=0;i<config.proactive_rules.length;i++){e=config.proactive_rules[i];underscore.defaults(e,{name:e.invitationText,urlPrefix:[{url:"/",mm:0}],page_timeout:20,close_timeout:300,enter_timeout:0,pages_count:0});for(var n=0;n<e.urlPrefix.length;n++){config.rules.push({legacyId:e.id,name:e.name,type:"all",conditions:[{condition:"online",value:true},{condition:"time_on_page",comparator:"greater_equal",value:e.page_timeout},{condition:"time_after_close",comparator:"greater_equal",value:e.close_timeout},{condition:"time_on_site",comparator:"greater_equal",value:e.enter_timeout},{condition:"pages_count",comparator:"greater_equal",value:e.pages_count},{condition:"page_url",comparator:t[e.urlPrefix[n].mm],value:e.urlPrefix[n].url}],commands:[{command:"proactive",params:{message:e.invitationText}}]})}}},onJivoHandling:function(e){switch(e.inputType){case"gui_minimize":cookie("close_time",(new Date).getTime());break;case"gui_message":if(!this.firstMessageTime){this.firstMessageTime=new Date}this.cancelInvites();break;case"accept":this.allRulesCancel();break;case"gui_maximize":if(1==config.contacts_ask){this.cancelInvites()}break;case"invitation":cookie("invitation_time",(new Date).getTime());break;case"api_open":if(e.args&&typeof e.args[0]==="object"&&e.args[0].start==="call"){this.allRulesCancel()}break}},cancelInvites:function(){log(this.namespace+": cancelInvites");for(var e=0;e<this.rules.length;e++){if(this.rules[e].state=="time_wait"&&this.rules[e].commands[0].command=="proactive"){this.rules[e].handle("cancel")}}this.canInvite=false},allRulesCancel:function(){for(var e=0;e<this.rules.length;e++){if(this.rules[e].state==="time_wait"){this.rules[e].handle("cancel")}}},restoreAgentInfo:function(){var e=cookie("agent_info");if(e){var t=e.split("$$");return{agent_id:t[0]}}return false},showProactive:function(e,t,i){if(!this.canInvite){return}if(typeof e=="number"){var n=parseInt(e),o=false;if(n){for(var s=0;s<this.rules.length;s++){if(this.rules[s].commands[0].command=="proactive"){if(this.rules[s].legacyId==n){e=this.rules[s].commands[0].params.message;log(this.namespace+": legacy rule found by ID="+n+"; message="+e);o=true;break}}}if(!o){log(this.namespace+": legacy rule not found by ID="+n);return}}}this.cancelInvites();var r=this.restoreAgentInfo();var a={name:"active_agent"};if(t&&config.departments&&underscore.findWhere(config.departments,{id:t})){a.department=t}if(r){a.agent_id=r.agent_id}if(cookie("client_id")){a.jv_client_id=cookie("client_id")}getJSONPWithData(chatServerUrl(config.widget_id,config.site_id),a,underscore.bind(jivo.handle,jivo,"invitation",{name:i,invitationText:e}))}});var _templates={content:underscore.template(["<!DOCTYPE html>","<html>","<head>","<meta charset='utf-8'>","<link rel='stylesheet' href='"+staticUrl("/css/chat.css")+"'/>","<!--[if lte IE 8]>","<link rel='stylesheet' href='"+staticUrl("/css/chat-ie8.css")+"' type='text/css' media='all'/>","<![endif]-->","<meta name='viewport' content='width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no'>","<title>{{ title }}</title>","</head>","<body id='inner-chat' <% if (jivo.isTablet()) {%>class='tablet-version-widget'<% } %>>","<div id='web_phone' class='phone_hidden'>","<div id='rtc_placeholder'></div>","<div id='up_arrow'></div>","<div id='phone_hint'></div>","</div>","<div id='sound_player'></div>","<div id='contents_placeholder'></div>","<script src='"+staticUrl("/js/chat_"+config.locale+".js")+"' charset='UTF-8'><\/script>","</body>","</html>"].join("\n")),chat:underscore.template(["<div dir='ltr' class='jivo-triangle-wraper {{ jivo_config.style_string }}'>","<div class='jivo-triangle-clip'>","<div class='jivo-triangle jivo-chat-triangle'><div class='jivo-triangle-inner'></div></div>","<div class='jivo-noise jivo-noise-pattern'></div>","<div class='jivo-css-leaf jivo-{{ jivo_config.chat_mode }} jivo-{{ jivo_config.widget_font_color }}'>","<div class='jivo-top-right-square'>","<div class='jivo-bottom-left-square'></div>","</div>","</div>","</div>","</div>","<div id='jivo-drag-handle'></div>","<div id='jivo-mouse-tracker' style='display: none'></div>","<div dir='ltr' id='jivo_action' class='jivo-{{ mobile }}'>","<div id='jivo_close_button' data-action='close'></div>","</div>","<div id='jivo_iframe_wrap'>","<div id='jivo_iframe_placeholder'></div>","</div>","<div class='jivo-loader' id='jivo-loader'>","<div class='jivo-loader-title' id='jivo-loader-title'>{{ lblLookingForFreeAgent }}</div>","<div class='jivo-loader-inner'></div>","</div>"].join("\n")),label:{top:underscore.template(["<div id='jivo_chat_widget_online'>","<div id='jivo-label' class='jivo-fixed-{{ orientation }} jivo-animate jivo-{{ jivo_config.chat_mode }}'>","<div class='jivo-triangle-wraper {{ jivo_config.style_string }}'>","<div class='jivo-triangle-clip'>","<div class='jivo-triangle jivo-label-triangle'><div class='jivo-triangle-inner'></div></div>","<div class='jivo-noise jivo-noise-pattern-{{ jivo_config.widget_font_color }}'></div>","<div class='jivo-css-leaf jivo-{{ jivo_config.chat_mode }} jivo-{{ jivo_config.widget_font_color }}'>","<div class='jivo-top-right-square'>","<div class='jivo-bottom-left-square'></div>","</div>","</div>","</div>","</div>","<div id='jivo-label-wrapper' style='height: {{ height }}px'>","<div id='jivo-label-copyright' class='jivo-{{ type }} <% if (locale) {%>jivo-{{ locale }}<% } %>'></div>","<div id='jivo-label-text' <% if (locale) {%>class='jivo-{{ locale }}'<% } %>>{{ text }}</div>","<div id='jivo-label-indicator'></div>","<div id='jivo-label-status' class='jivo-{{ type }}'></div>","</div>","</div>","</div>"].join("\n")),bottom:underscore.template(["<div id='jivo_chat_widget_online'>","<div id='jivo-label' class='jivo-fixed-{{ orientation }} jivo-animate jivo-{{ jivo_config.chat_mode }}'>","<div class='jivo-triangle-wraper {{ jivo_config.style_string }}'>","<div class='jivo-triangle-clip'>","<div class='jivo-triangle jivo-label-triangle'><div class='jivo-triangle-inner'></div></div>","<div class='jivo-noise jivo-noise-pattern-{{ jivo_config.widget_font_color }}'></div>","<div class='jivo-css-leaf jivo-{{ jivo_config.chat_mode }} jivo-{{ jivo_config.widget_font_color }}'>","<div class='jivo-top-right-square'>","<div class='jivo-bottom-left-square'></div>","</div>","</div>","</div>","</div>","<div id='jivo-label-wrapper' style='height: {{ height }}px'>","<div id='jivo-label-status' class='jivo-{{ type }}'></div>","<div id='jivo-label-text' <% if (locale) {%>class='jivo-{{ locale }}'<% } %>>{{ text }}</div>","<div id='jivo-label-indicator'></div>","<div id='jivo-label-copyright' class='jivo-{{ type }} <% if (locale) {%>jivo-{{ locale }}<% } %>'></div>","</div>","</div>","</div>"].join("\n")),left:underscore.template(["<div id='jivo_chat_widget_online'>","<div id='jivo-label' class='jivo-fixed-{{ orientation }} jivo-animate jivo-{{ jivo_config.chat_mode }}'>","<div class='jivo-triangle-wraper {{ jivo_config.style_string }}'>","<div class='jivo-triangle-clip'>","<div class='jivo-triangle jivo-label-triangle'><div class='jivo-triangle-inner'></div></div>","<div class='jivo-noise jivo-noise-pattern-{{ jivo_config.widget_font_color }}'></div>","<div class='jivo-css-leaf jivo-{{ jivo_config.chat_mode }} jivo-{{ jivo_config.widget_font_color }}'>","<div class='jivo-top-right-square'>","<div class='jivo-bottom-left-square'></div>","</div>","</div>","</div>","</div>","<div id='jivo-label-wrapper' style='width: {{ height }}px'>","<div id='jivo-label-copyright' class='jivo-{{ type }} <% if (locale) {%>jivo-{{ locale }}<% } %>'></div>","<div id='jivo-label-text' class='jivo-{{ type }} <% if (locale) {%>jivo-{{ locale }}<% } %>'>","<div id='jivo-text-container'>","<div>{{ text }}</div>","</div>","</div>","<div id='jivo-label-status' class='jivo-{{ type }}'></div>","<div id='jivo-label-indicator'></div>","</div>","</div>","</div>"].join("\n")),right:underscore.template(["<div id='jivo_chat_widget_online'>","<div id='jivo-label' class='jivo-fixed-{{ orientation }} jivo-animate jivo-{{ jivo_config.chat_mode }}'>","<div class='jivo-triangle-wraper {{ jivo_config.style_string }}'>","<div class='jivo-triangle-clip'>","<div class='jivo-triangle jivo-label-triangle'><div class='jivo-triangle-inner'></div></div>","<div class='jivo-noise jivo-noise-pattern-{{ jivo_config.widget_font_color }}'></div>","<div class='jivo-css-leaf jivo-{{ jivo_config.chat_mode }} jivo-{{ jivo_config.widget_font_color }}'>","<div class='jivo-top-right-square'>","<div class='jivo-bottom-left-square'></div>","</div>","</div>","</div>","</div>","<div id='jivo-label-wrapper' style='width: {{ height }}px'>","<div id='jivo-label-copyright' class='jivo-{{ type }} <% if (locale) {%>jivo-{{ locale }}<% } %>'></div>","<div id='jivo-label-text' class='jivo-{{ type }} <% if (locale) {%>jivo-{{ locale }}<% } %>'>","<div id='jivo-text-container'>","<div>{{ text }}</div>","</div>","</div>","<div id='jivo-label-status' class='jivo-{{ type }}'></div>","<div id='jivo-label-indicator'></div>","</div>","</div>","</div>"].join("\n"))}};var JivoWidget=TimeMachine.extend({namespace:"WIDG",fade:false,position:{},initialState:"HIDDEN",initialize:function(){this._templateData={orientation:config.widget_orientation,height:config.widget_height,style:config.style_string,text:config.chat_mode=="online"?config.online_widget_label:config.offline_widget_label,type:config.widget_font_color,locale:getIconLocale()};this._widgetDiv=document.createElement("div");this._widgetDiv.onclick=underscore.bind(this.handle,this,"click");this._widgetDiv.setAttribute("id","jivo_chat_widget");this._widgetDiv.innerHTML=_templates.label[config.widget_orientation](this._templateData);this.topWrap.appendChild(this._widgetDiv);this._el=document.getElementById("jivo-label");this.setColor();this.setFontStyle();this.setPosition()},isCustom:function(){var e=this._widgetDiv.currentStyle?this._widgetDiv.currentStyle.display:getComputedStyle(this._widgetDiv,null).display;return e=="none"},states:{VISIBLE:{_onEnter:function(){jivo.transferProportion({width:document.getElementById("jivo-label").offsetWidth,height:config.widget_height-0});this._el.style.display="block";this._el.style.visibility="visible";if(this.fade){addClass(this._el,"jivo-fade-in")}},click:function(){jivo.isClicked=true;jivo.handle("gui_maximize")},hide:"HIDDEN"},HIDDEN:{_onEnter:function(){removeClass(this._el,"jivo-fade-in");this._el.style.visibility="hidden"},show:"VISIBLE",hide:function(){}}},getOffset:function(e){var t=0;var i=0;while(e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop)){t+=e.offsetLeft-e.scrollLeft;i+=e.offsetTop-e.scrollTop;e=e.offsetParent}return{top:i,left:t}},setText:function(e){if(!this._widgetDiv||config.widget_orientation=="left"||config.widget_orientation=="right"){return}var t=document.getElementById("jivo-label-text");t.innerHTML=e;this.setPosition();this.position=getElementPosition(this._el)},setColor:function(){this._containerDiv=document.getElementById("jivo-label-wrapper");this._textContainer=document.getElementById("jivo-label-text");var e=getElementsByClassName("jivo-label-triangle");for(var t=0;t<e.length;t++){switch(config.widget_orientation){case"top":e[t].style.borderTopColor=config.widget_color;break;case"bottom":e[t].style.borderLeftColor=config.widget_color;break;case"right":e[t].style.borderBottomColor=config.widget_color;break;case"left":e[t].style.borderLeftColor=config.widget_color;break}}var e=getElementsByClassName("jivo-triangle-inner");for(var t=0;t<e.length;t++){e[t].style.backgroundColor=config.widget_color}if(config.chat_mode=="offline"){var e=getElementsByClassName("jivo-bottom-left-square");for(var t=0;t<e.length;t++){e[t].style.backgroundColor=config.widget_color}}if(this._containerDiv){this._textContainer.style.fontSize=config.font_size+"px";this._textContainer.style.fontFamily=config.font_family;this._isDarkText=config.widget_font_color=="dark";if(this._isDarkText){var i="#222222"}else{var i="#F0F1F1"}this._textContainer.style.color=i}},setOffline:function(){document.getElementById("jivo_chat_widget_online").setAttribute("id","jivo_chat_widget_offline");this.setText(config.offline_widget_label)},setPosition:function(){var e=getElementPosition(this._el),t=30,i=10;switch(config.widget_orientation){case"left":case"right":var n=document.getElementById("jivo-text-container");var o=n.getElementsByTagName("div")[0];if(o.offsetWidth<o.offsetHeight){n.style.width=o.offsetWidth+"px";n.style.height=o.offsetHeight+"px"}else{n.style.width=o.offsetHeight+"px";n.style.height=o.offsetWidth+"px"}e=getElementPosition(this._el);switch(config.widget_padding){case"0":t=-30;break;case"50":t=e.height/2;break;case"100":t=e.height+i;break}this._el.style.top=config.widget_padding+"%";this._el.style.marginTop=t*-1+"px";this._el.style.width=config.widget_height+"px";break;case"top":case"bottom":switch(config.widget_padding){case"0":t=-30;break;case"50":t=e.width/2;break;case"100":t=e.width+i;break}if(config.widget_padding=="100"){this._el.style.left="";this._el.style.right="30px"}else{this._el.style.left=config.widget_padding+"%";this._el.style.right="";this._el.style.marginLeft=t*-1+"px"}this._el.style.height=config.widget_height+"px";break}},setFontStyle:function(){var e=document.getElementById("jivo-label-text");switch(config.font_type){case"normal":e.style.fontWeight="normal";e.style.fontStyle="normal";break;case"italic":e.style.fontWeight="normal";e.style.fontStyle="italic";break;case"bold":e.style.fontWeight="bold";e.style.fontStyle="normal";break;case"bold italic":e.style.fontWeight="bold";e.style.fontStyle="italic";break}e.style.fontSize=config.font_size},getPosition:function(){return getElementPosition(document.getElementById("jivo-label"))}});var JivoChatTop=TimeMachine.extend({namespace:"CHAT",mode:"online",_scrollOffset:0,_manualyScrolled:0,_chatDiv:0,_iframe:0,_iframeWrap:0,_doc:0,_window:0,_backgroundColor:0,_borderColor:0,_bodyColor:0,_onload_semaphore:false,_event_queue:[],_guiState:null,_getDoc:function(){if(this._iframe.contentDocument){return this._iframe.contentDocument}else{if(this._iframe.contentWindow){return this._iframe.contentWindow.document}else{log("WARNING! chat_iframe._doc is null");return 0}}},iframeLoaded:function(e){if(this._onload_semaphore){removeEvent(window,"scroll",this._onWindowScroll);try{this._window.chat_contents.init(this.mode,this.open_params,jivo.isClicked);jivo.isClicked=false}catch(e){log("CHAT: iframe loaded, but contents is unreachable");return}this.handle("iframe_ready")}else{this._onload_semaphore=true}if(devicejs.chrome()){document.body.scrollTop=this._manualyScrolled||this._scrollOffset}},_onWindowScroll:null,setColor:function(){this._isDarkText=config.widget_font_color=="dark";this._backgroundColor=config.widget_color;this._borderColor=adjustLightness(this._backgroundColor,0.6,1);this._bodyColor=adjustLightness(this._backgroundColor,1.15,0.5);var e=document.getElementById("jivo-chat");if(e){var t,i;if(this._isDarkText){t=adjustLightness(this._backgroundColor,1.15,0.7)+" 0 1px";i=adjustLightness(this._backgroundColor,0.1,0.5)}else{t=adjustLightness(this._backgroundColor,0.6,1)+" 0 -1px";i="#ffffff"}document.getElementById("jivo-loader-title").style.color=i}},setChatHeight:function(e){var t=document.getElementById("jivo-chat");log("Setting chat height: "+e);jivo.transferProportion({width:t.offsetWidth,height:e});this._chatDiv.style.height=e+"px"},hide:function(){this._iframe.style.display="none";this._iframe.style.visibility="hidden";this._chatDiv.style.visibility="hidden";removeClass(this._chatDiv,"jivo-fade-in")},show:function(){this._iframe.style.display="block";this._iframe.style.visibility="visible";this._chatDiv.style.visibility="visible";addClass(this._chatDiv,"jivo-fade-in")},getInitPosition:function(){var e={};var t=config.widget_orientation=="top"||config.widget_orientation=="bottom";if(config.widget_orientation=="left"||t&&config.widget_padding==0){e.left="30px"}else{e.right="30px"}if(config.chat_mode==="online"){if(cookie("left")){e.left=cookie("left")}if(cookie("right")){e.right=cookie("right")}if(cookie("height")){e.height=cookie("height")}else{if(1==config.contacts_ask){e.height=this.getOnlineFormHeight()}}}else{e.height=this.getOfflineFormHeight()}if(jivo.isTablet()&&!jivo.isSeparateWindow()){e.height=350}return e},getOfflineFormHeight:function(){var e=this.getOfflineDescriptionHeight();e+=JivoChatTop.MESSAGE_OFFLINE_HEIGHT+JivoChatTop.INPUT_MARGIN;if(config.contacts_settings.email.show||!config.contacts_settings.phone.show||!config.contacts_settings.phone.required){e+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN}if(config.contacts_settings.name.show){e+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN}if(config.contacts_settings.phone.show){e+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN}if(!(config.options&8&&config.hide_ad)){e+=JivoChatTop.ADWORD_HEIGHT}e+=JivoChatTop.INNER_PADDING*2;e+=JivoChatTop.HEADER_OFFLINE_HEIGHT;e+=JivoChatTop.BUTTONS_HEIGHT;return e+"px"},getOfflineDescriptionHeight:function(){var e=document.createElement("div"),t;e.style.position="absolute";e.style.fontSize="16px";e.style.fontFamily="Arial, sans-serif";e.style.lineHeight="19px";e.style.visibility="hidden";e.style.width="247px";e.innerHTML=config.offline_form_text;document.body.appendChild(e);t=e.offsetHeight+JivoChatTop.DESCRIPTION_MARGIN;document.body.removeChild(e);return t},getOnlineFormHeight:function(){var e=JivoChatTop.MESSAGE_ONLINE_HEIGHT+JivoChatTop.INPUT_MARGIN;if(config.contacts_settings.email.show){e+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN}e+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN;if(config.contacts_settings.phone.show){e+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN}if(config.departments){e+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN}if(!(config.options&8&&config.hide_ad)){e+=JivoChatTop.ADWORD_HEIGHT}e+=JivoChatTop.INNER_PADDING;e+=JivoChatTop.HEADER_ONLINE_HEIGHT;e+=JivoChatTop.BUTTONS_HEIGHT;e+=JivoChatTop.AVATAR_MARGIN;return Math.max(JivoChatTop.MIN_HEIGHT,e)+"px"},getPosition:function(){return getElementPosition(this._chatDiv)},getGuiState:function(){this._guiState=cookie("gui_state")},initialize:function(){this._onWindowScroll=underscore.bind(function(){this._manualyScrolled=document.body.scrollTop},this);var e,t,i;this._chatDiv=document.createElement("div");this._chatDiv.setAttribute("id","jivo-chat");var n=this.getInitPosition();for(t in n){this._chatDiv.style[t]=n[t]}e="mobile";this._chatDiv.innerHTML=_templates.chat({chatMode:config.chat_mode,mobile:"desktop",lblLookingForFreeAgent:translate("lblLookingForFreeAgent")});this.topWrap.appendChild(this._chatDiv);this.setColor();i=getElementsByClassName("jivo-chat-triangle");for(t=0;t<i.length;t++){i[t].style.borderLeftColor=config.widget_color}i=getElementsByClassName("jivo-triangle-inner");for(t=0;t<i.length;t++){i[t].style.backgroundColor=config.widget_color}if(config.chat_mode=="offline"){i=getElementsByClassName("jivo-bottom-left-square");for(t=0;t<i.length;t++){i[t].style.backgroundColor=config.widget_color}}},states:{uninitialized:{show:function(e,t){this.getGuiState();this.mode=e;this.open_params=t;this.transition("LOADING_IFRAME")},resume_ok:function(){this.getGuiState();this._event_queue.push(["resume_ok"].concat(underscore.toArray(arguments)));this.mode="online";this.transition("LOADING_IFRAME")},invitation:function(e,t){this.getGuiState();this._event_queue.push(["accept",{agent_info:e}]);this._event_queue.push(["agent_message",{message:t,invitation:true}]);this.mode="online";this.transition("LOADING_IFRAME")}},LOADING_IFRAME:{_onEnter:function(){this._scrollOffset=document.body.scrollTop||0;addListener(window,"scroll",this._onWindowScroll);if(this._guiState==="CHAT"){this._chatDiv.style.visibility="visible";addClass(this._chatDiv,"jivo-fade-in")}this._iframe=document.createElement("iframe");this._iframe.setAttribute("id","jivo_chat_iframe");this._iframe.setAttribute("frameBorder","0");this._iframe.setAttribute("scrolling","no");this._iframe.allowTransparency=true;this._iframe.style.visibility="hidden";this._iframeWrap=document.getElementById("jivo_iframe_placeholder");this._iframeWrap.appendChild(this._iframe);setIframeLoadCallback(this._iframe,underscore.bind(this.iframeLoaded,this));this._doc=this._getDoc();this._doc.open();var e={title:window.document.title,lblPhoneHint:translate("lblPhoneHint")};this._doc.write(_templates.content(e));this._doc.close();this._window=this._iframe.contentWindow;this.iframeLoaded();addClass(this._chatDiv,"jivo-animated jivo-"+config.chat_mode)},iframe_ready:function(){delete this.open_params;if(jivo.gui.animationIsSupported()){addClass(document.getElementById("jivo-loader"),"jivo-fade-out");addClass(this._iframe,"jivo-fade-in")}else{document.getElementById("jivo-loader").style.display="none"}for(var e=0;e<this._event_queue.length;e++){var t=this._event_queue[e];this._window.chat_contents.handle.apply(this._window.chat_contents,t)}this._event_queue=[];this.transition(this._guiState==="CHAT"?"VISIBLE":"HIDDEN")},update_height:function(e){this.setChatHeight(e)},"*":function(){this._event_queue.push(underscore.toArray(arguments));this.mode="online"},invitation:function(e,t){this._event_queue.push(["accept",{agent_info:e}]);this._event_queue.push(["agent_message",{message:t,invitation:true}]);this.mode="online"}},VISIBLE:{_onEnter:function(){var e=document.getElementById("jivo-chat");jivo.transferProportion({width:e.offsetWidth,height:e.offsetHeight});this.show()},hide:function(){this.transition("HIDDEN")},update_height:function(e){this.setChatHeight(e)},"*":function(){this._window.chat_contents.handle.apply(this._window.chat_contents,underscore.toArray(arguments))},invitation:function(e,t){this._window.chat_contents.handle("accept",{agent_info:e});this._window.chat_contents.handle("agent_message",{message:t,invitation:true})}},HIDDEN:{_onEnter:function(){this.hide()},show:function(e,t){this.transition("VISIBLE");this._window.chat_contents.handle(jivo.isClicked?"focus_maximize":"maximize",t||e);jivo.isClicked=false},invitation:function(e,t){this._window.chat_contents.handle("accept",{agent_info:e});this._window.chat_contents.handle("agent_message",{message:t,invitation:true});this.transition("VISIBLE")},"*":function(){this._window.chat_contents.handle.apply(this._window.chat_contents,underscore.toArray(arguments))}}}},{INPUT_MARGIN:10,INPUT_HEIGTH:30,MESSAGE_OFFLINE_HEIGHT:109,BUTTONS_HEIGHT:28,HEADER_OFFLINE_HEIGHT:60,INNER_PADDING:10,ADWORD_HEIGHT:30,MESSAGE_ONLINE_HEIGHT:84,HEADER_ONLINE_HEIGHT:75,AVATAR_MARGIN:20,MIN_HEIGHT:372,DESCRIPTION_MARGIN:20});var JivoGui=TimeMachine.extend({namespace:"GUI",mode:"online",animate:false,unreadMessages:0,setCookie:true,_event_queue:[],setOnline:function(){this.mode="online";return this},setOffline:function(){if(this.mode!="offline"){this._setButtonsOffline();this.widget.setOffline();this.mode="offline"}return this},showWidget:function(e,t){this.enableAnimation(!!e);this.setCookie=t==undefined?true:!!t;this.handle("minimize");return this},showChat:function(e,t){if(jivo.isMobileOrTablet()){this.openNewWindow()}else{this.enableAnimation(!!e);this.handle("maximize",t)}return this},showInvitation:function(e,t){this.handle("invitation",e,t);return this},openNewWindow:function(){var e=window.location.protocol,t=e+jivo_config.base_url+"/script/window/"+jivo_config.widget_id,i=[],n=["client_id"],o;if(jivo_config.chat_mode==="online"){n.push("sess_id")}for(var s=0;s<n.length;s++){if(cookie(n[s])){i.push(n[s]+"="+cookie(n[s]))}}o=jivo.getCurrentPage();i.push("url="+encodeURIComponent(o.url));i.push("title="+encodeURIComponent(o.title));if(i.length){t+="?"+i.join("&")}var r;jivo.isTablet()&&jivo.checkVisibilityAPI?r=window.open(t,"jivo_"+config.widget_id):window.location=t;if(r){r.focus()}},getChatTop:function(){if(!this.chat_top){this.chat_top=new JivoChatTop({topWrap:this._wrapDiv})}return this.chat_top},chatInitialized:function(){return !!this.chat_top},incrementCounter:function(){var e=document.getElementById("jivo-label-indicator");e.innerHTML=++this.unreadMessages;e.style.visibility="visible"},resetCounter:function(){var e=document.getElementById("jivo-label-indicator");this.unreadMessages=0;e.style.visibility="hidden"},_setButtonsOffline:function(){var e=false;var t=getElementsByClassName("jivo-btn jivo-online-btn");for(var i=0;i<t.length;i++){if(!e){e=t[i].style.display}t[i].style.display="none"}t=getElementsByClassName("jivo-btn jivo-offline-btn");for(i=0;i<t.length;i++){t[i].style.display=e}},highlight:function(e){var t=config.base_url+"/script/cobrowsing?cb=?&hash="+e;getJSONP(t,function(e){if(underscore.isObject(e)){if(e.comment.length==0){e.comment=translate("lblDefaultCobrowseComment")}e.comment=stripBrackets(e.comment);childSandboxBridge.process("highlight",e);childSandboxBridge.process("renderTooltip",e)}})},initialize:function(){this._wrapDiv=document.createElement("div");this._wrapDiv.setAttribute("id","jivo_top_wrap");document.body.appendChild(this._wrapDiv);underscore.defaults(config,{online_widget_label:translate("defOnlineWidgetLabel"),offline_widget_label:translate("defOfflineWidgetLabel"),offline_form_text:translate("defOfflineFormText"),contacts_settings:{name:{show:false,required:false},phone:{show:false,required:false},email:{show:false,required:false}}});getConfigContactsAsk();if(jivo.isMobile()){config.online_widget_label=translate("defOnlineWidgetLabelMobile")||config.online_widget_label;config.offline_widget_label=translate("defOfflineWidgetLabelMobile")||config.offline_widget_label;config.widget_orientation="bottom";config.widget_padding=100;if(config.ignore_viewport){jivo.ignore_viewport=config.ignore_viewport}}if(jivo.isWixIframe()){config.widget_orientation="bottom"}this.widget=new JivoWidget({topWrap:this._wrapDiv});this.copyright=new JivoCopyright;if(this.animationIsSupported()){this.phantom=new JivoPhantom({topWrap:this._wrapDiv});this.phantom.on("animated",underscore.bind(this.handle,this,"animate_finished"))}},enableAnimation:function(e){if(!jivo.isWixIframe()&&e){log("GUI : enabling animation");this.animate=true}else{log("GUI : disabling animation");this.animate=false}},animationIsSupported:function(){return !!(!this.widget.isCustom()&&css3AnimationIsSupported())},states:{uninitialized:{minimize:"WIDGET",maximize:function(){this._event_queue.push(["show",this.mode]);this.transition("CHAT")},blacklist:"INVISIBLE",resume_ok:function(e){var t=e.client_info.msg_history;this.getChatTop().handle.apply(this.getChatTop(),["resume_ok"].concat(underscore.toArray(arguments)));if(underscore.findWhere(t,{type:"agentMessage",ack:0})){this.transition("CHAT");return}if(cookie("gui_state")&&cookie("gui_state")==="CHAT"){this.transition("CHAT")}else{this.transition("WIDGET")}}},WIDGET:{_onEnter:function(){if(this.setCookie){cookie("gui_state","WIDGET")}connection.updateClient({chat_opened:false});if(this.chatInitialized()){this.getChatTop().handle("hide")}this.widget.handle("show")},maximize:function(e){this.resetCounter();this._event_queue.push(["show",this.mode,e]);if(this.animationIsSupported()&&this.animate){this.transition("ANIMATE_EXPAND")}else{this.transition("CHAT")}},"*":function(e){if(!(jivo.isMobile()||jivo.isAndroid4old()&&jivo.isTablet())){if(e!=="invitation"){this._event_queue.push(["show",this.mode])}this._event_queue.push(underscore.toArray(arguments));if(underscore.indexOf(["agent_message","invitation","agent_service_message"],e)>=0){this.transition(this.animationIsSupported()?"ANIMATE_EXPAND":"CHAT")}else{if(e==="resume_ok"){if(!this.chat_top||this.chat_top&&cookie("gui_state")&&cookie("gui_state")==="CHAT"){this.transition("CHAT")}}}}else{if(underscore.indexOf(["agent_message","system_message","invitation","agent_service_message"],e)>=0){if(underscore.indexOf(["agent_message","invitation","agent_service_message"],e)>=0){this.incrementCounter()}}}},blacklist:function(){this.widget.handle("hide");this.transition("INVISIBLE")}},CHAT:{_onEnter:function(){if(this.setCookie){cookie("gui_state","CHAT")}connection.updateClient({chat_opened:true});this.widget.handle("hide");var e;jivo.transferProportion({width:this.getChatTop().getPosition().width,height:this.getChatTop().getPosition().height});while(e=this._event_queue.shift()){this.getChatTop().handle.apply(this.getChatTop(),e)}if(!this.widget.fade){this.widget.fade=true}},minimize:function(){if(this.animationIsSupported()&&this.animate){this.transition("ANIMATE_COLLAPSE")}else{this.transition("WIDGET")}},"*":function(e){this.getChatTop().handle.apply(this.getChatTop(),underscore.toArray(arguments));if(e==="resume_ok"){if(cookie("gui_state")&&cookie("gui_state")==="WIDGET"){this.transition("WIDGET")}}},blacklist:function(){this.getChatTop().handle("hide")}},ANIMATE_EXPAND:{_onEnter:function(){jivo.transferProportion({width:this.getChatTop().getPosition().width,height:this.getChatTop().getPosition().height});this.phantom.handle("expand",this.widget.getPosition(),this.getChatTop().getPosition());this.widget.handle("hide")},animate_finished:"CHAT",resume_ok:function(){this.getChatTop().handle.apply(this.getChatTop(),["resume_ok"].concat(underscore.toArray(arguments)))},agent_message:function(e){this._event_queue.push(["agent_message",e])},blacklist:"INVISIBLE"},ANIMATE_COLLAPSE:{_onEnter:function(){jivo.transferProportion({width:this.widget.getPosition().width,height:this.widget.getPosition().height});this.phantom.handle("collapse",this.widget.getPosition(),this.getChatTop().getPosition());this.getChatTop().hide()},agent_message:function(e){this._event_queue.push(["agent_message",e])},animate_finished:"WIDGET",blacklist:"INVISIBLE"},INVISIBLE:{animate_finished:function(){this.widget.handle("hide");this.getChatTop().handle("hide")}}}});var JivoCopyright=TimeMachine.extend({namespace:"AD",initialState:"HIDDEN",disabled:false,initialize:function(){var e=document.getElementById("jivo-label-copyright");if(!utils.showAd()){addClass(e,"jivo-no-copyright");this.disabled=true;return}this.jivo_copyright=document.getElementById("jivo_copyright");if(!this.jivo_copyright){this.jivo_copyright=document.createElement("div");var t=config.iconLocale==="en"?"com":"ru";this.jivo_copyright.innerHTML=translate("seo_copyrightTextNew").replace("_JIVOSITE_","<a href='http://jivo"+(config.iconLocale==="en"?"chat.":"site.")+t+"' target='_blank' id='jivosite-copyright' class='jivo-"+config.widget_font_color+" jivo-"+config.iconLocale+"'></a>");this.jivo_copyright.id="jivo_copyright";this.jivo_copyright.style.display="none";document.body.appendChild(this.jivo_copyright)}var i=document.createElement("div");i.setAttribute("id","jivo_copyright_corner");i.setAttribute("class","jivo-"+config.widget_orientation);switch(config.widget_orientation){case"top":i.style.borderBottomColor=config.widget_color;break;case"left":i.style.borderRightColor=config.widget_color;break;case"right":i.style.borderLeftColor=config.widget_color;break;case"bottom":i.style.borderTopColor=config.widget_color;break}this.jivo_copyright.style.backgroundColor=config.widget_color;this.jivo_copyright.appendChild(i);var n=this.jivo_copyright.getElementsByTagName("a");for(var o=0;o<n.length;o++){n[o].href+="?utm_source="+encodeURIComponent(location.hostname)+"&utm_medium=link&utm_content=widget_popup&utm_campaign=self_ad"}if(!jivo.isMobile()){e.onmouseover=underscore.bind(this.handle,this,"ad_mouseover");e.onmouseout=underscore.bind(this.handle,this,"ad_mouseout");this.jivo_copyright.onmouseover=underscore.bind(this.handle,this,"copyright_mouseover");this.jivo_copyright.onmouseout=underscore.bind(this.handle,this,"copyright_mouseout")}},getTooltipPosition:function(e){var t=getElementPosition(e),i=getElementPosition(document.getElementById("jivo_copyright")),n={top:0,left:0};switch(config.widget_orientation){case"left":n={top:t.top+20,left:t.left+t.width+10};if(ie8){n={top:t.top,left:t.left+t.width+10}}break;case"right":n={top:t.top+20,left:t.left-i.width-10};break;case"top":n={top:t.top+(t.height+15),left:t.left+40};break;case"bottom":n={bottom:t.height+10,left:t.left+(t.width-i.width)-40};break}return n},states:{HIDDEN:{_onEnter:function(){if(!this.disabled){this.jivo_copyright.style.display="none"}},ad_mouseover:"VISIBLE"},VISIBLE:{_onEnter:function(){this.jivo_copyright.style.display="block";var e=this.getTooltipPosition(document.getElementById("jivo-label"));this.jivo_copyright.style.left=e.left+"px";if(typeof e.bottom!="undefined"){this.jivo_copyright.style.bottom=e.bottom+"px"}else{this.jivo_copyright.style.top=e.top+"px"}},ad_mouseout:function(){this._scheduleEvent("hide",700)},hide:"HIDDEN",copyright_mouseover:function(){this._cancelEvent("hide")},copyright_mouseout:function(){this._scheduleEvent("hide",700)}}}});var jivoTitle=new TimeMachine({namespace:"TITLE",title:"",startBlink:function(){this.handle("start")},stopBlink:function(){this.handle("stop")},_messageShown:false,_showMessage:function(){document.title=translate("lblNewMessage");this._messageShown=true},_showTitle:function(){document.title=this.title;this._messageShown=false},states:{uninitialized:{start:"blinking"},blinking:{_onEnter:function(){this.title=document.title;this._showMessage();this._scheduleEvent("blink",1000)},blink:function(){if(this._messageShown){this._showTitle()}else{this._showMessage()}this._scheduleEvent("blink",1000)},stop:function(){this._showTitle();this._cancelEvent("blink");this.transition("uninitialized")}}}});var jivo=window.jivo=new TimeMachine({namespace:"JIVO",_chatWindow:false,_forcedCurrentPage:false,_forcedOffline:false,checkVisibilityAPI:true,invitationText:false,agentInfo:false,ruleName:false,isClicked:false,initialize:function(){var e=underscore.bind(this.handle,this,"window.loaded");if(window.parentSandboxBridge&&window.parentSandboxBridge.inAir){var t=setInterval(function(){log("check for document.readyState: "+document.readyState);if(document.readyState==="complete"||document.readyState==="loaded"){jivo.handle("window.loaded");clearInterval(t)}},300);return}if(document.readyState==="complete"){setTimeout(e)}else{if(document.addEventListener){document.addEventListener("DOMContentLoaded",e,false);window.addEventListener("load",e,false)}else{if(document.attachEvent){document.attachEvent("onreadystatechange",e);window.attachEvent("onload",e)}}}this.device=devicejs},_changeBrowserLocation:function(e,t){if(typeof window.parent.history.pushState==="function"){window.parent.history.pushState({},t,e)}},_newSession:function(){cookie("sess_id",null);if(!this.isSeparateWindow()){if(config.chat_mode==="offline"){if(utils.hideOffline()){this.transition("HIDDEN");return}}if(config.options&16){this.transition("INIT_RULE_MANAGER");return}if(config.chat_mode==="online"){if(this.isVisitorsInsight()){connection.handle("startup")}this.transition("ONLINE")}else{this.transition("OFFLINE")}}this.gui.showWidget()},_listenMessages:function(e){log("JIVO: listening for window messages");if("addEventListener" in window){window.addEventListener("message",underscore.bind(this._windowMessage,this,e),false)}else{if("attachEvent" in window){window.attachEvent("message",underscore.bind(this._windowMessage,this,e))}}},_windowMessage:function(e,t){this.handle([e,t.data.action].join("_"),t)},isVisitorsInsight:function(){return config.visitors_insight===1},isMobile:function(){return devicejs.mobile()},isTablet:function(){return devicejs.tablet()},isMobileOrTablet:function(){return this.isMobile()||this.isTablet()},isAndroid4old:function(){var e=navigator.userAgent,t,i=false;if(e.indexOf("Android")>=0){t=parseFloat(e.slice(e.indexOf("Android")+8));if(t===4||t===4.1||t===4.2){i=true}}return i},isWixIframe:function(){return typeof jivo_in_wix_iframe!=="undefined"},isSeparateWindow:function(){return typeof jivo_newWindow!=="undefined"},createMagicIFrame:function(){if(!this.isMobile()&&!this.isTablet()&&!this.isSeparateWindow()&&!this.isWixIframe()){site_iframe.create()}},_callUserFunction:function(e,t){e="jivo_"+e;if(typeof window[e]==="function"){try{log("JIVO: calling user function "+e);window[e](t);log("JIVO: user function "+e+" returned")}catch(i){}}},_sendIntroduce:function(e){connection.sendIfConnected({name:"introduction",client_name:e.name,phone:e.phone,email:e.email});this._saveClientInfo(e)},_saveClientInfo:function(e){underscore.each(["name","phone","email"],function(t){if(t in e&&e[t]!==""){if(t==="name"){cookie("client_name",e[t],{expires:365,path:"/"})}else{cookie(t,e[t],{expires:365,path:"/"})}}})},_chatAccepted:function(){analytics.trackChatConnected();this._callUserFunction("onAccepted")},transferProportion:function(e){this._callUserFunction("onResizeCallback",e)},getCurrentPage:function(){if(this._forcedCurrentPage){return this._forcedCurrentPage}return{url:window.location.href,title:setSubstrTitle(document.title)}},getChatHeight:function(){return document.getElementById("jivo-chat").offsetHeight},_stripHashFromLocation:function(e){if(window.location.href.indexOf("#jvhs_"+e)>0){this._changeBrowserLocation(window.location.href.replace("#jvhs_"+e,""),document.title)}},_pageVisible:function(){if("visibilityState" in document){return document.visibilityState==="visible"}else{if("webkitVisibilityState" in document){return document.webkitVisibilityState==="visible"}}return false},_listenVisibility:function(){log("Installing visibility event handler");var e,t,i;if(typeof document.hidden!=="undefined"){e="hidden";i="visibilitychange";t="visibilityState"}else{if(typeof document.mozHidden!=="undefined"){e="mozHidden";i="mozvisibilitychange";t="mozVisibilityState"}else{if(typeof document.msHidden!=="undefined"){e="msHidden";i="msvisibilitychange";t="msVisibilityState"}else{if(typeof document.webkitHidden!=="undefined"){e="webkitHidden";i="webkitvisibilitychange";t="webkitVisibilityState"}}}}if("addEventListener" in document&&typeof i!=="undefined"){document.addEventListener(i,underscore.bind(this._visibleHandler,this,t),false)}else{this.checkVisibilityAPI=false}},_visibleHandler:function(e){this.handle("window_"+document[e]);connection.updateClient({page_visible:this._pageVisible()})},_isBlacklisted:function(){var e=cookie("client_id");return e&&e.indexOf("z")===0},_inAir:function(){return window.parentSandboxBridge&&window.parentSandboxBridge.inAir},_sendRate:function(e,t){var i={jv_sess_id:t,r:e};getJSONPWithData(config.base_url+"/script/rate/"+config.widget_id,i,function(e){log("Rate result",e)})},handleGuiTransition:function(e){if(e.toState==="WIDGET"){this._callUserFunction("onClose")}else{if(e.toState==="CHAT"){this._callUserFunction("onOpen")}}},"*":function(e){if("update_height"===e){this.gui.handle.apply(this.gui,underscore.toArray(arguments));return}log(this.namespace+": unhandled "+e+" in state "+this.state)},states:{uninitialized:{"window.loaded":function(){if(!cookie("enter_ts")){cookie("enter_ts",(new Date).getTime());if(document.referrer){cookie("refer",document.referrer);setUTMParams(window.location.href)}var e=cookie("visits_count")-0;cookie("visits_count",!e?1:e+1,{expires:365,path:"/"})}if(this.isSeparateWindow()){this._listenVisibility();var t=getURLParam("url");var i=getURLParam("title");if(t&&i){this._forcedCurrentPage={url:t,title:setSubstrTitle(i)}}var n=getURLParam("client_id");if(n){cookie("client_id",n)}var o=getURLParam("sess_id");config.chat_mode=o?"online":"offline";this.gui=new JivoGui;if(o){cookie("sess_id",o,{expires:1,path:"/"});this.transition("CHECKING_SESSION")}else{this.transition("OFFLINE")}}else{if(this._isBlacklisted()||this.isMobileOrTablet()&&config.disable_mobile){this.transition("HIDDEN")}else{this.transition("LOADING_CSS")}}}},LOADING_CSS:{_onEnter:function(){if(document.createStyleSheet){document.createStyleSheet(staticUrl("/css/label.css"));if(ie8){document.createStyleSheet(staticUrl("/css/label-ie8.css"))}if(devicejs.windowsPhone()){document.createStyleSheet(staticUrl("/css/label-wp.css"))}}else{var e=document.createElement("link");e.setAttribute("rel","stylesheet");e.setAttribute("href",staticUrl("/css/label.css"));var t=utils.browser;if(t.name==="Opera"||t.name==="Safari"&&t.mV<6||t.name==="Firefox"&&t.mV<12){var i=document.createElement("link");i.setAttribute("rel","stylesheet");i.setAttribute("href",staticUrl("/css/label-ie8.css"));document.body.appendChild(i)}document.body.appendChild(e);if(devicejs.windowsPhone()){var n=document.createElement("link");n.setAttribute("rel","stylesheet");n.setAttribute("href",staticUrl("/css/label-wp.css"));document.body.appendChild(n)}}var o=this.cssDetector=document.createElement("div");o.id="jivo_css_detector";o.style.visibility="hidden";o.style.position="absolute";document.body.appendChild(o);this._scheduleEvent("timer_css",100)},timer_css:function(){if(!(this.cssDetector.offsetWidth>0)){this._scheduleEvent("timer_css",100);return}this.gui=new JivoGui;try{if(this._inAir()){window.parentSandboxBridge.process("onIframeDomReady");this.transition("HIDDEN");return}}catch(e){}this.gui.on("transition",underscore.bind(this.handleGuiTransition,this));var t=window.location.hash.split("jvhs_");if(!underscore.isUndefined(t[1])){this.gui.highlight(t[1])}if(window!=window.top){try{if(window.top.jivo_magic_var===jivo_magic_var&&!this.isWixIframe()){this.transition("IN_IFRAME");this._callUserFunction("onLoadCallback");return}}catch(e){}if(!this.isWixIframe()){this.transition("HIDDEN");return}}if(!this.isSeparateWindow()){this._listenVisibility();this._callUserFunction("onLoadCallback")}if(cookie("sess_id")){this.transition("CHECKING_SESSION")}else{this._newSession()}},gui_introduced:function(e){this._saveClientInfo(e)}},CHECKING_SESSION:{_onEnter:function(){var e=cookie("sess_id");var t=this.getCurrentPage();getJSONPWithData(chatServerUrl(e,config.site_id,config.widget_id),{name:"url_change",jv_widget_id:config.widget_id,title:setSubstrTitle(t.title),url:t.url},underscore.bind(this.handle,this,"check_session_response"));this._scheduleEvent("timer_check_session",4000)},check_session_response:function(e){log("JIVO: Check session response",e);this._cancelEvent("timer_check_session");if(typeof e==="object"){if(e.result==="ok"){if(e.has_connection){if(this._pageVisible()){this.transition("RESUMING")}else{this.transition("ONLINE");this.gui.showWidget()}}else{this.transition("RESUMING")}return}}this._newSession()},timer_check_session:function(){reportException({message:"Check session Timeout"});this._newSession()}},RESUMING:{_onEnter:function(){connection.resume(cookie("sess_id"))},resume_ok:function(e){var t=e.client_info.msg_history;if(t&&underscore.findWhere(t,{type:"clientMessage"})){this.createMagicIFrame()}this.transition("ONLINE");if(!this.isMobileOrTablet()||this.isSeparateWindow()){var i=this.isSeparateWindow()||!(this.isVisitorsInsight()&&t&&t.length===0)||e.agent_info;if(i){this.gui.handle("resume_ok",e)}if(!i||i&&this.gui.state==="WIDGET"&&t&&t.length===1&&t[0].id==="proactive"){this.transition("INIT_RULE_MANAGER")}}else{this.gui.showWidget();underscore.each(t,function(e){if(e.type==="agentMessage"&&!e.ack){this.gui.incrementCounter()}},this);if(!underscore.findWhere(t,{type:"agentMessage",ack:0})){this.gui.resetCounter()}}},resume_failed:function(){this._newSession()}},HIDDEN:{},IN_IFRAME:{_onEnter:function(){cookie("mframe",null);window.parent.jivo.handle("iframe_url_change",window.location.href,document.title)},highlight_cobrowse:function(e){this.gui.highlight(e)},"*":function(e){if(underscore.indexOf(["api_open","gui_close_cobrowse"],e)>=0){window.parent.jivo.handle.apply(window.parent.jivo,underscore.toArray(arguments))}else{log("JIVO: unhandled "+e+" in "+this.state)}}},INIT_RULE_MANAGER:{_onEnter:function(){if(ruleManager.isInited){this.handle("rule_manager_ready")}else{ruleManager.on("ready",underscore.bind(this.handle,this,"rule_manager_ready"));ruleManager.init()}},rule_manager_ready:function(){if(config.chat_mode==="online"){if(this.isVisitorsInsight()){connection.handle("startup")}this.transition("ONLINE")}else{this.transition("OFFLINE")}this.gui.showWidget()},hide:"HIDDEN"},ONLINE:{_onEnter:function(){this.gui.setOnline()},api_open:function(e){this.handle("gui_maximize",e)},invitation:function(e,t){if(!t){log("JIVO: invitation failed, no agent");return}connection.updateClient({chat_opened:true,page_visible:this._pageVisible(),proactive_rule:{invitation_text:e.invitationText,agent_id:t.agent_id}});analytics.trackProactiveInvitationShown(e.name);this.ruleName=e.name;this.invitationText=e.invitationText;this.agentInfo=t;this.gui.showInvitation(this.agentInfo,this.invitationText);this.transition("PROACTIVE")},highlight_cobrowse:function(e){this.gui.highlight(e)},gui_close_cobrowse:function(e){this._stripHashFromLocation(e)},gui_maximize:function(e){this.openParams=e;if(this.isMobileOrTablet()&&!cookie("sess_id")){this.transition("STARTING_SESSION")}else{analytics.trackChatOpenedByClick();this.gui.showChat(true,this.openParams)}},gui_answer_proactive:function(){if(cookie("sess_id")){this.gui.showChat(true,this.openParams)}},gui_typing:function(e){connection.sendIfConnected({name:"client_typing",typing:e})},gui_introduced:function(e,t){this._sendIntroduce(e);if(!t){analytics.trackGaveContacts();this._callUserFunction("onIntroduction")}},gui_message:function(e){this.createMagicIFrame();var t={name:"client_message",message:e};if(this.department_id){t.widget_department_id=this.department_id;this.department_id=null}connection.send(t);this.gui.handle("gui_message",e)},gui_department:function(e){this.department_id=e},gui_typing_insight:function(e){connection.sendIfConnected({name:"client_service_message",service:"typing_insight",event:"input_changed",new_val:e})},gui_minimize:function(){jivoTitle.stopBlink();this.gui.showWidget(true)},gui_decline_file:function(e,t){jivoTitle.stopBlink();connection.send({name:"client_service_message",service:"file_transfer",file_id:e,file_name:t,event:"file_declined"})},gui_receive_file:function(e,t){jivoTitle.stopBlink();connection.send({name:"client_service_message",service:"file_transfer",file_id:e,file_name:t,event:"file_received"})},gui_accept_cobrowse:function(e,t){jivoTitle.stopBlink();var i=document.location.href.split("#")[0];var n=e+"#jvhs_"+t;var o=document.getElementById("jivo_magic_iframe");if(i===e||i===encodeURI(e)){try{var s=window;if(o){s=o.contentWindow}s.jivo.handle("highlight_cobrowse",t)}catch(r){log(r.toString());return}this._changeBrowserLocation(n,document.title)}else{if(this.isMobileOrTablet()){window.open(n,document.title)}else{if(o){site_iframe.navigate(n)}else{document.location.href=n}}}},gui_evaluation:function(e,t){this._sendRate(e,t)},agent_chat_close:function(){this.invitationText=this.agentInfo=false;this.gui.handle("agent_chat_close")},gui_msg_input_focus:function(){jivoTitle.stopBlink()},"*":function(e,t){if(underscore.indexOf(["agent_message","agent_service_message","system_message","agent_typing","accept","agent_chat_close","gui_resume","update_height","transferred","update_agent_info","blacklist"],e)>=0){this.gui.handle.apply(this.gui,underscore.toArray(arguments));if(underscore.indexOf(["agent_message","agent_service_message"],e)>=0){jivoTitle.startBlink();if(this.isVisitorsInsight()&&t.msg_id&&t.msg_id===1&&!this.invitationText&&config.contacts_ask===1){this.invitationText=t.message}}if(e==="accept"){this._chatAccepted()}}else{log("JIVO: unhandled "+e+" in "+this.state)}},iframe_url_change:function(e,t){this._changeBrowserLocation(e,t);connection.sendIfConnected({name:"url_change",url:e,title:setSubstrTitle(t)})},reopened_elsewhere:function(){jivoTitle.stopBlink();this.gui.showWidget(false,false)},connect_failed:function(){this._forcedOffline="connect_failed";this.transition("OFFLINE");this.gui.handle("connect_failed")},force_offline:function(e){this._forcedOffline=e.err_code?e.err_code:e.name;this.transition("OFFLINE");this.gui.handle("connect_failed")},window_visible:function(){if(!connection.isConnected()&&cookie("sess_id")){this.transition("CHECKING_SESSION")}},gui_start_call:function(){connection.send({name:"request_call",want_call:1})},gui_agent_message_ack:function(e){connection.sendIfConnected({name:"agent_message_ack",ack_msg_ids:e})}},OFFLINE:{_onEnter:function(){jivoTitle.stopBlink();this.gui.setOffline()},gui_maximize:function(){analytics.trackOfflineFormOpenedByClick();this.gui.showChat(true)},gui_minimize:function(){this.gui.showWidget(true)},gui_offline_message:function(e){var t=this.getCurrentPage();var i=underscore.pick(e,"email","message","phone","name","cap_id","cap_symbols");underscore.extend(i,{page_url:t.url,page_title:setSubstrTitle(t.title)});if(cookie("client_id")){i.client_id=cookie("client_id")}if(cookie("__utmz")){i.g_utmz=cookie("__utmz")}if(cookie("refer")){i.refer=cookie("refer");if(cookie("utm")){i.utm=cookie("utm")}}if(this._forcedOffline){i.from_online=this._forcedOffline}if(this.isMobile()){i.is_mobile=1}if(typeof connection.user_token==="string"){i.user_token=connection.user_token}this._saveClientInfo(i);getJSONPWithData(config.base_url+"/script/offline-form/"+config.widget_id,i,underscore.bind(this.handle,this,"message_response"));this.transition("OFFLINE_WAIT")},gui_leave_msg:function(){this.gui.handle("gui_leave_msg")},api_open:function(){this.handle("gui_maximize")}},OFFLINE_WAIT:{_onEnter:function(){this._scheduleEvent("message_timer",5000)},message_response:function(e){this._cancelEvent("message_timer");if(typeof e==="object"){if(e.result==="ok"){if("client_id" in e){cookie("client_id",e.client_id,{expires:365,path:"/"})}analytics.trackOfflineMessageSent();this.gui.handle("offline_success");this.transition("OFFLINE");return}else{if(e.result==="error"){if("cap_id" in e){this.gui.handle("offline_captcha",e);this.transition("OFFLINE");return}}}}this.gui.handle("offline_failed");this.transition("OFFLINE")},message_timer:function(){this.gui.handle("offline_failed");this.transition("OFFLINE")}},PROACTIVE:{gui_minimize:function(){analytics.trackProactiveInvitationRejected(this.ruleName);this.gui.showWidget(true);this.transition("ONLINE")},gui_message:function(e){this.createMagicIFrame();analytics.trackProactiveInvitationAccepted(this.ruleName);cookie("agent_info",[this.agentInfo.agent_id].join("$$"));if(this.isMobileOrTablet()){return}connection.send({name:"client_message",message:e});this.gui.handle("gui_message",e);this.transition("ONLINE")},gui_answer_proactive:function(){this.transition("STARTING_SESSION")},gui_maximize:function(){if(this.isMobileOrTablet()){analytics.trackProactiveInvitationAccepted(this.ruleName);this.transition("STARTING_SESSION")}},gui_introduced:function(e,t){this._sendIntroduce(e);if(!t){analytics.trackGaveContacts();this._callUserFunction("onIntroduction")}},window_visible:function(){if(!connection.isConnected()&&cookie("sess_id")){this.transition("CHECKING_SESSION")}},api_open:function(e){this.transition("ONLINE");this.handle("api_open",e)},accept:function(){this.transition("ONLINE");this._chatAccepted()}},STARTING_SESSION:{_onEnter:function(){connection.handle("startup")},startup_ok:function(){this.transition("ONLINE");this.gui.showChat(true,this.openParams)},gui_maximize:function(e){this.gui.showChat(true,e)}}}});if(typeof JSON!=="object"){JSON={}}(function(){function f(e){return e<10?"0"+e:e}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(e){escapable.lastIndex=0;return escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t==="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var i,n,o,s,r=gap,a,c=t[e];if(c&&typeof c==="object"&&typeof c.toJSON==="function"){c=c.toJSON(e)}if(typeof rep==="function"){c=rep.call(t,e,c)}switch(typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c){return"null"}gap+=indent;a=[];if(Object.prototype.toString.apply(c)==="[object Array]"){s=c.length;for(i=0;i<s;i+=1){a[i]=str(i,c)||"null"}o=a.length===0?"[]":gap?"[\n"+gap+a.join(",\n"+gap)+"\n"+r+"]":"["+a.join(",")+"]";gap=r;return o}if(rep&&typeof rep==="object"){s=rep.length;for(i=0;i<s;i+=1){if(typeof rep[i]==="string"){n=rep[i];o=str(n,c);if(o){a.push(quote(n)+(gap?": ":":")+o)}}}}else{for(n in c){if(Object.prototype.hasOwnProperty.call(c,n)){o=str(n,c);if(o){a.push(quote(n)+(gap?": ":":")+o)}}}}o=a.length===0?"{}":gap?"{\n"+gap+a.join(",\n"+gap)+"\n"+r+"}":"{"+a.join(",")+"}";gap=r;return o}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(e,t,i){var n;gap="";indent="";if(typeof i==="number"){for(n=0;n<i;n+=1){indent+=" "}}else{if(typeof i==="string"){indent=i}}rep=t;if(t&&typeof t!=="function"&&(typeof t!=="object"||typeof t.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":e})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(e,t){var i,n,o=e[t];if(o&&typeof o==="object"){for(i in o){if(Object.prototype.hasOwnProperty.call(o,i)){n=walk(o,i);if(n!==undefined){o[i]=n}else{delete o[i]}}}}return reviver.call(e,t,o)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}})();(function(e){var t=e.setTimeout,i=e.document,n=0;e.jivoXHR=function(){var o,s,r,a,c=null;function l(){try{a.parentNode.removeChild(a)}catch(e){}}function u(){s=false;o="";l();a=null}function f(e){try{c.onerror.call(c,e,o)}catch(t){throw new Error(e)}}function d(){if(this.readyState&&this.readyState!=="complete"&&this.readyState!=="loaded"||s){return}this.onload=this.onreadystatechange=null;s=true;if(c.readyState!==4){f("Script failed to load ["+o+"].")}l()}function h(e){e=e||[];c.readyState=4;c.status=200;if(typeof c.onload==="function"){c.onload.apply(c,e)}}c={onerror:null,onload:null,readyState:0,open:function(t,i){u();internal_callback="cb"+n++;(function(t){e.jivoXHR[t]=function(){try{h.call(c,arguments)}catch(i){c.readyState=-1;f(i.message)}e.jivoXHR[t]=null}})(internal_callback);o=i.replace(/=\?/,"=jivoXHR."+internal_callback)},send:function(){t(function(){a=i.createElement("script");a.setAttribute("type","text/javascript");a.charset="UTF-8";a.onload=a.onreadystatechange=function(){d.call(a)};a.setAttribute("src",o);i.getElementsByTagName("head")[0].appendChild(a)},0)},abort:function(){},setRequestHeader:function(){},getResponseHeader:function(){return""},getAllResponseHeaders:function(){return[]}};u();return c}})(window);(function(){if(typeof module!=="undefined"&&module.exports&&typeof require!=="undefined"){var e=require("log4js").getLogger("pushengine");var t=require("underscore");var i=require("machina")(t);var n=require("xmlhttprequest").XMLHttpRequest;var o=require("./time_machine");var s=require("ws");var r=true}else{var t=underscore;var i=machina;var o=TimeMachine;var n=XMLHttpRequest;if(typeof WebSocket!="undefined"){var s=WebSocket}var e={};t.each(["debug","warn","error","info"],function(t){e[t]=function(){var e=Array.prototype.slice.call(arguments);if(typeof e[0]=="string"){e[0]="CONNECTION: "+e[0]}else{e.unshift("CONNECTION: ")}log.apply(log,e)}});var r=false}var a=i.Fsm.extend({namespace:"CONNECTION",host:"node.jivosite.com",resource:"cometan",srv_rotate:false,allow_fallback:true,server_index:0,plain_port:80,secure_port:443,secure:true,mode:"ws",open:function(){this.handle("cmd_open")},close:function(){this.handle("cmd_close")},push:function(e){this.handle("cmd_push",e)},initialState:"CLOSED",initialize:function(){this.socket=false},wsUri:function(){var t=[];var i=this.host;if(this.secure){t.push("wss:/");if(this.secure_port){i+=":"+this.secure_port}}else{t.push("ws:/");if(this.plain_port){i+=":"+this.plain_port}}t.push(i,this.resource);e.debug("wsUri="+t.join("/"));return t.join("/")},jivoOptions:function(){return t.pick(this,"secure","host","resource","plain_port","secure_port","srv_rotate")},setSocket:function(e){if(this.socket){var i=this.socket;i.onopen=i.onclose=i.onerror=i.onmessage=function(){};i=null}this.socket=e;e.onopen=t.bind(this.handle,this,"socket_open");e.onclose=t.bind(this.handle,this,"socket_close");e.onerror=t.bind(this.handle,this,"socket_error");e.onmessage=t.bind(this.handle,this,"socket_message")},states:{CLOSED:{cmd_open:"OPENING",cmd_push:function(){throw new Error("Push before connect")},cmd_close:function(){e.debug("Already closed")},socket_close:function(t){e.info("Socket close",t.code,t.reason);this.emit("disconnect",t.code,t.reason)}},OPENING:{_onEnter:function(){if(this.mode=="ws"){if(s){var t="plain";if(r){t={protocol:"plain"}}try{this.setSocket(new s(this.wsUri(),t))}catch(i){e.error("Could not create websocket",i.message);if(this.allow_fallback){e.debug("Falling back to polling");this.mode="jivo";this.setSocket(new c(this.jivoOptions()))}else{e.debug("Fallback to polling disabled");this.transition("CLOSED");this.emit("connect_failed",i.message)}}return}else{e.debug("WebSocket is not supported")}}this.mode="jivo";this.setSocket(new c(this.jivoOptions()))},socket_open:function(){this.transition("OPENED")},socket_error:function(t){e.error("Socket error!",t.message);if(typeof reportException=="function"){reportException({message:t.message||"Socket error"})}if(this.mode=="ws"){if(this.allow_fallback){e.debug("Falling back to polling");this.mode="jivo";this.setSocket(new c(this.jivoOptions()));return}else{e.info("Fallback to polling is disabled")}}this.transition("CLOSED");this.emit("connect_failed",t.message)},socket_close:function(){this.handle("socket_error",{message:"Socket closed while opening"})},connect_failed:function(e){this.transition("CLOSED");this.emit("connect_failed",e)},cmd_push:function(){throw new Error("Push before connect")},cmd_close:function(){this.transition("CLOSED");this.socket.close()}},OPENED:{_onEnter:function(){this.emit("connect",this.mode)},cmd_push:function(e){this.socket.send(JSON.stringify(e))},socket_message:function(e){if(typeof e.data=="object"){this.emit("message",e.data)}else{this.emit("message",JSON.parse(e.data))}},socket_close:function(t){e.info("Socket close",t.code,t.reason);this.emit("disconnect",t.code,t.reason);this.transition("CLOSED")},cmd_close:function(){this.socket.close();this.transition("CLOSED")}}}});var c=i.Fsm.extend({namespace:"SOCKET",initialize:function(){if(r){this.mode="xhr"}else{var e=new n;this.mode="withCredentials" in e?"xhr":"jsonp";e=null}this.pull_channel=new l({master:this});this.push_channel=new u({master:this})},xhrObject:function(){if(this.mode=="xhr"){return new n}else{return new jivoXHR}},cometUrl:function(e,t){var i;if(typeof t!="object"){t={}}t.t=(new Date).getTime();var n=this.host;if(e[0]=="push"){var o=n.split(".");if(o.length>1){o[0]+="psh";n=o.join(".")}}if(this.srv_rotate){if(this.server_index>0){var o=n.split(".");o[0]+="-"+this.server_index;n=o.join(".")}}if(this.secure){i=["https:/",n+":"+this.secure_port,this.resource].join("/")}else{i=["http:/",n+":"+this.plain_port,this.resource].join("/")}i+="/"+e.join("/")+"?";if(this.mode=="jsonp"){i+="cb=?&"}var s=[];for(var r in t){s.push(r+"="+encodeURIComponent(t[r]))}return i+s.join("&")},close:function(e,t){this.handle("cmd_close",e,t)},send:function(e){this.handle("cmd_push",e)},states:{uninitialized:{_onEnter:function(){this.pull_channel.handle("open");this.transition("CONNECTING")}},CONNECTING:{connect:function(){e.debug("Pull channel connected",this.socket_id);this.transition("OPEN")},connect_failed:function(e){if(typeof this.onerror=="function"){this.onerror.call(this,e)}this.transition("CLOSED")},cmd_push:function(){throw new Error("Push before connect")}},OPEN:{_onEnter:function(){this.push_channel.handle("open");if(typeof this.onopen=="function"){this.onopen.call(this)}},cmd_push:function(e){this.push_channel.handle("push",e)},message:function(e){if(typeof this.onmessage=="function"){this.onmessage.call(this,{data:e})}},disconnect:function(e,t){this.transition("CLOSED");if(typeof this.onclose=="function"){this.onclose.call(this,{code:e,reason:t})}},cmd_close:function(){this.transition("CLOSED")}},CLOSED:{_onEnter:function(){this.push_channel.handle("close")},disconnect:function(e,t){if(typeof this.onclose=="function"){this.onclose.call(this,{code:e,reason:t})}}}}});var l=o.extend({initialState:"CLOSED",namespace:"SOCKET-PULL",initialize:function(){},_pull:function(){this.pull_request=this.master.xhrObject();this.pull_request.open("GET",this.master.cometUrl(["pull",this.master.socket_id])),this.pull_request.onload=t.bind(this.handle,this,"pull_load");this.pull_request.onerror=t.bind(this.handle,this,"pull_error");this.pull_request.send();this._scheduleEvent("pull_timeout",this.hold_timeout);this.reconnect_state="PULL";this.transition("PULL")},_ack:function(){this.pull_request=this.master.xhrObject();this.pull_request.open("GET",this.master.cometUrl(["ack",this.master.socket_id],{mid:this.last_message_id}));this.pull_request.onload=t.bind(this.handle,this,"pull_load");this.pull_request.onerror=t.bind(this.handle,this,"pull_error");this.pull_request.send();this._scheduleEvent("pull_timeout",this.hold_timeout);this.reconnect_state="ACK";this.transition("PULL")},_startReconnect:function(){if(this.reconnect_counter>5){this.master.handle("disconnect",1006,"Reconnect failed");this.transition("CLOSED")}else{this._scheduleEvent("reconnect",1000);this.transition("RECONNECT_WAIT")}},_fin:function(){this.fin_request=this.master.xhrObject();this.fin_request.open("GET",this.master.cometUrl(["fin",this.master.socket_id]));this.fin_request.onload=t.bind(this.handle,this,"fin_load");this.fin_request.onerror=t.bind(this.handle,this,"fin_error");this.fin_request.send();this.transition("FIN")},states:{CLOSED:{open:"SYN"},SYN:{_onEnter:function(){this.syn_request=this.master.xhrObject();this.syn_request.open("GET",this.master.cometUrl(["syn"]));this.syn_request.onload=t.bind(this.handle,this,"syn_load");this.syn_request.onerror=t.bind(this.handle,this,"syn_error");this.syn_request.send();this._scheduleEvent("syn_timeout",5000)},syn_load:function(t){this._cancelEvent("syn_timeout");if(this.master.mode=="xhr"){try{t=JSON.parse(this.syn_request.responseText)}catch(i){this.transition("CLOSED");this.master.handle("connect_failed",i);return}}if("c"==t.t){this.master.socket_id=t.sid;this.hold_timeout=t.ht+2000;this.master.handle("connect");this._pull()}else{e.error("Unexpected syn response",t)}},syn_error:function(t){e.error(t);this._cancelEvent("syn_timeout");this.transition("CLOSED");this.master.handle("connect_failed",t)},syn_timeout:function(){this.syn_request.onload=this.syn_request.onerror=function(){};this.syn_request.abort();this.transition("CLOSED");this.master.handle("connect_failed",new Error("Connection timed out"))}},PULL:{pull_load:function(t){this._cancelEvent("pull_timeout");if(this.master.mode=="xhr"){try{t=JSON.parse(this.pull_request.responseText)}catch(i){e.error("Error parsing pull response",this.pull_request.responseText,i.message);this.master.handle("disconnect",1006,"Connection reset");this.transition("CLOSED");return}}this.reconnect_counter=0;if("k"==t.t){this.hold_timeout=t.ht+2000;this._pull()}else{if("m"==t.t){this.last_message_id=t.mid;this._ack();this.master.handle("message",t.msg)}else{if("r"==t.t){this.master.handle("disconnect",1006,"Connection reset");this.transition("CLOSED")}else{if("d"==t.t){this.master.handle("disconnect",1000,t.r);this.transition("CLOSED")}}}}},pull_error:function(t){e.warn("Pull error",t);this._cancelEvent("pull_timeout");this._startReconnect("PULL")},pull_timeout:function(){e.warn("Pull timeout");this.pull_request.onload=this.pull_request.onerror=function(){};this.pull_request.abort();this._startReconnect("PULL")},close:function(){this._cancelEvent("pull_timeout");this.pull_request.onload=this.pull_request.onerror=function(){};this.pull_request.abort();this._fin()}},RECONNECT_WAIT:{_onEnter:function(){this.hold_timeout=5000},reconnect:function(){this.reconnect_counter+=1;if(this.reconnect_state=="ACK"){this._ack()}else{this._pull()}}},FIN:{_onEnter:function(){this._scheduleEvent("fin_timeout",2000)},fin_timeout:function(){e.warn("FIN timeout");this.transition("CLOSED")},fin_load:function(){this._cancelEvent("fin_timeout");this.transition("CLOSED")},fin_error:function(t){e.error(t);this._cancelEvent("fin_timeout");this.transition("CLOSED")}}}});var u=o.extend({initialState:"CLOSED",namespace:"SOCKET-PUSH",initialize:function(){this.queue=[]},_push:function(){this.push_request=this.master.xhrObject();if(this.master.mode=="jsonp"){this.push_request.open("GET",this.master.cometUrl(["push",this.master.socket_id],{msg:this.queue[0]}),true)}else{this.push_request.open("POST",this.master.cometUrl(["push",this.master.socket_id]),true);this.push_request.setRequestHeader("Content-type","text/plain;charset=UTF-8")}this.push_request.onload=t.bind(this.handle,this,"push_load");this.push_request.onerror=t.bind(this.handle,this,"push_error");this.push_request.send(this.queue[0]);this.transition("PUSHING")},states:{CLOSED:{open:function(){this.transition("READY")},close:function(){}},READY:{push:function(e){this.queue.unshift(e);this._push()},close:function(){this.transition("CLOSED")}},PUSHING:{_onEnter:function(){this._scheduleEvent("push_timeout",3000)},push:function(t){var i=this.queue.push(t);e.debug("Message put to queue",i)},push_load:function(){this._cancelEvent("push_timeout");this.queue.shift();if(this.queue.length>0){this._push()}else{this.transition("READY")}},push_error:function(t){e.error(this.master.socket_id+": push error",t)},close:function(){this._cancelEvent("push_timeout");this.push_request.onload=this.push_request.onerror=function(){};this.push_request.abort();this.transition("CLOSED")},push_timeout:function(){this.push_request.onload=this.push_request.onerror=function(){};this.push_request.abort();this.transition("RETRY")}},RETRY:{_onEnter:function(){this._scheduleEvent("retry_push",2000)},retry_push:function(){this._push()},push:function(t){var i=this.queue.push(t);e.debug(this.master.socket_id+": message put to queue",i)},close:function(){this._cancelEvent("push_timeout");this.transition("CLOSED")}}}});if(r){module.exports=a}else{this.JivoConnection=a}}).call(this);var connection=new TimeMachine({namespace:"CONMANAGER",msg_buf:[],sess_id:false,send:function(e){log("SEND: ",e);this.handle("send",e)},sendIfConnected:function(e){if(this.isConnected()){log("SEND IF CONNECTION: ",e);this.handle("send",e)}},resume:function(e){this.handle("resume",e)},initialize:function(){var e=false;if("production"=="production"){e=true}this.jivoConnection=new JivoConnection(underscore.extend(underscore.clone(config.comet),{resource:"cometcn",mode:cookie("cm")||"ws",secure:e}));var t=["connect","message","disconnect","connection_reset","connect_failed"];for(var i=0;i<t.length;i++){this.jivoConnection.on(t[i],underscore.bind(this.handle,this,"socket_"+t[i]))}},_sendSocketEvent:function(e){if(typeof e=="object"){if("name" in e){log("Sending "+e.name);this.jivoConnection.push(e)}else{this.warn("Attempt to send event without name")}}else{this.warn("Socket event must be object")}},_bufferMessage:function(e){this.msg_buf.push(e)},_flushMessageBuffer:function(){var e;while(e=this.msg_buf.shift()){this.jivoConnection.push(e)}},isConnected:function(){return this.state==="CONNECTED"},setCustomData:function(e){if(this.isConnected()){this.send({name:"update_custom_data",custom_data:e})}else{this.custom_data=e}},setUserToken:function(e){if(this.isConnected()){this.send({name:"update_user_token",user_token:e})}else{this.user_token=e}},createClientModel:function(){if(!this.clientModel){this.clientModel={chat_opened:cookie("gui_state")==="CHAT",page_visible:jivo._pageVisible()}}},updateClient:function(e){var t={name:"update_client"};this.createClientModel();var i=underscore.clone(this.clientModel);underscore.extend(this.clientModel,e);if(!underscore.isEqual(this.clientModel,i)){underscore.extend(t,e);this.sendIfConnected(t)}},states:{uninitialized:{send:function(e){this._bufferMessage(e);this.transition("CONNECTING")},resume:function(e){this.sess_id=e;this.transition("CONNECTING")},startup:function(){this.sess_id=false;this.transition("CONNECTING")}},CONNECTING:{_onEnter:function(){this.jivoConnection.open()},socket_connect:function(e){cookie("cm",e);if(this.sess_id){this.transition("RESUMING")}else{this.transition("STARTING_UP")}},send:function(e){this._bufferMessage(e)},socket_connect_failed:function(){jivo.handle("connect_failed");this.transition("uninitialized")}},STARTING_UP:{_onEnter:function(){this.createClientModel();var e={name:"startup",jv_widget_id:config.widget_id,site_id:config.site_id,current_page:jivo.getCurrentPage(),is_mobile:jivo.isMobile(),visits_count:cookie("visits_count")-0};e=underscore.extend(e,this.clientModel);if(cookie("client_id")){e.jv_client_id=cookie("client_id");log("CONNECTION: restored client #"+e.jv_client_id)}if(cookie("__utmz")){e.g_utmz=cookie("__utmz")}if(cookie("agent_info")){e.pa_id=cookie("agent_info").split("$$")[0];log("CONNECTION: restored agent #"+e.pa_id)}if(cookie("client_name")){e.client_name=cookie("client_name");log("CONNECTION: restored client name="+e.client_name)}if(cookie("email")){e.email=cookie("email");log("CONNECTION: restored client email="+e.email)}if(cookie("phone")){e.phone=cookie("phone");log("CONNECTION: restored client phone="+e.phone)}if(cookie("refer")){e.refer=cookie("refer");if(cookie("utm")){e.utm=cookie("utm")}}if(jivo.invitationText){e.proactive_rule={invitation_text:jivo.invitationText,agent_info:jivo.agentInfo}}if(this.custom_data){e.custom_data=this.custom_data}if(this.user_token){e.user_token=this.user_token}this._sendSocketEvent(e);this._scheduleEvent("startup_timeout",3000)},startup_timeout:function(){reportException({message:"Startup Timeout"})},send:function(e){this._bufferMessage(e)},socket_message:function(e){if(e.name==="startup_ok"){this._cancelEvent("startup_timeout");cookie("sess_id",e.jv_sess_id,{expires:1,path:"/"});cookie("client_id",e.jv_client_id,{expires:365,path:"/"});this.transition("CONNECTED")}else{if(e.name==="startup_error"){jivo.handle("force_offline",e);this.transition("DISCONNECTING")}}}},RESUMING:{_onEnter:function(){this.createClientModel();this._sendSocketEvent(underscore.extend({name:"resume",jv_sess_id:this.sess_id,jv_widget_id:config.widget_id,site_id:config.site_id,visits_count:cookie("visits_count")-0,separate_window:jivo.isSeparateWindow(),current_page:jivo.getCurrentPage()},this.clientModel))},socket_message:function(e){if(e.name=="resume_ok"){jivo.handle(e.name,e);this.transition("CONNECTED")}else{this.sess_id=false;jivo.handle("resume_failed");this.transition("DISCONNECTING")}}},CONNECTED:{_onEnter:function(){jivo.handle("startup_ok");this._flushMessageBuffer()},socket_message:function(e){if(underscore.indexOf(["agent_chat_close","force_offline","blacklist"],e.name)>=0){if(!jivo.isVisitorsInsight()){cookie("sess_id",null);this.sess_id=false;this.transition("DISCONNECTING")}if(e.name==="blacklist"){cookie("client_id","z"+cookie("client_id"))}}if(underscore.indexOf(["accept","transferred"],e.name)>=0){cookie("agent_info",[e.agent_info.agent_id].join("$$"))}jivo.handle(e.name,e)},send:function(e){this.jivoConnection.push(e)},socket_disconnect:function(e){if(e==1000){jivo.handle("reopened_elsewhere")}this.transition("uninitialized")},startup:function(){jivo.handle("startup_ok")}},DISCONNECTING:{_onEnter:function(){this.jivoConnection.close()},socket_disconnect:function(){this.transition("uninitialized")}}}});var JivoPhantom=TimeMachine.extend({namespace:"PHANTOM",element:false,type:"chat",PHANTOM_ID:"jivo_phantom",TIMEOUT_TRANSITION:300,TIMEOUT_TRANSITION_DEBOUNCE:1,initialize:function(){element=this.element=document.createElement("div");element.id=this.PHANTOM_ID;prefixedEvent(element,"TransitionEnd",this.handleTransitionEnd);this.topWrap.appendChild(element);addClass(element,"jivo-"+config.widget_orientation);element.style.background=config.widget_color;function e(){if(this._transitionEndTimeout){clearTimeout(this._transitionEndTimeout)}this.handle("animate_finished")}this.handleTransitionEnd=underscore.debounce(underscore.bind(e,this),this.TIMEOUT_TRANSITION_DEBOUNCE)},setRect:function(e){setElementPosition(this.element,e);return this},setTransition:function(e){toggleClass(this.element,"jivo-notransition",!e);return this},animate:function(e,t){var i=this.element;var n=this.state==="EXPANDING";toggleClass(i,"jivo-phantom-chat",n);toggleClass(i,"jivo-phantom-label",!n);this.setTransition(false).setRect(e,true).setTransition(true);setTimeout(underscore.bind(function(){this.setRect(t);this._transitionEndTimeout=setTimeout(this.handleTransitionEnd,this.TIMEOUT_TRANSITION)},this),0)},initialState:"HIDDEN",states:{ANIMATED:{_onEnter:function(){this.emit("animated");this._scheduleEvent("hide",this.TIMEOUT_TRANSITION)},hide:"HIDDEN"},HIDDEN:{_onEnter:function(){this.setTransition(false)},collapse:function(e,t){this.transition("COLLAPSING");this.animate(t,e)},expand:function(e,t){this.transition("EXPANDING");this.animate(e,t)}},EXPANDING:{animate_finished:"ANIMATED"},COLLAPSING:{animate_finished:"ANIMATED"}}});var analytics={_yaCounter:false,_trackedEvents:[],_trackEvent:function(e,t){if(underscore.indexOf(this._trackedEvents,e)>=0){return}this._trackedEvents.push(e);log("ANALYTICS _trackEvent: "+e+"/"+t);if(typeof _gaq!=="undefined"){_gaq.push(["_trackEvent","JivoSite",e,t,undefined,true])}if(typeof ga==="function"){ga("send","event","JivoSite",e,t,{nonInteraction:1})}if(this._yaCounter){e=["Jivo"].concat(e.split(" ")).join("_");window[this._yaCounter].reachGoal(e)}},_setCustomVar:function(e,t){log("ANALYTICS _setCustomVar: "+e+"/"+t);if(typeof _gaq!=="undefined"){_gaq.push(["_setCustomVar",1,e,t,1])}if(typeof ga==="function"){ga("set",e,t)}if(this._yaCounter){var i={};i[e]=t;window[this._yaCounter].params(i)}},findYaCounter:function(){try{for(var e in window){if(e.indexOf("yaCounter")==0&&typeof window[e].reachGoal=="function"){this._yaCounter=e}}}catch(t){log("ANALYTICS: "+t.toString())}},trackChatOpenedByClick:function(){this._trackEvent("Chat requested","User clicked chat widget")},trackOfflineFormOpenedByClick:function(){this._trackEvent("Offline form shown","User offline form")},trackOfflineMessageSent:function(){this._trackEvent("Offline message sent","User sent message via offline form")},trackProactiveInvitationShown:function(e){this._trackEvent("Proactive invitation shown",e)},trackProactiveInvitationAccepted:function(e){this._trackEvent("Proactive invitation accepted",e)},trackProactiveInvitationRejected:function(e){this._trackEvent("Proactive invitation rejected",e)},trackChatConnected:function(){this._trackEvent("Chat established","User connected to agent")},trackGaveContacts:function(){this._trackEvent("User gave contacts during chat","User gave contacts during chat")},setABTestGroupContacts:function(e,t){this._setCustomVar(e,t)}};analytics.findYaCounter();var jivo_api=window.jivo_api={open:function(e){jivo.handle("api_open",e)},getContactInfo:function(){if(underscore.find(utils.fields,function(e){return cookie(e)})){var e={};underscore.each(utils.fields,function(t){if(cookie(t)){e[t==="client_name"?"name":t]=cookie(t)}});return e}},getVisitorNumber:function(e){var t=cookie("client_id");if(t&&t.indexOf(".")>0&&typeof e==="function"){setTimeout(function(){e(null,t.split(".").shift())},0);return}getJSONPWithData(config.base_url+"/script/get-visitor-number/"+config.widget_id,{site:config.site_id},function(t){if(typeof t==="object"&&t.result&&"client_id" in t){cookie("client_id",t.client_id,{expires:365,path:"/"});if(typeof e==="function"){e(null,t.client_id.split(".").shift());return}e(new Error("Error fetching visitor number"))}})},setUserToken:function(e){if(typeof e==="string"||e instanceof String){connection.setUserToken(e)}},setCustomData:function(e){if(Object.prototype.toString.call(e)==="[object Array]"){connection.setCustomData(e)}},setContactInfo:function(e){if(e&&typeof e==="object"){for(var t in e){var i=e[t],n={},o=false;if(underscore.find(utils.fields,function(e){return e==="client_name"?t==="name":e===t})&&!cookie(t==="name"?"client_name":t)&&utils["isValidValue_"+t](i)){n[t]=i;o=true}if(o){jivo.handle("gui_introduced",n,true)}}}},showProactiveInvitation:function(e,t){ruleManager.showProactive(e,t,"jivo_api.showProactiveInvitation")}};var site_iframe={frm:0,create:function(){if(config.disable_iframe){log("Magic iframe is disabled");return}if(this.frm){log("Magic iframe already created");return}if(cookie("mframe")){log("Magic iframe create cancelled, page may be protected from iframe");return}cookie("mframe",1);log("Creating iframe");var e=document.createElement("iframe");e.setAttribute("id","jivo_magic_iframe");e.setAttribute("class","jivo-frame-hidden");e.setAttribute("frameborder","0px");e.setAttribute("name","col_old_page");document.body.appendChild(e);e.contentWindow.location=window.location;this.frm=e;setIframeLoadCallback(e,underscore.bind(this.onFrameLoaded,this))},onFrameLoaded:function(){log("Magic frame content loaded. Time to show the frame...");var e=document.getElementById("jivo_top_wrap");document.body.setAttribute("id","jivo_outer_body");document.body.style.overflow="hidden";document.body.scroll="no";var t=document.getElementsByTagName("iframe");for(var i=0;i<t.length;i++){var n=t[i];if(n.id!="jivo_magic_iframe"&&n.id!="jivo_chat_iframe"){n.style.display="none"}}this.frm.setAttribute("class","jivo-frame-visible");this.frm.style.display="block";if(this.hasScroll().vScrollbar){var o=this.getScrollBarWidth()+"px";log("Adjusting right margin. Scroll width="+o);document.getElementById("jivo-chat").style.marginRight=o;document.getElementById("jivo-label").style.marginRight=o}this.syncPageScroll()},navigate:function(e){log("navigating iframe to ",e);this.frm.contentDocument.location.href=e},getDoc:function(){var e=this.frm.contentWindow.document;if(!e){e=this.frm.contentDocument}if(!e){log("Cannot find document!! :(");return 0}return e},syncPageScroll:function(){var e=0,t=0;if(typeof window.pageYOffset=="number"){t=window.pageYOffset;e=window.pageXOffset}else{if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){t=document.body.scrollTop;e=document.body.scrollLeft}else{if(document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){t=document.documentElement.scrollTop;e=document.documentElement.scrollLeft}}}log("scroll pos x="+e+" y="+t);this.frm.contentWindow.scrollTo(e,t)},getScrollBarWidth:function(){var e=document.createElement("div");e.style.visibility="hidden";e.style.width="100px";document.body.appendChild(e);var t=e.offsetWidth;e.style.overflow="scroll";var i=document.createElement("div");i.style.width="100%";e.appendChild(i);var n=i.offsetWidth;e.parentNode.removeChild(e);return t-n},hasScroll:function(){var e={vScrollbar:true,hScrollbar:true};try{var t=document.compatMode=="BackCompat"?document.body:document.documentElement;e.vScrollbar=t.scrollHeight>t.clientHeight;e.hScrollbar=t.scrollWidth>t.clientWidth}catch(i){}return e}};var coBrowserIframeCreater=window.coBrowserIframeCreater=function(){var e,t,i=false,n=[],o=false,s={},r=function(a,c){log("coBrowserIframeCreater has received event "+a);var l=document.getElementById("jivo_frame");if(!l){l=jivoFrame.init(function(){log("jivoFrame has been inited");if(e){e.postMessage({name:"widget_ready"},t)}i=true;r()})}if(!i){n.push({name:a,params:c});return}if(n.length){var u=n.shift();a=u.name;c=u.params}var f;if(o){log("controller of childSandboxBridge set as for NodeWebkit");f=l.contentWindow.jqueryFrameControllerForAir;f.setLangpack(s);var d=document.createElement("link");d.setAttribute("rel","stylesheet");d.setAttribute("href",staticUrl("/css/for_air.css"));document.body.appendChild(d);f.init()}else{f=l.contentWindow.jqueryFrameController}if(f[a]&&a!="is_node_webkit"){f[a](c)}else{log("controller has not "+a)}if(n.length){r()}};function a(e,t,i){if(e.addEventListener){e.addEventListener(t,i,false)}else{if(e.attachEvent){e.attachEvent("on"+t,function(e){return function(){i.call(e,window.event)}}(e));e=null}}}var c=false;a(window,"message",function(i){var n=i.data;if(n.name=="in_node_webkit"){if(!e){e=i.source;t=i.origin}o=true;s=n.langpack;c=true}if(c&&t==i.origin){r(n.name,n)}},false);return{process:function(e,t){r(e,t)},postMessage:function(i){if(e){e.postMessage(i,t)}},isNodeWebkit:function(){return o}}}();var jqueryFrame=window.childSandboxBridge={_queue:[],_ready:0,_inAir:0,process:function(e,t){var i=document.getElementById("jivo_frame");if(!i){if(window.parentSandboxBridge&&window.parentSandboxBridge.inAir){this._inAir=true}i=jivoFrame.init(function(){log("jivoFrame has been inited");if(window.parentSandboxBridge){window.parentSandboxBridge.process("onJqueryIframeReady")}childSandboxBridge._ready=true;childSandboxBridge.process()})}if(!this._ready){this._queue.push({name:e,params:t});return}if(this._queue.length){var n=this._queue.shift();e=n.name;t=n.params}var o;if(this.inAir()){log("controller of childSandboxBridge set as for Air");o=i.contentWindow.jqueryFrameControllerForAir;var s=document.createElement("link");s.setAttribute("rel","stylesheet");s.setAttribute("href",staticUrl("/css/for_air.css"));document.body.appendChild(s);o.init()}else{o=i.contentWindow.jqueryFrameController}log("childSandboxBridge has received event "+e);if(o[e]){o[e](t)}else{log("controller has not "+e)}if(this._queue.length){this.process()}},inAir:function(){return this._inAir}};if(window.parentSandboxBridge){var log=function(e){window.parentSandboxBridge.log(e)};log("parentSandboxBridge.initInterface() called");window.parentSandboxBridge.initInterface()}var jivoFrame={_content:"<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>		<html>		<head>			<meta http-equiv='Content-Type' content='text/html; charset=utf-8' />			<script type='text/javascript'  src='"+staticUrl("/js/jquery_frame.js")+"'><\/script>			<script type='text/javascript'>    lblDefaultCobrowseComment='"+translate("lblDefaultCobrowseComment")+"';			<\/script>		</head>		<body >		</body>        </html>",_iframe:0,init:function(e){this._iframe=document.createElement("iframe");this._iframe.setAttribute("id","jivo_frame");this._iframe.setAttribute("frameBorder","0");this._iframe.setAttribute("scrolling","no");this._iframe.allowTransparency=true;this._iframe.style.backgroundColor="transparent";this._iframe.style.display="none";window.document.body.appendChild(this._iframe);setIframeLoadCallback(this._iframe,e);this._doc=this._getDoc();this._doc.open();this._doc.write(this._content);this._doc.close();this._window=this._iframe.contentWindow;this._iframe.contentWindow.controller=this;return this._iframe},_getDoc:function(){if(this._iframe.contentDocument){return this._iframe.contentDocument}else{if(this._iframe.contentWindow){return this._iframe.contentWindow.document}else{log("WARNING! chat_iframe._doc is null");return 0}}}}})();var widgetContainer,widgetLoaded;if(jivo.isMobile()){widgetLoaded=setInterval(function(){widgetContainer=document.getElementById("jivo_top_wrap");if(widgetContainer&&!jivo.ignore_viewport){widgetContainer.className+="mobile-version";document.getElementById("jivo-label").style.right="auto";jivoMobileLabel();clearInterval(widgetLoaded)}},100)}else{if(jivo.isTablet()){widgetLoaded=setInterval(function(){widgetContainer=document.getElementById("jivo_top_wrap");if(widgetContainer){widgetContainer.className+="tablet-version";clearInterval(widgetLoaded)}},100)}}function jivoMobileLabel(){if(!document.querySelector("meta[name=viewport]")){var d=document.createElement("meta");d.id="viewport";d.name="viewport";d.content="width=device-width, height=device-height, initial-scale=0.33, maximum-scale=1.2";document.getElementsByTagName("head")[0].appendChild(d)}else{var b=document.querySelector("meta[name=viewport]").getAttribute("content").split(","),a,g=false;for(var f=0;f<b.length;f++){b[f]=b[f].replace(/^\s+/,"");var c=b[f].split("=");if(c[0]=="maximum-scale"){g=true;if(c[1]>1){c[1]="1.2"}}b[f]=c[0]+"="+c[1]}if(!g){b.push("maximum-scale=1.2")}a=b.join(", ");document.querySelector("meta[name=viewport]").setAttribute("content",a)}setInterval(function(){if(document.getElementById("jivo-label")){var k=0,j=290,h=500;var m=window.innerWidth||window.pageXOffset||document.documentElement.clientWidth||document.getElementsByTagName("html")[0];var l=(m/j).toFixed(3);if(window.matchMedia("(orientation: landscape)").matches||Math.abs(window.orientation)===90){l=(m/h).toFixed(3)}if(l!=k){document.getElementById("jivo-label").style.zoom=l;k=l}}},100)};