function updateDelivery(b){var f=b.find(".js-quantity"),c=f.closest(".js-buyform").find(".js-add2basketpid").val(),d=f.val(),a=b.find(".product-delivery");var e=function(){rsFlyaway.darken(a)};BX.onCustomEvent("rs_delivery_update",[c,d,e,e])}var updateDeliveryDebounce=BX.debounce(updateDelivery,5000);function rsFlyawayOfferChange(n){var j=n.data("elementid"),b=new CatalogElement(j),f=n.find(".js-detail-carousel"),m,h,c;f.find(".js-detail-carousel-nav").css("transform","");var d=(rsFlyaway.products[j])?rsFlyaway.products[j].pictures:[];for(h=0,c=f.find(".owl-item:not(.cloned)").length;h<c;h++){f.trigger("remove.owl.carousel",h)}d.forEach(function(i){if(i.DATA.OFFER_ID==b.selectedOffer||i.DATA.OFFER_ID==0){m=$("<div></div>").addClass("preview-wrap").attr("data-dot","<img class='owl-preview' data-picture-id='"+i.PIC.ID+"' src='"+i.PIC.SRC+"'>").append($("<a></a>").addClass("js-open_popupgallery").attr("href",window.location.pathname).append($("<img>").attr("src",i.PIC.SRC)));f.trigger("add.owl.carousel",m).trigger("refresh.owl.carousel").resize()}});f.trigger("refresh.owl.carousel");setMaxHeightDetailImages();var k=(rsFlyaway.stocks[j].SKU)?rsFlyaway.stocks[j].SKU[b.selectedOffer]:undefined,g=n.find(".js-stores .stores-table"),l,a,e;if(k){for(a in k){l=g.find(".store_"+a);e=k[a];if(e>0&&e>rsFlyaway.stocks[j].LOW_QUANTITY){l.find(".stores-icon").removeClass("stores-mal").addClass("stores-full");l.find(".genamount").removeClass("empty").addClass("isset").html(rsFlyaway.stocks[j].MESSAGES.MESSAGE_ISSET)}else{if(e>0){l.find(".stores-icon").removeClass("stores-full").addClass("stores-mal");l.find(".genamount").removeClass("empty isset").html(rsFlyaway.stocks[j].MESSAGES.MESSAGE_LOW)}else{l.find(".stores-icon").removeClass("stores-full stores-mal");l.find(".genamount").removeClass("isset").addClass("empty").html(rsFlyaway.stocks[j].MESSAGES.MESSAGE_EMPTY)}}}}updateDeliveryDebounce(n)}function setMaxHeightDetailImages(a){var a=a||$(".product-detail-carousel__images").css("height");$(".js-detail-carousel img").css({"max-height":a})}$(document).ready(function(){setMaxHeightDetailImages();function b(f){return decodeURIComponent((new RegExp("[?|&]"+f+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[null,""])[1].replace(/\+/g,"%20"))||null}var a=b("offer_id");if(a){var e=new CatalogElement($(".js-detail").data("elementid"));e.selectOfferById(a);if(e.getOffer()){updateProductDataAfterOffersChanged($(".js-detail"))}}$(window).load(function(){setTimeout(function(){var f="/bitrix/components/bitrix/catalog.element/ajax.php";var g={AJAX:"Y",SITE_ID:SITE_ID,PARENT_ID:$(".js-detail").data("elementid"),PRODUCT_ID:$(".js-detail").find(".js-add2basketpid").val()};$.ajax({type:"POST",url:f,data:g}).done(function(h){console.warn("Element add to viewed")}).fail(function(){console.warn("Element can't add to viewed")})},500)});$(document).on("changeOffer.rs.flyaway",function(g,f){rsFlyawayOfferChange(f)});$(".product-bar").closest(".maincontent").css("min-height",$(".product-bar").height()+150);$(window).resize(debounce(function(){if($(window).width()>rsFlyaway.breakpoints.md){$(".product-bar").closest(".maincontent").css("min-height",$(".product-bar").height()+150)}else{$(".product-bar").closest(".maincontent").css("min-height","")}setMaxHeightDetailImages()},250));var c=$(".js-detail-carousel");$.expr[":"].visibleDotFilter=function(i,h,g){var f=$(i).closest(".js-detail-carousel-nav").parent();if(f.length===0){return false}var j=f.offset().top;return $(i).offset().top>=j&&$(i).offset().top+$(i).outerHeight()<=f.outerHeight()+j};var d=function(f,i){var h,g;h=f.css("transform");if(!h||h=="none"){g=i}else{if(h){g=parseInt(h.split(",")[5],10)+i}else{g=0}}f.css("transform","translateY("+g+"px)")};c.owlCarousel({items:1,nav:false,dots:true,dotsData:true,dotsContainer:".js-detail-carousel-nav",onRefreshed:function(){var f=$(this.settings.dotsContainer);f.css("transform","")},onChanged:function(){var i=$(this.settings.dotsContainer),g=i.find(".owl-dot"),f=g.filter(".active:eq(0)"),h=0;if(f.next(".owl-dot").length>0&&!g.filter(":visibleDotFilter").is(f.next(".owl-dot"))){h-=(f.next(".owl-dot").offset().top-f.next(".owl-dot").parent().offset().top)-(f.offset().top-f.parent().offset().top)}else{if(f.prev(".owl-dot").length>0&&!g.filter(":visibleDotFilter").is(f.prev(".owl-dot"))){h-=(f.prev(".owl-dot").offset().top-f.prev(".owl-dot").parent().offset().top)-(f.offset().top-f.parent().offset().top)}}d(i,h)}});$("#product-detail-tabs").tabCollapse({tabsClass:"hidden-sm hidden-xs",accordionClass:"visible-sm visible-xs mobile-props"});$("#product-detail-tabs .tabs-item:eq(0) a").click();$(document).on("shown.bs.collapse",".panel-collapse",function(){window.location.hash=this.id});$(".reviews_mob").on("click",function(){$("#form_reviews").toggle()});$(document).on("click",".js-open_popupgallery",function(i){i.preventDefault();var h=$(this),f=h.closest(".js-element").data("elementid"),g=new CatalogElement(f),j={AJAX_CALL:"Y",POPUP_GALLERY:"Y"};if(g.selectedOffer){j.OFFER_ID=g.selectedOffer}else{j.OFFER_ID=h.closest(".js-element").data("curerntofferid")}openPopup(h,"wide",$.extend({},{type:"ajax",cache:false,title:h.attr("title"),ajax:{dataType:"html",headers:{"X-fancyBox":true},data:j},helpers:{title:{type:"inside",position:"top"}},href:h.closest(".js-element").data("detailpageurl"),afterShow:function(){var k=$(".js-detail-carousel-nav .owl-dot.active img").data("pictureId");if(k){this.inner.find(".thumbs .pic"+k+" a").click()}this.inner.find(".thumbs .thumb a").on("click.popupgallery_change_image",function(m){var l=$(this).data("index");console.log(l);h.closest(".js-element").find(".js-detail-carousel-nav .owl-dot img[data-picture-id="+l+"]").click()})},beforeClose:function(){console.log(this.inner)}}))});$(".js-select-input.js-quantity").on("change",function(){updateDelivery($(this).closest(".js-element"));var g=$(this).data("add-measure-factor"),f,h;if(g){f=$(".js-detail");f.find(".js-additional-factor").text(this.value*g);h=$(".js-detail").find(".js-add-measure__price").data("price");f.find(".js-add-measure__total").text(BX.Currency.currencyFormat(this.value*h,BX.Currency.defaultCurrency,true))}});$(".js-calc_delivery").on("click",function(){updateDelivery($(this).closest(".js-element"))})});