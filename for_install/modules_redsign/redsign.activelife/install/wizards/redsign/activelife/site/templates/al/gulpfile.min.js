"use strict";var gulp=require("gulp");var runSequence=require("run-sequence");var sass=require("gulp-sass");var sourcemaps=require("gulp-sourcemaps");var args=require("yargs").argv;var pixrem=require("gulp-pixrem");var autoprefixer=require("gulp-autoprefixer");var cssmin=require("gulp-minify-css");var spritesmith=require("gulp.spritesmith");var spritesmash=require("gulp-spritesmash");var uglify=require("gulp-uglify");var rename=require("gulp-rename");var path={src:{styles:"./sass",js:"./",images:"./img"},build:{styles:"./assets/css",images:"./assets/img",js:"./"},watch:{styles:"./sass/**/*.scss",sprite:{png:"assets/img/themes/"},js:["./**/*.js","!./node_modules/*.js","!./node_modules/**/*.js","!./gulpfile.js","!./**/*.min.js","!./**/*.map.js","!*.min.js","!*.map.js"]}};var themes=["activelife","everyday","fashionshow","homeware","lovekids","mediamart","officespace","pethouse","stroymart"];gulp.task("default",["build","watch"]);gulp.task("build",function(){if(args.theme=="all"){for(var a in themes){runSequence("sprite.png:build --theme="+themes[a],"styles:build --theme="+themes[a])}}else{if(args.theme){runSequence("sprite.png:build","styles:build")}else{runSequence("sprite.png:build","styles:build")}}});gulp.task("watch",function(){gulp.watch([path.watch.sprite.png],["sprite.png:build"]);gulp.watch([path.watch.styles],["styles:build"])});gulp.task("js:build",function(){gulp.src(path.watch.js).pipe(uglify().on("error",function(a){console.log(a)})).pipe(rename({suffix:".min"})).pipe(sourcemaps.write("./")).pipe(gulp.dest(path.build.js))});gulp.task("styles:build",function(){var a="./build/"+themes[0]+"/"+path.build.styles;if(args.theme=="all"){}else{if(args.theme){a=path.build.styles}else{a=path.build.styles}}if(args.production){gulp.src(path.watch.styles).pipe(sass().on("error",sass.logError)).pipe(pixrem({atrules:true})).pipe(autoprefixer({browsers:["last 2 versions"],cascade:false})).pipe(gulp.dest(a)).pipe(cssmin()).pipe(rename({suffix:".min"})).pipe(gulp.dest(a))}else{gulp.src(path.watch.styles).pipe(sourcemaps.init()).pipe(sass().on("error",sass.logError)).pipe(pixrem({atrules:true,rootValue:"16px"})).pipe(autoprefixer({browsers:["last 2 versions"],cascade:false})).pipe(sourcemaps.write("./")).pipe(gulp.dest(a));gulp.src(a+"/template.css").pipe(pixrem({atrules:true,replace:true,rootValue:"16px"})).pipe(gulp.dest(a+"/1/"))}});gulp.task("sprite:build",["sprite.png:build"]);gulp.task("sprite.png:build",function(){var b="icons.png";var a=gulp.src([path.watch.sprite.png+"_base/icon/png/*.png",path.watch.sprite.png+(args.theme?args.theme:themes[0])+"/icon/png/*.png"]).pipe(spritesmith({imgName:b,cssName:"./_sprite.scss",cssFormat:"scss",imgPath:"../img/"+b}));a.img.pipe(gulp.dest(path.build.images));a.css.pipe(spritesmash()).pipe(gulp.dest(path.src.styles))});