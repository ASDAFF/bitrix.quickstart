var Basket={url:null,itemClass:null,btnClass:null,fastOrderClass:null,fastOrderBtnClass:null,successAddFunction:function(a){$.fancybox(a)},successMessage:'<div class="success"><div class="title">Заказ успешно оформлен</div><div class="text">В ближайшее время наш менеджер свяжется с Вами!</div></div>',init:function(a){var b=$.extend(true,{},this);b.url=a;return b},setItemClass:function(a){this.itemClass=a;return this},setBtnClass:function(a){this.btnClass=a;return this},setFastOrderBtnClass:function(a){this.fastOrderBtnClass=a;return this},setFastOrderClass:function(a){this.fastOrderClass=a;return this},setEvents:function(){var a=this;a.setPlusMinusEvents();$(this.btnClass).off("click").on("click",function(h){h.preventDefault();var g=$(this).data();g.PRODUCT_ID=g.id;var f=$(this).closest(".catalogFull, .catalogItem").find('input[name="QUANTITY"]');g.QUANTITY=f&&f.val()?f.val()*1:1;if(g.props){var b=g.props.split(",");g.PROPERTIES={};for(var c in b){var d=$(this).closest(".catalogFull, .catalogItem").find('[data-name="'+b[c]+'"].selected');if(d&&d.data("value")){g.PROPERTIES[b[c]]=d.data("value")}}}a.add(g,$(this).closest(a.itemClass).get(0))});return this},setSuccessMessage:function(a){this.successMessage=a;return this},add:function(a,b){var c=this;if(b=="undefined"){b=$("body").get(0)}BX.showWait(b);$.post((this.url+(this.url.indexOf("?")!==-1?"&":"?")+"action=add"),a,function(d){c.successAddFunction(d);BX.closeWait(b)},"json");return this},setSuccessAddFunction:function(a){this.successAddFunction=a;return this},setFastOrder:function(a,c){var b=$(a),d=this;c=c||b.find('[type="submit"]').parent().get(0);d.setPlusMinusEvents();$(d.fastOrderBtnClass).off("click").on("click",function(f){f.preventDefault();b.find("input, textarea").val("");b.find(".it-error").empty();b.find('input[name="PRODUCT_ID"]').val($(this).data("id"));b.find('input[name="QUANTITY"]').val(1);$.fancybox.open(b)});b.find("form").off("submit").on("submit",function(g){g.preventDefault();var f=$(this);BX.showWait(c);$.post((d.url+(d.url.indexOf("?")!==-1?"&":"?")+"action=fastOrder"),$(this).serialize(),function(e){BX.closeWait(c);console.log(e);if(e&&e.errors){b.find(".it-error").empty();b.find("input, textarea").css({border:"1px solid #dfcd7d"});for(var h in e.errors){d.addErrorToElement(f.find('[name="'+h+'"]').first(),e.errors[h])}}else{d.successAddFunction(d.successMessage)}},"json");return false});return this},setPlusMinusEvents:function(){$('.plus:not(".not-from-lib"), .minus:not(".not-from-lib")').off("click").on("click",function(b){b.preventDefault();var a=$(this).parent().find("input").first(),c=parseInt(a.val().replace(/\D+/g,""))+($(this).hasClass("plus")?1:-1);if(c<1||isNaN(c)){c=1}a.val(c).attr("value",c).get(0).value=c});$('.plus:not(".not-from-lib")').parent().find("input").first().off("input change").on("input",function(a){a.preventDefault();var b=$(this).val()*1;if(b<1||isNaN(b)){b=1}$(this).get(0).value=b});return this},addErrorToElement:function(b,a){$(b).css({border:"1px solid red"}).closest(".it-block").find(".it-error").html(a);return this}};