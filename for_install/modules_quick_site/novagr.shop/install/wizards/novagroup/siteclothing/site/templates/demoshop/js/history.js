/*
 * history API JavaScript Library v2.0.4
 *
 * Support: IE6+, FF3+, Opera 9+, Safari
 *
 * Copyright 2011-2012, Dmitriy Pakhtinov ( spb.piksel@gmail.com )
 *
 * http://spb-piksel.ru/
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * Update: 06-04-2012
 */
(function(b,r){function i(a){var d=e.href.split("#"),a=a||d.shift()&&"#"+d.join("#"),d=(a||"#").replace(RegExp("^#[/]?(?:"+h.type+")?"),""),c=h.basepath+d,b=(a=c.split("?")).shift(),f=(a=a.join("?").split("#")).shift(),a=a.join("#");return{base:d,url:c,href:e.protocol+"//"+e.host+c,protocol:e.protocol,host:e.host,hostname:e.hostname,port:e.port,path:b.replace(/[^\/]+$/g,""),pathname:b,search:f?"?"+f:"",hash:a?"#"+a:"",toString:function(){return this.href}}}function G(){var a=e.pathname;if(y){if(l!=
h.basepath&&RegExp("^"+h.basepath+"$","i").test(a))b.location=l;if(!RegExp("^"+h.basepath,"i").test(a))b.location=a.replace(/^\//,h.basepath)+e.search}else if(a!=h.basepath)return b.location=h.basepath+"#"+a.replace(RegExp("^"+h.basepath,"i"),h.type)+e.search+e.hash,!1;return!0}function z(){if(A&&!(A=!1)&&l!==h.basepath)clearInterval(B),setTimeout(function(){C()},10)}function s(a){return b.sessionStorage?a?(sessionStorage.setItem("__hitoryapi__",D(a)),a):((a=sessionStorage.getItem("__hitoryapi__"))?
b.JSON&&JSON.parse?JSON.parse(a):(new Function("return "+a))():null)||{}:{}}function q(){var a=j?j.storage:s()[i().href];g.state=a&&a.state||null;g.title=a&&a.title||k.title;g.location=i()}function C(){q();if(null!=g.title)k.title=g.title;if(k.createEvent){var a=k.createEvent("Events");a.initEvent("popstate",!1,!1)}else a=k.createEventObject(),a.type="popstate";a.location=g.location;a.state=g.state;a.title=g.title;a.srcElement=b;b.dispatchEvent?b.dispatchEvent(a):b.fireEvent("popstate",a)}function t(){var a=
i().url;l!==a&&(l=a,C())}var y=!(!b.history||!history.pushState),k=b.document,e=b.location,g=b.history||{},l,h=function(){var a,d,c,b={basepath:"/",redirect:!1,type:""};c=k.getElementsByTagName("SCRIPT");for(a=0;c[a];a++)if(d=/(.*)\/history(?:-\d\.\d(?:\.\d\w?)?(?:\.min)?)?.js\?(.*)$/i.exec(c[a].src)){for(a=0,c=d[2].split("&");c[a];)d=c[a++].split("="),b[d[0]]="true"==d[1]?!0:"false"==d[1]?!1:d[1]||"";break}return b}();l=i().url;g.location=e;if(!(h.redirect&&0===b.parent.frames.length&&!G()||y)){var n,
o,p,E=eval("/*@cc_on @_jscript_version;@*/"),F=(n="addEventListener",b[n])||(n="attachEvent",b[n]),H=(o="removeEventListener",b[o])||(o="detachEvent",b[o]),I=(p="dispatchEvent",b[p])||(p="fireEvent",b[p]),u={popstate:1,onpopstate:1},m=[],j,v,A=!0,B;B=setInterval(function(){b.onpopstate&&"[object Function]"===Object.prototype.toString.call(b.onpopstate)&&z()},100);b[n]=function(a,b,c,x){u[a]?(m.push(b),z()):F(a,b,c,x)};b[o]=function(a,b,c){if(u[a])for(a=m.length;--a;){if(m[a]===b){m.splice(a,1);break}}else H(a,
b,c)};b[p]=function(a,d){if(u[a&&a.type||a]){d=d||("string"==typeof a?b.event:a);try{d&&(d.target=b)}catch(c){try{d.srcElement=b}catch(x){}}if(b.onpopstate&&"[object Function]"===Object.prototype.toString.call(b.onpopstate)&&!1===b.onpopstate.call(b,d))return!1;for(var f=0,J=m.length;f<J;f++)if(!1===m[f].call(b,d))return!1;return!0}return I(a,d)};var D=function(){function a(a){var b=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
d={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};b.lastIndex=0;return b.test(a)?'"'+a.replace(b,function(a){var c=d[a];return"string"===typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function d(c){var b,f,e;b=(typeof c).charCodeAt(2);if(114==b)c=a(c);else if(109==b)c=isFinite(c)?""+c:"null";else if(111==b||108==b)c=""+c;else if(106==b)if(c){f=(b="[object Array]"===Object.prototype.toString.apply(c))?"[":"{";if(b)for(e=0;e<c.length;e++)f+=
(0==e?"":",")+d(c[e]);else for(e in c)Object.hasOwnProperty.call(c,e)&&c[e]!==r&&(f+=(1==f.length?"":",")+a(e)+":"+d(c[e]));c=f+(b?"]":"}")}else c="null";else c=r;return c}return b.JSON&&JSON.stringify?JSON.stringify:d}();if(E&&5.8>E){j=k.createElement("iframe");j.src="javascript:true;";j=k.documentElement.firstChild.appendChild(j).contentWindow;j.storage=null;j.onload=q;var w=function(a,b,c,h){var f=j.document,g=["<script>","lfirst=1;",null,"storage="+D(b)+";","<\/script>"];if(c)j.lfirst?(history.back(),
w(a,b,0,1)):e.replace("#"+a);else if(i("#"+a).url!=i().url||h){if(!j.lfirst)j.lfirst=1,w(i().base,j.storage,0,1);g[2]='parent.location.hash="'+a.replace(/"/g,'\\"')+'";';f.open();f.write(g.join(""));f.close()}};v=setInterval(t,100)}else F((b.addEventListener?"":"on")+"hashchange",t,!1);q();g.emulate=!0;g.pushState=function(a,d,c,g){c=c==r||null==c?h.basepath:c;c=c.replace(RegExp("^"+e.protocol+"//"+e.host+"/","i"),"/");0==c.indexOf("?")?c=i().pathname+c:0!=c.indexOf("/")&&(c=i().path+c);RegExp("^"+
h.basepath,"i").test(c)?c=c.replace(RegExp("^"+h.basepath,"i"),h.type):e.href=c;var a={state:a,title:d},f=s();j?(clearInterval(v),l=i("#"+c).url,w(c,a,g),v=setInterval(t,100)):(l=i("#"+c).url,g?(f[i().href]&&delete f[i().href],b.location.replace("#"+c)):b.location.hash=c,f[i().href]=a,s(f));q();if(null!=d)k.title=d};g.replaceState=function(a,b,c){g.pushState(a,b,c,!0)}}})(window);
