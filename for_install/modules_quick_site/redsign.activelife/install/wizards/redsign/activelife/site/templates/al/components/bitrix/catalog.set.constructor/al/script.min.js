BX.namespace("BX.Catalog.SetConstructor");BX.Catalog.SetConstructor=(function(){var a=function(c){this.numSliderItems=c.numSliderItems||0;this.numSetItems=c.numSetItems||0;this.jsId=c.jsId||"";this.ajaxPath=c.ajaxPath||"";this.currency=c.currency||"";this.lid=c.lid||"";this.iblockId=c.iblockId||"";this.basketUrl=c.basketUrl||"";this.setIds=c.setIds||null;this.offersCartProps=c.offersCartProps||null;this.itemsRatio=c.itemsRatio||null;this.noFotoSrc=c.noFotoSrc||"";this.messages=c.messages;this.mainElementPrice=c.mainElementPrice||0;this.mainElementOldPrice=c.mainElementOldPrice||0;this.mainElementDiffPrice=c.mainElementDiffPrice||0;this.mainElementBasketQuantity=c.mainElementBasketQuantity||1;this.parentCont=BX(c.parentContId)||null;this.sliderItemsCont=this.parentCont.querySelector("[data-role='set-other-items']");this.setItemsCont=this.parentCont.querySelector("[data-role='set-items']");this.setPriceCont=this.parentCont.querySelector("[data-role='set-price']");this.setOldPriceCont=this.parentCont.querySelector("[data-role='set-old-price']");this.setDiffPriceCont=this.parentCont.querySelector("[data-role='set-diff-price']");this.notAvailProduct=this.sliderItemsCont.querySelector("[data-not-avail='yes']");this.emptySetMessage=this.parentCont.querySelector("[data-set-message='empty-set']");BX.bindDelegate(this.setItemsCont,"click",{attribute:"data-role"},BX.proxy(this.deleteFromSet,this));BX.bindDelegate(this.sliderItemsCont,"click",{attribute:"data-role"},BX.proxy(this.addToSet,this));var b=this.parentCont.querySelector("[data-role='set-buy-btn']");BX.bind(b,"click",BX.proxy(this.addToBasket,this));this.generateSliderStyles()};a.prototype.generateSliderStyles=function(){var b=BX.create("style",{html:".bx-catalog-set-topsale-slids-"+this.jsId+"{width: "+this.numSliderItems*240+"px}.bx-catalog-set-item-container-"+this.jsId+"{width: "+(100/this.numSliderItems)+"%;}@media (max-width:767px){.bx-catalog-set-topsale-slids-"+this.jsId+"{width: "+this.numSliderItems*240+"px;}}",attrs:{id:"bx-set-const-style-"+this.jsId}});if(BX("bx-set-const-style-"+this.jsId)){BX.remove(BX("bx-set-const-style-"+this.jsId))}this.parentCont.appendChild(b)};a.prototype.deleteFromSet=function(){var g=BX.proxy_context,r,n,t,d,k,o,s,q,j,p,b,h,f,c,m;if(g&&g.hasAttribute("data-role")&&g.getAttribute("data-role")=="set-delete-btn"){r=g.parentNode.parentNode;n=r.getAttribute("data-id");t=r.getAttribute("data-name");d=r.getAttribute("data-url");k=r.getAttribute("data-img");o=r.getAttribute("data-print-price");s=r.getAttribute("data-price");q=r.getAttribute("data-print-old-price");itemPrintDiffPrice=r.getAttribute("data-diff-print-price");j=r.getAttribute("data-old-price");p=r.getAttribute("data-diff-price");b=r.getAttribute("data-measure");h=r.getAttribute("data-quantity");m=BX.create("div",{attrs:{className:"catalog_item catalog_item__inner bx-catalog-set-item-container bx-catalog-set-item-container-"+this.jsId,"data-id":n,"data-img":k?k:"","data-url":d,"data-name":t,"data-print-price":o,"data-print-old-price":q,"data-diff-print-price":itemPrintDiffPrice,"data-price":s,"data-old-price":j,"data-diff-price":p,"data-measure":b,"data-quantity":h},children:[BX.create("div",{attrs:{className:"bx-catalog-set-item"},children:[BX.create("div",{attrs:{className:"bx-catalog-set-item-img"},children:[BX.create("div",{attrs:{className:"bx-catalog-set-item-img-container"},children:[BX.create("img",{attrs:{src:k?k:this.noFotoSrc,className:"img-responsive"}})]})]}),BX.create("div",{attrs:{className:"bx-catalog-set-item-title"},children:[BX.create("a",{attrs:{href:d},html:t})]}),BX.create("div",{attrs:{className:"bx-catalog-set-item-price clearfix"},children:[BX.create("div",{attrs:{className:"bx-catalog-set-item-price-new price__pdv"},html:o}),BX.create("div",{attrs:{className:"bx-catalog-set-item-price-dics price__pdd js-price_pdd-2"},html:s!=j?"- "+itemPrintDiffPrice:""})]}),BX.create("div",{attrs:{className:"bx-catalog-set-item-add-btn clearfix"},children:[BX.create("a",{attrs:{className:"btn-add catalog_item__add2cart btn add2cart","data-role":"set-add-btn"},html:this.messages.ADD_BUTTON})]})]})]});if(s==j){var e=BX.findChild(m,{"class":"bx-catalog-set-item-price-dics"},true);BX.remove(e)}if(!!this.notAvailProduct){this.sliderItemsCont.insertBefore(m,this.notAvailProduct)}else{this.sliderItemsCont.appendChild(m)}this.numSliderItems++;this.numSetItems--;this.generateSliderStyles();BX.remove(r);for(f=0,c=this.setIds.length;f<c;f++){if(this.setIds[f]==n){this.setIds.splice(f,1)}}this.recountPrice();if(this.numSetItems<=0&&!!this.emptySetMessage){BX.adjust(this.emptySetMessage,{style:{display:"inline-block"},html:this.messages.EMPTY_SET})}}};a.prototype.addToSet=function(){var e=BX.proxy_context,m,i,o,d,h,j,n,l,g,k,b,f,c;if(!!e&&e.hasAttribute("data-role")&&e.getAttribute("data-role")=="set-add-btn"){m=e.parentNode.parentNode.parentNode;i=m.getAttribute("data-id");o=m.getAttribute("data-name");d=m.getAttribute("data-url");h=m.getAttribute("data-img");j=m.getAttribute("data-print-price");n=m.getAttribute("data-price");l=m.getAttribute("data-print-old-price");itemPrintDiffPrice=m.getAttribute("data-diff-print-price");g=m.getAttribute("data-old-price");k=m.getAttribute("data-diff-price");b=m.getAttribute("data-measure");f=m.getAttribute("data-quantity");c=BX.create("tr",{attrs:{"data-id":i,"data-img":h?h:"","data-url":d,"data-name":o,"data-print-price":j,"data-print-old-price":l,"data-diff-print-price":itemPrintDiffPrice,"data-price":n,"data-old-price":g,"data-diff-price":k,"data-measure":b,"data-quantity":f},children:[BX.create("td",{attrs:{className:"bx-added-item-table-cell-img"},children:[BX.create("img",{attrs:{src:h?h:this.noFotoSrc,className:"img-responsive"}})]}),BX.create("td",{attrs:{className:"bx-added-item-table-cell-itemname"},children:[BX.create("a",{attrs:{href:d,className:"tdn"},html:o}),BX.create("br"),BX.create("span",{html:this.messages.MEASURE_NUM+f+" "+b})]}),BX.create("td",{attrs:{className:"bx-added-item-table-cell-price"},children:[BX.create("span",{attrs:{className:"bx-added-item-old-price price__pv"},html:n!=g?l:""}),BX.create("br"),BX.create("span",{attrs:{className:"bx-added-item-new-price price__pdv"},html:j})]}),BX.create("td",{attrs:{className:"bx-added-item-table-cell-del"},children:[BX.create("div",{attrs:{className:"bx-added-item-delete","data-role":"set-delete-btn"}})]})]});this.setItemsCont.appendChild(c);this.numSliderItems--;this.numSetItems++;this.generateSliderStyles();BX.remove(m);this.setIds.push(i);this.recountPrice();if(this.numSetItems>0&&!!this.emptySetMessage){BX.adjust(this.emptySetMessage,{style:{display:"none"},html:""})}}};a.prototype.recountPrice=function(){var f=this.mainElementPrice*this.mainElementBasketQuantity,h=this.mainElementOldPrice*this.mainElementBasketQuantity,g=this.mainElementDiffPrice*this.mainElementBasketQuantity,d=BX.findChildren(this.setItemsCont,{tagName:"tr"},true),c,b,e;if(d){for(c=0,b=d.length;c<b;c++){e=Number(d[c].getAttribute("data-quantity"))||1;f+=Number(d[c].getAttribute("data-price"))*e;h+=Number(d[c].getAttribute("data-old-price"))*e;g+=Number(d[c].getAttribute("data-diff-price"))*e}}this.setPriceCont.innerHTML=BX.Currency.currencyFormat(f,this.currency,true);if(Math.floor(g*100)>0){this.setOldPriceCont.innerHTML=BX.Currency.currencyFormat(h,this.currency,true);this.setDiffPriceCont.innerHTML=BX.Currency.currencyFormat(g,this.currency,true)}else{this.setOldPriceCont.innerHTML="";this.setDiffPriceCont.innerHTML=""}};a.prototype.addToBasket=function(){var b=BX.proxy_context;BX.showWait(b.parentNode);BX.ajax.post(this.ajaxPath,{sessid:BX.bitrix_sessid(),action:"catalogSetAdd2Basket",set_ids:this.setIds,lid:this.lid,iblockId:this.iblockId,setOffersCartProps:this.offersCartProps,itemsRatio:this.itemsRatio},BX.proxy(function(c){BX.closeWait();document.location.href=this.basketUrl},this))};return a})();function buy1click(a){var c="";c+=a.closest(".bx-modal-container").find(".js-main-elem-set").data("elemmain");a.closest(".bx-modal-container").find(".bx-added-item-table-container").find("tr").each(function(){c+="["+$(this).data("id")+"] "+$(this).data("name")+", "});var b={};b.RS_EXT_FIELD_0=c;if($(window).width()>=780){$(document).one("RSSline_FancyAfterLoad",function(){setTimeout(function(){$(".form-group [name=RS_EXT_FIELD_0]").val(c)},50)})}else{BX.localStorage.set("ajax_data",b)}}$(document).ready(function(){$(".bx-added-item-table-container").scrollbar({scrollx:"none"});$(".bx-modal-container").find(".bx-catalog-set-topsale-slider-container").scrollbar({showArrows:true,scrollx:$(".bx-modal-container").find(".picbox__bar"),scrollStep:220})});$(document).on("click",".bx-constructor-container-result .buy1click",function(){buy1click($(this))});$(document).on("click",".show_more_set",function(){$(this).closest(".bx-modal-container").find(".bx-catalog-set-topsale-slider-box").show();$(this).hide();return false});