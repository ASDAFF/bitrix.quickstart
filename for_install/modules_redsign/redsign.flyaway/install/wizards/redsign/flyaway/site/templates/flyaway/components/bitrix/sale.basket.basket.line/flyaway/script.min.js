"use strict";function BitrixSmallCart(){}BitrixSmallCart.prototype={activate:function(){this.cartElement=BX(this.cartId);this.isOpen=false;this.fixedPosition=this.arParams.POSITION_FIXED=="Y";if(this.fixedPosition){this.cartClosed=true;this.maxHeight=false;this.itemRemoved=false;this.verticalPosition=this.arParams.POSITION_VERTICAL;this.horizontalPosition=this.arParams.POSITION_HORIZONTAL;this.topPanelElement=BX("bx-panel");this.fixAfterRender();this.fixAfterRenderClosure=this.closure("fixAfterRender");var b=this.closure("fixCart");this.fixCartClosure=b;if(this.topPanelElement&&this.verticalPosition=="top"){BX.addCustomEvent(window,"onTopPanelCollapse",b)}var a=null;BX.bind(window,"resize",function(){clearTimeout(a);a=setTimeout(b,200)})}this.setCartBodyClosure=this.closure("setCartBody");BX.addCustomEvent(window,"OnBasketChange",this.closure("refreshCart",{}))},fixAfterRender:function(){this.statusElement=BX(this.cartId+"status");if(this.statusElement){if(this.cartClosed){this.statusElement.innerHTML=this.openMessage}else{this.statusElement.innerHTML=this.closeMessage}}this.productsElement=BX(this.cartId+"products");this.fixCart()},closure:function(c,a){var b=this;return a?function(){b[c](a)}:function(d){b[c](d)}},toggleOpenCloseCart:function(){if(this.cartClosed){BX.removeClass(this.cartElement,"bx-closed");BX.addClass(this.cartElement,"bx-opener");this.statusElement.innerHTML=this.closeMessage;this.cartClosed=false;this.fixCart()}else{BX.addClass(this.cartElement,"bx-closed");BX.removeClass(this.cartElement,"bx-opener");BX.removeClass(this.cartElement,"bx-max-height");this.statusElement.innerHTML=this.openMessage;this.cartClosed=true;var a=this.cartElement.querySelector("[data-role='basket-item-list']");if(a){a.style.top="auto"}}setTimeout(this.fixCartClosure,100)},setVerticalCenter:function(b){var a=b/2-(this.cartElement.offsetHeight/2);if(a<5){a=5}this.cartElement.style.top=a+"px"},fixCart:function(){if(this.horizontalPosition=="hcenter"){var b="innerWidth" in window?window.innerWidth:document.documentElement.offsetWidth;var c=b/2-(this.cartElement.offsetWidth/2);if(c<5){c=5}this.cartElement.style.left=c+"px"}var d="innerHeight" in window?window.innerHeight:document.documentElement.offsetHeight;switch(this.verticalPosition){case"top":if(this.topPanelElement){this.cartElement.style.top=this.topPanelElement.offsetHeight+5+"px"}break;case"vcenter":this.setVerticalCenter(d);break}if(this.productsElement){var a=this.cartElement.querySelector("[data-role='basket-item-list']");if(this.cartClosed){if(this.maxHeight){BX.removeClass(this.cartElement,"bx-max-height");if(a){a.style.top="auto"}this.maxHeight=false}}else{if(this.maxHeight){if(this.productsElement.scrollHeight==this.productsElement.clientHeight){BX.removeClass(this.cartElement,"bx-max-height");if(a){a.style.top="auto"}this.maxHeight=false}}else{if(this.verticalPosition=="top"||this.verticalPosition=="vcenter"){if(this.cartElement.offsetTop+this.cartElement.offsetHeight>=d){BX.addClass(this.cartElement,"bx-max-height");if(a){a.style.top=82+"px"}this.maxHeight=true}}else{if(this.cartElement.offsetHeight>=d){BX.addClass(this.cartElement,"bx-max-height");if(a){a.style.top=82+"px"}this.maxHeight=true}}}}if(this.verticalPosition=="vcenter"){this.setVerticalCenter(d)}}},refreshCart:function(a){if(this.itemRemoved){this.itemRemoved=false;return}this.isOpen=$("#dropdown_basket").is(":visible");a.sessid=BX.bitrix_sessid();a.siteId=this.siteId;a.templateName=this.templateName;a.arParams=this.arParams;rsFlyaway.darken($("#dropdown_basket .basket-table"));BX.ajax({url:this.ajaxPath,method:"POST",dataType:"html",data:a,onsuccess:this.setCartBodyClosure})},setCartBody:function(a){if(this.cartElement){this.cartElement.innerHTML=a}if(this.fixedPosition){setTimeout(this.fixAfterRenderClosure,100)}if(this.isOpen){$(document).off("click.dropdown-basket");$("#dropdown_basket_link").click()}initSelect()},removeItemFromCart:function(a){this.refreshCart({sbblRemoveItemFromCart:a});this.itemRemoved=true;BX.onCustomEvent("OnBasketChange");$(document).trigger("change.rs_flyaway.inbasket")}};$(document).ready(function(){$(document).on("click","#dropdown_basket_link",function(a){if($(window).width()<=rsFlyaway.breakpoints.sm||$(this).siblings("#dropdown_basket").find(".js-smbasket tr").length===0){return true}a.preventDefault();$("#dropdown_basket").show();$(document).on("click.dropdown-basket",function(b){if(!$(b.target).parents().andSelf().is("#dropdown_basket")){$("#dropdown_basket").hide();$(document).off("click.dropdown-basket")}})});$(document).on("change",".js-outbasket-quantity",function(){var d=$(this),a=d.parents("tr.js-element"),e=d.parents("tr.js-element").data("id"),c=d.val(),b=$(".js-addbasketpopup");if(b.length>0){rsFlyaway.darken(b)}Basket.updateQuantity(e,c).then(function(f){console.log(f);if(b.length>0){console.log(f.BASKET_DATA.GRID.ROWS[e]);if(f.BASKET_DATA.GRID.ROWS[e]){b.find(".js-item-price").html(f.BASKET_DATA.GRID.ROWS[e].FULL_PRICE_FORMATED);b.find(".js-outbasket-quantity").val(f.BASKET_DATA.GRID.ROWS[e].QUANTITY);b.find(".js-item-sum").html(f.BASKET_DATA.GRID.ROWS[e].SUM)}$(".js-total-price").html(f.BASKET_DATA.allSum_FORMATED);rsFlyaway.darken(b)}});BX.onCustomEvent("OnBasketChange")});$(document).on("show.bs.dropdown",".js-smbasket .js-select",function(d){var b=$(this),c=b.find(".select-menu"),a=b.position().top+b.outerHeight(),f=$(".js-smbasket .heighter").outerHeight();if(a+c.outerHeight()>f&&b.position().top-c.outerHeight()>0){c.css({top:"auto",bottom:"100%","margin-bottom":"2px"})}else{if(a+c.outerHeight()>f&&b.position().top-c.outerHeight()<=0){if(b.position().top<=f-a){c.css({"max-height":(f-a-5)+"px"})}else{c.css({top:"auto",bottom:"100%","margin-bottom":"2px","max-height":(b.position().top-5)+"px"})}}}});$(document).on("hidden.bs.dropdown",".js-smbasket .js-select",function(a){$(this).find(".select-menu").removeAttr("style")})});