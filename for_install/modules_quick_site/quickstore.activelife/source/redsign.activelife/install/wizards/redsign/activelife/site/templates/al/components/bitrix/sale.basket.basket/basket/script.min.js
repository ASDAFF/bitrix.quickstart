function updateBasketTable(e,t){var a,s,i,o,l,n,r,_,u,c,d,p,T,A,E,b,B,f,P,v,y,m,X,I,S,C,k,O,D,N,h,R,U,L=BX("basket_items"),g=!1,Q=!1,M=!1,F=!1,Y=!1,H=!1,x=!1,w=BX("basket_form");if(L&&"object"==typeof t){if(a=L.rows,o=a[a.length-1],r="Y"===t.PARAMS.QUANTITY_FLOAT,null!==e&&t.BASKET_DATA){s=t.BASKET_ID,i=t.BASKET_DATA.GRID.ROWS[s],n=t.COLUMNS.split(","),l=document.createElement("tr"),_=BX(e),l.setAttribute("id",t.BASKET_ID),l.setAttribute("class","table_item product"),o.parentNode.insertBefore(l,_.nextSibling),"Y"===t.DELETE_ORIGINAL&&_.parentNode.removeChild(_);var G=["TYPE","PROPS","DELAY","DELETE","DISCOUNT","WEIGHT"];for(u=0;u<n.length;u++)if("TYPE"===n[u])x=!0;else if("PROPS"===n[u])H=!0;else if("DELAY"===n[u])Q=!0;else if("DELETE"===n[u])g=!0;else if("DISCOUNT"===n[u])F=!0;else if("WEIGHT"===n[u])Y=!0;else if(n[u].indexOf("PROPERTY_")!=-1&&basketJSParams.ARTICLE_PROP&&Object.keys(basketJSParams.ARTICLE_PROP).length>0)for(var K in basketJSParams.ARTICLE_PROP)if(n[u]=="PROPERTY_"+basketJSParams.ARTICLE_PROP[K]){G.push(n[u]),M=u;break}e:for(u=0;u<n.length;u++){for(K in G)if(G[K]==n[u])continue e;switch(n[u]){case"TYPE":case"PROPS":case"DELAY":case"DELETE":case"DISCOUNT":case"WEIGHT":break;case"NAME":if(d=l.insertCell(-1),d.setAttribute("class","table_item__item"),p="",c=i.PREVIEW_PICTURE_SRC.length>0?i.PREVIEW_PICTURE_SRC:i.DETAIL_PICTURE_SRC.length>0?i.DETAIL_PICTURE_SRC:basketJSParams.TEMPLATE_FOLDER+"/assets/img/noimg.png",p+='<div class="table_item__pic">',p+=i.DETAIL_PAGE_URL.length>0?'<a href="'+i.DETAIL_PAGE_URL+'">              <img class="table_item__img" src="'+c+'" alt="'+i.NAME+'" title="'+i.NAME+'">            </a>':'<img class="table_item__img" src="'+c+'" alt="'+i.NAME+'" title="'+i.NAME+'">',p+="</div>",p+='<div class="table_item__head">            <h4 class="table_item__name">',p+=i.DETAIL_PAGE_URL.length>0?'<a href="'+i.DETAIL_PAGE_URL+'">'+i.NAME+"</a>":i.NAME,p+="</h4>",M!==!1)for(var K in basketJSParams.ARTICLE_PROP)if(""!=basketJSParams.ARTICLE_PROP[K]){p+='<div class="product__article">'+t.BASKET_DATA.GRID.HEADERS[M].name+": "+i[t.BASKET_DATA.GRID.HEADERS[M].id]+"</div>";break}p+='</div>            <dl class="table_item__props dl-list">';t:for(A=0;A<n.length;A++){for(K in G)if(G[K]==n[A])continue t;switch(n[A]){case"TYPE":case"PROPS":case"DELAY":case"DELETE":case"DISCOUNT":case"WEIGHT":case"NAME":case"QUANTITY":case"PRICE":case"SUM":break;default:var J;J=n[A].indexOf("PROPERTY_")!=-1?i[n[A]+"_VALUE"]:i[n[A]],void 0!=J&&(p+="<dt>"+basketJSParams.HEADERS[A]+":</dt>                     <dd>"+J+"</dd>")}}if(Y&&i.WEIGHT_FORMATED>0&&(cellTotalHTML+="<dt>"+basketJSParams.SALE_WEIGHT+":</dt> <dd>"+i.WEIGHT_FORMATED+"</dd>"),H)for(var u in i.PROPS){var T=!1;for(var A in i.SKU_DATA)if(i.SKU_DATA[A].CODE==i.PROPS[u].CODE){T=!0;break}T||(p+="<dt>"+i.PROPS[u].NAME+":</dt>              <dd>"+i.PROPS[u].VALUE+"</dd>")}if(p+="</dl>",i.SKU_DATA){p+='<div class="table_item__offer_props">';for(E in i.SKU_DATA)if(i.SKU_DATA.hasOwnProperty(E)){b=i.SKU_DATA[E];var V=!1,W=!1,j="offer_prop";if(BX.util.in_array(b.CODE,basketJSParams.OFFER_TREE_COLOR_PROPS))V=!0,j+=" offer_prop-color";else if(BX.util.in_array(b.CODE,basketJSParams.OFFER_TREE_BTN_PROPS))W=!0,j+=" offer_prop-btn";else for(f in b.VALUES)if(B=b.VALUES[f],B.PICT!==!1){V=!0;break}if(V||W){p+='<div class="'+j+' js-offer_prop" data-code="'+b.CODE+'">                    <div class="offer_prop-name">'+b.NAME+':</div>                  <ul class="offer_prop__values clearfix" id="prop_'+b.CODE+"_"+i.ID+'">';var q=!1;for(v in b.VALUES){P=b.VALUES[v];var z="offer_prop__value";for(y=0;y<i.PROPS.length;y++)m=i.PROPS[y],m.CODE===b.CODE&&(m.VALUE!==P.NAME&&m.VALUE!==P.XML_ID||(z+=" checked",q=P));if(p+='<li class="'+z+'"                        data-value-id="'+("S"==b.TYPE&&"directory"==b.USER_TYPE?P.XML_ID:P.NAME)+'"                        data-element="'+i.ID+'"                        data-property="'+b.CODE+'"                      >',V){var Z="";P.PICT?Z="background-image:url("+P.PICT.SRC+")":basketJSParams.COLORS_TABLE[P.NAME.toLowerCase()]&&(Z="background-color:"+basketJSParams.COLORS_TABLE[P.NAME.toLowerCase()].RGB),p+='<span class="offer_prop__icon">                          <span class="offer_prop__img" title="'+P.NAME+'" style="'+Z+'"></span>                        </span>'}else p+=P.NAME;p+="</li>"}p+="</ul>                    </div>"}else{var $="cart_item_"+b.CODE+"_"+i.ID;p+='<div class="offer_prop js-offer_prop" data-code="'+b.CODE+'">                      <div class="offer_prop-name">'+b.NAME+':</div>                      <div class="dropdown select">                          <ul class="offer_prop__values dropdown-menu" aria-labelledby="'+$+'" id="prop_'+b.CODE+"_"+i.ID+'">';var q=!1;for(v in b.VALUES){P=b.VALUES[v];var z="offer_prop__value";for(y=0;y<i.PROPS.length;y++)m=i.PROPS[y],m.CODE===b.CODE&&(m.VALUE!==P.NAME&&m.VALUE!==P.XML_ID||(z+=" checked",q=P));p+='<li class="'+z+'"                                   data-value-id="'+("S"==b.TYPE&&"directory"==b.USER_TYPE?P.XML_ID:P.NAME)+'"                                    data-element="'+i.ID+'"                                    data-property="'+b.CODE+'"                                  >                                <a>'+P.NAME+"</a>                              </li>",p+="</li>"}p+='</ul>                      <div class="dropdown-toggle select__btn" id="'+$+'" data-toggle="dropdown" aria-expanded="true" aria-haspopup="true" role="button">                        <svg class="select__icon icon-svg"><use xlink:href="#svg-down-round"></use></svg>'+q.NAME+"</div>                    </div>                  </div>"}}p+="</div>"}d.innerHTML=p;break;case"QUANTITY":X=l.insertCell(-1),I="",S=parseFloat(i.MEASURE_RATIO)>0?i.MEASURE_RATIO:1,C=parseFloat(i.AVAILABLE_QUANTITY)>0?'max="'+i.AVAILABLE_QUANTITY+'"':"",k=!1,0!=S&&""!=S&&(O=i.QUANTITY,i.QUANTITY=getCorrectRatioQuantity(i.QUANTITY,S,r),O!=i.QUANTITY&&(k=!0)),X.setAttribute("class","table_item__quantity"),I+='<span class="quantity">',0!=S&&""!=S&&(I+='<i class="quantity__minus js-basket-minus"></i>'),I+='<input type="number" size="3"\t\t\t\t\t\tclass="quantity__input js-quantity"\t\t\t\t\t\tid="QUANTITY_INPUT_'+i.ID+'"\t\t\t\t\t\tname="QUANTITY_INPUT_'+i.ID+'"\t\t\t\t\t\tsize="2" min="0" '+C+"step="+S+'\t\t\t\t\t\tvalue="'+i.QUANTITY+'"\t\t\t\t\t\tonchange="updateQuantity(\'QUANTITY_INPUT_'+i.ID+"','"+i.ID+"', "+S+","+r+')"\t\t\t\t\t/>',0!=S&&""!=S&&(I+='<i class="quantity__plus js-basket-plus"></i>'),I+='<input type="hidden" id="QUANTITY_'+i.ID+'" name="QUANTITY_'+i.ID+'" value="'+i.QUANTITY+'" />\t\t\t\t\t\t</span>',i.hasOwnProperty("MEASURE_TEXT")&&i.MEASURE_TEXT.length>0&&(I+=' <span class="js-measure">'+i.MEASURE_TEXT+"</span>"),X.innerHTML=I,k&&updateQuantity("QUANTITY_INPUT_"+i.ID,i.ID,S,r);break;case"PRICE":D=l.insertCell(-1),oCellPriceHTML="",D.setAttribute("class","table_item__price price"),N=i.FULL_PRICE_FORMATED!=i.PRICE_FORMATED?i.FULL_PRICE_FORMATED:"",oCellPriceHTML+=' <div class="price__pdv'+(parseFloat(i.DISCOUNT_PRICE_PERCENT>0)?" disc":"")+'" id="current_price_'+i.ID+'">'+i.PRICE_FORMATED+'</div>\t\t\t\t\t\t<div class="price__pv" id="old_price_'+i.ID+'">'+N+"</div>",F&&0<parseFloat(i.DISCOUNT_PRICE_PERCENT)&&(oCellPriceHTML+='<div class="price__pdd">'+basketJSParams.SALE_PRICE_DIFF+': \t\t\t\t\t\t\t<span id="discount_value_'+i.ID+'">'+i.DISCOUNT_PRICE_PERCENT_FORMATED+"</span>\t\t\t\t\t\t</div>"),D.innerHTML=oCellPriceHTML;break;case"SUM":R=l.insertCell(-1),U="",D.setAttribute("class","table_item__sum price"),U+='<div class="price__pdv" id="sum_'+i.ID+'">',void 0!=typeof i[n[u]]&&(U+=i[n[u]]),U+="</div>",R.innerHTML+=U}}oCellControl=l.insertCell(-1),oCellControl.setAttribute("class",""),oCellControlHTML="",g&&(oCellControlHTML+='<a href="'+basketJSParams.DELETE_URL.replace("#ID#",i.ID)+'">        <svg class="btn__icon icon-close icon-svg"><use xlink:href="#svg-close"></use></svg>'+basketJSParams.SALE_DELETE+"</a><br/>"),Q&&(oCellControlHTML+='<a href="'+basketJSParams.DELAY_URL.replace("#ID#",i.ID)+'">        <svg class="btn__icon icon-lock icon-svg"><use xlink:href="#svg-lock"></use></svg>'+basketJSParams.SALE_DELAY+"</a>"),oCellControl.innerHTML=oCellControlHTML;var ee=BX.findChildren(l,{className:"offer_prop__value"},!0);if(ee&&ee.length>0)for(u=0;ee.length>u;u++)BX.bind(ee[u],"click",BX.delegate(function(e){skuPropClickHandler(e)},this))}if(t.BASKET_DATA)for(h in t.BASKET_DATA.GRID.ROWS)if(t.BASKET_DATA.GRID.ROWS.hasOwnProperty(h)){var te=t.BASKET_DATA.GRID.ROWS[h];BX("discount_value_"+h)&&(BX("discount_value_"+h).innerHTML=basketJSParams.SALE_DISCOUNT+": "+te.DISCOUNT_PRICE_PERCENT_FORMATED),BX("current_price_"+h)&&(BX("current_price_"+h).innerHTML=te.PRICE_FORMATED),BX("old_price_"+h)&&(BX("old_price_"+h).innerHTML=te.FULL_PRICE_FORMATED!=te.PRICE_FORMATED?te.FULL_PRICE_FORMATED:""),BX("sum_"+h)&&(BX("sum_"+h).innerHTML=te.SUM),BX("QUANTITY_"+h)&&(BX("QUANTITY_INPUT_"+h).value=te.QUANTITY,BX("QUANTITY_INPUT_"+h).defaultValue=te.QUANTITY,BX("QUANTITY_"+h).value=te.QUANTITY)}if(t.BASKET_DATA&&couponListUpdate(t.BASKET_DATA),t.hasOwnProperty("WARNING_MESSAGE")){var ae="";for(u=t.WARNING_MESSAGE.length-1;u>=0;u--)ae+='<font class="errortext">'+t.WARNING_MESSAGE[u]+"</font><br/>";var se=BX("warning_message");""==ae?BX.hide(se):BX.show(se),se.innerHTML=ae}if(t.BASKET_DATA){var ie=BX.findChildren(w,{class:"allWeight_FORMATED"},!0);if(ie&&ie.length>0)for(var u in ie)ie[u].innerHTML=t.BASKET_DATA.allWeight_FORMATED.replace(/\s/g,"&nbsp;");var oe=BX.findChildren(w,{class:"allSum_wVAT_FORMATED"},!0);if(oe&&oe.length>0)for(var u in oe)oe[u].innerHTML=t.BASKET_DATA.allSum_wVAT_FORMATED.replace(/\s/g,"&nbsp;");var le=BX.findChildren(w,{class:"allVATSum_FORMATED"},!0);if(le&&le.length>0)for(var u in le)le[u].innerHTML=t.BASKET_DATA.allVATSum_FORMATED.replace(/\s/g,"&nbsp;");var ne=BX.findChildren(w,{class:"allSum_FORMATED"},!0);if(ne&&ne.length>0)for(var u in ne)ne[u].innerHTML=t.BASKET_DATA.allSum_FORMATED.replace(/\s/g,"&nbsp;");var re=BX.findChildren(w,{class:"PRICE_WITHOUT_DISCOUNT"},!0);if(re&&re.length>0)for(var u in re)re[u].innerHTML=t.BASKET_DATA.PRICE_WITHOUT_DISCOUNT!=t.BASKET_DATA.allSum_FORMATED?t.BASKET_DATA.PRICE_WITHOUT_DISCOUNT.replace(/\s/g,"&nbsp;"):"";BX.onCustomEvent("OnBasketChange")}}}function couponCreate(e,t){var a="disabled";BX.type.isElementNode(e)&&("BAD"===t.JS_STATUS?a="bad":"APPLYED"===t.JS_STATUS&&(a="good"),e.appendChild(BX.create("div",{props:{className:"coupon"},children:[BX.create("span",{props:{className:"coupon__del "+a},attrs:{"data-coupon":t.COUPON}}),BX.create("div",{props:{className:"l-context"},children:[BX.create("input",{props:{className:"form-control coupon__input "+a,type:"text",value:t.COUPON,name:"OLD_COUPON[]"},attrs:{disabled:!0,readonly:!0}})]}),BX.create("div",{props:{className:"coupon__note"},html:t.JS_CHECK_CODE})]})))}function couponListUpdate(e){var t,a,s,i,o,l,n,r,_=BX("basket_form");if(!e||"object"==typeof e){if(t=BX.findChildren(_,{class:"cart__coupons"},!0),t&&t.length>0&&e.COUPON_LIST&&BX.type.isArray(e.COUPON_LIST))for(var u in t)if(s=BX.findChildren(t[u],{class:"coupon__input"},!0),s&&(s.value=""),i=BX.findChildren(t[u],{tagName:"input",property:{name:"OLD_COUPON[]"}},!0)){for(BX.type.isElementNode(i)&&(i=[i]),l=0;l<e.COUPON_LIST.length;l++){for(o=!1,r=-1,n=0;n<i.length;n++)if(i[n].value===e.COUPON_LIST[l].COUPON){o=!0,r=n,i[n].couponUpdate=!0;break}o?(a="disabled","BAD"===e.COUPON_LIST[l].JS_STATUS?a="bad":"APPLYED"===e.COUPON_LIST[l].JS_STATUS&&(a="good"),BX.adjust(i[r],{props:{className:"form-control coupon__input "+a}}),BX.adjust(i[r].parentNode.previousSibling,{props:{className:"coupon__del "+a}}),BX.adjust(i[r].parentNode.nextSibling,{html:e.COUPON_LIST[l].JS_CHECK_CODE})):couponCreate(t[u],e.COUPON_LIST[l])}for(n=0;n<i.length;n++)"undefined"!=typeof i[n].couponUpdate&&i[n].couponUpdate?i[n].couponUpdate=null:(BX.remove(i[n].parentNode.parentNode),i[n]=null)}else for(l=0;l<e.COUPON_LIST.length;l++)couponCreate(t[u],e.COUPON_LIST[l]);t=null}}function skuPropClickHandler(e){e||(e=window.event);var t,a,s,i,o,l,n,r=BX.proxy_context,_={},u={};if(r&&r.hasAttribute("data-value-id")){if(BX.showWait(),t=r.getAttribute("data-element"),a=r.getAttribute("data-property"),s=BX("action_var").value,_[a]=r.getAttribute("data-value-id"),BX.hasClass(r,"checked"))return void BX.closeWait();if(i=BX.findChildren(BX(t),{tagName:"ul",className:"offer_prop__values"},!0),i&&i.length>0)for(o=0;i.length>o;o++)if(i[o].id!=="prop_"+a+"_"+t&&(l=BX.findChildren(BX(i[o].id),{tagName:"li",className:"checked"},!0),l&&l.length>0))for(n=0;l.length>n;n++)l[n].hasAttribute("data-value-id")&&(_[l[n].getAttribute("data-property")]=l[n].getAttribute("data-value-id"));u={basketItemId:t,sessid:BX.bitrix_sessid(),site_id:BX.message("SITE_ID"),props:_,action_var:s,select_props:BX("column_headers").value,offers_props:BX("offers_props").value,quantity_float:BX("quantity_float").value,count_discount_4_all_quantity:BX("count_discount_4_all_quantity").value,price_vat_show_value:BX("price_vat_show_value").value,hide_coupon:BX("hide_coupon").value,use_prepayment:BX("use_prepayment").value},u[s]="select_item",BX.ajax({url:"/bitrix/components/bitrix/sale.basket.basket/ajax.php",method:"POST",data:u,dataType:"json",onsuccess:function(e){BX.closeWait(),updateBasketTable(t,e)}})}}function getColumnName(e,t){return BX("col_"+t)?BX.util.trim(BX("col_"+t).innerHTML):""}function leftScroll(e,t,a){a=parseInt(a,10);var s=BX("prop_"+e+"_"+t);if(s){var i=parseInt(s.style.marginLeft,10);i<=20*(6-a)&&(s.style.marginLeft=i+20+"%")}}function rightScroll(e,t,a){a=parseInt(a,10);var s=BX("prop_"+e+"_"+t);if(s){var i=parseInt(s.style.marginLeft,10);i>20*(5-a)&&(s.style.marginLeft=i-20+"%")}}function checkOut(){return BX("coupon")&&(BX("coupon").disabled=!0),BX("basket_form").submit(),!0}function updateBasket(){recalcBasketAjax({})}function enterCoupon(e){var t=e;t&&t.value&&recalcBasketAjax({coupon:t.value})}function updateQuantity(e,t,a,s){var i=BX(e).defaultValue,o=parseFloat(BX(e).value)||0,l=!1,n=BX("auto_calculation")&&"Y"==BX("auto_calculation").value||!BX("auto_calculation");if(0===a||1==a)l=!0;else{var r=1e4*o,_=1e4*a,u=r%_;parseInt(o);0===u&&(l=!0)}var c=!1;parseInt(o)!=parseFloat(o)&&(c=!0),o=s===!1&&c===!1?parseInt(o):parseFloat(o).toFixed(4),o=correctQuantity(o),l?(BX(e).defaultValue=o,BX("QUANTITY_INPUT_"+t).value=o,BX("QUANTITY_"+t).value=o,n&&basketPoolQuantity.changeQuantity(t)):(o=getCorrectRatioQuantity(o,a,s),o=correctQuantity(o),o!=i?(BX("QUANTITY_INPUT_"+t).value=o,BX("QUANTITY_"+t).value=o,n&&basketPoolQuantity.changeQuantity(t)):BX(e).value=i)}function setQuantity(e,t,a,s){var i,o=parseFloat(BX("QUANTITY_INPUT_"+e).value);i="up"==a?o+t:o-t,i<0&&(i=0),s&&(i=parseFloat(i).toFixed(4)),i=correctQuantity(i),t>0&&i<t&&(i=t),s||i==i.toFixed(4)||(i=parseFloat(i).toFixed(4)),i=getCorrectRatioQuantity(i,t,s),i=correctQuantity(i),BX("QUANTITY_INPUT_"+e).value=i,BX("QUANTITY_INPUT_"+e).defaultValue=i,updateQuantity("QUANTITY_INPUT_"+e,e,t,s)}function getCorrectRatioQuantity(e,t,a){var s,i=(e/t-(e/t).toFixed(0)).toFixed(6),o=e,l=!1;if(t=parseFloat(t),0==i)return o;if(0!==t&&1!=t)for(s=t,max=parseFloat(e)+parseFloat(t);s<=max;s=parseFloat(parseFloat(s)+parseFloat(t)).toFixed(4))o=s;else 1===t&&(o=0|e);return parseInt(o,10)!=parseFloat(o)&&(l=!0),o=a===!1&&l===!1?parseInt(o,10):parseFloat(o).toFixed(4),o=correctQuantity(o)}function correctQuantity(e){return parseFloat((1*e).toString())}function recalcBasketAjax(e){if(basketPoolQuantity.isProcessing())return!1;BX.showWait();var t,a,s={},i=BX("action_var").value,o=BX("basket_items"),l=BX("delayed_items");if(t={sessid:BX.bitrix_sessid(),site_id:BX.message("SITE_ID"),props:s,action_var:i,select_props:BX("column_headers").value,offers_props:BX("offers_props").value,quantity_float:BX("quantity_float").value,count_discount_4_all_quantity:BX("count_discount_4_all_quantity").value,price_vat_show_value:BX("price_vat_show_value").value,hide_coupon:BX("hide_coupon").value,use_prepayment:BX("use_prepayment").value},t[i]="recalculate",e&&"object"==typeof e)for(a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);if(o&&o.rows.length>0)for(a=0;o.rows.length>a;a++)t["QUANTITY_"+o.rows[a].id]=BX("QUANTITY_"+o.rows[a].id).value;if(l&&l.rows.length>0)for(a=0;l.rows.length>a;a++)t["DELAY_"+l.rows[a].id]="Y";basketPoolQuantity.setProcessing(!0),basketPoolQuantity.clearPool(),BX.ajax({url:"/bitrix/components/bitrix/sale.basket.basket/ajax.php",method:"POST",data:t,dataType:"json",onsuccess:function(t){BX.closeWait(),basketPoolQuantity.setProcessing(!1),e.coupon&&t&&t.BASKET_DATA&&t.BASKET_DATA.NEED_TO_RELOAD_FOR_GETTING_GIFTS&&BX.reload(),basketPoolQuantity.isPoolEmpty()?(updateBasketTable(null,t),basketPoolQuantity.updateQuantity()):basketPoolQuantity.enableTimer(!0)}})}function showBasketItemsList(e){BX.removeClass(BX("basket_toolbar_button"),"current"),BX.removeClass(BX("basket_toolbar_button_delayed"),"current"),BX.removeClass(BX("basket_toolbar_button_subscribed"),"current"),BX.removeClass(BX("basket_toolbar_button_not_available"),"current"),BX("normal_count").style.display="inline-block",BX("delay_count").style.display="inline-block",BX("subscribe_count").style.display="inline-block",BX("not_available_count").style.display="inline-block",2==e?(BX("basket_items_list")&&(BX("basket_items_list").style.display="none"),BX("basket_items_delayed")&&(BX("basket_items_delayed").style.display="block",BX.addClass(BX("basket_toolbar_button_delayed"),"current"),BX("delay_count").style.display="none"),BX("basket_items_subscribed")&&(BX("basket_items_subscribed").style.display="none"),BX("basket_items_not_available")&&(BX("basket_items_not_available").style.display="none")):3==e?(BX("basket_items_list")&&(BX("basket_items_list").style.display="none"),BX("basket_items_delayed")&&(BX("basket_items_delayed").style.display="none"),BX("basket_items_subscribed")&&(BX("basket_items_subscribed").style.display="block",BX.addClass(BX("basket_toolbar_button_subscribed"),"current"),BX("subscribe_count").style.display="none"),BX("basket_items_not_available")&&(BX("basket_items_not_available").style.display="none")):4==e?(BX("basket_items_list")&&(BX("basket_items_list").style.display="none"),BX("basket_items_delayed")&&(BX("basket_items_delayed").style.display="none"),BX("basket_items_subscribed")&&(BX("basket_items_subscribed").style.display="none"),BX("basket_items_not_available")&&(BX("basket_items_not_available").style.display="block",BX.addClass(BX("basket_toolbar_button_not_available"),"current"),BX("not_available_count").style.display="none")):(BX("basket_items_list")&&(BX("basket_items_list").style.display="block",BX.addClass(BX("basket_toolbar_button"),"current"),BX("normal_count").style.display="none"),BX("basket_items_delayed")&&(BX("basket_items_delayed").style.display="none"),BX("basket_items_subscribed")&&(BX("basket_items_subscribed").style.display="none"),BX("basket_items_not_available")&&(BX("basket_items_not_available").style.display="none"))}function deleteCoupon(e){var t,a=BX.proxy_context;a&&a.hasAttribute("data-coupon")&&(t=a.getAttribute("data-coupon"),t&&t.length>0&&recalcBasketAjax({delete_coupon:t}))}BasketPoolQuantity=function(){this.processing=!1,this.poolQuantity={},this.updateTimer=null,this.currentQuantity={},this.updateQuantity()},BasketPoolQuantity.prototype.updateQuantity=function(){var e=BX("basket_items");if(e&&e.rows.length>0)for(var t=0;e.rows.length>t;t++){var a=e.rows[t].id;this.currentQuantity[a]=BX("QUANTITY_"+a).value}},BasketPoolQuantity.prototype.changeQuantity=function(e){var t=BX("QUANTITY_"+e).value,a=this.isPoolEmpty();this.currentQuantity[e]&&this.currentQuantity[e]!=t&&(this.poolQuantity[e]=this.currentQuantity[e]=t),a?this.trySendPool():this.enableTimer(!0)},BasketPoolQuantity.prototype.trySendPool=function(){this.isPoolEmpty()||this.isProcessing()||(this.enableTimer(!1),recalcBasketAjax({}))},BasketPoolQuantity.prototype.isPoolEmpty=function(){return 0==Object.keys(this.poolQuantity).length},BasketPoolQuantity.prototype.clearPool=function(){this.poolQuantity={}},BasketPoolQuantity.prototype.isProcessing=function(){return this.processing===!0},BasketPoolQuantity.prototype.setProcessing=function(e){this.processing=e===!0},BasketPoolQuantity.prototype.enableTimer=function(e){clearTimeout(this.updateTimer),e!==!1&&(this.updateTimer=setTimeout(function(){basketPoolQuantity.trySendPool()},1500))},BX.ready(function(){basketPoolQuantity=new BasketPoolQuantity;var e,t,a=BX.findChildren(BX("basket_items"),{className:"offer_prop__value"},!0),s=BX("basket_form");if(a&&a.length>0)for(e=0;a.length>e;e++)BX.bind(a[e],"click",BX.delegate(function(e){skuPropClickHandler(e)},this));if(t=BX.findChildren(s,{class:"cart__coupons"},!0))for(var i in t)BX.bindDelegate(t[i],"click",{attribute:"data-coupon"},BX.delegate(function(e){deleteCoupon(e)},this));basketJSParams.EVENT_ONCHANGE_ON_START&&"Y"==basketJSParams.EVENT_ONCHANGE_ON_START&&BX.onCustomEvent("OnBasketChange")});