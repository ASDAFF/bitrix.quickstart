num=0;function OnFormDesignSettingsEdit(h){num=0;if(typeof(jQuery)=="undefined"){var g=document.createElement("script");g.src="/bitrix/components/elipseart/form.design_modify/script/jquery-1.6.1.min.js";g.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(g);var k=h.data.split("||");var j=k[0].split(";");var i=document.createElement("span");h.oCont.appendChild(i);i.innerHTML=j[0];e();function e(){if(typeof(jQuery)=="undefined"){window.setTimeout(e,100)}else{i.innerHTML="";OnFormDesignSettingsEdit(h)}}}else{$('input[name="WEB_FORM_PARAMS"]').parent().parent().hide();var i=document.createElement("div");h.oCont.appendChild(i);i.id="EANewContParam";i.style.display="none";var f="";var d=h.data.split("||");for(y=1;y<d.length;++y){var c=d[y].split("#");if(c[0]=="SELECTED"&&c[1]!=""){if(f!=""){f+="||"}f+=d[y]}}$("div#EANewContParam").after('<br /><input type="button" value="+" id="EAFormSettingsAddBtn" /><div id="EANewContParamResult"><input type="hidden" name="WEB_FORM" value="" /></div>');$("#EAFormSettingsAddBtn").click(function(){OnFormDesignSettingsAdd(h,"")});var k=h.data.split("||");var j=k[0].split(";");for(y=1;y<k.length;++y){var b=k[y].split("#");if(b[0]=="SELECTED"&&b[1]!=""){OnFormDesignSettingsAdd(h,k[y])}}OnFormDesignSettingsAdd(h,"");$('input[name="save"][type="button"]').mouseover(function(){UpdateSendParam()});$('input[name="save"][type="button"]').focus(function(){UpdateSendParam()});$('input[name="btn_popup_save"][type="button"]').mouseover(function(){UpdateSendParam()});$('input[name="btn_popup_save"][type="button"]').focus(function(){UpdateSendParam()})}}function OnFormDesignSettingsAdd(h,g){var k=h.data.split("||");var j=k[0].split(";");var c="";var b='<select id="WEB_FORM_ID_'+num+'" onChange="OnFormDesignSettingsAddMore(\''+num+"','"+c+"','"+j[4]+'\');"><option value="">'+j[1]+"</option>";var e=0;var f="";$("form").each(function(){if($(this).attr("id")==""){$(this).attr("id","EAFormAutoID"+e)}var m=$(this).attr("name");var t=$(this).attr("id");if(m!=""){var i="name";var s=$(this).attr("name")}else{var i="id";var s=$(this).attr("id")}var r="FORM "+i+'="'+s+'"';for(z=6;z<k.length;++z){var u=k[z].split("#");var p=u[1];var l=u[2];if(i==p&&s==l){var r=u[3]}}var n="";var q="FORM#"+i+"#"+s;if(g!=""&&g!=undefined){var o=g.split("#");if(q==o[1]+"#"+o[2]+"#"+o[3]){n="selected";f="false"}}b+='<option value="'+q+'" '+n+">"+r+"</option>";++e});option_selected="";display_other='style="display: none;"';FormOtherContentParam="";if(g!=""&&g!=undefined){if(f!="false"){option_selected="selected";d=g.split("#");display_other="";FormOtherContentParam+='<input type="text" id="FormOtherContentParam'+num+'" value="'+d[1]+"#"+d[2]+"#"+d[3]+'#" /> ';FormOtherContentParam+='<input type="button" value="ok" OnClick="OnFormDesignSettingsAddMore(\''+num+"','"+d[4]+"','"+j[4]+"')\" />"}}b+='<option value="other" '+option_selected+">"+j[5]+"</option>";b+="</select>";b+='<div id="FormOtherContent'+num+'" '+display_other+">"+FormOtherContentParam+"</div>";b+='<div id="FormSelectContentMoreLink'+num+'">&nbsp;</div>';b+='<div id="FormSelectContentMoreForm'+num+'" class="FormSelectContentMoreForm" rel="'+num+'" style="display: none;"></div>';b+='<div id="FormSelectContentMoreData'+num+'" class="FormSelectContentMoreData" rel="'+num+'" style="display: none;"></div>';$("div#EANewContParam").before(b);if(g!=""&&g!=undefined){var d=g.split("#");OnFormDesignSettingsAddMore(num,d[4],j[4])}num=num+1}function OnFormDesignSettingsAddMore(e,b,c){var f="select#WEB_FORM_ID_"+e;$("#FormSelectContentMoreLink"+e).html("");$("#FormSelectContentMoreForm"+e).html("");$("#FormSelectContentMoreData"+e).html("");if($(f).attr("value")!=""){if($(f).attr("value")=="other"&&($("#FormOtherContentParam"+e).attr("value")==""||$("#FormOtherContentParam"+e).attr("value")==undefined)){FormOtherContentParam="";FormOtherContentParam+='<input type="text" id="FormOtherContentParam'+e+'" value="" /> ';FormOtherContentParam+='<input type="button" value="ok" OnClick="OnFormDesignSettingsAddMore(\''+e+"','"+b+"','"+c+"')\" />";$("#FormOtherContent"+e).html(FormOtherContentParam);$("#FormOtherContent"+e).show()}else{if($(f).attr("value")=="other"){var d=$("#FormOtherContentParam"+e).attr("value").split("#")}else{$("#FormOtherContent"+e).hide();$("#FormOtherContent"+e).html("");var d=$(f).attr("value").split("#")}$("#FormSelectContentMoreLink"+e+" a").die("click");FormSelectContentMoreLink="";FormSelectContentMoreLink+='<a href="#" onclick="(new BX.CDialog({ content_url: \'/bitrix/components/elipseart/form.design_modify/script/settings.php?SelObjNum='+e+"&SelObjParamSelected="+b+"&ParamDataMore="+d+"', width: 700, height: 500, resizable: true })).Show(); return false;\">"+c+"</a><br /><br />";FormSelectContentMoreForm="";FormSelectContentMoreForm+=d[0]+"#";FormSelectContentMoreForm+=d[1]+"#";FormSelectContentMoreForm+=d[2]+"#";FormSelectContentMoreData=b;$("#FormSelectContentMoreLink"+e).html(FormSelectContentMoreLink);$("#FormSelectContentMoreForm"+e).html(FormSelectContentMoreForm);$("#FormSelectContentMoreData"+e).html(FormSelectContentMoreData)}}}function UpdateSendParam(){FormUpdateContent="";a=0;$("div.FormSelectContentMoreForm").each(function(){if(a>0){FormUpdateContent+="||"}FormUpdateContent+=$(this).html();FormUpdateContent+=$("#FormSelectContentMoreData"+$(this).attr("rel")+"").html();a=a+1});$('input[name="WEB_FORM"]').val("");$('input[name="WEB_FORM"]').change();$('input[name="WEB_FORM_PARAMS"]').val(FormUpdateContent);$('input[name="WEB_FORM_PARAMS"]').change()};