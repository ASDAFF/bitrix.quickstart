(function(a){if(BX.PopupWindowManager){return}BX.PopupWindowManager={_popups:[],_currentPopup:null,create:function(f,c,g){var d=-1;if((d=this._getPopupIndex(f))!==-1){return this._popups[d]}var e=new BX.PopupWindow(f,c,g);BX.addCustomEvent(e,"onPopupShow",BX.delegate(this.onPopupShow,this));BX.addCustomEvent(e,"onPopupClose",BX.delegate(this.onPopupClose,this));BX.addCustomEvent(e,"onPopupDestroy",BX.delegate(this.onPopupDestroy,this));if(g&&g.events){for(var b in g.events){BX.addCustomEvent(e,b,g.events[b])}}this._popups.push(e);return e},onPopupShow:function(b){if(this._currentPopup!==null){this._currentPopup.close()}this._currentPopup=b},onPopupClose:function(b){this._currentPopup=null},onPopupDestroy:function(c){var b=-1;if((b=this._getPopupIndex(c.uniquePopupId))!==-1){this._popups=BX.util.deleteFromArray(this._popups,b)}},getCurrentPopup:function(){return this._currentPopup},isPopupExists:function(b){return this._getPopupIndex(b)!==-1},_getPopupIndex:function(d){var b=-1;for(var c=0;c<this._popups.length;c++){if(this._popups[c].uniquePopupId==d){return c}}return b}};BX.PopupWindow=function(d,c,f){this.uniquePopupId=d;this.params=f||{};this.params.zIndex=parseInt(this.params.zIndex);this.params.zIndex=isNaN(this.params.zIndex)?0:this.params.zIndex;this.buttons=this.params.buttons&&BX.type.isArray(this.params.buttons)?this.params.buttons:[];this.offsetTop=this.offsetLeft=0;this.firstShow=false;this.bordersWidth=20;this.bindElementPos=null;this.closeIcon=null;this.angle=null;this.titleBar=null;this.bindOptions=typeof(this.params.bindOptions)=="object"?this.params.bindOptions:{};this.isAutoHideBinded=false;if(this.params.events){for(var b in this.params.events){BX.addCustomEvent(this,b,this.params.events[b])}}this.popupContainer=document.createElement("DIV");BX.adjust(this.popupContainer,{props:{id:d},style:{zIndex:0,position:"absolute",display:"none",top:"0px",left:"0px"}});var e="popup-window";if(f.lightShadow){e+=" popup-window-light"}if(f.titleBar){e+=" popup-window-titlebar"}if(f.className&&BX.type.isNotEmptyString(f.className)){e+=" "+f.className}this.popupContainer.innerHTML=['<table class="',e,'" cellspacing="0"> 		<tr class="popup-window-top-row"> 			<td class="popup-window-left-column"></td> 			<td class="popup-window-center-column">',(f.titleBar?'<div class="popup-window-titlebar" id="popup-window-titlebar-'+d+'"></div>':""),'</td> 			<td class="popup-window-right-column"></td> 		</tr> 		<tr class="popup-window-content-row"> 			<td class="popup-window-left-column"></td> 			<td class="popup-window-center-column"><div class="popup-window-content" id="popup-window-content-',d,'"> 			</div></td> 			<td class="popup-window-right-column"></td> 		</tr> 		<tr class="popup-window-bottom-row"> 			<td class="popup-window-left-column"></td> 			<td class="popup-window-center-column"></td> 			<td class="popup-window-right-column"></td> 		</tr> 	</table>'].join("");document.body.appendChild(this.popupContainer);if(f.closeIcon){this.popupContainer.appendChild((this.closeIcon=BX.create("span",{props:{className:"popup-window-close-icon"},style:(typeof(f.closeIcon)=="object"?f.closeIcon:{}),events:{click:BX.proxy(this.close,this)}})))}this.contentContainer=BX("popup-window-content-"+d);this.titleBar=BX("popup-window-titlebar-"+d);this.buttonsContainer=this.buttonsHr=null;if(f.angle){this.setAngle(f.angle)}this.setOffset(this.params);this.setBindElement(c);this.setTitleBar(this.params.titleBar);this.setContent(this.params.content);this.setButtons(this.params.buttons);BX.bind(a,"resize",BX.delegate(this._onResizeWindow,this))};BX.PopupWindow.prototype.setContent=function(b){if(!this.contentContainer||!b){return}if(BX.type.isElementNode(b)){BX.cleanNode(this.contentContainer);this.contentContainer.appendChild(b.parentNode?b.parentNode.removeChild(b):b);b.style.display="block"}else{if(BX.type.isString(b)){this.contentContainer.innerHTML=b}else{this.contentContainer.innerHTML="&nbsp;"}}};BX.PopupWindow.prototype.setButtons=function(e){this.buttons=e&&BX.type.isArray(e)?e:[];if(this.buttonsHr){BX.remove(this.buttonsHr)}if(this.buttonsContainer){BX.remove(this.buttonsContainer)}if(this.buttons.length>0&&this.contentContainer){var b=[];for(var d=0;d<this.buttons.length;d++){var c=this.buttons[d];if(c==null||!BX.is_subclass_of(c,BX.PopupWindowButton)){continue}c.popupWindow=this;b.push(c.render())}this.buttonsHr=this.contentContainer.parentNode.appendChild(BX.create("div",{props:{className:"popup-window-hr popup-window-buttons-hr"},children:[BX.create("i",{})]}));this.buttonsContainer=this.contentContainer.parentNode.appendChild(BX.create("div",{props:{className:"popup-window-buttons"},children:b}))}};BX.PopupWindow.prototype.setBindElement=function(b){if(!b||typeof(b)!="object"){return}if(BX.type.isDomNode(b)||(BX.type.isNumber(b.clientX)&&BX.type.isNumber(b.clientY))||(BX.type.isNumber(b.top)&&BX.type.isNumber(b.left))){this.bindElement=b}};BX.PopupWindow.prototype.getBindElementPos=function(b){if(BX.type.isDomNode(b)){return BX.pos(b,false)}else{if(b&&BX.type.isNumber(b.clientX)&&BX.type.isNumber(b.clientY)){BX.fixEventPageXY(b);return{left:b.pageX,top:b.pageY,bottom:b.pageY}}else{if(b&&typeof(b)=="object"){if(!BX.type.isNumber(b.bottom)){b.bottom=b.top}return b}else{var c=BX.GetWindowInnerSize();var f=BX.GetWindowScrollPos();var d=this.popupContainer.offsetWidth;var e=this.popupContainer.offsetHeight;return{left:c.innerWidth/2-d/2+f.scrollLeft,top:c.innerHeight/2-e/2+f.scrollTop,bottom:c.innerHeight/2-e/2+f.scrollTop,windowSize:c,windowScroll:f,popupWidth:d,popupHeight:e}}}}};BX.PopupWindow.prototype.setAngle=function(c){var b=this.params.lightShadow?"popup-window-light-angly":"popup-window-angly";if(this.angle==null){this.angle={element:BX.create("div",{props:{className:b+" "+b+"-top"}}),position:"top",offset:0};this.popupContainer.appendChild(this.angle.element)}if(typeof(c)=="object"&&c.position&&BX.util.in_array(c.position,["top","right","bottom","left","hide"])){BX.removeClass(this.angle.element,b+"-"+this.angle.position);BX.addClass(this.angle.element,b+"-"+c.position);this.angle.position=c.position}if(typeof(c)=="object"&&BX.type.isNumber(c.offset)){if(this.angle.position=="top"){this.angle.element.style.left=(this.angle.offset=Math.max(7,c.offset))+"px";this.angle.element.style.marginLeft="auto"}else{if(this.angle.position=="right"){this.angle.element.style.top=(this.angle.offset=Math.max(2,c.offset))+"px"}else{if(this.angle.position=="bottom"){this.angle.element.style.marginLeft=(this.angle.offset=Math.max(7,c.offset))+"px";this.angle.element.style.left="auto"}else{if(this.angle.position=="left"){this.angle.element.style.top=(this.angle.offset=Math.max(2,c.offset))+"px"}}}}}};BX.PopupWindow.prototype.setOffset=function(b){if(typeof(b)!="object"){return}if(b.offsetLeft&&BX.type.isNumber(b.offsetLeft)){this.offsetLeft=b.offsetLeft}if(b.offsetTop&&BX.type.isNumber(b.offsetTop)){this.offsetTop=b.offsetTop}};BX.PopupWindow.prototype.setTitleBar=function(b){if(!this.titleBar||typeof(b)!="object"||!BX.type.isDomNode(b.content)){return}this.titleBar.innerHTML="";this.titleBar.appendChild(b.content)};BX.PopupWindow.prototype.show=function(){if(!this.firstShow){BX.onCustomEvent(this,"onPopupFirstShow",[this]);this.firstShow=true}BX.onCustomEvent(this,"onPopupShow",[this]);this.popupContainer.style.display="block";this.adjustPosition();BX.onCustomEvent(this,"onAfterPopupShow",[this]);if(this.params.autoHide&&!this.isAutoHideBinded){setTimeout(BX.proxy(function(){this.isAutoHideBinded=true;BX.bind(this.popupContainer,"click",this.cancelBubble);BX.bind(document,"click",BX.proxy(this.close,this))},this),0)}};BX.PopupWindow.prototype.isShown=function(){return this.popupContainer.style.display=="block"};BX.PopupWindow.prototype.cancelBubble=function(b){if(!b){b=a.event}if(b.stopPropagation){b.stopPropagation()}else{b.cancelBubble=true}};BX.PopupWindow.prototype.close=function(b){if(!this.isShown()){return}BX.onCustomEvent(this,"onPopupClose",[this,b]);this.popupContainer.style.display="none";setTimeout(BX.proxy(this._close,this),0)};BX.PopupWindow.prototype._close=function(){if(this.params.autoHide&&this.isAutoHideBinded){this.isAutoHideBinded=false;BX.unbind(this.popupContainer,"click",this.cancelBubble);BX.unbind(document,"click",BX.proxy(this.close,this))}};BX.PopupWindow.prototype.destroy=function(){BX.onCustomEvent(this,"onPopupDestroy",[this]);BX.unbindAll(this);BX.remove(this.popupContainer)};BX.PopupWindow.prototype.adjustPosition=function(k){if(k&&typeof(k)=="object"){this.bindOptions=k}var d=this.getBindElementPos(this.bindElement);if(!this.bindOptions.forceBindPosition&&this.bindElementPos!=null&&d.top==this.bindElementPos.top&&d.left==this.bindElementPos.left){return}this.bindElementPos=d;var i=d.windowSize?d.windowSize:BX.GetWindowInnerSize();var l=d.windowScroll?d.windowScroll:BX.GetWindowScrollPos();var h=d.popupWidth?d.popupWidth:this.popupContainer.offsetWidth;var e=d.popupHeight?d.popupHeight:this.popupContainer.offsetHeight;var m=7;var j=5;var f=15;var g=this.bindElementPos.bottom+this.offsetTop+(this.angle!=null&&this.angle.position=="top"?j:0);var c=this.bindElementPos.left+this.offsetLeft-(this.angle!=null&&BX.util.in_array(this.angle.position,["top","bottom"])?f:0);if(!this.bindOptions.forceLeft&&(c+h)>=(i.innerWidth+l.scrollLeft)&&(i.innerWidth+l.scrollLeft-h-this.bordersWidth)>0){var b=c;c=i.innerWidth+l.scrollLeft-h-this.bordersWidth;if(this.angle!=null&&BX.util.in_array(this.angle.position,["top","bottom"])){this.setAngle({offset:b-c+m})}}else{if(this.angle!=null&&BX.util.in_array(this.angle.position,["top","bottom"])){this.setAngle({offset:0})}}if(c<0){c=0}if(!this.bindOptions.forceTop&&(g+e)>(i.innerHeight+l.scrollTop)&&(this.bindElementPos.top-e)>=0){g=this.bindElementPos.top-e;if(this.angle!=null){g-=j;this.setAngle({position:"bottom"})}}else{if(this.angle!=null&&this.angle.position=="bottom"){g+=j;this.setAngle({position:"top"})}}if(g<0){g=0}BX.adjust(this.popupContainer,{style:{top:g+"px",left:c+"px",zIndex:1000+this.params.zIndex}})};BX.PopupWindow.prototype._onResizeWindow=function(b){this.adjustPosition()};BX.PopupWindowButton=function(c){this.popupWindow=null;this.params=c||{};this.text=this.params.text||"";this.id=this.params.id||"";this.className=this.params.className||"";this.events=this.params.events||{};this.contextEvents={};for(var b in this.events){this.contextEvents[b]=BX.proxy(this.events[b],this)}this.nameNode=BX.create("span",{props:{className:"popup-window-button-text"},text:this.text});this.buttonNode=BX.create("span",{props:{className:"popup-window-button"+(this.className.length>0?" "+this.className:""),id:this.id},children:[BX.create("span",{props:{className:"popup-window-button-left"}}),this.nameNode,BX.create("span",{props:{className:"popup-window-button-right"}})],events:this.contextEvents})};BX.PopupWindowButton.prototype.render=function(){return this.buttonNode};BX.PopupWindowButton.prototype.setName=function(b){this.text=b||"";if(this.nameNode){BX.cleanNode(this.nameNode);BX.adjust(this.nameNode,{text:this.text})}};BX.PopupWindowButton.prototype.setClassName=function(b){if(this.buttonNode){BX.removeClass(this.buttonNode,this.className);BX.addClass(this.buttonNode,b)}this.className=b};BX.PopupWindowButtonLink=function(b){BX.PopupWindowButtonLink.superclass.constructor.apply(this,arguments);this.nameNode=BX.create("span",{props:{className:"popup-window-button-link-text"},text:this.text,events:this.contextEvents});this.buttonNode=BX.create("span",{props:{className:"popup-window-button popup-window-button-link"+(this.className.length>0?" "+this.className:""),id:this.id},children:[this.nameNode]})};BX.extend(BX.PopupWindowButtonLink,BX.PopupWindowButton)})(window);