function updateBasketTable(Q,N){var x=BX("basket_items"),ab,V,r,E,b,C,U=false,K=false,ad=false,D=false,l,G,T,aa,g,y,R,v,d,z,Z,I,s,e,P,ae,F,h,u,J,q,W,o,t,Y,S,B,c,A,X,a,O,m,w,f,M;if(!x||typeof N!=="object"){return}ab=x.rows;E=ab[ab.length-1];l=(N.PARAMS.QUANTITY_FLOAT==="Y");if(Q!==null&&!!N.BASKET_DATA){V=N.BASKET_ID;r=N.BASKET_DATA.GRID.ROWS[V];C=N.COLUMNS.split(",");b=document.createElement("tr");G=BX(Q);b.setAttribute("id",N.BASKET_ID);E.parentNode.insertBefore(b,G.nextSibling);if(N.DELETE_ORIGINAL==="Y"){G.parentNode.removeChild(G)}T=b.insertCell(-1);T.setAttribute("class","margin");for(aa=0;aa<C.length;aa++){if(C[aa]==="DELETE"){U=true}else{if(C[aa]==="DELAY"){K=true}else{if(C[aa]==="PROPS"){ad=true}else{if(C[aa]==="TYPE"){D=true}}}}}for(aa=0;aa<C.length;aa++){switch(C[aa]){case"PROPS":case"DELAY":case"DELETE":case"TYPE":break;case"NAME":g=b.insertCell(-1);y="";R="";g.setAttribute("class","itemphoto");if(r.PREVIEW_PICTURE_SRC.length>0){y=r.PREVIEW_PICTURE_SRC}else{if(r.DETAIL_PICTURE_SRC.length>0){y=r.DETAIL_PICTURE_SRC}else{y=basketJSParams.TEMPLATE_FOLDER+"/images/no_photo.png"}}if(r.DETAIL_PAGE_URL.length>0){R='<div class="bx_ordercart_photo_container">							<a href="'+r.DETAIL_PAGE_URL+'">								<div class="bx_ordercart_photo" style="background-image:url(\''+y+"')\"></div>							</a>						</div>"}else{R='<div class="bx_ordercart_photo_container">							<div class="bx_ordercart_photo" style="background-image:url(\''+y+"')\"></div>						</div>"}if(r.BRAND&&r.BRAND.length>0){R+='<div class="bx_ordercart_brand">							<img alt="" src="'+r.BRAND+'"/>						</div>'}g.innerHTML=R;v=b.insertCell(-1);d="";v.setAttribute("class","item");if(r.DETAIL_PAGE_URL.length>0){d+='<h2 class="bx_ordercart_itemtitle"><a href="'+r.DETAIL_PAGE_URL+'">'+r.NAME+"</a></h2>"}else{d+='<h2 class="bx_ordercart_itemtitle">'+r.NAME+"</h2>"}d+='<div class="bx_ordercart_itemart">';if(ad){for(Z=0;Z<r.PROPS.length;Z++){I=r.PROPS[Z];if(r.SKU_DATA){z=false;for(s in r.SKU_DATA){if(r.SKU_DATA.hasOwnProperty(s)){e=r.SKU_DATA[s];if(e.CODE===I.CODE){z=true;break}}}if(z){continue}}d+=I.NAME+":&nbsp;<span>"+I.VALUE+"</span><br/>"}}d+="</div>";if(r.SKU_DATA){for(s in r.SKU_DATA){if(r.SKU_DATA.hasOwnProperty(s)){e=r.SKU_DATA[s];P=false;ae=(BX.util.array_keys(e.VALUES).length>5)?"full":"";for(h in e.VALUES){F=e.VALUES[h];if(!!F&&typeof F==="object"&&!!F.PICT){P=true;break}}if(P){d+='<div class="bx_item_detail_scu_small_noadaptive '+ae+'">';d+='<span class="bx_item_section_name_gray">'+e.NAME+"</span>";d+='<div class="bx_scu_scroller_container">';d+='<div class="bx_scu">';d+='<ul id="prop_'+e.CODE+"_"+r.ID+'" style="width: 200%; margin-left:0%;" class="sku_prop_list">';for(q in e.VALUES){u=e.VALUES[q];J="";for(W=0;W<r.PROPS.length;W++){o=r.PROPS[W];if(o.CODE===e.CODE){if(o.VALUE===u.NAME||o.VALUE===u.XML_ID){J=" bx_active"}}}d+='<li style="width:10%;"															class="sku_prop'+J+'"															data-value-id="'+u.XML_ID+'"															data-element="'+r.ID+'"															data-property="'+e.CODE+'"															>															<a href="javascript:void(0)" class="cnt"><span class="cnt_item" style="background-image:url('+u.PICT["SRC"]+'"></span></a>														</li>'}d+="</ul>";d+="</div>";d+='<div class="bx_slide_left" onclick="leftScroll(\''+e.CODE+"', "+r.ID+", "+BX.util.array_keys(e.VALUES).length+');"></div>';d+='<div class="bx_slide_right" onclick="rightScroll(\''+e.CODE+"', "+r.ID+", "+BX.util.array_keys(e.VALUES).length+');"></div>';d+="</div>";d+="</div>"}else{d+='<div class="bx_item_detail_size_small_noadaptive '+ae+'">';d+='<span class="bx_item_section_name_gray">'+e.NAME+"</span>";d+='<div class="bx_size_scroller_container">';d+='<div class="bx_size">';d+='<ul id="prop_'+e.CODE+"_"+r.ID+'" style="width: 200%; margin-left:0%;" class="sku_prop_list">';for(q in e.VALUES){u=e.VALUES[q];J="";for(W=0;W<r.PROPS.length;W++){o=r.PROPS[W];if(o.CODE===e.CODE){if(o.VALUE===u.NAME){J="bx_active"}}}d+='<li style="width:10%;"															class="sku_prop '+J+'"															data-value-id="'+u.NAME+'"															data-element="'+r.ID+'"															data-property="'+e.CODE+'"															>															<a href="javascript:void(0)" class="cnt">'+u.NAME+"</a>														</li>"}d+="</ul>";d+="</div>";d+='<div class="bx_slide_left" onclick="leftScroll(\''+e.CODE+"', "+r.ID+", "+BX.util.array_keys(e.VALUES).length+');"></div>';d+='<div class="bx_slide_right" onclick="rightScroll(\''+e.CODE+"', "+r.ID+", "+BX.util.array_keys(e.VALUES).length+');"></div>';d+="</div>";d+="</div>"}}}}v.innerHTML=d;break;case"QUANTITY":t=b.insertCell(-1);Y="";S=(parseFloat(r.MEASURE_RATIO)>0)?r.MEASURE_RATIO:1;B=(parseFloat(r.AVAILABLE_QUANTITY)>0)?'max="'+r.AVAILABLE_QUANTITY+'"':"";c=false;if(S!=0&&S!=""){A=r.QUANTITY;r.QUANTITY=getCorrectRatioQuantity(r.QUANTITY,S,l);if(A!=r.QUANTITY){c=true}}t.setAttribute("class","custom");Y+="<span>"+getColumnName(N,C[aa])+":</span>";Y+='<div class="centered">';Y+='<table cellspacing="0" cellpadding="0" class="counter">';Y+="<tr>";Y+="<td>";Y+='<input type="text" size="3" id="QUANTITY_INPUT_'+r.ID+'"											name="QUANTITY_INPUT_'+r.ID+'"											size="2" maxlength="18" min="0" '+B+"step="+S+'											style="max-width: 50px"											value="'+r.QUANTITY+'"											onchange="updateQuantity(\'QUANTITY_INPUT_'+r.ID+"','"+r.ID+"', "+S+","+l+')"						>';Y+="</td>";if(S!=0&&S!=""){Y+='<td id="basket_quantity_control">							<div class="basket_quantity_control">								<a href="javascript:void(0);" class="plus" onclick="setQuantity('+r.ID+", "+S+", 'up', "+l+');"></a>								<a href="javascript:void(0);" class="minus" onclick="setQuantity('+r.ID+", "+S+", 'down', "+l+');"></a>							</div>						</td>'}if(r.hasOwnProperty("MEASURE_TEXT")&&r.MEASURE_TEXT.length>0){Y+='<td style="text-align: left">'+r.MEASURE_TEXT+"</td>"}Y+="</tr>";Y+="</table>";Y+="</div>";Y+='<input type="hidden" id="QUANTITY_'+r.ID+'" name="QUANTITY_'+r.ID+'" value="'+r.QUANTITY+'" />';t.innerHTML=Y;if(c){updateQuantity("QUANTITY_INPUT_"+r.ID,r.ID,S,l)}break;case"PRICE":X=b.insertCell(-1);a=(r.FULL_PRICE_FORMATED!=r.PRICE_FORMATED)?r.FULL_PRICE_FORMATED:"";X.setAttribute("class","price");X.innerHTML+='<div class="current_price" id="current_price_'+r.ID+'">'+r.PRICE_FORMATED+"</div>";X.innerHTML+='<div class="old_price" id="old_price_'+r.ID+'">'+a+"</div>";if(D&&r.NOTES.length>0){X.innerHTML+='<div class="type_price">'+basketJSParams.SALE_TYPE+"</div>";X.innerHTML+='<div class="type_price_value">'+r.NOTES+"</div>"}break;case"DISCOUNT":m=b.insertCell(-1);m.setAttribute("class","custom");m.innerHTML="<span>"+getColumnName(N,C[aa])+":</span>";m.innerHTML+='<div id="discount_value_'+r.ID+'">'+r.DISCOUNT_PRICE_PERCENT_FORMATED+"</div>";break;case"WEIGHT":w=b.insertCell(-1);w.setAttribute("class","custom");w.innerHTML="<span>"+getColumnName(N,C[aa])+":</span>";w.innerHTML+=r.WEIGHT_FORMATED;break;default:f=b.insertCell(-1);M="";f.setAttribute("class","custom");f.innerHTML="<span>"+getColumnName(N,C[aa])+":</span>";if(C[aa]=="SUM"){M+='<div id="sum_'+r.ID+'">'}if(typeof(r[C[aa]])!="undefined"){M+=r[C[aa]]}if(C[aa]=="SUM"){M+="</div>"}f.innerHTML+=M;break}}if(U||K){var ac=b.insertCell(-1);ac.setAttribute("class","control");if(U){ac.innerHTML='<a href="'+basketJSParams.DELETE_URL.replace("#ID#",r.ID)+'">'+basketJSParams.SALE_DELETE+"</a><br />"}if(K){ac.innerHTML+='<a href="'+basketJSParams.DELAY_URL.replace("#ID#",r.ID)+'">'+basketJSParams.SALE_DELAY+"</a>"}}var p=b.insertCell(-1);p.setAttribute("class","margin");var n=BX.findChildren(BX(V),{tagName:"li",className:"sku_prop"},true);if(!!n&&n.length>0){for(aa=0;n.length>aa;aa++){BX.bind(n[aa],"click",BX.delegate(function(i){skuPropClickHandler(i)},this))}}}if(!!N.BASKET_DATA){for(O in N.BASKET_DATA.GRID.ROWS){if(N.BASKET_DATA.GRID.ROWS.hasOwnProperty(O)){var L=N.BASKET_DATA.GRID.ROWS[O];if(BX("discount_value_"+O)){BX("discount_value_"+O).innerHTML=L.DISCOUNT_PRICE_PERCENT_FORMATED}if(BX("current_price_"+O)){BX("current_price_"+O).innerHTML=L.PRICE_FORMATED}if(BX("old_price_"+O)){BX("old_price_"+O).innerHTML=(L.FULL_PRICE_FORMATED!=L.PRICE_FORMATED)?L.FULL_PRICE_FORMATED:""}if(BX("sum_"+O)){BX("sum_"+O).innerHTML=L.SUM}if(BX("QUANTITY_"+O)){BX("QUANTITY_INPUT_"+O).value=L.QUANTITY;BX("QUANTITY_INPUT_"+O).defaultValue=L.QUANTITY;BX("QUANTITY_"+O).value=L.QUANTITY}}}}if(!!N.BASKET_DATA){couponListUpdate(N.BASKET_DATA)}if(N.hasOwnProperty("WARNING_MESSAGE")){var H="";for(aa=N.WARNING_MESSAGE.length-1;aa>=0;aa--){H+=N.WARNING_MESSAGE[aa]+"<br/>"}BX("warning_message").innerHTML=H}if(!!N.BASKET_DATA){if(BX("allWeight_FORMATED")){BX("allWeight_FORMATED").innerHTML=N.BASKET_DATA["allWeight_FORMATED"].replace(/\s/g,"&nbsp;")}if(BX("allSum_wVAT_FORMATED")){BX("allSum_wVAT_FORMATED").innerHTML=N.BASKET_DATA["allSum_wVAT_FORMATED"].replace(/\s/g,"&nbsp;")}if(BX("allVATSum_FORMATED")){BX("allVATSum_FORMATED").innerHTML=N.BASKET_DATA["allVATSum_FORMATED"].replace(/\s/g,"&nbsp;")}if(BX("allSum_FORMATED")){BX("allSum_FORMATED").innerHTML=N.BASKET_DATA["allSum_FORMATED"].replace(/\s/g,"&nbsp;")}if(BX("PRICE_WITHOUT_DISCOUNT")){BX("PRICE_WITHOUT_DISCOUNT").innerHTML=(N.BASKET_DATA["PRICE_WITHOUT_DISCOUNT"]!=N.BASKET_DATA["allSum_FORMATED"])?N.BASKET_DATA["PRICE_WITHOUT_DISCOUNT"].replace(/\s/g,"&nbsp;"):""}BX.onCustomEvent("OnBasketChange")}}function couponCreate(a,b){var c="disabled";if(!BX.type.isElementNode(a)){return}if(b.JS_STATUS==="BAD"){c="bad"}else{if(b.JS_STATUS==="APPLYED"){c="good"}}a.appendChild(BX.create("div",{props:{className:"bx_ordercart_coupon"},children:[BX.create("input",{props:{className:c,type:"text",value:b.COUPON,name:"OLD_COUPON[]"},attrs:{disabled:true,readonly:true}}),BX.create("span",{props:{className:c},attrs:{"data-coupon":b.COUPON}}),BX.create("div",{props:{className:"bx_ordercart_coupon_notes"},html:b.JS_CHECK_CODE})]}))}function couponListUpdate(f){var c,a,b,k,h,e,d,g;if(!!f&&typeof f!=="object"){return}c=BX("coupons_block");if(!!c){if(!!f.COUPON_LIST&&BX.type.isArray(f.COUPON_LIST)){b=BX("coupon");if(!!b){b.value=""}k=BX.findChildren(c,{tagName:"input",property:{name:"OLD_COUPON[]"}},true);if(!!k){if(BX.type.isElementNode(k)){k=[k]}for(e=0;e<f.COUPON_LIST.length;e++){h=false;g=-1;for(d=0;d<k.length;d++){if(k[d].value===f.COUPON_LIST[e].COUPON){h=true;g=d;k[d].couponUpdate=true;break}}if(h){a="disabled";if(f.COUPON_LIST[e].JS_STATUS==="BAD"){a="bad"}else{if(f.COUPON_LIST[e].JS_STATUS==="APPLYED"){a="good"}}BX.adjust(k[g],{props:{className:a}});BX.adjust(k[g].nextSibling,{props:{className:a}});BX.adjust(k[g].nextSibling.nextSibling,{html:f.COUPON_LIST[e].JS_CHECK_CODE})}else{couponCreate(c,f.COUPON_LIST[e])}}for(d=0;d<k.length;d++){if(typeof(k[d].couponUpdate)==="undefined"||!k[d].couponUpdate){BX.remove(k[d].parentNode);k[d]=null}else{k[d].couponUpdate=null}}}else{for(e=0;e<f.COUPON_LIST.length;e++){couponCreate(c,f.COUPON_LIST[e])}}}}c=null}function skuPropClickHandler(h){if(!h){h=window.event}var j=BX.proxy_context,l,n,k={},b={},f,a,g,c,d;if(!!j&&j.hasAttribute("data-value-id")){BX.showWait();l=j.getAttribute("data-element");n=j.getAttribute("data-property");f=BX("action_var").value;k[n]=j.getAttribute("data-value-id");if(BX.hasClass(j,"bx_active")){BX.closeWait();return}a=BX.findChildren(BX(l),{tagName:"ul",className:"sku_prop_list"},true);if(!!a&&a.length>0){for(g=0;a.length>g;g++){if(a[g].id!=="prop_"+n+"_"+l){c=BX.findChildren(BX(a[g].id),{tagName:"li",className:"bx_active"},true);if(!!c&&c.length>0){for(d=0;c.length>d;d++){if(c[d].hasAttribute("data-value-id")){k[c[d].getAttribute("data-property")]=c[d].getAttribute("data-value-id")}}}}}}b={basketItemId:l,sessid:BX.bitrix_sessid(),site_id:BX.message("SITE_ID"),props:k,action_var:f,select_props:BX("column_headers").value,offers_props:BX("offers_props").value,quantity_float:BX("quantity_float").value,count_discount_4_all_quantity:BX("count_discount_4_all_quantity").value,price_vat_show_value:BX("price_vat_show_value").value,hide_coupon:BX("hide_coupon").value,use_prepayment:BX("use_prepayment").value};b[f]="select_item";BX.ajax({url:"/bitrix/components/bitrix/sale.basket.basket/ajax.php",method:"POST",data:b,dataType:"json",onsuccess:function(e){BX.closeWait();updateBasketTable(l,e)}})}}function getColumnName(a,b){if(BX("col_"+b)){return BX.util.trim(BX("col_"+b).innerHTML)}else{return""}}function leftScroll(e,d,c){c=parseInt(c,10);var b=BX("prop_"+e+"_"+d);if(b){var a=parseInt(b.style.marginLeft,10);if(a<=(6-c)*20){b.style.marginLeft=a+20+"%"}}}function rightScroll(e,d,c){c=parseInt(c,10);var b=BX("prop_"+e+"_"+d);if(b){var a=parseInt(b.style.marginLeft,10);if(a>(5-c)*20){b.style.marginLeft=a-20+"%"}}}function checkOut(){if(!!BX("coupon")){BX("coupon").disabled=true}BX("basket_form").submit();return true}function enterCoupon(){var a=BX("coupon");if(!!a&&!!a.value){recalcBasketAjax({coupon:a.value})}}function updateQuantity(l,d,j,c){var k=BX(l).defaultValue,b=parseFloat(BX(l).value)||0,h=false;if(j===0||j==1){h=true}else{var e=b*10000,f=j*10000,i=e%f,a=parseInt(b);if(i===0){h=true}}var g=false;if(parseInt(b)!=parseFloat(b)){g=true}b=(c===false&&g===false)?parseInt(b):parseFloat(b).toFixed(2);if(h){BX(l).defaultValue=b;BX("QUANTITY_INPUT_"+d).value=b;BX("QUANTITY_"+d).value=b;recalcBasketAjax({})}else{b=getCorrectRatioQuantity(b,j,c);if(b!=k){BX("QUANTITY_INPUT_"+d).value=b;BX("QUANTITY_"+d).value=b;recalcBasketAjax({})}else{BX(l).value=k}}}function setQuantity(b,e,a,f){var d=parseFloat(BX("QUANTITY_INPUT_"+b).value),c;c=(a=="up")?d+e:d-e;if(c<0){c=0}if(f){c=c.toFixed(2)}if(e>0&&c<e){c=e}if(!f&&c!=c.toFixed(2)){c=c.toFixed(2)}c=getCorrectRatioQuantity(c,e,f);BX("QUANTITY_INPUT_"+b).value=c;BX("QUANTITY_INPUT_"+b).defaultValue=c;updateQuantity("QUANTITY_INPUT_"+b,b,e,f)}function getCorrectRatioQuantity(d,h,a){var b=d*10000,c=h*10000,g=b%c,j=d,e=false,f;h=parseFloat(h);if(g===0){return j}if(h!==0&&h!=1){for(f=h,max=parseFloat(d)+parseFloat(h);f<=max;f=parseFloat(parseFloat(f)+parseFloat(h)).toFixed(2)){j=f}}else{if(h===1){j=d|0}}if(parseInt(j,10)!=parseFloat(j)){e=true}j=(a===false&&e===false)?parseInt(j,10):parseFloat(j).toFixed(2);return j}function recalcBasketAjax(g){BX.showWait();var e={},d=BX("action_var").value,b=BX("basket_items"),f=BX("delayed_items"),a,c;a={sessid:BX.bitrix_sessid(),site_id:BX.message("SITE_ID"),props:e,action_var:d,select_props:BX("column_headers").value,offers_props:BX("offers_props").value,quantity_float:BX("quantity_float").value,count_discount_4_all_quantity:BX("count_discount_4_all_quantity").value,price_vat_show_value:BX("price_vat_show_value").value,hide_coupon:BX("hide_coupon").value,use_prepayment:BX("use_prepayment").value};a[d]="recalculate";if(!!g&&typeof g==="object"){for(c in g){if(g.hasOwnProperty(c)){a[c]=g[c]}}}if(!!b&&b.rows.length>0){for(c=1;b.rows.length>c;c++){a["QUANTITY_"+b.rows[c].id]=BX("QUANTITY_"+b.rows[c].id).value}}if(!!f&&f.rows.length>0){for(c=1;f.rows.length>c;c++){a["DELAY_"+f.rows[c].id]="Y"}}BX.ajax({url:"/bitrix/components/bitrix/sale.basket.basket/ajax.php",method:"POST",data:a,dataType:"json",onsuccess:function(h){BX.closeWait();updateBasketTable(null,h)}})}function showBasketItemsList(a){BX.removeClass(BX("basket_toolbar_button"),"current");BX.removeClass(BX("basket_toolbar_button_delayed"),"current");BX.removeClass(BX("basket_toolbar_button_subscribed"),"current");BX.removeClass(BX("basket_toolbar_button_not_available"),"current");BX("normal_count").style.display="inline-block";BX("delay_count").style.display="inline-block";BX("subscribe_count").style.display="inline-block";BX("not_available_count").style.display="inline-block";if(a==2){if(BX("basket_items_list")){BX("basket_items_list").style.display="none"}if(BX("basket_items_delayed")){BX("basket_items_delayed").style.display="block";BX.addClass(BX("basket_toolbar_button_delayed"),"current");BX("delay_count").style.display="none"}if(BX("basket_items_subscribed")){BX("basket_items_subscribed").style.display="none"}if(BX("basket_items_not_available")){BX("basket_items_not_available").style.display="none"}}else{if(a==3){if(BX("basket_items_list")){BX("basket_items_list").style.display="none"}if(BX("basket_items_delayed")){BX("basket_items_delayed").style.display="none"}if(BX("basket_items_subscribed")){BX("basket_items_subscribed").style.display="block";BX.addClass(BX("basket_toolbar_button_subscribed"),"current");BX("subscribe_count").style.display="none"}if(BX("basket_items_not_available")){BX("basket_items_not_available").style.display="none"}}else{if(a==4){if(BX("basket_items_list")){BX("basket_items_list").style.display="none"}if(BX("basket_items_delayed")){BX("basket_items_delayed").style.display="none"}if(BX("basket_items_subscribed")){BX("basket_items_subscribed").style.display="none"}if(BX("basket_items_not_available")){BX("basket_items_not_available").style.display="block";BX.addClass(BX("basket_toolbar_button_not_available"),"current");BX("not_available_count").style.display="none"}}else{if(BX("basket_items_list")){BX("basket_items_list").style.display="block";BX.addClass(BX("basket_toolbar_button"),"current");BX("normal_count").style.display="none"}if(BX("basket_items_delayed")){BX("basket_items_delayed").style.display="none"}if(BX("basket_items_subscribed")){BX("basket_items_subscribed").style.display="none"}if(BX("basket_items_not_available")){BX("basket_items_not_available").style.display="none"}}}}}function deleteCoupon(c){var b=BX.proxy_context,a;if(!!b&&b.hasAttribute("data-coupon")){a=b.getAttribute("data-coupon");if(!!a&&a.length>0){recalcBasketAjax({delete_coupon:a})}}}BX.ready(function(){var b=BX.findChildren(BX("basket_items"),{tagName:"li",className:"sku_prop"},true),c,a;if(!!b&&b.length>0){for(c=0;b.length>c;c++){BX.bind(b[c],"click",BX.delegate(function(d){skuPropClickHandler(d)},this))}}a=BX("coupons_block");if(!!a){BX.bindDelegate(a,"click",{attribute:"data-coupon"},BX.delegate(function(d){deleteCoupon(d)},this))}});