(function(){if(BX.date){return}BX.date={};BX.date.format=function(u,e,d,b){var w=BX.type.isDate(e)?new Date(e.getTime()):BX.type.isNumber(e)?new Date(e*1000):new Date();var q=BX.type.isDate(d)?new Date(d.getTime()):BX.type.isNumber(d)?new Date(d*1000):new Date();var c=!!b;if(BX.type.isArray(u)){return s(u,w,q,c)}else{if(!BX.type.isNotEmptyString(u)){return""}}var t=/\\?(sago|iago|isago|Hago|dago|mago|Yago|sdiff|idiff|Hdiff|ddiff|mdiff|Ydiff|yesterday|today|tommorow|[a-z])/gi;var p={d:function(){return BX.util.str_pad_left(l(w).toString(),2,"0")},D:function(){return BX.message("DOW_"+i(w))},j:function(){return l(w)},l:function(){return BX.message("DAY_OF_WEEK_"+i(w))},N:function(){return i(w)||7},S:function(){if(l(w)%10==1&&l(w)!=11){return"st"}else{if(l(w)%10==2&&l(w)!=12){return"nd"}else{if(l(w)%10==3&&l(w)!=13){return"rd"}else{return"th"}}}},w:function(){return i(w)},z:function(){var A=new Date(m(w),0,1);var B=new Date(m(w),k(w),l(w));return Math.ceil((B-A)/(24*3600*1000))},W:function(){var B=new Date(w.getTime());var D=(i(w)+6)%7;f(B,l(B)-D+3);var C=B.getTime();j(B,0,1);if(i(B)!=4){j(B,0,1+((4-i(B))+7)%7)}var A=1+Math.ceil((C-B)/(7*24*3600*1000));return BX.util.str_pad_left(A.toString(),2,"0")},F:function(){return BX.message("MONTH_"+(k(w)+1)+"_S")},f:function(){return BX.message("MONTH_"+(k(w)+1))},m:function(){return BX.util.str_pad_left((k(w)+1).toString(),2,"0")},M:function(){return BX.message("MON_"+(k(w)+1))},n:function(){return k(w)+1},t:function(){var A=c?new Date(Date.UTC(m(w),k(w)+1,0)):new Date(m(w),k(w)+1,0);return l(A)},L:function(){var A=m(w);return(A%4==0&&A%100!=0||A%400==0?1:0)},o:function(){var A=new Date(w.getTime());f(A,l(A)-((i(w)+6)%7)+3);return m(A)},Y:function(){return m(w)},y:function(){return m(w).toString().slice(2)},a:function(){return h(w)>11?"pm":"am"},A:function(){return h(w)>11?"PM":"AM"},B:function(){var A=((w.getUTCHours()+1)%24)+w.getUTCMinutes()/60+w.getUTCSeconds()/3600;return BX.util.str_pad_left(Math.floor(A*1000/24).toString(),3,"0")},g:function(){return h(w)%12||12},G:function(){return h(w)},h:function(){return BX.util.str_pad_left((h(w)%12||12).toString(),2,"0")},H:function(){return BX.util.str_pad_left(h(w).toString(),2,"0")},i:function(){return BX.util.str_pad_left(y(w).toString(),2,"0")},s:function(){return BX.util.str_pad_left(g(w).toString(),2,"0")},u:function(){return BX.util.str_pad_left((x(w)*1000).toString(),6,"0")},e:function(){if(c){return"UTC"}return""},I:function(){if(c){return 0}var B=new Date(m(w),0,1);var D=Date.UTC(m(w),0,1);var C=new Date(m(w),6,0);var A=Date.UTC(m(w),6,0);return 0+((B-D)!==(C-A))},O:function(){if(c){return"+0000"}var B=w.getTimezoneOffset();var A=Math.abs(B);return(B>0?"-":"+")+BX.util.str_pad_left((Math.floor(A/60)*100+A%60).toString(),4,"0")},P:function(){if(c){return"+00:00"}var A=this.O();return A.substr(0,3)+":"+A.substr(3)},Z:function(){if(c){return 0}return -w.getTimezoneOffset()*60},c:function(){return"Y-m-d\\TH:i:sP".replace(t,o)},r:function(){return"D, d M Y H:i:s O".replace(t,o)},U:function(){return Math.floor(w.getTime()/1000)},sago:function(){return v(z((q-w)/1000),{"0":"FD_SECOND_AGO_0","1":"FD_SECOND_AGO_1","10_20":"FD_SECOND_AGO_10_20",MOD_1:"FD_SECOND_AGO_MOD_1",MOD_2_4:"FD_SECOND_AGO_MOD_2_4",MOD_OTHER:"FD_SECOND_AGO_MOD_OTHER"})},sdiff:function(){return v(z((q-w)/1000),{"0":"FD_SECOND_DIFF_0","1":"FD_SECOND_DIFF_1","10_20":"FD_SECOND_DIFF_10_20",MOD_1:"FD_SECOND_DIFF_MOD_1",MOD_2_4:"FD_SECOND_DIFF_MOD_2_4",MOD_OTHER:"FD_SECOND_DIFF_MOD_OTHER"})},iago:function(){return v(z((q-w)/60/1000),{"0":"FD_MINUTE_AGO_0","1":"FD_MINUTE_AGO_1","10_20":"FD_MINUTE_AGO_10_20",MOD_1:"FD_MINUTE_AGO_MOD_1",MOD_2_4:"FD_MINUTE_AGO_MOD_2_4",MOD_OTHER:"FD_MINUTE_AGO_MOD_OTHER"})},idiff:function(){return v(z((q-w)/60/1000),{"0":"FD_MINUTE_DIFF_0","1":"FD_MINUTE_DIFF_1","10_20":"FD_MINUTE_DIFF_10_20",MOD_1:"FD_MINUTE_DIFF_MOD_1",MOD_2_4:"FD_MINUTE_DIFF_MOD_2_4",MOD_OTHER:"FD_MINUTE_DIFF_MOD_OTHER"})},isago:function(){var B=z((q-w)/60/1000);var A=v(B,{"0":"FD_MINUTE_0","1":"FD_MINUTE_1","10_20":"FD_MINUTE_10_20",MOD_1:"FD_MINUTE_MOD_1",MOD_2_4:"FD_MINUTE_MOD_2_4",MOD_OTHER:"FD_MINUTE_MOD_OTHER"});A+=" ";var C=z((q-w)/1000)-(B*60);A+=v(C,{"0":"FD_SECOND_AGO_0","1":"FD_SECOND_AGO_1","10_20":"FD_SECOND_AGO_10_20",MOD_1:"FD_SECOND_AGO_MOD_1",MOD_2_4:"FD_SECOND_AGO_MOD_2_4",MOD_OTHER:"FD_SECOND_AGO_MOD_OTHER"});return A},Hago:function(){return v(z((q-w)/60/60/1000),{"0":"FD_HOUR_AGO_0","1":"FD_HOUR_AGO_1","10_20":"FD_HOUR_AGO_10_20",MOD_1:"FD_HOUR_AGO_MOD_1",MOD_2_4:"FD_HOUR_AGO_MOD_2_4",MOD_OTHER:"FD_HOUR_AGO_MOD_OTHER"})},Hdiff:function(){return v(z((q-w)/60/60/1000),{"0":"FD_HOUR_DIFF_0","1":"FD_HOUR_DIFF_1","10_20":"FD_HOUR_DIFF_10_20",MOD_1:"FD_HOUR_DIFF_MOD_1",MOD_2_4:"FD_HOUR_DIFF_MOD_2_4",MOD_OTHER:"FD_HOUR_DIFF_MOD_OTHER"})},yesterday:function(){return BX.message("FD_YESTERDAY")},today:function(){return BX.message("FD_TODAY")},tommorow:function(){return BX.message("FD_TOMORROW")},dago:function(){return v(z((q-w)/60/60/24/1000),{"0":"FD_DAY_AGO_0","1":"FD_DAY_AGO_1","10_20":"FD_DAY_AGO_10_20",MOD_1:"FD_DAY_AGO_MOD_1",MOD_2_4:"FD_DAY_AGO_MOD_2_4",MOD_OTHER:"FD_DAY_AGO_MOD_OTHER"})},ddiff:function(){return v(z((q-w)/60/60/24/1000),{"0":"FD_DAY_DIFF_0","1":"FD_DAY_DIFF_1","10_20":"FD_DAY_DIFF_10_20",MOD_1:"FD_DAY_DIFF_MOD_1",MOD_2_4:"FD_DAY_DIFF_MOD_2_4",MOD_OTHER:"FD_DAY_DIFF_MOD_OTHER"})},mago:function(){return v(z((q-w)/60/60/24/31/1000),{"0":"FD_MONTH_AGO_0","1":"FD_MONTH_AGO_1","10_20":"FD_MONTH_AGO_10_20",MOD_1:"FD_MONTH_AGO_MOD_1",MOD_2_4:"FD_MONTH_AGO_MOD_2_4",MOD_OTHER:"FD_MONTH_AGO_MOD_OTHER"})},mdiff:function(){return v(z((q-w)/60/60/24/31/1000),{"0":"FD_MONTH_DIFF_0","1":"FD_MONTH_DIFF_1","10_20":"FD_MONTH_DIFF_10_20",MOD_1:"FD_MONTH_DIFF_MOD_1",MOD_2_4:"FD_MONTH_DIFF_MOD_2_4",MOD_OTHER:"FD_MONTH_DIFF_MOD_OTHER"})},Yago:function(){return v(z((q-w)/60/60/24/365/1000),{"0":"FD_YEARS_AGO_0","1":"FD_YEARS_AGO_1","10_20":"FD_YEARS_AGO_10_20",MOD_1:"FD_YEARS_AGO_MOD_1",MOD_2_4:"FD_YEARS_AGO_MOD_2_4",MOD_OTHER:"FD_YEARS_AGO_MOD_OTHER"})},Ydiff:function(){return v(z((q-w)/60/60/24/365/1000),{"0":"FD_YEARS_DIFF_0","1":"FD_YEARS_DIFF_1","10_20":"FD_YEARS_DIFF_10_20",MOD_1:"FD_YEARS_DIFF_MOD_1",MOD_2_4:"FD_YEARS_DIFF_MOD_2_4",MOD_OTHER:"FD_YEARS_DIFF_MOD_OTHER"})},x:function(){return BX.date.format([["tommorow","tommorow, H:i"],["-",BX.date.convertBitrixFormat(BX.message("FORMAT_DATETIME")).replace(/:s$/g,"")],["s","sago"],["i","iago"],["today","today, H:i"],["yesterday","yesterday, H:i"],["",BX.date.convertBitrixFormat(BX.message("FORMAT_DATETIME")).replace(/:s$/g,"")]],w,q,c)},X:function(){var A=BX.date.format([["tommorow","tommorow"],["-",BX.date.convertBitrixFormat(BX.message("FORMAT_DATE"))],["today","today"],["yesterday","yesterday"],["",BX.date.convertBitrixFormat(BX.message("FORMAT_DATE"))]],w,q,c);var B=BX.date.format([["tommorow","H:i"],["today","H:i"],["yesterday","H:i"],["",""]],w,q,c);if(B.length>0){return BX.message("FD_DAY_AT_TIME").replace(/#DAY#/g,A).replace(/#TIME#/g,B)}else{return A}},Q:function(){var A=z((q-w)/60/60/24/1000);if(A==0){return BX.message("FD_DAY_DIFF_1").replace(/#VALUE#/g,1)}else{return BX.date.format([["d","ddiff"],["m","mdiff"],["","Ydiff"]],w,q)}}};var r=false;if(u[0]&&u[0]=="^"){r=true;u=u.substr(1)}var n=u.replace(t,o);if(r){n=n.replace(/\s*00:00:00\s*/g,"").replace(/(\d\d:\d\d)(:00)/g,"$1").replace(/(\s*00:00\s*)(?!:)/g,"")}return n;function s(E,P,L,A){var G=z((L-P)/1000);for(var O=0;O<E.length;O++){var M=E[O][0];var D=E[O][1];var H=null;if(M=="s"){if(G<60){return BX.date.format(D,P,L,A)}}else{if((H=/^s(\d+)/.exec(M))!=null){if(G<H[1]){return BX.date.format(D,P,L,A)}}else{if(M=="i"){if(G<60*60){return BX.date.format(D,P,L,A)}}else{if((H=/^i(\d+)/.exec(M))!=null){if(G<H[1]*60){return BX.date.format(D,P,L,A)}}else{if(M=="H"){if(G<24*60*60){return BX.date.format(D,P,L,A)}}else{if((H=/^H(\d+)/.exec(M))!=null){if(G<H[1]*60*60){return BX.date.format(D,P,L,A)}}else{if(M=="d"){if(G<31*24*60*60){return BX.date.format(D,P,L,A)}}else{if((H=/^d(\d+)/.exec(M))!=null){if(G<H[1]*60*60){return BX.date.format(D,P,L,A)}}else{if(M=="m"){if(G<365*24*60*60){return BX.date.format(D,P,L,A)}}else{if((H=/^m(\d+)/.exec(M))!=null){if(G<H[1]*31*24*60*60){return BX.date.format(D,P,L,A)}}else{if(M=="today"){var J=m(L),Q=k(L),N=l(L);var R=A?new Date(Date.UTC(J,Q,N,0,0,0,0)):new Date(J,Q,N,0,0,0,0);var F=A?new Date(Date.UTC(J,Q,N+1,0,0,0,0)):new Date(J,Q,N+1,0,0,0,0);if(P>=R&&P<F){return BX.date.format(D,P,L,A)}}else{if(M=="yesterday"){J=m(L);Q=k(L);N=l(L);var C=A?new Date(Date.UTC(J,Q,N-1,0,0,0,0)):new Date(J,Q,N-1,0,0,0,0);var B=A?new Date(Date.UTC(J,Q,N,0,0,0,0)):new Date(J,Q,N,0,0,0,0);if(P>=C&&P<B){return BX.date.format(D,P,L,A)}}else{if(M=="tommorow"){J=m(L);Q=k(L);N=l(L);var I=A?new Date(Date.UTC(J,Q,N+1,0,0,0,0)):new Date(J,Q,N+1,0,0,0,0);var K=A?new Date(Date.UTC(J,Q,N+2,0,0,0,0)):new Date(J,Q,N+2,0,0,0,0);if(P>=I&&P<K){return BX.date.format(D,P,L,A)}}else{if(M=="-"){if(G<0){return BX.date.format(D,P,L,A)}}}}}}}}}}}}}}}}return E.length>0?BX.date.format(E.pop()[1],P,L,A):""}function m(A){return c?A.getUTCFullYear():A.getFullYear()}function l(A){return c?A.getUTCDate():A.getDate()}function k(A){return c?A.getUTCMonth():A.getMonth()}function h(A){return c?A.getUTCHours():A.getHours()}function y(A){return c?A.getUTCMinutes():A.getMinutes()}function g(A){return c?A.getUTCSeconds():A.getSeconds()}function x(A){return c?A.getUTCMilliseconds():A.getMilliseconds()}function i(A){return c?A.getUTCDay():A.getDay()}function f(A,B){return c?A.setUTCDate(B):A.setDate(B)}function j(B,A,C){return c?B.setUTCMonth(A,C):B.setMonth(A,C)}function v(C,B){var D=C<100?Math.abs(C):Math.abs(C%100);var E=D%10;var A="";if(D==0){A=BX.message(B["0"])}else{if(D==1){A=BX.message(B["1"])}else{if(D>=10&&D<=20){A=BX.message(B["10_20"])}else{if(E==1){A=BX.message(B.MOD_1)}else{if(2<=E&&E<=4){A=BX.message(B.MOD_2_4)}else{A=BX.message(B.MOD_OTHER)}}}}}return A.replace(/#VALUE#/g,C)}function o(A,B){if(p[A]){return p[A]()}else{return B}}function z(A){return A>=0?Math.floor(A):Math.ceil(A)}};BX.date.convertBitrixFormat=function(b){if(!BX.type.isNotEmptyString(b)){return""}return b.replace("YYYY","Y").replace("MMMM","F").replace("MM","m").replace("M","M").replace("DD","d").replace("G","g").replace(/GG/i,"G").replace("H","h").replace(/HH/i,"H").replace("MI","i").replace("SS","s").replace("TT","A").replace("T","a")};BX.date.convertToUTC=function(b){if(!BX.type.isDate(b)){return null}return new Date(Date.UTC(b.getFullYear(),b.getMonth(),b.getDate(),b.getHours(),b.getMinutes(),b.getSeconds(),b.getMilliseconds()))};BX.date.getNewDate=function(b){return new Date(BX.date.getBrowserTimestamp(b))};BX.date.getBrowserTimestamp=function(c){c=parseInt(c,10);var b=new Date(c*1000).getTimezoneOffset()*60;return(parseInt(c,10)+parseInt(BX.message("SERVER_TZ_OFFSET"))+b)*1000};BX.date.getServerTimestamp=function(c){c=parseInt(c,10);var b=new Date(c).getTimezoneOffset()*60;return Math.round(c/1000-(parseInt(BX.message("SERVER_TZ_OFFSET"),10)+parseInt(b,10)))};var a=null;BX.calendar=function(b){return BX.calendar.get().Show(b)};BX.calendar.get=function(){if(!a){a=new BX.JCCalendar()}return a};BX.calendar.InsertDaysBack=function(b,e){if(e!=""){var c=new Date();if(e>0){c.setTime(c.valueOf()-e*86400000)}b.value=BX.date.format(BX.date.convertBitrixFormat(BX.message("FORMAT_DATE")),c,null)}else{b.value=""}};BX.calendar.ValueToString=function(c,d,b){return BX.date.format(BX.date.convertBitrixFormat(BX.message(d?"FORMAT_DATETIME":"FORMAT_DATE")),c,null,!!b)};BX.CalendarPeriod={Init:function(d,b,c){if((d.value!=""||b.value!="")&&c.value==""){c.value="interval"}c.onchange()},ChangeDirectOpts:function(c,b){var d=BX.findChild(b,{className:"adm-select adm-calendar-direction"},true);if(c=="week"){d.options[0].text=BX.message("JSADM_CALEND_PREV_WEEK");d.options[1].text=BX.message("JSADM_CALEND_CURR_WEEK");d.options[2].text=BX.message("JSADM_CALEND_NEXT_WEEK")}else{d.options[0].text=BX.message("JSADM_CALEND_PREV");d.options[1].text=BX.message("JSADM_CALEND_CURR");d.options[2].text=BX.message("JSADM_CALEND_NEXT")}},SaveAndClearInput:function(b){if(!window.SavedPeriodValues){window.SavedPeriodValues={}}window.SavedPeriodValues[b.id]=b.value;b.value=""},RestoreInput:function(b){if(!window.SavedPeriodValues||!window.SavedPeriodValues[b.id]){return}b.value=window.SavedPeriodValues[b.id];delete (window.SavedPeriodValues[b.id])},OnChangeP:function(d){var m=d.parentNode.parentNode;var l,f,k,b;l=f=k=b=false;var c=BX.findChild(m,{className:"adm-input-wrap adm-calendar-inp adm-calendar-first"});var i=BX.findChild(m,{className:"adm-input-wrap adm-calendar-second"});var j=BX.findChild(m,{className:"adm-select-wrap adm-calendar-direction"});var g=BX.findChild(m,{className:"adm-calendar-separate"});var e=BX.findChild(m,{className:"adm-input adm-calendar-from"},true);var h=BX.findChild(m,{className:"adm-input adm-calendar-to"},true);switch(d.value){case"day":case"week":case"month":case"quarter":case"year":k=true;BX.CalendarPeriod.OnChangeD(j.children[0]);break;case"before":f=true;break;case"after":l=true;break;case"exact":l=true;break;case"interval":l=f=b=true;BX.CalendarPeriod.RestoreInput(e);BX.CalendarPeriod.RestoreInput(h);break;case"":BX.CalendarPeriod.SaveAndClearInput(e);BX.CalendarPeriod.SaveAndClearInput(h);break;default:break}BX.CalendarPeriod.ChangeDirectOpts(d.value,m);c.style.display=(l?"inline-block":"none");i.style.display=(f?"inline-block":"none");j.style.display=(k?"inline-block":"none");g.style.display=(b?"inline-block":"none")},OnChangeD:function(d){var p=d.parentNode.parentNode;var e=BX.findChild(p,{className:"adm-input adm-calendar-from"},true);var g=BX.findChild(p,{className:"adm-input adm-calendar-to"},true);var o=BX.findChild(p,{className:"adm-select adm-calendar-period"},true);var f=0;switch(d.value){case"previous":f=-1;break;case"next":f=1;break;case"current":default:break}var m=false;var n=false;var j=new Date();var i=j.getFullYear();var h=j.getMonth();var k=j.getDate();var c=j.getDay();if(c==0){c=7}switch(o.value){case"day":m=new Date(i,h,k+f,0,0,0);n=new Date(i,h,k+f,23,59,59);break;case"week":m=new Date(i,h,k-c+1+f*7,0,0,0);n=new Date(i,h,k+(7-c)+f*7,23,59,59);break;case"month":m=new Date(i,h+f,1,0,0,0);n=new Date(i,h+1+f,0,23,59,59);break;case"quarter":var b=Math.floor((h/3))+f;m=new Date(i,3*(b),1,0,0,0);n=new Date(i,3*(b+1),0,23,59,59);break;case"year":m=new Date(i+f,0,1,0,0,0);n=new Date(i+1+f,0,0,23,59,59);break;default:break}var l=window[e.name+"_bTime"]?BX.message("FORMAT_DATETIME"):BX.message("FORMAT_DATE");if(m){e.value=BX.formatDate(m,l);BX.addClass(e,"adm-calendar-inp-setted")}if(n){g.value=BX.formatDate(n,l);BX.addClass(g,"adm-calendar-inp-setted")}}};BX.JCCalendar=function(){this.params={};this.bAmPm=BX.isAmPmMode();this.popup=null;this.popup_month=null;this.popup_year=null;this.value=null;this.control_id=Math.random();this._layers={};this._current_layer=null;this.DIV=null;this.PARTS={};this.weekStart=0;this.numRows=6;this._create=function(b){this.popup=new BX.PopupWindow("calendar_popup_"+this.control_id,b.node,{closeByEsc:true,autoHide:false,content:this._get_content(),zIndex:3000,bindOptions:{forceBindPosition:true}});BX.bind(this.popup.popupContainer,"click",this.popup.cancelBubble)};this._auto_hide_disable=function(){BX.unbind(document,"click",BX.proxy(this._auto_hide,this))};this._auto_hide_enable=function(){BX.bind(document,"click",BX.proxy(this._auto_hide,this))};this._auto_hide=function(b){this._auto_hide_disable();this.popup.close()};this._get_content=function(){var b=BX.delegate(function(f){f=f||window.event;this.SetDate(new Date(parseInt(BX.proxy_context.getAttribute("data-date"))),f.type=="dblclick")},this);this.DIV=BX.create("DIV",{props:{className:"bx-calendar"},children:[BX.create("DIV",{props:{className:"bx-calendar-header"},children:[BX.create("A",{attrs:{href:"javascript:void(0)"},props:{className:"bx-calendar-left-arrow"},events:{click:BX.proxy(this._prev,this)}}),BX.create("SPAN",{props:{className:"bx-calendar-header-content"},children:[(this.PARTS.MONTH=BX.create("A",{attrs:{href:"javascript:void(0)"},props:{className:"bx-calendar-top-month"},events:{click:BX.proxy(this._menu_month,this)}})),(this.PARTS.YEAR=BX.create("A",{attrs:{href:"javascript:void(0)"},props:{className:"bx-calendar-top-year"},events:{click:BX.proxy(this._menu_year,this)}}))]}),BX.create("A",{attrs:{href:"javascript:void(0)"},props:{className:"bx-calendar-right-arrow"},events:{click:BX.proxy(this._next,this)}})]}),(this.PARTS.WEEK=BX.create("DIV",{props:{className:"bx-calendar-name-day-wrap"}})),(this.PARTS.LAYERS=BX.create("DIV",{props:{className:"bx-calendar-cell-block"},events:{click:BX.delegateEvent({className:"bx-calendar-cell"},b),dblclick:BX.delegateEvent({className:"bx-calendar-cell"},b)}})),(this.PARTS.TIME=BX.create("DIV",{props:{className:"bx-calendar-set-time-wrap"},events:{click:BX.delegateEvent({attr:"data-action"},BX.delegate(this._time_actions,this))},html:'<a href="javascript:void(0)" data-action="time_show" class="bx-calendar-set-time"><i></i>'+BX.message("CAL_TIME_SET")+'</a><div class="bx-calendar-form-block"><span class="bx-calendar-form-text">'+BX.message("CAL_TIME")+'</span><span class="bx-calendar-form"><input type="text" class="bx-calendar-form-input" maxwidth="2" onkeyup="BX.calendar.get()._check_time()" /><span class="bx-calendar-form-separator"></span><input type="text" class="bx-calendar-form-input" maxwidth="2" onkeyup="BX.calendar.get()._check_time()" />'+(this.bAmPm?'<span class="bx-calendar-AM-PM-block"><span class="bx-calendar-AM-PM-text" data-action="time_ampm"></span><span class="bx-calendar-form-arrow-r"><a href="javascript:void(0)" class="bx-calendar-form-arrow-top" data-action="time_ampm_up"><i></i></a><a href="javascript:void(0)" class="bx-calendar-form-arrow-bottom" data-action="time_ampm_down"><i></i></a></span></span>':"")+'</span><a href="javascript:void(0)" data-action="time_hide" class="bx-calendar-form-close"><i></i></a></div>'})),BX.create("DIV",{props:{className:"bx-calendar-button-block"},events:{click:BX.delegateEvent({attr:"data-action"},BX.delegate(this._button_actions,this))},html:'<a href="javascript:void(0)" class="bx-calendar-button bx-calendar-button-select" data-action="submit"><span class="bx-calendar-button-left"></span><span class="bx-calendar-button-text">'+BX.message("CAL_BUTTON")+'</span><span class="bx-calendar-button-right"></span></a><a href="javascript:void(0)" class="bx-calendar-button bx-calendar-button-cancel" data-action="cancel"><span class="bx-calendar-button-left"></span><span class="bx-calendar-button-text">'+BX.message("JS_CORE_WINDOW_CLOSE")+'</span><span class="bx-calendar-button-right"></span></a>'})]});this.PARTS.TIME_INPUT_H=BX.findChild(this.PARTS.TIME,{tag:"INPUT"},true);this.PARTS.TIME_INPUT_M=this.PARTS.TIME_INPUT_H.nextSibling.nextSibling;if(this.bAmPm){this.PARTS.TIME_AMPM=this.PARTS.TIME_INPUT_M.nextSibling.firstChild}var d=(new BX.JCSpinner({input:this.PARTS.TIME_INPUT_H,callback_change:BX.proxy(this._check_time,this),bSaveValue:false})).Show();d.className="bx-calendar-form-arrow-l";this.PARTS.TIME_INPUT_H.parentNode.insertBefore(d,this.PARTS.TIME_INPUT_H);d=(new BX.JCSpinner({input:this.PARTS.TIME_INPUT_M,callback_change:BX.proxy(this._check_time,this),bSaveValue:true})).Show();d.className="bx-calendar-form-arrow-r";if(!this.PARTS.TIME_INPUT_M.nextSibling){this.PARTS.TIME_INPUT_M.parentNode.appendChild(d)}else{this.PARTS.TIME_INPUT_M.parentNode.insertBefore(d,this.PARTS.TIME_INPUT_M.nextSibling)}for(var c=0;c<7;c++){this.PARTS.WEEK.appendChild(BX.create("SPAN",{props:{className:"bx-calendar-name-day"},text:BX.message("DOW_"+((c+this.weekStart)%7))}))}return this.DIV};this._time_actions=function(){switch(BX.proxy_context.getAttribute("data-action")){case"time_show":BX.addClass(this.PARTS.TIME,"bx-calendar-set-time-opened");this.popup.adjustPosition();break;case"time_hide":BX.removeClass(this.PARTS.TIME,"bx-calendar-set-time-opened");this.popup.adjustPosition();break;case"time_ampm":this.PARTS.TIME_AMPM.innerHTML=this.PARTS.TIME_AMPM.innerHTML=="AM"?"PM":"AM";break;case"time_ampm_up":this._check_time({bSaveValue:false},null,12);return;break;case"time_ampm_down":this._check_time({bSaveValue:false},null,-12);return;break}this._check_time()};this._button_actions=function(){switch(BX.proxy_context.getAttribute("data-action")){case"submit":this.SaveValue();break;case"cancel":this.Close();break}};this._check_time=function(g,e,f){var d=parseInt(this.PARTS.TIME_INPUT_H.value.substring(0,5),10)||0,b=parseInt(this.PARTS.TIME_INPUT_M.value.substring(0,5),10)||0,c=false;if(!!g&&!g.bSaveValue){this.value.setUTCHours(this.value.getUTCHours()+f)}else{if(!isNaN(d)){if(this.bAmPm){if(d!=12&&this.PARTS.TIME_AMPM.innerHTML=="PM"){d+=12}}c=true;this.value.setUTCHours(d%24)}}if(!isNaN(b)){c=true;this.value.setUTCMinutes(b%60)}if(c){this.SetValue(this.value)}};this._set_layer=function(){var b=parseInt(this.value.getUTCFullYear()+""+BX.util.str_pad_left(this.value.getUTCMonth()+"",2,"0"));if(!this._layers[b]){this._layers[b]=this._create_layer();this._layers[b].BXLAYERID=b}if(this._current_layer){var c=new Date(this.value.valueOf());c.setUTCHours(0);c.setUTCMinutes(0);var e=BX.findChild(this._layers[b],{tag:"A",className:"bx-calendar-active"},true),d=BX.findChild(this._layers[b],{tag:"A",attr:{"data-date":c.valueOf()+""}},true);if(e){BX.removeClass(e,"bx-calendar-active")}if(d){BX.addClass(d,"bx-calendar-active")}this._replace_layer(this._current_layer,this._layers[b])}else{this.PARTS.LAYERS.appendChild(this._layers[b])}this._current_layer=this._layers[b]};this._replace_layer=function(i,b){if(i!=b){if(!BX.browser.IsIE()||BX.browser.IsDoctype()){var d=i.BXLAYERID>b.BXLAYERID?1:-1;var c=0;var h=-d*i.offsetHeight;i.style.position="relative";i.style.top="0px";i.style.zIndex=5;b.style.position="absolute";b.style.top=h+"px";b.style.zIndex=6;this.PARTS.LAYERS.appendChild(b);var g=15;var e;(e=function(){h+=d*g;c+=d*g;if(d*h<0){i.style.top=c+"px";b.style.top=h+"px";setTimeout(e,10)}else{i.parentNode.removeChild(i);b.style.top="0px";b.style.position="static";b.style.zIndex=0}})()}else{this.PARTS.LAYERS.replaceChild(b,i)}}};this._create_layer=function(){var c=BX.create("DIV",{props:{className:"bx-calendar-layer"}});var g=new Date(this.value);g.setUTCHours(0);g.setUTCMinutes(0);g.setUTCDate(1);if(g.getUTCDay()!=this.weekStart){var m=g.getUTCDay()-this.weekStart;m+=m<0?7:0;g.setUTCDate(g.getUTCDate()-m)}var h=this.value.getUTCMonth(),n=this.value.getUTCDate(),o="";for(var f=0;f<this.numRows;f++){o+='<div class="bx-calendar-range'+(f==this.numRows-1?" bx-calendar-range-noline":"")+'">';for(var e=0;e<7;e++){m=g.getUTCDate();var b=g.getUTCDay();var k="bx-calendar-cell";if(h!=g.getUTCMonth()){k+=" bx-calendar-date-hidden"}else{if(n==m){k+=" bx-calendar-active"}}if(b==0||b==6){k+=" bx-calendar-weekend"}o+='<a href="javascript:void(0)" class="'+k+'" data-date="'+g.valueOf()+'">'+m+"</a>";g.setUTCDate(g.getUTCDate()+1)}o+="</div>"}c.innerHTML=o;return c};this._prev=function(){this.SetMonth(this.value.getUTCMonth()-1)};this._next=function(){this.SetMonth(this.value.getUTCMonth()+1)};this._menu_month_content=function(){var b="",d=this.value.getMonth(),c;for(c=0;c<12;c++){b+='<a href="javascript:void(0)" class="bx-calendar-month'+(c==d?" bx-calendar-month-active":"")+'" onclick="BX.calendar.get().SetMonth('+c+')">'+BX.message("MONTH_"+(c+1))+"</a>"}return'<div class="bx-calendar-month-popup"><div class="bx-calendar-month-title" onclick="BX.calendar.get().popup_month.close();">'+BX.message("MONTH_"+(this.value.getUTCMonth()+1))+'</div><div class="bx-calendar-month-content">'+b+"</div></div>"};this._menu_month=function(){if(!this.popup_month){this.popup_month=BX.PopupWindowManager.create("calendar_popup_month_"+this.control_id,this.PARTS.MONTH,{content:this._menu_month_content(),zIndex:3001,closeByEsc:true,autoHide:true,offsetTop:-29,offsetLeft:-1});this.popup_month.BXMONTH=this.value.getUTCMonth()}else{if(this.popup_month.BXMONTH!=this.value.getUTCMonth()){this.popup_month.setContent(this._menu_month_content());this.popup_month.BXMONTH=this.value.getUTCMonth()}}this.popup_month.show()};this._menu_year_content=function(){var c='<div class="bx-calendar-year-popup"><div class="bx-calendar-year-title" onclick="BX.calendar.get().popup_year.close();">'+this.value.getUTCFullYear()+'</div><div class="bx-calendar-year-content" id="bx-calendar-year-content">';for(var b=-3;b<=3;b++){c+='<a href="javascript:void(0)" class="bx-calendar-year-number'+(b==0?" bx-calendar-year-active":"")+'" onclick="BX.calendar.get().SetYear('+(this.value.getUTCFullYear()-b)+')">'+(this.value.getUTCFullYear()-b)+"</a>"}c+='</div><input type="text" class="bx-calendar-year-input" onkeyup="if(this.value>=1900&&this.value<=2100)BX.calendar.get().SetYear(this.value);" maxlength="4" /></div>';return c};this._menu_year=function(){if(!this.popup_year){this.popup_year=BX.PopupWindowManager.create("calendar_popup_year_"+this.control_id,this.PARTS.YEAR,{content:this._menu_year_content(),zIndex:3001,closeByEsc:true,autoHide:true,offsetTop:-29,offsetLeft:-1});this.popup_year.BXYEAR=this.value.getUTCFullYear()}else{if(this.popup_year.BXYEAR!=this.value.getUTCFullYear()){this.popup_year.setContent(this._menu_year_content());this.popup_year.BXYEAR=this.value.getUTCFullYear()}}this.popup_year.show()};this._check_date=function(b){var c=b;if(BX.type.isString(b)){c=BX.parseDate(b,true)}if(!BX.type.isDate(c)||isNaN(c.valueOf())){c=BX.date.convertToUTC(new Date());if(this.params.bHideTime){c.setUTCHours(0);c.setUTCMinutes(0)}}c.setUTCMilliseconds(0);c.setUTCSeconds(0);c.BXCHECKED=true;return c}};BX.JCCalendar.prototype.Show=function(d){if(!BX.isReady){BX.ready(BX.delegate(function(){this.Show(d)},this));return}d.node=d.node||document.body;if(BX.type.isNotEmptyString(d.node)){var e=BX(d.node);if(!e){e=document.getElementsByName(d.node);if(e&&e.length>0){e=e[0]}}d.node=e}if(!d.node){return}if(!!d.field){if(BX.type.isString(d.field)){e=BX(d.field);if(!!e){d.field=e}else{if(d.form){if(BX.type.isString(d.form)){d.form=document.forms[d.form]}}if(BX.type.isDomNode(d.form)&&!!d.form[d.field]){d.field=d.form[d.field]}else{e=document.getElementsByName(d.field);if(e&&e.length>0){e=e[0];d.field=e}}}if(BX.type.isString(d.field)){d.field=BX(d.field)}}}var c=!this.popup||!this.popup.isShown()||this.params.node!=d.node;this.params=d;this.params.bTime=typeof this.params.bTime=="undefined"?true:!!this.params.bTime;this.params.bHideTime=typeof this.params.bHideTime=="undefined"?true:!!this.params.bHideTime;this.weekStart=parseInt(this.params.weekStart||this.params.weekStart||BX.message("WEEK_START"));if(isNaN(this.weekStart)){this.weekStart=1}if(!this.popup){this._create(this.params)}else{this.popup.setBindElement(this.params.node)}var b=!!this.params.bHideTime;if(this.params.value){this.SetValue(this.params.value);b=this.value.getUTCHours()<=0&&this.value.getUTCMinutes()<=0}else{if(this.params.field){this.SetValue(this.params.field.value);b=this.value.getUTCHours()<=0&&this.value.getUTCMinutes()<=0}else{if(!!this.params.currentTime){this.SetValue(this.params.currentTime)}else{this.SetValue()}}}if(!!this.params.bTime){BX.removeClass(this.DIV,"bx-calendar-time-disabled")}else{BX.addClass(this.DIV,"bx-calendar-time-disabled")}if(!!b){BX.removeClass(this.PARTS.TIME,"bx-calendar-set-time-opened")}else{BX.addClass(this.PARTS.TIME,"bx-calendar-set-time-opened")}if(c){this._auto_hide_disable();this.popup.show();setTimeout(BX.proxy(this._auto_hide_enable,this),0)}this.params.bSetFocus=typeof this.params.bSetFocus=="undefined"?true:!!this.params.bSetFocus;if(this.params.bSetFocus){d.node.blur()}return this};BX.JCCalendar.prototype.SetDay=function(b){this.value.setUTCDate(b);return this.SetValue(this.value)};BX.JCCalendar.prototype.SetMonth=function(b){if(this.popup_month){this.popup_month.close()}this.value.setUTCMonth(b);if(b<0){b+=12}else{if(b>=12){b-=12}}while(this.value.getUTCMonth()>b){this.value.setUTCDate(this.value.getUTCDate()-1)}return this.SetValue(this.value)};BX.JCCalendar.prototype.SetYear=function(b){if(this.popup_year){this.popup_year.close()}this.value.setUTCFullYear(b);return this.SetValue(this.value)};BX.JCCalendar.prototype.SetDate=function(b,c){b=this._check_date(b);b.setUTCHours(this.value.getUTCHours());b.setUTCMinutes(this.value.getUTCMinutes());b.setUTCSeconds(this.value.getUTCSeconds());if(this.params.bTime&&!c){return this.SetValue(b)}else{this.SetValue(b);this.SaveValue()}};BX.JCCalendar.prototype.SetValue=function(b){this.value=(b&&b.BXCHECKED)?b:this._check_date(b);this.PARTS.MONTH.innerHTML=BX.message("MONTH_"+(this.value.getUTCMonth()+1));this.PARTS.YEAR.innerHTML=this.value.getUTCFullYear();if(!!this.params.bTime){var c=this.value.getUTCHours();if(this.bAmPm){if(c>=12){this.PARTS.TIME_AMPM.innerHTML="PM";if(c!=12){c-=12}}else{this.PARTS.TIME_AMPM.innerHTML="AM";if(c==0){c=12}}}this.PARTS.TIME_INPUT_H.value=BX.util.str_pad_left(c.toString(),2,"0");this.PARTS.TIME_INPUT_M.value=BX.util.str_pad_left(this.value.getUTCMinutes().toString(),2,"0")}this._set_layer();return this};BX.JCCalendar.prototype.SaveValue=function(){if(this.popup_month){this.popup_month.close()}if(this.popup_year){this.popup_year.close()}var d=true;if(!!this.params.callback){var b=this.params.callback.apply(this,[new Date(this.value.valueOf()+this.value.getTimezoneOffset()*60000)]);if(b===false){d=false}}if(d){var c=!!this.params.bTime&&BX.hasClass(this.PARTS.TIME,"bx-calendar-set-time-opened");if(this.params.field){this.params.field.value=BX.calendar.ValueToString(this.value,c,true);BX.fireEvent(this.params.field,"change")}this.popup.close();if(!!this.params.callback_after){this.params.callback_after.apply(this,[new Date(this.value.valueOf()+this.value.getTimezoneOffset()*60000),c])}}return this};BX.JCCalendar.prototype.Close=function(){if(!!this.popup){this.popup.close()}return this};BX.JCSpinner=function(b){b=b||{};this.params={input:b.input||null,delta:b.delta||1,timeout_start:b.timeout_start||1000,timeout_cont:b.timeout_cont||150,callback_start:b.callback_start||null,callback_change:b.callback_change||null,callback_finish:b.callback_finish||null,bSaveValue:typeof b.bSaveValue=="undefined"?!!b.input:!!b.bSaveValue};this.mousedown=false;this.direction=1};BX.JCSpinner.prototype.Show=function(){this.node=BX.create("span",{events:{mousedown:BX.delegateEvent({attr:"data-dir"},BX.delegate(this.Start,this))},html:'<a href="javascript:void(0)" class="bx-calendar-form-arrow bx-calendar-form-arrow-top" data-dir="1"><i></i></a><a href="javascript:void(0)" class="bx-calendar-form-arrow bx-calendar-form-arrow-bottom" data-dir="-1"><i></i></a>'});return this.node};BX.JCSpinner.prototype.Start=function(){this.mousedown=true;this.direction=BX.proxy_context.getAttribute("data-dir")>0?1:-1;BX.bind(document,"mouseup",BX.proxy(this.MouseUp,this));this.ChangeValue(true)};BX.JCSpinner.prototype.ChangeValue=function(c){if(!this.mousedown){return}if(this.params.input){var b=parseInt(this.params.input.value,10)+this.params.delta*this.direction;if(this.params.bSaveValue){this.params.input.value=b}if(!!c&&this.params.callback_start){this.params.callback_start(this.params,b,this.direction)}if(this.params.callback_change){this.params.callback_change(this.params,b,this.direction)}setTimeout(BX.proxy(this.ChangeValue,this),!!c?this.params.timeout_start:this.params.timeout_cont)}};BX.JCSpinner.prototype.MouseUp=function(){this.mousedown=false;BX.unbind(document,"mouseup",BX.proxy(this.MouseUp,this));if(this.params.callback_finish){this.params.callback_finish(this.params,this.params.input.value)}};window.jsCalendar={Show:function(h,g,f,c,i,d,e,b){return BX.calendar({node:h,field:g,form:e,bTime:!!i,currentTime:d,bHideTimebar:!!b})},ValueToString:BX.calendar.ValueToString};BX.CClockSelector=function(b){this.params=b;this.params.popup_buttons=this.params.popup_buttons||[new BX.PopupWindowButton({text:BX.message("CAL_BUTTON"),className:"popup-window-button-create",events:{click:BX.proxy(this.setValue,this)}})];this.isReady=false;this.WND=new BX.PopupWindow(this.params.popup_id||"clock_selector_popup",this.params.node,this.params.popup_config||{titleBar:{content:BX.create("SPAN",{text:BX.message("CAL_TIME")})},offsetLeft:-45,offsetTop:-135,autoHide:true,closeIcon:true,closeByEsc:true,zIndex:this.params.zIndex});this.SHOW=false;BX.addCustomEvent(this.WND,"onPopupClose",BX.delegate(this.onPopupClose,this));this.obClocks={};this.CLOCK_ID=this.params.clock_id||"clock_selector"};BX.CClockSelector.prototype.Show=function(){if(!this.isReady){BX.addCustomEvent("onClockRegister",BX.proxy(this.onClockRegister,this));return BX.ajax.get("/bitrix/tools/clock_selector.php",{start_time:this.params.start_time,clock_id:this.CLOCK_ID,sessid:BX.bitrix_sessid()},BX.delegate(this.Ready,this))}this.WND.setButtons(this.params.popup_buttons);this.WND.show();this.SHOW=true;if(window["bxClock_"+this.obClocks[this.CLOCK_ID]]){setTimeout("window['bxClock_"+this.obClocks[this.CLOCK_ID]+"'].CalculateCoordinates()",40)}return true};BX.CClockSelector.prototype.onClockRegister=function(b){if(b[this.CLOCK_ID]){this.obClocks[this.CLOCK_ID]=b[this.CLOCK_ID];BX.removeCustomEvent("onClockRegister",BX.proxy(this.onClockRegister,this))}};BX.CClockSelector.prototype.Ready=function(b){this.content=this.CreateContent(b);this.WND.setContent(this.content);this.isReady=true;setTimeout(BX.proxy(this.Show,this),30)};BX.CClockSelector.prototype.CreateContent=function(b){return BX.create("DIV",{events:{click:BX.PreventDefault},html:'<div class="bx-tm-popup-clock">'+b+"</div>"})};BX.CClockSelector.prototype.setValue=function(c){if(this.params.callback){var b=BX.findChild(this.content,{tagName:"INPUT"},true);this.params.callback.apply(this.params.node,[b.value])}return BX.PreventDefault(c)};BX.CClockSelector.prototype.closeWnd=function(b){this.WND.close();return(b||window.event)?BX.PreventDefault(b):true};BX.CClockSelector.prototype.setNode=function(b){this.WND.setBindElement(b)};BX.CClockSelector.prototype.setTime=function(b){this.params.start_time=b;if(window["bxClock_"+this.obClocks[this.CLOCK_ID]]){window["bxClock_"+this.obClocks[this.CLOCK_ID]].SetTime(parseInt(b/3600),parseInt((b%3600)/60))}};BX.CClockSelector.prototype.setCallback=function(b){this.params.callback=b};BX.CClockSelector.prototype.onPopupClose=function(){this.SHOW=false}})();