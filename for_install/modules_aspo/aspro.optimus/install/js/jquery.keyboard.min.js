(function(d){d.fn.keyboard=function(){e.bind(this,arguments);return this};d.keyboard=function(){e.bind(d(document),arguments);return this};var e={setup:{strict:true,event:"keydown",preventDefault:false},keys:{cont:[],getCodes:function(){var g=[];for(var h=0;h<e.keys.cont.length;h++){g.push(e.keys.cont[h].keyCode)}return g},add:function(g){if(g.keyCode==0){}else{e.keys.rm(g);e.keys.cont.push(g);e.keys.dump()}},rm:function(h){for(var g=0;g<e.keys.cont.length;g++){if(e.keys.cont[g].keyCode==h.keyCode){e.keys.cont.splice(g,1);return}}},clear:function(){e.keys.cont=[]},dump:function(){}},keyCodes:{a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,n0:48,n1:49,n2:50,n3:51,n4:52,n5:53,n6:54,n7:55,n8:56,n9:57,tab:9,enter:13,shift:16,backspace:8,ctrl:17,alt:18,esc:27,space:32,menu:93,pause:19,cmd:91,insert:45,home:36,pageup:33,"delete":46,end:35,pagedown:34,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,np0:96,np1:97,np2:98,np3:99,np4:100,np5:101,np6:102,np7:103,np8:104,np9:105,npslash:11,npstar:106,nphyphen:109,npplus:107,npdot:110,capslock:20,numlock:144,scrolllock:145,equals:61,hyphen:109,coma:188,dot:190,gravis:192,backslash:220,sbopen:219,sbclose:221,slash:191,semicolon:59,apostrophe:222,aleft:37,aup:38,aright:39,adown:40},parseArgs:function(g){if(typeof g[0]=="object"){return{setup:g[0]}}else{var h=(typeof g[1]=="function");var i=!h&&(typeof g[2]!="function");var j={};j.keys=g[0];if(d.isArray(j.keys)){j.keys=j.keys.join(" ")}if(i){j.isDelete=true}else{j.func=h?g[1]:g[2];j.cfg=h?g[2]:g[1];if(typeof j.cfg!="object"){j.cfg={}}j.cfg=d.extend(f(e.setup),j.cfg)}return j}},getIndex:function(h,g){return(g=="strict")?"s."+h.join("."):"f."+f(h).sort().join(".")},getIndexCode:function(g){if(e.keyCodes[g]){return e.keyCodes[g]}else{throw"No such index: «"+g+"»"}},getRange:function(h){var i=e.keyCodes;var g=arguments.callee;switch(h){case"letters":return b(i.a,i.z);case"numbers":return b(i.n0,i.n9);case"numpad":return b(i.np0,i.np9);case"fkeys":return b(i.f1,i.f12);case"arrows":return b(i.aleft,i.adown);case"symbols":return[i.equals,i.hyphen,i.coma,i.dot,i.gravis,i.backslash,i.sbopen,i.sbclose,i.slash,i.semicolon,i.apostrophe,i.npslash,i.npstar,i.nphyphen,i.npplus,i.npdot];case"allnum":return g("numbers").concat(g("numpad"));case"printable":return g("letters").concat(g("allnum").concat(g("symbols")));default:throw"No such range: «"+h+"»"}},stringGetCodes:function(l){var k;l=l.toLowerCase();if(l.match(/^\[[\w\d\s\|\)\(\-]*\]$/i)){var g=[];k=l.substring(1,l.length-1).replace(/\s/,"").split("|");for(var h=0;h<k.length;h++){var j=e.stringGetCodes(k[h]);g=g.concat(j)}return g}else{if(l.match(/^\([\w\d\s\-]*\)$/i)){k=l.substring(1,l.length-1).replace(/\s/,"").split("-");if(k.length==2){return b(e.getIndexCode(k[0]),e.getIndexCode(k[1]))}else{return e.getRange(k[0])}}else{return[e.getIndexCode(l)]}}},getCodes:function(j){var k=[];for(var h=0;h<j.length;h++){var g=j[h];if(!isNaN(g)){g=[1*g]}else{if(typeof g=="string"){g=e.stringGetCodes(g)}else{throw"Wrong key type: «"+(typeof g)+"»"}}k.push(g)}return k},parseKeysString:function(k){var j=k.split(",");for(var h=0;h<j.length;h++){var g=d.trim(j[h]);j[h]={};j[h].order=g.indexOf("+")>=0?"strict":"float";j[h].codes=e.getCodes(g.split(j[h].order=="strict"?"+":" "));j[h].index=e.getIndex(j[h].codes,j[h].order);j[h].group=h}return j},match:function(p){var l,n,h,o=undefined;var g=e.keys.getCodes();var j=f(p.keys.codes);var m=[];if(j.length==0){return false}if(p.keys.order=="strict"){for(n=0;n<g.length;n++){if(!j.length){break}if(o===undefined){o=j.shift()}if(c(g[n],o)){o=undefined;m.push(n)}else{if(p.cfg.strict){return false}}}return(j.length===0&&o===undefined)?m:false}else{for(n=0;n<j.length;n++){h=false;for(l=0;l<j[n].length;l++){o=d.inArray(j[n][l],g);if(o>=0){m.push(o);h=true;break}}if(!h){return false}}if(p.cfg.strict){for(n=0;n<g.length;n++){h=false;for(l in j){if(c(g[n],j[l])){h=true;break}}if(!h){return false}}}return m}},hasCurrent:function(i,h){var g=i.keys.codes.length-1;return(i.keys.order=="strict")?c(h.keyCode,i.keys.codes[g]):a(h.keyCode,i.keys.codes)},checkBinds:function(g,n){var h,p=g.keyboardBinds;for(var l in p){var o=p[l];if(o.cfg.event==n.originalEvent.type){h=e.match(o);if(h&&e.hasCurrent(o,n)){var m=g.keyboardFunc;var q=[];for(var j in h){q.push(e.keys.cont[h[j]])}g.keyboardFunc=o.func;g.keyboardFunc(q,o);g.keyboardFunc=m;if(o.cfg.preventDefault){n.preventDefault()}}}}},bind:function(k,g){g=e.parseArgs(g);if(g.setup){e.setup=d.extend(e.setup,g.setup)}else{if(!k.keyboardBinds){k.keyboardBinds={};k.keydown(function(i){e.keys.add(i);e.checkBinds(k,i)}).keyup(function(i){e.checkBinds(k,i)})}var j=e.parseKeysString(g.keys);for(var h=0;h<j.length;h++){if(g.keys.isDelete){k.keyboardBinds[j[h].index]=undefined}else{k.keyboardBinds[j[h].index]=f(g);k.keyboardBinds[j[h].index].keys=j[h]}}}},init:function(){d(document).keydown(e.keys.add).keyup(function(g){setTimeout(function(){e.keys.rm(g)},0)}).blur(e.keys.clear)}};var a=function(h,j){for(var g=0;g<j.length;g++){if(typeof j[g]=="object"||d.isArray(j[g])){if(a(h,j[g])){return true}}else{if(h==j[g]){return true}}}return false};var c=function(g,h){return(d.inArray(g,h)!=-1)};var b=function(i,h){var g=[];do{g.push(i)}while(i++<h);return g};var f=function(j){var g,h;if(d.isArray(j)){g=[];for(h=0;h<j.length;h++){g[h]=(typeof j[h]=="object"||d.isArray(j[h]))?f(j[h]):j[h]}}else{g={};for(h in j){g[h]=(typeof j[h]=="object"||d.isArray(j[h]))?f(j[h]):j[h]}}return g};e.init()})(jQuery);