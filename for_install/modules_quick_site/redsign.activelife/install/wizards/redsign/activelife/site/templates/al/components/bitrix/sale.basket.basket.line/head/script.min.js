"use strict";function BitrixSmallCart(){}BitrixSmallCart.prototype={activate:function(){this.cartElement=BX(this.cartId);this.fixedPosition=this.arParams.POSITION_FIXED=="Y";if(this.fixedPosition){this.cartClosed=true;this.maxHeight=false;this.itemRemoved=false;this.verticalPosition=this.arParams.POSITION_VERTICAL;this.horizontalPosition=this.arParams.POSITION_HORIZONTAL;this.topPanelElement=BX("bx-panel");this.fixAfterRender();this.fixAfterRenderClosure=this.closure("fixAfterRender");var b=this.closure("fixCart");this.fixCartClosure=b;if(this.topPanelElement&&this.verticalPosition=="top"){BX.addCustomEvent(window,"onTopPanelCollapse",b)}var a=null;BX.bind(window,"resize",function(){clearTimeout(a);a=setTimeout(b,200)})}this.setCartBodyClosure=this.closure("setCartBody");BX.addCustomEvent(window,"OnBasketChange",this.closure("refreshCart",{}))},fixAfterRender:function(){this.statusElement=BX(this.cartId+"status");if(this.statusElement){if(this.cartClosed){this.statusElement.innerHTML=this.openMessage}else{this.statusElement.innerHTML=this.closeMessage}}this.productsElement=BX(this.cartId+"products");this.fixCart()},closure:function(c,a){var b=this;return a?function(){b[c](a)}:function(d){b[c](d)}},toggleOpenCloseCart:function(){if(this.cartClosed){BX.removeClass(this.cartElement,"bx-closed");BX.addClass(this.cartElement,"bx-opener");this.statusElement.innerHTML=this.closeMessage;this.cartClosed=false;this.fixCart()}else{BX.addClass(this.cartElement,"bx-closed");BX.removeClass(this.cartElement,"bx-opener");BX.removeClass(this.cartElement,"bx-max-height");this.statusElement.innerHTML=this.openMessage;this.cartClosed=true;var a=this.cartElement.querySelector("[data-role='basket-item-list']");if(a){a.style.top="auto"}}setTimeout(this.fixCartClosure,100)},setVerticalCenter:function(b){var a=b/2-(this.cartElement.offsetHeight/2);if(a<5){a=5}this.cartElement.style.top=a+"px"},fixCart:function(){if(this.horizontalPosition=="hcenter"){var b="innerWidth" in window?window.innerWidth:document.documentElement.offsetWidth;var c=b/2-(this.cartElement.offsetWidth/2);if(c<5){c=5}this.cartElement.style.left=c+"px"}var d="innerHeight" in window?window.innerHeight:document.documentElement.offsetHeight;switch(this.verticalPosition){case"top":if(this.topPanelElement){this.cartElement.style.top=this.topPanelElement.offsetHeight+5+"px"}break;case"vcenter":this.setVerticalCenter(d);break}if(this.productsElement){var a=this.cartElement.querySelector("[data-role='basket-item-list']");if(this.cartClosed){if(this.maxHeight){BX.removeClass(this.cartElement,"bx-max-height");if(a){a.style.top="auto"}this.maxHeight=false}}else{if(this.maxHeight){if(this.productsElement.scrollHeight==this.productsElement.clientHeight){BX.removeClass(this.cartElement,"bx-max-height");if(a){a.style.top="auto"}this.maxHeight=false}}else{if(this.verticalPosition=="top"||this.verticalPosition=="vcenter"){if(this.cartElement.offsetTop+this.cartElement.offsetHeight>=d){BX.addClass(this.cartElement,"bx-max-height");if(a){a.style.top=82+"px"}this.maxHeight=true}}else{if(this.cartElement.offsetHeight>=d){BX.addClass(this.cartElement,"bx-max-height");if(a){a.style.top=82+"px"}this.maxHeight=true}}}}if(this.verticalPosition=="vcenter"){this.setVerticalCenter(d)}}},refreshCart:function(a){if(this.itemRemoved){this.itemRemoved=false;return}a.sessid=BX.bitrix_sessid();a.siteId=this.siteId;a.templateName=this.templateName;a.arParams=this.arParams;a.cartList=appSLine.cartList;BX.ajax({url:this.ajaxPath,method:"POST",dataType:"html",data:a,onsuccess:this.setCartBodyClosure})},setCartBody:function(a){if(this.cartElement){this.cartElement.innerHTML=a}if(this.fixedPosition){setTimeout(this.fixAfterRenderClosure,100)}},removeItemFromCart:function(a){this.refreshCart({sbblRemoveItemFromCart:a});this.itemRemoved=true;BX.onCustomEvent("OnBasketChange")}};