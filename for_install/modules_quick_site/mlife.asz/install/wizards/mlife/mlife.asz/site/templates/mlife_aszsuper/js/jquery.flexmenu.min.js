(function(c){var e=[],b;function d(){c(e).each(function(){c(this).flexMenu({undo:true}).flexMenu(this.options)})}function a(g){var h,f;h=c("li.flexMenu-viewMore.active");f=h.not(g);f.removeClass("active").find("> ul").hide()}c(window).resize(function(){clearTimeout(b);b=setTimeout(function(){d()},200)});c.fn.flexMenu=function(g){var f,h=c.extend({threshold:2,cutoff:2,linkText:"More",linkTitle:"View More",linkTextAll:"Menu",linkTitleAll:"Open/Close Menu",showOnHover:true,popupAbsolute:true,undo:false},g);this.options=h;f=c.inArray(this,e);if(f>=0){e.splice(f,1)}else{e.push(this)}return this.each(function(){var m=c(this),x=m,u=m.find("li:first-child"),v=m.find("li:last-child"),p=m.find("li").length,r=Math.floor(u.offset().top),y=Math.floor(u.outerHeight(true)),A,n,o,z,j,s=false,k,w;function l(B){var i=(Math.ceil(B.offset().top)>=(r+y))?true:false;return i}if(l(v)&&p>h.threshold&&!h.undo&&m.is(":visible")){var t=c('<ul class="flexMenu-popup" style="display:none;'+((h.popupAbsolute)?" position: absolute;":"")+'"></ul>'),q=u.offset().top;for(w=p;w>1;w--){A=m.find("li:last-child");n=(l(A));A.appendTo(t);if((w-1)<=h.cutoff){c(m.children().get().reverse()).appendTo(t);s=true;break}if(!n){break}}if(s){m.append('<li class="flexMenu-viewMore flexMenu-allInPopup"><a href="#" title="'+h.linkTitleAll+'">'+h.linkTextAll+"</a></li>")}else{m.append('<li class="flexMenu-viewMore"><a href="#" title="'+h.linkTitle+'">'+h.linkText+"</a></li>")}o=m.find("li.flexMenu-viewMore");if(l(o)){m.find("li:nth-last-child(2)").appendTo(t)}t.children().each(function(C,B){t.prepend(B)});o.append(t);z=m.find("li.flexMenu-viewMore > a");z.click(function(i){a(o);t.toggle();o.toggleClass("active");i.preventDefault()});if(h.showOnHover&&(typeof Modernizr!=="undefined")&&!Modernizr.touch){o.hover(function(){t.show();c(this).addClass("active")},function(){t.hide();c(this).removeClass("active")})}}else{if(h.undo&&m.find("ul.flexMenu-popup")){k=m.find("ul.flexMenu-popup");j=k.find("li").length;for(w=1;w<=j;w++){k.find("li:first-child").appendTo(m)}k.remove();m.find("li.flexMenu-viewMore").remove()}}})}})(jQuery);