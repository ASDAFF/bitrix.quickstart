function RSMonopolyDrawPlacemark(b,a){b.each(function(){if($(this).hasClass("cityempty")||$(this).hasClass("typeempty")){a[$(this).data("id")].options.set("visible",false)}else{a[$(this).data("id")].options.set("visible",true)}})}$(document).ready(function(){var c=$(".shops_list").find(".item"),d=[0,0],b={},a;c.each(function(){var e=$(this).data("coords").split(",");d[0]=d[0]+parseFloat(e[0]);d[1]=d[1]+parseFloat(e[1])});d[0]=d[0]/c.length;d[1]=d[1]/c.length;var b={},a;ymaps.ready(function(){a=new ymaps.Map("rsYMapShops",{center:d,zoom:16,type:"yandex#publicMap",behaviors:["default","scrollZoom"]});c.each(function(){var e=$(this).data("coords").split(","),f=$(this).data("id");e[0]=parseFloat(e[0]);e[1]=parseFloat(e[1]);b[f]=new ymaps.Placemark(e,{balloonContentHeader:$(this).find("name").html(),balloonContentBody:$(this).find(".descr").html()});a.geoObjects.add(b[f])});a.setBounds(a.geoObjects.getBounds(),{checkZoomRange:true}).controls.add("mapTools").add("zoomControl").add("typeSelector")});c.on("mouseenter",function(){b[$(this).data("id")].options.set("preset","twirl#redDotIcon")}).on("mouseleave",function(){b[$(this).data("id")].options.set("preset","twirl#blueIcon")});$(document).on("keyup",".search_city input",function(){var h=$(this);var g=h.parents(".search_city").find(".cities_list");var f=h.val();var e=0;if(f.length<1){g.css("display","none")}else{g.css("display","block");e=0;g.find("a").each(function(){var i=$(this).html().substr(0,f.length);if(f.toLowerCase()==i.toLowerCase()){$(this).parent().css("display","block");e++}else{$(this).parent().css("display","none")}});if(e<1){g.css("display","none")}}});$(document).on("blur",".search_city input",function(){var e=$(this).val();if(e.length<1){$(".shops_list").find("li").removeClass("cityempty")}else{$(".search_city input").trigger("keyup")}RSMonopolyDrawPlacemark(c,b)});$(document).on("click",".cities_list a",function(){var e=$(this).data("filter");$(".search_city input").val($(this).html());$(".cities_list").css("display","none");$(".shops_list").find("li").addClass("cityempty");$(".shops_list").find('li[data-city="'+e+'"]').removeClass("cityempty");RSMonopolyDrawPlacemark(c,b);return false});$(document).on("click",".shops .filter .btn",function(){$(".shops .filter").find(".btn").removeClass("btn-primary").addClass("btn-default");$(this).addClass("btn-primary").removeClass("btn-default");var e=$(this).data("filter");if(e.length>0){$(".shops_list").find("li").addClass("typeempty");$(".shops_list").find('li[data-type="'+e+'"]').removeClass("typeempty")}else{$(".shops_list").find("li").removeClass("typeempty")}RSMonopolyDrawPlacemark(c,b)})});