$(function(){initPage();windowEvents();topMenu();$("[data-placeholder]").each(function(){$(this).placeholder()});new Form();initMap()});function initMap(){(function(e,b,f){function c(){var g,d=e.getElementsByTagName(b)[0];if(e.getElementById(f)){return}g=e.createElement(b);g.id=f;g.src="http://api-maps.yandex.ru/2.0/?load=package.full&amp;lang=ru-RU";d.parentNode.insertBefore(g,d);a()}if(window.addEventListener){window.addEventListener("load",c,false)}else{if(window.attachEvent){window.attachEvent("onload",c)}}}(document,"script","ymap-script"));function a(){var c=setInterval(function(){b()},500);function b(){if(window.ymaps){clearInterval(c);ymaps.ready(initYmapOnPage)}}}}function Form(){var k=this;j();function j(){e();f()}function e(){k.$elem=$("#contact-form form");k.$elem.data("Form",k);k.submitFlag=0;k.firstElement=null;k.$submitButton=k.$elem.find(".b-form-submit .b-button")}function f(){k.$submitButton.click(d);k.$elem.submit(a);k.$elem.find("input, textarea").focus(l)}function l(){b($(this))}function d(m){k.$elem.submit();m.preventDefault()}function a(m){if(i()){$.ajax({url:k.$elem.attr("action"),type:k.$elem.attr("method"),dataType:"json",data:k.$elem.serialize(),success:function(n){c(n);setTimeout(h,5000)},error:ajaxError})}m.preventDefault()}function h(){var m=$("#form-block .b-icon");m.animate({opacity:0});$("#b-contact-form-message").text("").fadeOut(500,function(){k.$elem.find("input, textarea").val("").blur();k.$elem.fadeIn(500);m.css({backgroundPosition:"0 0"}).animate({opacity:1})})}function c(n){m();k.$elem.fadeOut(500,function(){if(n&&n.message){$("#b-contact-form-message").text(n.message).fadeIn()}});function m(){var o=$("#form-block .b-icon");for(var p=0;p<4;p++){var q=function(r){setTimeout(function(){o.css({backgroundPosition:(-1*r*76)+"px 0"})},80*r)}(p)}}}function g(m){m.closest(".b-form-field").addClass("i-attention");if(k.submitFlag==0){k.firstElement=m}k.submitFlag=1}function b(m){m.closest(".b-form-field").removeClass("i-attention")}function i(){return m();function m(){k.submitFlag=0;k.firstElement=null;q();n();o();p();if(k.submitFlag==0){return true}var r=window.pageYOffset||document.documentElement.scrollTop;if((k.firstElement.offset().top-r)<0){$.scrollTo(k.firstElement.parent(),10);if(k.firstElement!=null){k.firstElement.focus()}}return false}function o(){var r={};k.$elem.find("[data-equal]").each(function(){var w=$(this),v=w.attr("data-equal");if(!r[v]){r[v]=k.$elem.find("[data-equal="+v+"]")}});var s;for(var t in r){s=true;var u=$.trim($(r[t][0]).val());r[t].each(function(){if($.trim($(this).val())!=u){s=false}});if(!s){r[t].each(function(){g($(this))})}else{r[t].each(function(){b($(this))})}}}function p(){k.$elem.find(".b-select.i-required").each(function(){if($(this).find("input:hidden").val()==""){g($(this))}else{b($(this))}});k.$elem.find("[required]").each(function(){var s=$(this),r=$.trim(s.val());if(s.is("[type=radio]")){if(s.closest(".b-form-field").find("input:checked").size()==0){g(s)}}else{if(s.is("[type=checkbox]")){if(!s.is(":checked")){g(s)}else{b(s)}}else{if(s.is("[data-equal]")){if($.trim(s.val())==""){g(s)}}else{if(r==""){g(s)}else{if(!s.is("[type=email]")&&!s.is("[type=tel]")&&!s.is("[type=number]")&&!s.is("[type=url]")){b(s)}}}}}})}function q(){r();s();v();t();u();function r(){k.$elem.find("input:visible[type=password]").each(function(){var y=$(this),w=$.trim(y.val()),x=6;if(w.length<x){g(y)}else{b(y)}})}function s(){k.$elem.find("[type=email]").each(function(){var y=$(this),w=$.trim(y.val()),x=/^([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})$/i;if(w!=""&&!x.test(w)){g(y)}else{b(y)}})}function v(){k.$elem.find("[type=tel]").each(function(){var y=$(this),w=$.trim(y.val()),x=/^([0-9-()\++\s]{5,})$/i;if(w!=""&&!x.test(w)){g(y)}else{b(y)}})}function t(){k.$elem.find("[type=number]").each(function(){var x=$(this),w=$.trim(x.val()),y=/^([0-9\s\.,]+)$/i;if(w!=""&&!y.test(w)){g(x)}else{b(x)}})}function u(){k.$elem.find("[type=url]").each(function(){var x=$(this),w=$.trim(x.val()),y=/^((https?:\/\/)?(www\.)?([-a-z0-9]+\.)+[a-z]{2,})$/i;if(w!=""&&!y.test(w)){g(x)}else{b(x)}})}}function n(){var r={};k.$elem.find("[data-required-or]").each(function(){var v=$(this),u=v.attr("data-required-or");if(!r[u]){r[u]=k.$elem.find("[data-required-or="+u+"]")}});var s;for(var t in r){s=0;r[t].each(function(){if($.trim($(this).val())!=""){s++}});if(s==0){r[t].each(function(){g($(this))})}else{r[t].each(function(){b($(this))})}}}}}function topMenu(){if(checkPageElements()){return}var a=$(".b-header").height();var b=parseInt($(".b-header").css("top"));$(".b-top-menu a").click(function(f){var c=$(this).attr("href");if(c=="#index"){$.scrollTo(0,500);return}for(var d=0;d<pagesArray.length;d++){if("#"+pagesArray[d].page==c){$.scrollTo(pagesArray[d].top-b-a+"px",500)}}f.preventDefault()});$("body").delegate("[href='#form']","click",function(c){$.scrollTo($("#form-block").offset().top-b-a+"px",500);return false})}function setPageArray(){window.pagesArray=[];$(".i-page-block").each(function(a){pagesArray.push({top:Math.floor($(this).offset().top),page:$(this).find(".b-anchor").attr("name")})})}function windowEvents(){if(checkPageElements()){return}setPageArray();$(window).scroll(a).scroll().resize(c).resize();setTimeout(function(){$(".b-index-block__ill img").height("72%").animate({opacity:1})},100);function c(h){var f=$(".b-header").height();var g=$(window).height()-window.pageBlocksTop-f-120;setPagesHeight(g);setPageArray()}function a(h){var f=d();if(f<pagesArray[0].top){$(".b-top-menu a").removeClass("i-active");$(".b-top-menu__link__type_index").addClass("i-active")}var f=parseFloat(f)+parseFloat($(".b-header").css("top"))+parseFloat($(".b-header").height());for(var g=0;g<pagesArray.length;g++){if(f>=pagesArray[g].top){if(pagesArray[g+1]){if(f<pagesArray[g+1].top){b(g)}}else{b(g)}}}}function b(f){var e=$(".b-top-menu a[href='#"+pagesArray[f].page+"']");if(e.hasClass("i-active")){return}$(".b-top-menu a").removeClass("i-active");e.addClass("i-active")}function d(){return window.pageYOffset||document.documentElement.scrollTop}}function checkPageElements(){return $(".b-header").size()==0||$("#page-blocks").size()==0}function initPage(){if(checkPageElements()){return}var c=$(".b-header");var d=$("#page-blocks");var b=c.height();var a=$("#index-block");window.pageBlocksTop=Math.floor(d.offset().top);var f=$(window).height()-pageBlocksTop-b-120;var e=$('<div class="b-header-fixed-block"></div>');e.css({height:b+"px"});c.addClass("i-fixed").css({top:pageBlocksTop+"px"}).after(e);a.css({top:pageBlocksTop+b+"px"});$("#page-blocks").css({zIndex:parseInt(a.css("zIndex"),10)+1});setPagesHeight(f);d.animate({opacity:1})}function setPagesHeight(c){var b=$("#index-block");var a=$(".b-header").height();b.height(c);$("#page-blocks").css({top:c+"px"});$(".i-page-block").each(function(d){if(d==$(".i-page-block").size()-1){return}if($(this).outerHeight()<c){$(this).height(c)}})}(function(a){var b={};a.fn.placeholder=function(d){var c=a.extend({},b,d);a(this).each(function(){var f=this;f.$elem=a(this),f.$formField=f.$elem.closest(".b-form-field");f.placeholderText=c.text||f.$elem.attr("data-placeholder");l();function l(){if(!f.$placeholder){j()}i();k()}function i(){setTimeout(function(){if(f.$elem.val()==""){f.$formField.addClass("i-placeholder")}},10)}function k(){f.$placeholderText.click(function(){if(!f.$elem.parent().hasClass("i-disabled")){f.$elem.focus()}});f.$elem.focus(function(){g()}).blur(function(){h()})}function j(){f.$placeholder=a('<div class="b-form-field__placeholder"><div class="b-form-field__placeholder__text">'+f.placeholderText+"</div></div>");f.$placeholderText=f.$placeholder.find(".b-form-field__placeholder__text");f.$elem.before(f.$placeholder);e()}function e(){if(f.$elem.is(":visible")){o()}else{var m=f.$elem;var n=m.parent();m.css({position:"absolute",bottom:"0",left:"0"}).appendTo("body");o();n.append(m);m.css({position:"static",bottom:"none",left:"none"})}function o(){f.$placeholderText.css({width:f.$elem.outerWidth()-parseInt(f.$placeholderText.css("paddingLeft"))+"px"})}}function g(){f.$formField.removeClass("i-placeholder")}function h(){if(f.$elem.val()==""){f.$formField.addClass("i-placeholder")}}});return this}})(jQuery);(function(c){var b=c.scrollTo=function(e,d,f){c(window).scrollTo(e,d,f)};b.defaults={axis:"xy",duration:parseFloat(c.fn.jquery)>=1.3?0:1,limit:true};b.window=function(d){return c(window)._scrollable()};c.fn._scrollable=function(){return this.map(function(){var e=this,f=!e.nodeName||c.inArray(e.nodeName.toLowerCase(),["iframe","#document","html","body"])!=-1;if(!f){return e}var d=(e.contentWindow||e).document||e.ownerDocument||e;return/webkit/i.test(navigator.userAgent)||d.compatMode=="BackCompat"?d.body:d.documentElement})};c.fn.scrollTo=function(i,h,d){if(typeof h=="object"){d=h;h=0}if(typeof d=="function"){d={onAfter:d}}if(i=="max"){i=9000000000}d=c.extend({},b.defaults,d);h=h||d.duration;d.queue=d.queue&&d.axis.length>1;if(d.queue){h/=2}d.offset=a(d.offset);d.over=a(d.over);return this._scrollable().each(function(){if(i==null){return}var m=this,j=c(m),k=i,g,e={},l=j.is("html,body");switch(typeof k){case"number":case"string":if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(k)){k=a(k);break}k=c(k,this);if(!k.length){return}case"object":if(k.is||k.style){g=(k=c(k)).offset()}}c.each(d.axis.split(""),function(s,q){var o=q=="x"?"Left":"Top",u=o.toLowerCase(),r="scroll"+o,p=m[r],n=b.max(m,q);if(g){e[r]=g[u]+(l?0:p-j.offset()[u]);if(d.margin){e[r]-=parseInt(k.css("margin"+o))||0;e[r]-=parseInt(k.css("border"+o+"Width"))||0}e[r]+=d.offset[u]||0;if(d.over[u]){e[r]+=k[q=="x"?"width":"height"]()*d.over[u]}}else{var t=k[u];e[r]=t.slice&&t.slice(-1)=="%"?parseFloat(t)/100*n:t}if(d.limit&&/^\d+$/.test(e[r])){e[r]=e[r]<=0?0:Math.min(e[r],n)}if(!s&&d.queue){if(p!=e[r]){f(d.onAfterFirst)}delete e[r]}});f(d.onAfter);function f(n){j.animate(e,h,d.easing,n&&function(){n.call(this,i,d)})}}).end()};b.max=function(h,g){var k=g=="x"?"Width":"Height",f="scroll"+k;if(!c(h).is("html,body")){return h[f]-c(h)[k.toLowerCase()]()}var j="client"+k,i=h.ownerDocument.documentElement,e=h.ownerDocument.body;return Math.max(i[f],e[f])-Math.min(i[j],e[j])};function a(d){return typeof d=="object"?d:{top:d,left:d}}})(jQuery);function ajaxError(e,d,f){if(window.console){console.log(e);console.log(d);console.log(f)}};