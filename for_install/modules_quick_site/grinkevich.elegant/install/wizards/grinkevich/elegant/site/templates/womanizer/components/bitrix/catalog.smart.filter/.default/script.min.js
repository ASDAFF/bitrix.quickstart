function JCSmartFilter(a){this.ajaxURL=a;this.form=null;this.timer=null}JCSmartFilter.prototype.keyup=function(a){if(this.timer){clearTimeout(this.timer)}this.timer=setTimeout(BX.delegate(function(){this.reload(a)},this),1000)};JCSmartFilter.prototype.click=function(a){if(this.timer){clearTimeout(this.timer)}this.timer=setTimeout(BX.delegate(function(){this.reload(a)},this),1000)};JCSmartFilter.prototype.reload=function(b){this.position=BX.pos(b,true);this.form=BX.findParent(b,{tag:"form"});if(this.form){var a=new Array;a[0]={name:"ajax",value:"y"};this.gatherInputsValues(a,BX.findChildren(this.form,{tag:"input"},true));window.input=b;BX.ajax.loadJSON(this.ajaxURL,this.values2post(a),BX.delegate(this.postHandler,this))}};JCSmartFilter.prototype.postHandler=function(k){if(k.ITEMS){for(var a in k.ITEMS){var c=k.ITEMS[a];if(c.PROPERTY_TYPE=="N"||c.PRICE){}else{if(c.VALUES){for(var h in c.VALUES){var e=c.VALUES[h];var g=BX(e.CONTROL_ID);if(g){g.parentNode.className=e.DISABLED?"lvl2 lvl2_disabled":"lvl2"}}}}}var j=BX("modef");var f=BX("modef_num");if(j&&f){f.innerHTML=k.ELEMENT_COUNT;var b=BX.findChildren(j,{tag:"A"},true);if(k.FILTER_URL&&b){b[0].href=BX.util.htmlspecialcharsback(k.FILTER_URL)}curProp=BX.findParent(window.input,{"class":"cnt"});var d=$(curProp).attr("id");if(j.style.display=="none"){j.style.display="block"}$("."+d).prepend(j)}}};JCSmartFilter.prototype.gatherInputsValues=function(a,e){if(e){for(var c=0;c<e.length;c++){var d=e[c];if(d.disabled||!d.type){continue}switch(d.type.toLowerCase()){case"text":case"textarea":case"password":case"hidden":case"select-one":if(d.value.length){a[a.length]={name:d.name,value:d.value}}break;case"radio":case"checkbox":if(d.checked){a[a.length]={name:d.name,value:d.value}}break;case"select-multiple":for(var b=0;b<d.options.length;b++){if(d.options[b].selected){a[a.length]={name:d.name,value:d.options[b].value}}}break;default:break}}}};JCSmartFilter.prototype.values2post=function(b){var e=new Array;var h=e;var d=0;while(d<b.length){var g=b[d].name.indexOf("[");if(g==-1){h[b[d].name]=b[d].value;h=e;d++}else{var c=b[d].name.substring(0,g);var f=b[d].name.substring(g+1);if(!h[c]){h[c]=new Array}var a=f.indexOf("]");if(a==-1){h=e;d++}else{if(a==0){h=h[c];b[d].name=""+h.length}else{h=h[c];b[d].name=f.substring(0,a)+f.substring(a+1)}}}}return e};