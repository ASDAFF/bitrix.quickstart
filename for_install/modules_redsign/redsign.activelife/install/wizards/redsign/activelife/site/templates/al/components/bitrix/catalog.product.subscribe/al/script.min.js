(function(b){if(!!b.JCCatalogProductSubscribe){return}var a=function(c){a.superclass.constructor.apply(this,arguments);this.nameNode=BX.create("span",{props:{id:this.id},style:typeof(c.style)==="object"?c.style:{},text:c.text});this.buttonNode=BX.create("span",{attrs:{className:c.className},style:{marginBottom:"0",borderBottom:"0 none transparent"},children:[this.nameNode],events:this.contextEvents});if(BX.browser.IsIE()){this.buttonNode.setAttribute("hideFocus","hidefocus")}};b.JCCatalogProductSubscribe=function(c){this.buttonId=c.buttonId;this.buttonClass=c.buttonClass;this.jsObject=c.jsObject;this.ajaxUrl="/bitrix/components/bitrix/catalog.product.subscribe/ajax.php";this.alreadySubscribed=c.alreadySubscribed;this.urlListSubscriptions=c.urlListSubscriptions;this.listOldItemId={};this.elemButtonSubscribe=null;this.elemPopupWin=null;this.defaultButtonClass="btn catalog_item__subscr";this._elemButtonSubscribeClickHandler=BX.delegate(this.subscribe,this);this._elemHiddenClickHandler=BX.delegate(this.checkSubscribe,this);BX.ready(BX.delegate(this.init,this))};b.JCCatalogProductSubscribe.prototype.init=function(){if(!!this.buttonId){this.elemButtonSubscribe=BX(this.buttonId);this.elemHiddenSubscribe=BX(this.buttonId+"_hidden")}if(!!this.elemButtonSubscribe){BX.bind(this.elemButtonSubscribe,"click",this._elemButtonSubscribeClickHandler)}if(!!this.elemHiddenSubscribe){BX.bind(this.elemHiddenSubscribe,"click",this._elemHiddenClickHandler)}this.setButton(this.alreadySubscribed)};b.JCCatalogProductSubscribe.prototype.checkSubscribe=function(){if(!this.elemHiddenSubscribe||!this.elemButtonSubscribe){return}if(this.listOldItemId.hasOwnProperty(this.elemButtonSubscribe.dataset.item)){this.setButton(true)}else{BX.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:{sessid:BX.bitrix_sessid(),checkSubscribe:"Y",itemId:this.elemButtonSubscribe.dataset.item},onsuccess:BX.delegate(function(c){if(c.subscribe){this.setButton(true);this.listOldItemId[this.elemButtonSubscribe.dataset.item]=true}else{this.setButton(false)}},this)})}};b.JCCatalogProductSubscribe.prototype.subscribe=function(){this.elemButtonSubscribe=BX.proxy_context;if(!this.elemButtonSubscribe){return false}BX.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:{sessid:BX.bitrix_sessid(),subscribe:"Y",itemId:this.elemButtonSubscribe.dataset.item,siteId:BX.message("SITE_ID")},onsuccess:BX.delegate(function(c){if(c.success){this.createSuccessPopup(c);this.setButton(true);this.listOldItemId[this.elemButtonSubscribe.dataset.item]=true}else{if(c.contactFormSubmit){var e=this.createContentForPopup(c);var d=BX.create("div",{props:{className:"rsform row"},children:[e,BX.create("div",{props:{className:"form-group"},children:[BX.create("button",{text:BX.message("CPST_SUBSCRIBE_BUTTON_SUBSCRIBE"),props:{className:"btn"},events:{click:BX.delegate(function(){if(!this.validateContactField(c.contactTypeData)){return false}BX.ajax.submitAjax(e,{method:"POST",url:this.ajaxUrl,processData:true,onsuccess:BX.delegate(function(f){f=BX.parseJSON(f,{});if(f.success){this.createSuccessPopup(f);this.setButton(true);this.listOldItemId[this.elemButtonSubscribe.dataset.item]=true}else{if(f.error){if(f.hasOwnProperty("setButton")){this.listOldItemId[this.elemButtonSubscribe.dataset.item]=true;this.setButton(true)}var g=f.message;if(f.hasOwnProperty("typeName")){g=f.message.replace("USER_CONTACT",f.typeName)}BX.addClass(BX("bx-catalog-subscribe-form-notify"),"alert alert-danger");BX("bx-catalog-subscribe-form-notify").innerHTML=g}}},this)})},this)}})]})]});$.fancybox(d,$.extend({},appSLine.fancyOptions,{title:BX.message("CPST_SUBSCRIBE_POPUP_TITLE")}))}else{if(c.error){if(c.hasOwnProperty("setButton")){this.listOldItemId[this.elemButtonSubscribe.dataset.item]=true;this.setButton(true)}this.showWindowWithAnswer({status:"error",message:c.message})}}}},this)})};b.JCCatalogProductSubscribe.prototype.validateContactField=function(c){var h=BX.findChildren(BX("bx-catalog-subscribe-form"),{tag:"input",attribute:{id:"userContact"}},true);if(!h.length||typeof c!=="object"){BX.addClass(BX("bx-catalog-subscribe-form-notify"),"alert alert-danger");BX("bx-catalog-subscribe-form-notify").innerHTML=BX.message("CPST_SUBSCRIBE_VALIDATE_UNKNOW_ERROR");return false}var d,g,m,l=[],j=[];for(var e=0;e<h.length;e++){d=h[e].getAttribute("data-id");g=h[e].value;m=BX("bx-contact-use-"+d);if(m&&m.value=="N"){j.push(true);continue}if(!g.length){l.push(BX.message("CPST_SUBSCRIBE_VALIDATE_ERROR_EMPTY_FIELD").replace("#FIELD#",c[d].contactLable))}}if(h.length==j.length){BX.addClass(BX("bx-catalog-subscribe-form-notify"),"alert alert-danger");BX("bx-catalog-subscribe-form-notify").innerHTML=BX.message("CPST_SUBSCRIBE_VALIDATE_ERROR");return false}if(l.length){BX.addClass(BX("bx-catalog-subscribe-form-notify"),"alert alert-danger");for(var f=0;f<l.length;f++){BX("bx-catalog-subscribe-form-notify").innerHTML=l[f]}return false}return true};b.JCCatalogProductSubscribe.prototype.reloadCaptcha=function(){BX.ajax.get(this.ajaxUrl+"?reloadCaptcha=Y","",function(c){BX("captcha_sid").value=c;BX("captcha_img").src="/bitrix/tools/captcha.php?captcha_sid="+c+""})};b.JCCatalogProductSubscribe.prototype.createContentForPopup=function(f){if(!f.hasOwnProperty("contactTypeData")){return null}var i=f.contactTypeData,e=Object.keys(i).length,c="",j="N",h=document.createDocumentFragment();if(e>1){j="Y";c="display:none;";h.appendChild(BX.create("p",{text:BX.message("CPST_SUBSCRIBE_MANY_CONTACT_NOTIFY")}))}h.appendChild(BX.create("p",{props:{id:"bx-catalog-subscribe-form-notify"}}));for(var d in i){if(e>1){h.appendChild(BX.create("div",{props:{className:"bx-catalog-subscribe-form-container"},children:[BX.create("div",{props:{className:"checkbox"},children:[BX.create("lable",{props:{className:"bx-filter-param-label"},attrs:{onclick:this.jsObject+".selectContactType("+d+", event);"},children:[BX.create("input",{props:{type:"hidden",id:"bx-contact-use-"+d,name:"contact["+d+"][use]",value:"N"}}),BX.create("input",{props:{id:"bx-contact-checkbox-"+d,type:"checkbox"}}),BX.create("span",{props:{className:"bx-filter-param-text"},text:i[d].contactLable})]})]})]}))}h.appendChild(BX.create("div",{props:{id:"bx-catalog-subscribe-form-container-"+d,className:"form-group",style:c},children:[BX.create("input",{props:{id:"userContact",className:"form-control",type:"text",name:"contact["+d+"][user]",placeholder:BX.message("CPST_SUBSCRIBE_LABLE_CONTACT_INPUT").replace("#CONTACT#",i[d].contactLable)},attrs:{"data-id":d}})]}))}if(f.hasOwnProperty("captchaCode")){h.appendChild(BX.create("div",{props:{className:"form-group"},children:[BX.create("input",{props:{type:"hidden",id:"captcha_sid",name:"captcha_sid",value:f.captchaCode}}),BX.create("img",{props:{id:"captcha_img",src:"/bitrix/tools/captcha.php?captcha_sid="+f.captchaCode+"",className:"captcha-img pull-right"},attrs:{alt:"captcha",onclick:this.jsObject+".reloadCaptcha();"}}),BX.create("div",{props:{className:"l-overflow"},children:[BX.create("input",{props:{id:"captcha_word",className:"form-control",type:"text",name:"captcha_word",placeholder:BX.message("CPST_ENTER_WORD_PICTURE")+"*"},attrs:{maxlength:"50"}})]})]}))}var g=BX.create("form",{props:{id:"bx-catalog-subscribe-form"},children:[BX.create("input",{props:{type:"hidden",name:"manyContact",value:j}}),BX.create("input",{props:{type:"hidden",name:"sessid",value:BX.bitrix_sessid()}}),BX.create("input",{props:{type:"hidden",name:"itemId",value:this.elemButtonSubscribe.dataset.item}}),BX.create("input",{props:{type:"hidden",name:"siteId",value:BX.message("SITE_ID")}}),BX.create("input",{props:{type:"hidden",name:"contactFormSubmit",value:"Y"}})]});g.appendChild(h);return g};b.JCCatalogProductSubscribe.prototype.selectContactType=function(h,g){var e=BX("bx-catalog-subscribe-form-container-"+h),d="",c=BX("bx-contact-checkbox-"+h);if(!e){return false}if(c!=g.target){if(c.checked){c.checked=false}else{c.checked=true}}if(e.currentStyle){d=e.currentStyle.display}else{if(b.getComputedStyle){var f=b.getComputedStyle(e,null);d=f.getPropertyValue("display")}}if(d==="none"){BX("bx-contact-use-"+h).value="Y";BX.style(e,"display","")}else{BX("bx-contact-use-"+h).value="N";BX.style(e,"display","none")}};b.JCCatalogProductSubscribe.prototype.createSuccessPopup=function(c){var d=BX.create("div",{props:{className:"rsform row"},children:[BX.create("p",{props:{className:"text-center"},children:[BX.create("img",{props:{src:appSLine.SITE_TEMPLATE_PATH+"/assets/img/like.png"}})]}),BX.create("p",{props:{className:"text-center"},text:c.message}),BX.create("div",{props:{className:"form-group"},children:[BX.create("button",{text:BX.message("CPST_SUBSCRIBE_BUTTON_CLOSE"),props:{className:"btn"},events:{click:BX.delegate(function(){$.fancybox.close()},this)}})]})]});$.fancybox(d,$.extend({},appSLine.fancyOptions,{title:BX.message("CPST_SUBSCRIBE_POPUP_TITLE")}))};b.JCCatalogProductSubscribe.prototype.initPopupWindow=function(){if(!!this.elemPopupWin){return}this.elemPopupWin=BX.PopupWindowManager.create("CatalogSubscribe_"+this.buttonId,null,{autoHide:false,offsetLeft:0,offsetTop:0,overlay:true,closeByEsc:true,titleBar:true,closeIcon:true,contentColor:"white"})};b.JCCatalogProductSubscribe.prototype.setButton=function(c){this.alreadySubscribed=Boolean(c);if(this.alreadySubscribed){this.elemButtonSubscribe.className=this.defaultButtonClass;this.elemButtonSubscribe.innerHTML=BX.message("CPST_TITLE_ALREADY_SUBSCRIBED");BX.unbind(this.elemButtonSubscribe,"click",this._elemButtonSubscribeClickHandler)}else{this.elemButtonSubscribe.className=this.buttonClass+" "+this.defaultButtonClass;this.elemButtonSubscribe.innerHTML=BX.message("CPST_SUBSCRIBE_BUTTON_NAME");BX.bind(this.elemButtonSubscribe,"click",this._elemButtonSubscribeClickHandler)}};b.JCCatalogProductSubscribe.prototype.showWindowWithAnswer=function(e){e=e||{};if(!e.message){if(e.status=="success"){e.message=BX.message("CPST_STATUS_SUCCESS")}else{e.message=BX.message("CPST_STATUS_ERROR")}}var d=BX.create("div",{props:{className:"bx-catalog-subscribe-alert text-center rsform row"},children:[BX.create("p",{props:{className:"text-center"},children:[BX.create("img",{props:{src:appSLine.SITE_TEMPLATE_PATH+"/assets/img/like.png"}})]}),BX.create("p",{props:{className:"text-center"},children:[BX.create("span",{props:{className:"bx-catalog-subscribe-aligner"}}),BX.create("span",{props:{className:"bx-catalog-subscribe-alert-text"},text:e.message})]}),BX.create("div",{props:{className:"form-group"},children:[BX.create("button",{text:BX.message("CPST_SUBSCRIBE_BUTTON_CLOSE"),props:{className:"btn"},events:{click:BX.delegate(function(){$.fancybox.close()},this)}})]})]});var c=0;$.fancybox(d,$.extend({},appSLine.fancyOptions,{title:BX.message("CPST_SUBSCRIBE_POPUP_TITLE"),afterShow:function(){c=setTimeout(function(){$.fancybox.close()},3500);console.log("afterShow",c);this.wrap.on("mouseenter",function(){clearTimeout(c);console.log("mouseenter",c)});this.wrap.on("mouseleave",function(){c=setTimeout(function(){$.fancybox.close()},3500);console.log("mouseleave",c)})}}))}})(window);