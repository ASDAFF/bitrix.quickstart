<?if(!defined("B_PROLOG_INCLUDED")||B_PROLOG_INCLUDED!==true)die();$dbSite=CSite::GetByID(WIZARD_SITE_ID);if($arSite=$dbSite->Fetch())
$lid=$arSite["LANGUAGE_ID"];if(strlen($lid)<=0)
$lid="ru";WizardServices::IncludeServiceLang("mail.php",$lid);$CHARSET=defined("BX_UTF")?"UTF-8":$lid=="ru"?"windows-1251":"ISO-8859-1";$PREFIX="BUSINESSCARD";$event_name_array=array("FEEDBACK","ORDER","CALLBACK","COMMENTS","VACANCIES",);$dbEvent_=array();$dbEvent=CEventType::GetList(Array("LID"=>$lid));while($ar=$dbEvent->Fetch())
$dbEvent_[$ar["EVENT_NAME"]]=$ar;foreach($event_name_array as $EVENT_NAME)
{$et=new CEventType;$event_name=$EVENT_NAME."_FORM_".$PREFIX;$description=GetMessage($EVENT_NAME."_FORM_DESCRIPTION");if(array_key_exists($event_name,$dbEvent_)){$et->Update(array("ID"=>$dbEvent_[$event_name]["ID"]),array("NAME"=>GetMessage($EVENT_NAME."_FORM_NAME"),"DESCRIPTION"=>$description,));}else{$et->Add(array("LID"=>$lid,"EVENT_NAME"=>$event_name,"NAME"=>GetMessage($EVENT_NAME."_FORM_NAME"),"DESCRIPTION"=>$description,));}}
$dbEvent_=array();$dbEvent=CEventMessage::GetList($b="ID",$order="ASC",Array("SITE_ID"=>WIZARD_SITE_ID));while($ar=$dbEvent->Fetch())
$dbEvent_[$ar["EVENT_NAME"]]=$ar;foreach($event_name_array as $EVENT_NAME)
{$emess=new CEventMessage;$event_name=$EVENT_NAME."_FORM_".$PREFIX;$subject=GetMessage($EVENT_NAME."_FORM_SUBJECT");$message=str_replace("#SITE_CHARSET#",$CHARSET,GetMessage($EVENT_NAME."_FORM_MESSAGE"));if(array_key_exists($event_name,$dbEvent_)){$emess->Update($dbEvent_[$event_name]["ID"],array("ACTIVE"=>"Y","EMAIL_FROM"=>"#DEFAULT_EMAIL_FROM#","EMAIL_TO"=>"#DEFAULT_EMAIL_FROM#","BCC"=>"#BCC#","SUBJECT"=>$subject,"MESSAGE"=>$message,"BODY_TYPE"=>"html",));}else{$emess->Add(array("ACTIVE"=>"Y","EVENT_NAME"=>$event_name,"LID"=>WIZARD_SITE_ID,"EMAIL_FROM"=>"#DEFAULT_EMAIL_FROM#","EMAIL_TO"=>"#DEFAULT_EMAIL_FROM#","BCC"=>"#BCC#","SUBJECT"=>$subject,"MESSAGE"=>$message,"BODY_TYPE"=>"html",));}}?>