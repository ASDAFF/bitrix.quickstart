(function(a){if(BX.PopupWindowManager){return}BX.PopupWindowManager={_popups:[],_currentPopup:null,create:function(e,b,f){var c=-1;if((c=this._getPopupIndex(e))!==-1){return this._popups[c]}var d=new BX.PopupWindow(e,b,f);BX.addCustomEvent(d,"onPopupShow",BX.delegate(this.onPopupShow,this));BX.addCustomEvent(d,"onPopupClose",BX.delegate(this.onPopupClose,this));BX.addCustomEvent(d,"onPopupDestroy",BX.delegate(this.onPopupDestroy,this));this._popups.push(d);return d},onPopupShow:function(b){if(this._currentPopup!==null){this._currentPopup.close()}this._currentPopup=b},onPopupClose:function(b){this._currentPopup=null},onPopupDestroy:function(c){var b=-1;if((b=this._getPopupIndex(c.uniquePopupId))!==-1){this._popups=BX.util.deleteFromArray(this._popups,b)}},getCurrentPopup:function(){return this._currentPopup},isPopupExists:function(b){return this._getPopupIndex(b)!==-1},_getPopupIndex:function(d){var b=-1;for(var c=0;c<this._popups.length;c++){if(this._popups[c].uniquePopupId==d){return c}}return b}};BX.PopupWindow=function(d,c,f){BX.onCustomEvent("onPopupWindowInit",[d,c,f]);this.uniquePopupId=d;this.params=f||{};this.params.zIndex=parseInt(this.params.zIndex);this.params.zIndex=isNaN(this.params.zIndex)?0:this.params.zIndex;this.buttons=this.params.buttons&&BX.type.isArray(this.params.buttons)?this.params.buttons:[];this.offsetTop=BX.PopupWindow.getOption("offsetTop");this.offsetLeft=BX.PopupWindow.getOption("offsetLeft");this.firstShow=false;this.bordersWidth=20;this.bindElementPos=null;this.closeIcon=null;this.angle=null;this.overlay=null;this.titleBar=null;this.bindOptions=typeof(this.params.bindOptions)=="object"?this.params.bindOptions:{};this.isAutoHideBinded=false;this.closeByEsc=!!this.params.closeByEsc;this.isCloseByEscBinded=false;this.dragged=false;this.dragPageX=0;this.dragPageY=0;if(this.params.events){for(var b in this.params.events){BX.addCustomEvent(this,b,this.params.events[b])}}this.popupContainer=document.createElement("DIV");BX.adjust(this.popupContainer,{props:{id:d},style:{zIndex:this.getZindex(),position:"absolute",display:"none",top:"0px",left:"0px"}});var e="popup-window";if(f.lightShadow){e+=" popup-window-light"}if(f.titleBar){e+=f.lightShadow?" popup-window-titlebar-light":" popup-window-titlebar"}if(f.className&&BX.type.isNotEmptyString(f.className)){e+=" "+f.className}this.popupContainer.innerHTML=['<table class="',e,'" cellspacing="0"> 		<tr class="popup-window-top-row"> 			<td class="popup-window-left-column"><div class="popup-window-left-spacer"></div></td> 			<td class="popup-window-center-column">',(f.titleBar?'<div class="popup-window-titlebar" id="popup-window-titlebar-'+d+'"></div>':""),'</td> 			<td class="popup-window-right-column"><div class="popup-window-right-spacer"></div></td> 		</tr> 		<tr class="popup-window-content-row"> 			<td class="popup-window-left-column"></td> 			<td class="popup-window-center-column"><div class="popup-window-content" id="popup-window-content-',d,'"> 			</div></td> 			<td class="popup-window-right-column"></td> 		</tr> 		<tr class="popup-window-bottom-row"> 			<td class="popup-window-left-column"></td> 			<td class="popup-window-center-column"></td> 			<td class="popup-window-right-column"></td> 		</tr> 	</table>'].join("");document.body.appendChild(this.popupContainer);if(f.closeIcon){this.popupContainer.appendChild((this.closeIcon=BX.create("a",{props:{className:"popup-window-close-icon"+(f.titleBar?" popup-window-titlebar-close-icon":""),href:""},style:(typeof(f.closeIcon)=="object"?f.closeIcon:{}),events:{click:BX.proxy(this._onCloseIconClick,this)}})));if(BX.browser.IsIE()){BX.adjust(this.closeIcon,{attrs:{hidefocus:"true"}})}}this.contentContainer=BX("popup-window-content-"+d);this.titleBar=BX("popup-window-titlebar-"+d);this.buttonsContainer=this.buttonsHr=null;if(f.angle){this.setAngle(f.angle)}if(f.overlay){this.setOverlay(f.overlay)}this.setOffset(this.params);this.setBindElement(c);this.setTitleBar(this.params.titleBar);this.setContent(this.params.content);this.setButtons(this.params.buttons);if(this.params.bindOnResize!==false){BX.bind(a,"resize",BX.proxy(this._onResizeWindow,this))}};BX.PopupWindow.prototype.setContent=function(b){if(!this.contentContainer||!b){return}if(BX.type.isElementNode(b)){BX.cleanNode(this.contentContainer);this.contentContainer.appendChild(b.parentNode?b.parentNode.removeChild(b):b);b.style.display="block"}else{if(BX.type.isString(b)){this.contentContainer.innerHTML=b}else{this.contentContainer.innerHTML="&nbsp;"}}};BX.PopupWindow.prototype.setButtons=function(e){this.buttons=e&&BX.type.isArray(e)?e:[];if(this.buttonsHr){BX.remove(this.buttonsHr)}if(this.buttonsContainer){BX.remove(this.buttonsContainer)}if(this.buttons.length>0&&this.contentContainer){var b=[];for(var d=0;d<this.buttons.length;d++){var c=this.buttons[d];if(c==null||!BX.is_subclass_of(c,BX.PopupWindowButton)){continue}c.popupWindow=this;b.push(c.render())}this.buttonsHr=this.contentContainer.parentNode.appendChild(BX.create("div",{props:{className:"popup-window-hr popup-window-buttons-hr"},children:[BX.create("i",{})]}));this.buttonsContainer=this.contentContainer.parentNode.appendChild(BX.create("div",{props:{className:"popup-window-buttons"},children:b}))}};BX.PopupWindow.prototype.setBindElement=function(b){if(!b||typeof(b)!="object"){return}if(BX.type.isDomNode(b)||(BX.type.isNumber(b.top)&&BX.type.isNumber(b.left))){this.bindElement=b}else{if(BX.type.isNumber(b.clientX)&&BX.type.isNumber(b.clientY)){BX.fixEventPageXY(b);this.bindElement={left:b.pageX,top:b.pageY,bottom:b.pageY}}}};BX.PopupWindow.prototype.getBindElementPos=function(b){if(BX.type.isDomNode(b)){return BX.pos(b,false)}else{if(b&&typeof(b)=="object"){if(!BX.type.isNumber(b.bottom)){b.bottom=b.top}return b}else{var c=BX.GetWindowInnerSize();var f=BX.GetWindowScrollPos();var d=this.popupContainer.offsetWidth;var e=this.popupContainer.offsetHeight;return{left:c.innerWidth/2-d/2+f.scrollLeft,top:c.innerHeight/2-e/2+f.scrollTop,bottom:c.innerHeight/2-e/2+f.scrollTop,windowSize:c,windowScroll:f,popupWidth:d,popupHeight:e}}}};BX.PopupWindow.prototype.setAngle=function(c){var h=this.params.lightShadow?"popup-window-light-angly":"popup-window-angly";if(this.angle==null){var e=this.bindOptions.position&&this.bindOptions.position=="top"?"bottom":"top";var j=BX.PopupWindow.getOption(e=="top"?"angleMinTop":"angleMinBottom");var f=BX.type.isNumber(c.offset)?c.offset:0;var i=BX.PopupWindow.getOption("angleLeftOffset",null);if(f>0&&BX.type.isNumber(i)){f+=i-BX.PopupWindow.defaultOptions.angleLeftOffset}this.angle={element:BX.create("div",{props:{className:h+" "+h+"-"+e}}),position:e,offset:0,defaultOffset:Math.max(f,j)};this.popupContainer.appendChild(this.angle.element)}if(typeof(c)=="object"&&c.position&&BX.util.in_array(c.position,["top","right","bottom","left","hide"])){BX.removeClass(this.angle.element,h+"-"+this.angle.position);BX.addClass(this.angle.element,h+"-"+c.position);this.angle.position=c.position}if(typeof(c)=="object"&&BX.type.isNumber(c.offset)){var d=c.offset;var g,b;if(this.angle.position=="top"){g=BX.PopupWindow.getOption("angleMinTop");b=this.popupContainer.offsetWidth-BX.PopupWindow.getOption("angleMaxTop");b=b<g?Math.max(g,d):b;this.angle.offset=Math.min(Math.max(g,d),b);this.angle.element.style.left=this.angle.offset+"px";this.angle.element.style.marginLeft="auto"}else{if(this.angle.position=="bottom"){g=BX.PopupWindow.getOption("angleMinBottom");b=this.popupContainer.offsetWidth-BX.PopupWindow.getOption("angleMaxBottom");b=b<g?Math.max(g,d):b;this.angle.offset=Math.min(Math.max(g,d),b);this.angle.element.style.marginLeft=this.angle.offset+"px";this.angle.element.style.left="auto"}else{if(this.angle.position=="right"){g=BX.PopupWindow.getOption("angleMinRight");b=this.popupContainer.offsetHeight-BX.PopupWindow.getOption("angleMaxRight");b=b<g?Math.max(g,d):b;this.angle.offset=Math.min(Math.max(g,d),b);this.angle.element.style.top=this.angle.offset+"px"}else{if(this.angle.position=="left"){g=BX.PopupWindow.getOption("angleMinLeft");b=this.popupContainer.offsetHeight-BX.PopupWindow.getOption("angleMaxLeft");b=b<g?Math.max(g,d):b;this.angle.offset=Math.min(Math.max(g,d),b);this.angle.element.style.top=this.angle.offset+"px"}}}}}};BX.PopupWindow.prototype.isTopAngle=function(){return this.angle!=null&&this.angle.position=="top"};BX.PopupWindow.prototype.isBottomAngle=function(){return this.angle!=null&&this.angle.position=="bottom"};BX.PopupWindow.prototype.isTopOrBottomAngle=function(){return this.angle!=null&&BX.util.in_array(this.angle.position,["top","bottom"])};BX.PopupWindow.prototype.getAngleHeight=function(){return(this.isTopOrBottomAngle()?BX.PopupWindow.getOption("angleTopOffset"):0)};BX.PopupWindow.prototype.setOffset=function(b){if(typeof(b)!="object"){return}if(b.offsetLeft&&BX.type.isNumber(b.offsetLeft)){this.offsetLeft=b.offsetLeft+BX.PopupWindow.getOption("offsetLeft")}if(b.offsetTop&&BX.type.isNumber(b.offsetTop)){this.offsetTop=b.offsetTop+BX.PopupWindow.getOption("offsetTop")}};BX.PopupWindow.prototype.setTitleBar=function(b){if(!this.titleBar||typeof(b)!="object"||!BX.type.isDomNode(b.content)){return}this.titleBar.innerHTML="";this.titleBar.appendChild(b.content);if(this.params.draggable){this.titleBar.parentNode.style.cursor="move";BX.bind(this.titleBar.parentNode,"mousedown",BX.proxy(this._startDrag,this))}};BX.PopupWindow.prototype.setClosingByEsc=function(b){b=!!b;if(b){this.closeByEsc=true;if(!this.isCloseByEscBinded){BX.bind(document,"keyup",BX.proxy(this._onKeyUp,this));this.isCloseByEscBinded=true}}else{this.closeByEsc=false;if(this.isCloseByEscBinded){BX.unbind(document,"keyup",BX.proxy(this._onKeyUp,this));this.isCloseByEscBinded=false}}};BX.PopupWindow.prototype.setOverlay=function(b){if(this.overlay==null){this.overlay={element:BX.create("div",{props:{className:"popup-window-overlay",id:"popup-window-overlay-"+this.uniquePopupId}})};this.adjustOverlayZindex();this.resizeOverlay();document.body.appendChild(this.overlay.element)}if(b&&b.opacity&&BX.type.isNumber(b.opacity)&&b.opacity>=0&&b.opacity<=100){if(BX.browser.IsIE()&&!BX.browser.IsIE9()){this.overlay.element.style.filter="alpha(opacity="+b.opacity+")"}else{this.overlay.element.style.filter="none";this.overlay.element.style.opacity=parseFloat(b.opacity/100).toPrecision(3)}}if(b&&b.backgroundColor){this.overlay.element.style.backgroundColor=b.backgroundColor}};BX.PopupWindow.prototype.removeOverlay=function(){if(this.overlay!=null&&this.overlay.element!=null){BX.remove(this.overlay.element)}this.overlay=null};BX.PopupWindow.prototype.hideOverlay=function(){if(this.overlay!=null&&this.overlay.element!=null){this.overlay.element.style.display="none"}};BX.PopupWindow.prototype.showOverlay=function(){if(this.overlay!=null&&this.overlay.element!=null){this.overlay.element.style.display="block"}};BX.PopupWindow.prototype.resizeOverlay=function(){if(this.overlay!=null&&this.overlay.element!=null){var b=BX.GetWindowScrollSize();this.overlay.element.style.width=b.scrollWidth+"px";this.overlay.element.style.height=b.scrollHeight+"px"}};BX.PopupWindow.prototype.getZindex=function(){if(this.overlay!=null){return BX.PopupWindow.getOption("popupOverlayZindex")+this.params.zIndex}else{return BX.PopupWindow.getOption("popupZindex")+this.params.zIndex}};BX.PopupWindow.prototype.adjustOverlayZindex=function(){if(this.overlay!=null&&this.overlay.element!=null){this.overlay.element.style.zIndex=parseInt(this.popupContainer.style.zIndex)-1}};BX.PopupWindow.prototype.show=function(){if(!this.firstShow){BX.onCustomEvent(this,"onPopupFirstShow",[this]);this.firstShow=true}BX.onCustomEvent(this,"onPopupShow",[this]);this.showOverlay();this.popupContainer.style.display="block";this.adjustPosition();BX.onCustomEvent(this,"onAfterPopupShow",[this]);if(this.closeByEsc&&!this.isCloseByEscBinded){BX.bind(document,"keyup",BX.proxy(this._onKeyUp,this));this.isCloseByEscBinded=true}if(this.params.autoHide&&!this.isAutoHideBinded){setTimeout(BX.proxy(function(){this.isAutoHideBinded=true;BX.bind(this.popupContainer,"click",this.cancelBubble);BX.bind(document,"click",BX.proxy(this.close,this))},this),0)}};BX.PopupWindow.prototype.isShown=function(){return this.popupContainer.style.display=="block"};BX.PopupWindow.prototype.cancelBubble=function(b){if(!b){b=a.event}if(b.stopPropagation){b.stopPropagation()}else{b.cancelBubble=true}};BX.PopupWindow.prototype.close=function(b){if(!this.isShown()){return}if(b&&!(BX.getEventButton(b)&BX.MSLEFT)){return true}BX.onCustomEvent(this,"onPopupClose",[this,b]);this.hideOverlay();this.popupContainer.style.display="none";if(this.isCloseByEscBinded){BX.unbind(document,"keyup",BX.proxy(this._onKeyUp,this));this.isCloseByEscBinded=false}setTimeout(BX.proxy(this._close,this),0)};BX.PopupWindow.prototype._close=function(){if(this.params.autoHide&&this.isAutoHideBinded){this.isAutoHideBinded=false;BX.unbind(this.popupContainer,"click",this.cancelBubble);BX.unbind(document,"click",BX.proxy(this.close,this))}};BX.PopupWindow.prototype._onCloseIconClick=function(b){b=b||a.event;this.close(b);BX.PreventDefault(b)};BX.PopupWindow.prototype._onKeyUp=function(b){b=b||a.event;if(b.keyCode==27){this.close(b)}};BX.PopupWindow.prototype.destroy=function(){BX.onCustomEvent(this,"onPopupDestroy",[this]);BX.unbindAll(this);BX.unbind(document,"keyup",BX.proxy(this._onKeyUp,this));BX.unbind(document,"click",BX.proxy(this.close,this));BX.unbind(document,"mousemove",BX.proxy(this._moveDrag,this));BX.unbind(document,"mouseup",BX.proxy(this._stopDrag,this));BX.unbind(a,"resize",BX.proxy(this._onResizeWindow,this));BX.remove(this.popupContainer);this.removeOverlay()};BX.PopupWindow.prototype.adjustPosition=function(j){if(j&&typeof(j)=="object"){this.bindOptions=j}var d=this.getBindElementPos(this.bindElement);if(!this.bindOptions.forceBindPosition&&this.bindElementPos!=null&&d.top==this.bindElementPos.top&&d.left==this.bindElementPos.left){return}this.bindElementPos=d;var h=d.windowSize?d.windowSize:BX.GetWindowInnerSize();var k=d.windowScroll?d.windowScroll:BX.GetWindowScrollPos();var g=d.popupWidth?d.popupWidth:this.popupContainer.offsetWidth;var e=d.popupHeight?d.popupHeight:this.popupContainer.offsetHeight;var i=BX.PopupWindow.getOption("angleTopOffset");var c=this.bindElementPos.left+this.offsetLeft-(this.isTopOrBottomAngle()?BX.PopupWindow.getOption("angleLeftOffset"):0);if(!this.bindOptions.forceLeft&&(c+g+this.bordersWidth)>=(h.innerWidth+k.scrollLeft)&&(h.innerWidth+k.scrollLeft-g-this.bordersWidth)>0){var b=c;c=h.innerWidth+k.scrollLeft-g-this.bordersWidth;if(this.isTopOrBottomAngle()){this.setAngle({offset:b-c+this.angle.defaultOffset})}}else{if(this.isTopOrBottomAngle()){this.setAngle({offset:this.angle.defaultOffset+(c<0?c:0)})}}if(c<0){c=0}var f=0;if(this.bindOptions.position&&this.bindOptions.position=="top"){f=this.bindElementPos.top-e-this.offsetTop-(this.isBottomAngle()?i:0);if(f<0||(!this.bindOptions.forceTop&&f<k.scrollTop)){f=this.bindElementPos.bottom+this.offsetTop;if(this.angle!=null){f+=i;this.setAngle({position:"top"})}}else{if(this.isTopAngle()){f=f-i+BX.PopupWindow.getOption("positionTopXOffset");this.setAngle({position:"bottom"})}else{f+=BX.PopupWindow.getOption("positionTopXOffset")}}}else{f=this.bindElementPos.bottom+this.offsetTop+this.getAngleHeight();if(!this.bindOptions.forceTop&&(f+e)>(h.innerHeight+k.scrollTop)&&(this.bindElementPos.top-e-this.getAngleHeight())>=0){f=this.bindElementPos.top-e;if(this.isTopOrBottomAngle()){f-=i;this.setAngle({position:"bottom"})}f+=BX.PopupWindow.getOption("positionTopXOffset")}else{if(this.isBottomAngle()){f+=i;this.setAngle({position:"top"})}}}if(f<0){f=0}BX.adjust(this.popupContainer,{style:{top:f+"px",left:c+"px",zIndex:this.getZindex()}});this.adjustOverlayZindex()};BX.PopupWindow.prototype._onResizeWindow=function(b){if(this.isShown()){this.adjustPosition();if(this.overlay!=null){this.resizeOverlay()}}};BX.PopupWindow.prototype.move=function(b,h){var g=parseInt(this.popupContainer.style.left)+b;var f=parseInt(this.popupContainer.style.top)+h;if(typeof(this.params.draggable)=="object"&&this.params.draggable.restrict){if(g<0){g=0}var d=BX.GetWindowScrollSize();var e=this.popupContainer.offsetWidth;var c=this.popupContainer.offsetHeight;if(g>(d.scrollWidth-e)){g=d.scrollWidth-e}if(f>(d.scrollHeight-c)){f=d.scrollHeight-c}if(f<0){f=0}}this.popupContainer.style.left=g+"px";this.popupContainer.style.top=f+"px"};BX.PopupWindow.prototype._startDrag=function(b){b=b||a.event;BX.fixEventPageXY(b);this.dragPageX=b.pageX;this.dragPageY=b.pageY;this.dragged=false;BX.bind(document,"mousemove",BX.proxy(this._moveDrag,this));BX.bind(document,"mouseup",BX.proxy(this._stopDrag,this));if(document.body.setCapture){document.body.setCapture()}document.body.ondrag=BX.False;document.body.onselectstart=BX.False;document.body.style.cursor="move";document.body.style.MozUserSelect="none";this.popupContainer.style.MozUserSelect="none";return BX.PreventDefault(b)};BX.PopupWindow.prototype._moveDrag=function(b){b=b||a.event;BX.fixEventPageXY(b);if(this.dragPageX==b.pageX&&this.dragPageY==b.pageY){return}this.move((b.pageX-this.dragPageX),(b.pageY-this.dragPageY));this.dragPageX=b.pageX;this.dragPageY=b.pageY;if(!this.dragged){BX.onCustomEvent(this,"onPopupDragStart");this.dragged=true}BX.onCustomEvent(this,"onPopupDrag")};BX.PopupWindow.prototype._stopDrag=function(b){if(document.body.releaseCapture){document.body.releaseCapture()}BX.unbind(document,"mousemove",BX.proxy(this._moveDrag,this));BX.unbind(document,"mouseup",BX.proxy(this._stopDrag,this));document.body.ondrag=null;document.body.onselectstart=null;document.body.style.cursor="";document.body.style.MozUserSelect="";this.popupContainer.style.MozUserSelect="";BX.onCustomEvent(this,"onPopupDragEnd");this.dragged=false;return BX.PreventDefault(b)};BX.PopupWindow.options={};BX.PopupWindow.defaultOptions={angleLeftOffset:15,positionTopXOffset:0,angleTopOffset:8,popupZindex:1000,popupOverlayZindex:1100,angleMinLeft:10,angleMaxLeft:10,angleMinRight:10,angleMaxRight:10,angleMinBottom:7,angleMaxBottom:25,angleMinTop:7,angleMaxTop:25,offsetLeft:0,offsetTop:0};BX.PopupWindow.setOptions=function(b){if(!b||typeof(b)!="object"){return}for(var c in b){BX.PopupWindow.options[c]=b[c]}};BX.PopupWindow.getOption=function(c,b){if(typeof(BX.PopupWindow.options[c])!="undefined"){return BX.PopupWindow.options[c]}else{if(typeof(b)!="undefined"){return b}else{return BX.PopupWindow.defaultOptions[c]}}};BX.PopupWindowButton=function(c){this.popupWindow=null;this.params=c||{};this.text=this.params.text||"";this.id=this.params.id||"";this.className=this.params.className||"";this.events=this.params.events||{};this.contextEvents={};for(var b in this.events){this.contextEvents[b]=BX.proxy(this.events[b],this)}this.nameNode=BX.create("span",{props:{className:"popup-window-button-text"},text:this.text});this.buttonNode=BX.create("span",{props:{className:"popup-window-button"+(this.className.length>0?" "+this.className:""),id:this.id},children:[BX.create("span",{props:{className:"popup-window-button-left"}}),this.nameNode,BX.create("span",{props:{className:"popup-window-button-right"}})],events:this.contextEvents})};BX.PopupWindowButton.prototype.render=function(){return this.buttonNode};BX.PopupWindowButton.prototype.setName=function(b){this.text=b||"";if(this.nameNode){BX.cleanNode(this.nameNode);BX.adjust(this.nameNode,{text:this.text})}};BX.PopupWindowButton.prototype.setClassName=function(b){if(this.buttonNode){if(BX.type.isString(this.className)&&(this.className!="")){BX.removeClass(this.buttonNode,this.className)}BX.addClass(this.buttonNode,b)}this.className=b};BX.PopupWindowButtonLink=function(b){BX.PopupWindowButtonLink.superclass.constructor.apply(this,arguments);this.nameNode=BX.create("span",{props:{className:"popup-window-button-link-text"},text:this.text,events:this.contextEvents});this.buttonNode=BX.create("span",{props:{className:"popup-window-button popup-window-button-link"+(this.className.length>0?" "+this.className:""),id:this.id},children:[this.nameNode]})};BX.extend(BX.PopupWindowButtonLink,BX.PopupWindowButton);BX.PopupMenu={Data:{},currentItem:null,stack:[],onkeypresslistener:null,show:function(b,c,e,f,g){if(!g){g=0}if(g<this.stack.length){for(var d=this.stack.length-1;d>=g;d--){this.currentItem=this.stack.pop();if(this.currentItem){this.currentItem.popupWindow.close()}if(d>0){this.currentItem=this.stack[d-1]}}}if(!this.Data[b]){this.Data[b]={id:b,bindElement:c,params:f};this.Data[b].popupWindow=this.__createPopup(this.Data[b],e,f)}this.currentItem=this.Data[b];this.stack[g]=this.currentItem;this.currentItem.popupWindow.show();if(!this.onkeypresslistener){this.onkeypresslistener=BX.delegate(function(h){h=h||a.event;if(h&&h.keyCode==27){this.currentItem=this.stack.pop();if(this.currentItem){this.currentItem.popupWindow.close()}if(this.stack.length>0){this.currentItem=this.stack[this.stack.length-1]}}},this);BX.bind(document,"keypress",this.onkeypresslistener)}},__createPopup:function(c,b,d){var h=[];for(var f=0;f<b.length;f++){var k=b[f];if(!k){continue}if(f>0){h.push(BX.create("div",{props:{className:"popup-window-hr"},html:"<i></i>"}))}if(!!k.delimiter){var j=BX.create("span",{props:{className:"popup-window-delimiter"},html:"<i></i>"})}else{if(!!k.text&&BX.type.isNotEmptyString(k.text)){var j=BX.create(!!k.href?"a":"span",{props:{className:"menu-popup-item"+(BX.type.isNotEmptyString(k.className)?" "+k.className:"")},attrs:{title:k.title?k.title:"",onclick:k.onclick&&BX.type.isString(k.onclick)?k.onclick:null},events:k.onclick&&BX.type.isFunction(k.onclick)?{click:BX.proxy(k.onclick,c)}:null,html:'<span class="menu-popup-item-left"></span><span class="menu-popup-item-icon"></span><span class="menu-popup-item-text">'+k.text+'</span><span class="menu-popup-item-right"></span>'});if(k.href){j.href=k.href}}}h.push(j)}var e=new BX.PopupWindow("menu-popup-"+c.id,c.bindElement,{closeByEsc:false,autoHide:typeof(d.autoHide)!="undefined"?d.autoHide:true,offsetTop:d.offsetTop?d.offsetTop:1,offsetLeft:d.offsetLeft?d.offsetLeft:0,lightShadow:typeof(d.lightShadow)!="undefined"?d.lightShadow:true,angle:typeof(d.angle)!="undefined"?d.angle:false,content:BX.create("div",{props:{className:"menu-popup"},children:[BX.create("div",{props:{className:"menu-popup-items"},children:h})]})});if(d&&d.events){for(var g in d.events){BX.addCustomEvent(e,g,d.events[g])}}return e}};a.BXInputPopup=function(b){this.id=b.id||"bx-inp-popup-"+Math.round(Math.random()*1000000);this.handler=b.handler||false;this.values=b.values||false;this.pInput=b.input;this.bValues=!!this.values;this.defaultValue=b.defaultValue||"";this.openTitle=b.openTitle||"";this.className=b.className||"";this.noMRclassName=b.noMRclassName||"ec-no-rm";this.emptyClassName=b.noMRclassName||"ec-label";var c=this;this.curInd=false;if(this.bValues){this.pInput.onfocus=this.pInput.onclick=function(d){if(this.value==c.defaultValue){this.value="";this.className=""}c.ShowPopup();return BX.PreventDefault(d)};this.pInput.onblur=function(){if(c.bShowed){setTimeout(function(){c.ClosePopup(true)},200)}c.OnChange()}}else{this.pInput.className=this.noMRclassName;this.pInput.onblur=BX.proxy(this.OnChange,this)}};BXInputPopup.prototype={ShowPopup:function(){if(this.bShowed){return}var f=this;if(!this.oPopup){var e,d=BX.create("DIV",{props:{className:"bxecpl-loc-popup "+this.className}});for(var c=0,b=this.values.length;c<b;c++){e=d.appendChild(BX.create("DIV",{props:{id:"bxecmr_"+c,title:this.values[c].DESCRIPTION},text:this.values[c].NAME,events:{mouseover:function(){this.className="bxecplloc-over"},mouseout:function(){this.className=""},click:function(){var g=this.id.substr("bxecmr_".length);f.pInput.value=f.values[g].NAME;f.curInd=g;f.OnChange();f.ClosePopup(true)}}}));if(this.values[c].URL){e.appendChild(BX.create("A",{props:{href:this.values[c].URL,className:"bxecplloc-view",target:"_blank",title:this.openTitle}}))}}this.oPopup=new BX.PopupWindow(this.id,this.pInput,{autoHide:true,offsetTop:1,offsetLeft:0,lightShadow:true,closeByEsc:true,content:d});BX.addCustomEvent(this.oPopup,"onPopupClose",BX.proxy(this.ClosePopup,this))}this.oPopup.show();this.pInput.select();this.bShowed=true;BX.onCustomEvent(this,"onInputPopupShow",[this])},ClosePopup:function(b){this.bShowed=false;if(this.pInput.value==""){this.OnChange()}BX.onCustomEvent(this,"onInputPopupClose",[this]);if(b===true){this.oPopup.close()}},OnChange:function(){var b=this.pInput.value;if(this.bValues){if(this.pInput.value==""||this.pInput.value==this.defaultValue){this.pInput.value=this.defaultValue;this.pInput.className=this.emptyClassName;b=""}else{this.pInput.className=""}}if(isNaN(parseInt(this.curInd))||this.curInd!==false&&b!=this.values[this.curInd].NAME){this.curInd=false}else{this.curInd=parseInt(this.curInd)}BX.onCustomEvent(this,"onInputPopupChanged",[this,this.curInd,b]);if(this.handler&&typeof this.handler=="function"){this.handler({ind:this.curInd,value:b})}},Set:function(c,d,b){this.curInd=c;if(this.curInd!==false){this.pInput.value=this.values[this.curInd].NAME}else{this.pInput.value=d}if(b!==false){this.OnChange()}},Get:function(b){var c=false;if(typeof b=="undefined"){b=this.curInd}if(b!==false&&this.values[b]){c=this.values[b].ID}return c},GetIndex:function(d){for(var c=0,b=this.values.length;c<b;c++){if(this.values[c].ID==d){return c}}return false},Deactivate:function(b){if(this.pInput.value==""||this.pInput.value==this.defaultValue){if(b){this.pInput.value="";this.pInput.className=this.noMRclassName}else{if(this.oEC.bUseMR){this.pInput.value=this.defaultValue;this.pInput.className=this.emptyClassName}}}this.pInput.disabled=b}}})(window);