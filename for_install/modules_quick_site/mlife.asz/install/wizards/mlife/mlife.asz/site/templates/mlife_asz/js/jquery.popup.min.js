(function(a){a.fn.bPopup=function(j,V){function i(){ap.contentContainer=a(ap.contentContainer||ao);switch(ap.content){case"iframe":var c=a('<iframe class="b-iframe" '+ap.iframeAttr+"></iframe>");c.appendTo(ap.contentContainer);aa=ao.outerHeight(!0);Y=ao.outerWidth(!0);af();c.attr("src",ap.loadUrl);aj(ap.loadCallback);break;case"image":af();a("<img />").load(function(){aj(ap.loadCallback);T(a(this))}).attr("src",ap.loadUrl).hide().appendTo(ap.contentContainer);break;default:af(),a('<div class="b-ajax-wrapper"></div>').load(ap.loadUrl,ap.loadData,function(){aj(ap.loadCallback);T(a(this))}).hide().appendTo(ap.contentContainer)}}function af(){ap.modal&&a('<div class="b-modal '+am+'"></div>').css({backgroundColor:ap.modalColor,position:"fixed",top:0,right:0,bottom:0,left:0,opacity:0,zIndex:ap.zIndex+W}).appendTo(ap.appendTo).fadeTo(ap.speed,ap.opacity);Z();ao.data("bPopup",ap).data("id",am).css({left:"slideIn"==ap.transition||"slideBack"==ap.transition?"slideBack"==ap.transition?ak.scrollLeft()+U:-1*(S+Y):ai(!(!ap.follow[0]&&ah||al)),position:ap.positionStyle||"absolute",top:"slideDown"==ap.transition||"slideUp"==ap.transition?"slideUp"==ap.transition?ak.scrollTop()+Q:P+-1*aa:ag(!(!ap.follow[1]&&ae||al)),"z-index":ap.zIndex+W+1}).each(function(){ap.appending&&a(this).appendTo(ap.appendTo)});R(!0)}function ad(){ap.modal&&a(".b-modal."+ao.data("id")).fadeTo(ap.speed,0,function(){a(this).remove()});ap.scrollBar||a("html").css("overflow","auto");a(".b-modal."+am).unbind("click");ak.unbind("keydown."+am);an.unbind("."+am).data("bPopup",0<an.data("bPopup")-1?an.data("bPopup")-1:null);ao.undelegate(".bClose, ."+ap.closeClass,"click."+am,ad).data("bPopup",null);R();return !1}function T(f){var c=f.width(),g=f.height(),k={};ap.contentContainer.css({height:g,width:c});g>=ao.height()&&(k.height=ao.height());c>=ao.width()&&(k.width=ao.width());aa=ao.outerHeight(!0);Y=ao.outerWidth(!0);Z();ap.contentContainer.css({height:"auto",width:"auto"});k.left=ai(!(!ap.follow[0]&&ah||al));k.top=ag(!(!ap.follow[1]&&ae||al));ao.animate(k,250,function(){f.show();ac=X()})}function h(){an.data("bPopup",W);ao.delegate(".bClose, ."+ap.closeClass,"click."+am,ad);ap.modalClose&&a(".b-modal."+am).css("cursor","pointer").bind("click",ad);b||!ap.follow[0]&&!ap.follow[1]||an.bind("scroll."+am,function(){ac&&ao.dequeue().animate({left:ap.follow[0]?ai(!al):"auto",top:ap.follow[1]?ag(!al):"auto"},ap.followSpeed,ap.followEasing)}).bind("resize."+am,function(){Q=o.innerHeight||an.height();U=o.innerWidth||an.width();if(ac=X()){clearTimeout(O),O=setTimeout(function(){Z();ao.dequeue().each(function(){al?a(this).css({left:S,top:P}):a(this).animate({left:ap.follow[0]?ai(!0):"auto",top:ap.follow[1]?ag(!0):"auto"},ap.followSpeed,ap.followEasing)})},50)}});ap.escClose&&ak.bind("keydown."+am,function(c){27==c.which&&ad()})}function R(c){function e(d){ao.css({display:"block",opacity:1}).animate(d,ap.speed,ap.easing,function(){N(c)})}switch(c?ap.transition:ap.transitionClose||ap.transition){case"slideIn":e({left:c?ai(!(!ap.follow[0]&&ah||al)):ak.scrollLeft()-(Y||ao.outerWidth(!0))-ab});break;case"slideBack":e({left:c?ai(!(!ap.follow[0]&&ah||al)):ak.scrollLeft()+U+ab});break;case"slideDown":e({top:c?ag(!(!ap.follow[1]&&ae||al)):ak.scrollTop()-(aa||ao.outerHeight(!0))-ab});break;case"slideUp":e({top:c?ag(!(!ap.follow[1]&&ae||al)):ak.scrollTop()+Q+ab});break;default:ao.stop().fadeTo(ap.speed,c?1:0,function(){N(c)})}}function N(c){c?(h(),aj(V),ap.autoClose&&setTimeout(ad,ap.autoClose)):(ao.hide(),aj(ap.onClose),ap.loadUrl&&(ap.contentContainer.empty(),ao.css({height:"auto",width:"auto"})))}function ai(c){return c?S+ak.scrollLeft():S}function ag(c){return c?P+ak.scrollTop():P}function aj(c){a.isFunction(c)&&c.call(ao)}function Z(){P=ae?ap.position[1]:Math.max(0,(Q-ao.outerHeight(!0))/2-ap.amsl);S=ah?ap.position[0]:(U-ao.outerWidth(!0))/2;ac=X()}function X(){return Q>ao.outerHeight(!0)&&U>ao.outerWidth(!0)}a.isFunction(j)&&(V=j,j=null);var ap=a.extend({},a.fn.bPopup.defaults,j);ap.scrollBar||a("html").css("overflow","hidden");var ao=this,ak=a(document),o=window,an=a(o),Q=o.innerHeight||an.height(),U=o.innerWidth||an.width(),b=/OS 6(_\d)+/i.test(navigator.userAgent),ab=200,W=0,am,ac,ae,ah,al,P,S,aa,Y,O;ao.close=function(){ap=this.data("bPopup");am="__b-popup"+an.data("bPopup")+"__";ad()};return ao.each(function(){a(this).data("bPopup")||(aj(ap.onOpen),W=(an.data("bPopup")||0)+1,am="__b-popup"+W+"__",ae="auto"!==ap.position[1],ah="auto"!==ap.position[0],al="fixed"===ap.positionStyle,aa=ao.outerHeight(!0),Y=ao.outerWidth(!0),ap.loadUrl?i():af())})};a.fn.bPopup.defaults={amsl:50,appending:!0,appendTo:"body",autoClose:!1,closeClass:"b-close",content:"ajax",contentContainer:!1,easing:"swing",escClose:!0,follow:[!0,!0],followEasing:"swing",followSpeed:500,iframeAttr:'scrolling="no" frameborder="0"',loadCallback:!1,loadData:!1,loadUrl:!1,modal:!0,modalClose:!0,modalColor:"#000",onClose:!1,onOpen:!1,opacity:0.7,position:["auto","auto"],positionStyle:"absolute",scrollBar:!0,speed:250,transition:"fadeIn",transitionClose:!1,zIndex:9997}})(jQuery);