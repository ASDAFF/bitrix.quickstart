function JCSmartFilter(b,a,c){this.ajaxURL=b;this.form=null;this.timer=null;this.cacheKey="";this.cache=[];this.viewMode=a;this.normal_url=false;this.bindUrlToButton("set_filter",c.SEF_SET_FILTER_URL);this.sef=true;this.bindUrlToButton("del_filter",c.SEF_DEL_FILTER_URL);if(!c.SEF_DEL_FILTER_URL){this.normal_url=true}}JCSmartFilter.prototype.keyup=function(a){if(!!this.timer){clearTimeout(this.timer)}if(!$(a).hasClass("disabled")){this.timer=setTimeout(BX.delegate(function(){this.reload(a)},this),500)}};JCSmartFilter.prototype.click=function(a){if(!!this.timer){clearTimeout(this.timer)}this.timer=setTimeout(BX.delegate(function(){this.reload(a)},this),500)};JCSmartFilter.prototype.reload=function(c){if(this.cacheKey!==""){if(!!this.timer){clearTimeout(this.timer)}this.timer=setTimeout(BX.delegate(function(){this.reload(c)},this),1000);return}this.cacheKey="|";this.position=BX.pos(c,true);this.form=BX.findParent(c,{tag:"form"});if(this.form){var b=[];b[0]={name:"ajax",value:"y"};this.gatherInputsValues(b,BX.findChildren(this.form,{tag:new RegExp("^(input|select)$","i")},true));for(var e=0;e<b.length;e++){this.cacheKey+=b[e].name+":"+b[e].value+"|"}if(this.cache[this.cacheKey]){this.curFilterinput=c;this.postHandler(this.cache[this.cacheKey],true)}else{if(this.sef){var a=BX("set_filter"),d=BX("del_filter");a.disabled=true;d.disabled=true}this.curFilterinput=c;BX.ajax.loadJSON(this.ajaxURL,this.values2post(b),BX.delegate(this.postHandler,this))}}};JCSmartFilter.prototype.updateItem=function(h,g,c){if(g.PROPERTY_TYPE==="N"||g.PRICE){var e=window["trackBar"+h];if(!e&&g.ENCODED_ID){e=window["trackBar"+g.ENCODED_ID]}if(e&&g.VALUES){if(g.VALUES.MIN){if(g.VALUES.MIN.FILTERED_VALUE){e.setMinFilteredValue(g.VALUES.MIN.FILTERED_VALUE)}else{e.setMinFilteredValue(g.VALUES.MIN.VALUE)}}if(g.VALUES.MAX){if(g.VALUES.MAX.FILTERED_VALUE){e.setMaxFilteredValue(g.VALUES.MAX.FILTERED_VALUE)}else{e.setMaxFilteredValue(g.VALUES.MAX.VALUE)}}if(c=="Y"){e.leftPercent=e.rightPercent=0;$("#"+g.VALUES.MIN.CONTROL_ID).val("");$("#"+g.VALUES.MAX.CONTROL_ID).val("");$("#left_slider_"+g.ENCODED_ID).css({left:"0%"});$("#colorUnavailableActive_"+g.ENCODED_ID).css({left:"0%",right:"0%"});$("#colorAvailableInactive_"+g.ENCODED_ID).css({left:"0%",right:"0%"});$("#colorAvailableActive_"+g.ENCODED_ID).css({left:"0%",right:"0%"});$("#right_slider_"+g.ENCODED_ID).css({right:"0%"})}}}else{if(g.VALUES){for(var b in g.VALUES){if(g.VALUES.hasOwnProperty(b)){var d=g.VALUES[b];var f=BX(d.CONTROL_ID);if(!!f){var a=document.querySelector('[data-role="label_'+d.CONTROL_ID+'"]');input=document.querySelector('[id="'+d.CONTROL_ID+'"]');if(d.DISABLED){if(a){BX.addClass(a,"disabled");if(input){input.setAttribute("disabled","disabled");BX.addClass(input,"disabled")}}else{BX.addClass(f.parentNode,"disabled")}}else{if(a){BX.removeClass(a,"disabled");if(input){input.removeAttribute("disabled");BX.removeClass(input,"disabled")}if($(f)){$(f).prop("disabled",false);$(f).removeClass("disabled")}$(a).find("span").removeClass("disabled")}else{BX.removeClass(f.parentNode,"disabled")}}if(c=="Y"){if($(f).attr("type")=="checkbox"||$(f).attr("type")=="radio"){if($(f).attr("checked")){$(f).prop("checked",false)}}}if(d.hasOwnProperty("ELEMENT_COUNT")){a=document.querySelector('[data-role="count_'+d.CONTROL_ID+'"]');if(a){a.innerHTML=d.ELEMENT_COUNT}}}}}}}};JCSmartFilter.prototype.postHandlerAjax=function(a,b){$("#content").html(a)};JCSmartFilter.prototype.setUrlSortDisplay=function(b){var a="",c="";$(".sort_btn").each(function(){a=$(this).attr("href").split("?");a[0]=b;c=a.join("?");$(this).attr("href",c)})};JCSmartFilter.prototype.filterCatalog=function(a,b){if(window.History.enabled||window.history.pushState!=null){window.History.pushState(null,document.title,a)}else{location.href=a}this.setUrlSortDisplay(a);$.ajax({url:a,type:"GET",data:{ajax_get:"Y",ajax_get_filter:"Y"},success:function(e){if($(".display_list").length){$(".display_list").html(e)}else{if($(".block_list").length){$(".block_list").html(e);touchItemBlock(".catalog_item a");$(".catalog_block").ready(function(){$(".catalog_block").equalize({children:".catalog_item .cost",reset:true});$(".catalog_block").equalize({children:".catalog_item .item-title",reset:true});$(".catalog_block").equalize({children:".catalog_item .counter_block",reset:true});$(".catalog_block").equalize({children:".catalog_item_wrapp",reset:true})})}else{if($(".module_products_list").length){$(".module_products_list > tbody").html(e)}}}setStatusButton();BX.onCustomEvent("onAjaxSuccess");if($(e).find(".bottom_nav").size()){if($(".module_products_list").length){if($(".bottom_nav").length<2){$(".bottom_nav").insertAfter($(".module_products_list"))}$(".bottom_nav").show()}else{if($(".bottom_nav").length<2){if($(".top_wrapper").length){$(".bottom_nav").insertAfter($(".top_wrapper"))}else{if($(".display_list").length){$(".bottom_nav").insertAfter($(".display_list"))}}}}$(".bottom_nav").html($(e).find(".bottom_nav").html())}else{$(".bottom_nav").html("")}if(b=="Y"){var c=BX("set_filter"),d=BX("del_filter");c.disabled=false;d.disabled=false}initCountdown()}})};JCSmartFilter.prototype.postHandler=function(m,g){var e,c,d;var k=BX("modef");var j=BX("modef_mobile");var h=BX("modef_num");var b=BX("modef_num_mobile");var i="N";if("RESET_FORM" in m){document.getElementById("smartfilter").reset();i="Y"}if(!!m&&!!m.ITEMS){for(var a in m.ITEMS){if(m.ITEMS.hasOwnProperty(a)){this.updateItem(a,m.ITEMS[a],i)}}if(i=="Y"){if($(".bx_filter_select_block").length){$(".bx_filter_select_block").each(function(){var o=$(this).closest(".bx_filter_parameters_box").attr("property_id"),n=$(this).find(".input_wr_all input:first-child").data("title");$(this).find(".bx_filter_select_text").text(n);$(this).find(".bx_filter_select_popup li label").removeClass("selected")})}}if(!!k&&!!h){h.innerHTML=m.ELEMENT_COUNT;b.innerHTML=m.ELEMENT_COUNT;e=BX.findChildren(k,{tag:"A"},true);hrefFILTER_mobile=BX.findChildren(j,{tag:"A"},true);if(m.FILTER_URL&&e){e[0].href=BX.util.htmlspecialcharsback(m.FILTER_URL);hrefFILTER_mobile[0].href=BX.util.htmlspecialcharsback(m.FILTER_URL)}if(m.FILTER_AJAX_URL&&m.COMPONENT_CONTAINER_ID){BX.unbindAll(e[0]);BX.unbindAll(hrefFILTER_mobile[0]);BX.bind(e[0],"click",function(n){c=BX.util.htmlspecialcharsback(m.FILTER_AJAX_URL);BX.ajax.insertToNode(c,m.COMPONENT_CONTAINER_ID);return BX.PreventDefault(n)})}if(m.INSTANT_RELOAD&&m.COMPONENT_CONTAINER_ID){c=BX.util.htmlspecialcharsback(m.FILTER_AJAX_URL);BX.ajax.insertToNode(c,m.COMPONENT_CONTAINER_ID)}else{c=BX.util.htmlspecialcharsback(m.FILTER_AJAX_URL);this.filterCatalog(c,"N");if(m.SEF_SET_FILTER_URL){this.bindUrlToButton("set_filter",m.SEF_SET_FILTER_URL)}else{this.bindUrlToButton("set_filter",c)}}}}if(this.sef){var l=BX("set_filter"),f=BX("del_filter");l.disabled=false;f.disabled=false}if(!g&&this.cacheKey!==""){this.cache[this.cacheKey]=m}this.cacheKey=""};JCSmartFilter.prototype.bindUrlToButton=function(d,a){var c=BX(d);if(c){var b=function(e,f){return function(){return f(e)}};if(c.type=="submit"){c.type="button"}$(c).data("href",a);BX.unbindAll(c);BX.bind(c,"click",BX.proxy(function(){var i=$(c).data("href"),j=$(c).attr("id");if(j=="del_filter"){var g=[],e=this.normal_url?$("form.smartfilter").attr("action"):this.ajaxURL;g[0]={name:"ajax",value:"y"};if(!this.normal_url){this.gatherInputsValues(g,BX.findChildren(document.getElementById("smartfilter"),{attribute:"hidden"},true))}g[1]={name:"reset_form",value:"y"};if(this.sef){var f=BX("set_filter"),h=BX("del_filter");f.disabled=true;h.disabled=true}BX.ajax.loadJSON(e,this.values2post(g),BX.delegate(this.postHandler,this))}else{if(i){if(this.sef){var f=BX("set_filter"),h=BX("del_filter");f.disabled=true;h.disabled=true}this.filterCatalog(i,"Y")}}},this))}};JCSmartFilter.prototype.gatherInputsValues=function(a,e){if(e){for(var c=0;c<e.length;c++){var d=e[c];if(d.disabled||!d.type){continue}switch(d.type.toLowerCase()){case"text":case"textarea":case"password":case"hidden":case"select-one":if(d.value.length){a[a.length]={name:d.name,value:d.value}}break;case"radio":case"checkbox":if(d.checked){a[a.length]={name:d.name,value:d.value}}break;case"select-multiple":for(var b=0;b<d.options.length;b++){if(d.options[b].selected){a[a.length]={name:d.name,value:d.options[b].value}}}break;default:break}}}};JCSmartFilter.prototype.values2post=function(b){var e=[];var h=e;var d=0;while(d<b.length){var g=b[d].name.indexOf("[");if(g==-1){h[b[d].name]=b[d].value;h=e;d++}else{var c=b[d].name.substring(0,g);var f=b[d].name.substring(g+1);if(!h[c]){h[c]=[]}var a=f.indexOf("]");if(a==-1){h=e;d++}else{if(a==0){h=h[c];b[d].name=""+h.length}else{h=h[c];b[d].name=f.substring(0,a)+f.substring(a+1)}}}}return e};JCSmartFilter.prototype.hideFilterProps=function(d){var e=d.parentNode,b=e.querySelector("[data-role='bx_filter_block']"),a=e.querySelector("[data-role='prop_angle']");if(BX.hasClass(e,"bx-active")){new BX.easing({duration:300,start:{opacity:1,height:b.offsetHeight},finish:{opacity:0,height:0},transition:BX.easing.transitions.quart,step:function(f){b.style.opacity=f.opacity;b.style.height=f.height+"px"},complete:function(){b.setAttribute("style","");BX.removeClass(e,"bx-active")}}).animate();BX.addClass(a,"fa-angle-down");BX.removeClass(a,"fa-angle-up")}else{b.style.display="block";b.style.opacity=0;b.style.height="auto";var c=b.offsetHeight;b.style.height=0;new BX.easing({duration:300,start:{opacity:0,height:0},finish:{opacity:1,height:c},transition:BX.easing.transitions.quart,step:function(f){b.style.opacity=f.opacity;b.style.height=f.height+"px"},complete:function(){}}).animate();BX.addClass(e,"bx-active");BX.removeClass(a,"fa-angle-down");BX.addClass(a,"fa-angle-up")}};JCSmartFilter.prototype.showDropDownPopup=function(c,b){var a=c.querySelector('[data-role="dropdownContent"]'),d=$(c).offset();BX.PopupWindowManager.create("smartFilterDropDown"+b,c,{autoHide:true,offsetLeft:0,offsetTop:0,overlay:false,draggable:{restrict:true},closeByEsc:true,content:a}).show();$("#smartFilterDropDown"+b).css({top:d.top+30,left:d.left})};JCSmartFilter.prototype.selectDropDownItem=function(c,d){if(!BX.hasClass(c,"disabled")){this.keyup(BX(d));var a=BX.findParent(BX(d),{className:"bx_filter_select_container"},false);var b=a.querySelector('[data-role="currentOption"]');b.innerHTML=c.innerHTML;$(c).closest(".bx_filter_select_popup").find("label").removeClass("selected");BX.addClass(c,"selected");BX.PopupWindowManager.getCurrentPopup().close()}};BX.namespace("BX.Iblock.SmartFilter");BX.Iblock.SmartFilter=(function(){var a=function(b){if(typeof b==="object"){this.leftSlider=BX(b.leftSlider);this.rightSlider=BX(b.rightSlider);this.tracker=BX(b.tracker);this.trackerWrap=BX(b.trackerWrap);this.minInput=BX(b.minInputId);this.maxInput=BX(b.maxInputId);this.minPrice=parseFloat(b.minPrice);this.maxPrice=parseFloat(b.maxPrice);this.curMinPrice=parseFloat(b.curMinPrice);this.curMaxPrice=parseFloat(b.curMaxPrice);this.fltMinPrice=b.fltMinPrice?parseFloat(b.fltMinPrice):parseFloat(b.curMinPrice);this.fltMaxPrice=b.fltMaxPrice?parseFloat(b.fltMaxPrice):parseFloat(b.curMaxPrice);this.precision=b.precision||0;this.priceDiff=this.maxPrice-this.minPrice;this.leftPercent=0;this.rightPercent=0;this.fltMinPercent=0;this.fltMaxPercent=0;this.colorUnavailableActive=BX(b.colorUnavailableActive);this.colorAvailableActive=BX(b.colorAvailableActive);this.colorAvailableInactive=BX(b.colorAvailableInactive);this.isTouch=false;this.init();if("ontouchstart" in document.documentElement){this.isTouch=true;BX.bind(this.leftSlider,"touchstart",BX.proxy(function(c){this.onMoveLeftSlider(c)},this));BX.bind(this.rightSlider,"touchstart",BX.proxy(function(c){this.onMoveRightSlider(c)},this))}else{BX.bind(this.leftSlider,"mousedown",BX.proxy(function(c){this.onMoveLeftSlider(c)},this));BX.bind(this.rightSlider,"mousedown",BX.proxy(function(c){this.onMoveRightSlider(c)},this))}BX.bind(this.colorAvailableActive,"mousedown",BX.proxy(function(c){this.onChangeLeftSlider(c)},this));BX.bind(this.colorUnavailableActive,"mousedown",BX.proxy(function(c){this.onChangeLeftSlider(c)},this));BX.bind(this.minInput,"keyup",BX.proxy(function(c){this.onInputChange()},this));BX.bind(this.maxInput,"keyup",BX.proxy(function(c){this.onInputChange()},this))}};a.prototype.init=function(){var b;if(this.curMinPrice>this.minPrice){b=this.curMinPrice-this.minPrice;this.leftPercent=(b*100)/this.priceDiff;this.leftSlider.style.left=this.leftPercent+"%";this.colorUnavailableActive.style.left=this.leftPercent+"%"}this.setMinFilteredValue(this.fltMinPrice);if(this.curMaxPrice<this.maxPrice){b=this.maxPrice-this.curMaxPrice;this.rightPercent=(b*100)/this.priceDiff;this.rightSlider.style.right=this.rightPercent+"%";this.colorUnavailableActive.style.right=this.rightPercent+"%"}this.setMaxFilteredValue(this.fltMaxPrice)};a.prototype.setMinFilteredValue=function(b){this.fltMinPrice=parseFloat(b);if(this.fltMinPrice>=this.minPrice){var c=this.fltMinPrice-this.minPrice;this.fltMinPercent=(c*100)/this.priceDiff;if(this.leftPercent>this.fltMinPercent){this.colorAvailableActive.style.left=this.leftPercent+"%"}else{this.colorAvailableActive.style.left=this.fltMinPercent+"%"}this.colorAvailableInactive.style.left=this.fltMinPercent+"%"}else{this.colorAvailableActive.style.left="0%";this.colorAvailableInactive.style.left="0%"}};a.prototype.setMaxFilteredValue=function(b){this.fltMaxPrice=parseFloat(b);if(this.fltMaxPrice<=this.maxPrice){var c=this.maxPrice-this.fltMaxPrice;this.fltMaxPercent=(c*100)/this.priceDiff;if(this.rightPercent>this.fltMaxPercent){this.colorAvailableActive.style.right=this.rightPercent+"%"}else{this.colorAvailableActive.style.right=this.fltMaxPercent+"%"}this.colorAvailableInactive.style.right=this.fltMaxPercent+"%"}else{this.colorAvailableActive.style.right="0%";this.colorAvailableInactive.style.right="0%"}};a.prototype.getXCoord=function(e){var d=e.getBoundingClientRect();var c=document.body;var b=document.documentElement;var g=window.pageXOffset||b.scrollLeft||c.scrollLeft;var h=b.clientLeft||c.clientLeft||0;var f=d.left+g-h;return Math.round(f)};a.prototype.getPageX=function(f){f=f||window.event;var d=null;if(this.isTouch&&event.targetTouches[0]!=null){d=f.targetTouches[0].pageX}else{if(f.pageX!=null){d=f.pageX}else{if(f.clientX!=null){var c=document.documentElement;var b=document.body;d=f.clientX+(c.scrollLeft||b&&b.scrollLeft||0);d-=c.clientLeft||0}}}return d};a.prototype.recountMinPrice=function(){var b=(this.priceDiff*this.leftPercent)/100;b=(this.minPrice+b).toFixed(this.precision);if(b!=this.minPrice){this.minInput.value=b}else{this.minInput.value=""}smartFilter.keyup(this.minInput)};a.prototype.recountMaxPrice=function(){var b=(this.priceDiff*this.rightPercent)/100;b=(this.maxPrice-b).toFixed(this.precision);if(b!=this.maxPrice){this.maxInput.value=b}else{this.maxInput.value=""}smartFilter.keyup(this.maxInput)};a.prototype.onInputChange=function(){var d;if(this.minInput.value){var b=this.minInput.value;if(b<this.minPrice){b=this.minPrice}if(b>this.maxPrice){b=this.maxPrice}d=b-this.minPrice;this.leftPercent=(d*100)/this.priceDiff;this.makeLeftSliderMove(false)}if(this.maxInput.value){var c=this.maxInput.value;if(c<this.minPrice){c=this.minPrice}if(c>this.maxPrice){c=this.maxPrice}d=this.maxPrice-c;this.rightPercent=(d*100)/this.priceDiff;this.makeRightSliderMove(false)}};a.prototype.makeLeftSliderMove=function(c){c=(c!==false);this.leftSlider.style.left=this.leftPercent+"%";this.colorUnavailableActive.style.left=this.leftPercent+"%";var b=false;if(this.leftPercent+this.rightPercent>=100){b=true;this.rightPercent=100-this.leftPercent;this.rightSlider.style.right=this.rightPercent+"%";this.colorUnavailableActive.style.right=this.rightPercent+"%"}if(this.leftPercent>=this.fltMinPercent&&this.leftPercent<=(100-this.fltMaxPercent)){this.colorAvailableActive.style.left=this.leftPercent+"%";if(b){this.colorAvailableActive.style.right=100-this.leftPercent+"%"}}else{if(this.leftPercent<=this.fltMinPercent){this.colorAvailableActive.style.left=this.fltMinPercent+"%";if(b){this.colorAvailableActive.style.right=100-this.fltMinPercent+"%"}}else{if(this.leftPercent>=this.fltMaxPercent){this.colorAvailableActive.style.left=100-this.fltMaxPercent+"%";if(b){this.colorAvailableActive.style.right=this.fltMaxPercent+"%"}}}}if(c){this.recountMinPrice();if(b){this.recountMaxPrice()}}};a.prototype.countNewLeft=function(f){var d=this.getPageX(f);var c=this.getXCoord(this.trackerWrap);var b=this.trackerWrap.offsetWidth;var e=d-c;if(e<0){e=0}else{if(e>b){e=b}}return e};a.prototype.onMoveLeftSlider=function(b){if(!this.isTouch){this.leftSlider.ondragstart=function(){return false}}if(!this.isTouch){document.onmousemove=BX.proxy(function(c){this.leftPercent=((this.countNewLeft(c)*100)/this.trackerWrap.offsetWidth);this.makeLeftSliderMove()},this);document.onmouseup=function(){document.onmousemove=document.onmouseup=null}}else{document.ontouchmove=BX.proxy(function(c){this.leftPercent=((this.countNewLeft(c)*100)/this.trackerWrap.offsetWidth);this.makeLeftSliderMove()},this);document.ontouchend=function(){document.ontouchmove=document.touchend=null}}return false};a.prototype.makeRightSliderMove=function(c){c=(c!==false);this.rightSlider.style.right=this.rightPercent+"%";this.colorUnavailableActive.style.right=this.rightPercent+"%";var b=false;if(this.leftPercent+this.rightPercent>=100){b=true;this.leftPercent=100-this.rightPercent;this.leftSlider.style.left=this.leftPercent+"%";this.colorUnavailableActive.style.left=this.leftPercent+"%"}if((100-this.rightPercent)>=this.fltMinPercent&&this.rightPercent>=this.fltMaxPercent){this.colorAvailableActive.style.right=this.rightPercent+"%";if(b){this.colorAvailableActive.style.left=100-this.rightPercent+"%"}}else{if(this.rightPercent<=this.fltMaxPercent){this.colorAvailableActive.style.right=this.fltMaxPercent+"%";if(b){this.colorAvailableActive.style.left=100-this.fltMaxPercent+"%"}}else{if((100-this.rightPercent)<=this.fltMinPercent){this.colorAvailableActive.style.right=100-this.fltMinPercent+"%";if(b){this.colorAvailableActive.style.left=this.fltMinPercent+"%"}}}}if(c){this.recountMaxPrice();if(b){this.recountMinPrice()}}};a.prototype.onMoveRightSlider=function(b){if(!this.isTouch){this.rightSlider.ondragstart=function(){return false}}if(!this.isTouch){document.onmousemove=BX.proxy(function(c){this.rightPercent=100-(((this.countNewLeft(c))*100)/(this.trackerWrap.offsetWidth));this.makeRightSliderMove()},this);document.onmouseup=function(){document.onmousemove=document.onmouseup=null}}else{document.ontouchmove=BX.proxy(function(c){this.rightPercent=100-(((this.countNewLeft(c))*100)/(this.trackerWrap.offsetWidth));this.makeRightSliderMove()},this);document.ontouchend=function(){document.ontouchmove=document.ontouchend=null}}return false};a.prototype.onChangeLeftSlider=function(b){if(!this.isTouch){this.leftSlider.ondragstart=function(){}}if(!this.isTouch){document.onmousedown=BX.proxy(function(d){var c=((this.countNewLeft(d)*100)/this.trackerWrap.offsetWidth);if($(d.target).is(".bx_ui_slider_handle")||!$(d.target).is("[class^=bx_ui_slider]")){return}if(c<50){this.leftPercent=c+1;this.makeLeftSliderMove()}else{this.rightPercent=100-c;this.makeRightSliderMove()}},this);document.onmouseup=function(){document.onmousemove=document.onmouseup=null}}else{document.ontouchend=BX.proxy(function(d){var c=((this.countNewLeft(d)*100)/this.trackerWrap.offsetWidth);if($(d.target).is(".bx_ui_slider_handle")){return}if(c<50){this.leftPercent=c;this.makeLeftSliderMove()}else{this.rightPercent=100-c;this.makeRightSliderMove()}},this);document.ontouchend=function(){document.ontouchmove=document.touchend=null}}return false};return a})();