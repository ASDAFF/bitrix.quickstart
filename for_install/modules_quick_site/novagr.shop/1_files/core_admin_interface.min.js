(function(){if(!!BX.adminPanel){return}BX.adminPanel=function(){this.buttons=[];this.panel=null;this.modifyFormElements=BX.adminFormTools.modifyFormElements;this.modifyFormElement=BX.adminFormTools.modifyFormElement;this._showMenu=function(a){if(this.CONFIG.MENU){BX.adminShowMenu(this.BUTTON,this.CONFIG.MENU,{active_class:"adm-header-language-active"})}return BX.PreventDefault(a)};BX.ready(BX.defer(this.Init,this))};BX.adminPanel.isFixed=BX.False;BX.adminPanel.prototype.Init=function(){this.panel=BX("bx-panel");if(!!this.panel){for(var a=0;a<this.buttons.length;a++){this.buttons[a].BUTTON=BX(this.buttons[a].ID);if(this.buttons[a].BUTTON){if(this.buttons[a].CONFIG.MENU){this.setButtonMenu(this.buttons[a])}}}(BX.defer(this._recountWrapHeight,this))()}};BX.adminPanel.prototype.registerButton=function(b,a){this.buttons.push({ID:b,CONFIG:a})};BX.adminPanel.prototype.setButtonMenu=function(a){BX.bind(a.BUTTON,"click",BX.delegate(this._showMenu,a))};BX.adminPanel.prototype.isFixed=function(){return BX.hasClass(document.documentElement,"adm-header-fixed")};BX.adminPanel.prototype.Fix=function(b){var a=this.isFixed();if(a){this.panel.parentNode.style.height="auto";BX.removeClass(document.documentElement,"adm-header-fixed");b.title=BX.message("JSADM_PIN_ON")}else{BX.addClass(document.documentElement,"adm-header-fixed");b.title=BX.message("JSADM_PIN_OFF");(BX.defer(this._recountWrapHeight,this))()}BX.userOptions.save("admin_panel","settings","fix",(a?"off":"on"));BX.onCustomEvent("onAdminPanelFix",[!a])};BX.adminPanel.prototype.addDesktop=function(){(new BX.CAdminDialog({content_url:"/bitrix/components/bitrix/desktop/admin_settings.php?lang="+BX.message("LANGUAGE_ID")+"&bxpublic=Y",content_post:"sessid="+BX.bitrix_sessid()+"&type=desktop&desktop_page=0&action=new&desktop_backurl=/bitrix/admin/",draggable:true,resizable:true,buttons:[BX.CAdminDialog.btnSave,BX.CAdminDialog.btnCancel]})).Show()};BX.adminPanel.prototype.recalcDesktopSettingsDialog=function(f){if(!f){f=window.event}var g=this.value;if(f.type=="blur"&&g.length<=0){g=current_col_count;BX("SETTINGS_COLUMNS").value=g}else{if(f.type=="keyup"&&(parseInt(g)<=0||parseInt(g)>=10)){current_col_count=g=2;BX("SETTINGS_COLUMNS").value=g}else{if(f.type=="keyup"&&g.length>0){current_col_count=g}}}var d=BX.findParent(this,{tag:"tbody"});var c=BX.findChildren(d,{tag:"tr","class":"bx-gd-admin-settings-col"},true);if(!c){c=[]}for(var b=0;b<c.length;b++){if(b>=g){c[b].parentNode.removeChild(c[b])}}var a=g-b;for(b=0;b<a;b++){d.appendChild(BX.create("tr",{props:{className:"bx-gd-admin-settings-col"},children:[BX.create("td",{attrs:{width:"40%"},html:BX.message("langGDSettingsDialogRowTitle")+(parseInt(c.length)+parseInt(b)+1)}),BX.create("td",{attrs:{width:"60%"},children:[BX.create("input",{attrs:{type:"text",size:"5",maxlength:"6"},props:{id:"SETTINGS_COLUMN_WIDTH_"+(c.length+b),name:"SETTINGS_COLUMN_WIDTH_"+(c.length+b),value:""}})]})]}))}};BX.adminPanel.prototype.setTitle=function(b){document.title=BX.message("TITLE_PREFIX")+b;var a=BX("adm-title");if(a){if(a.firstChild&&a.firstChild.nodeType==3){a.replaceChild(document.createTextNode(b),a.firstChild)}else{if(a.firstChild){a.insertBefore(a.firstChild,document.createTextNode(b))}else{BX.adjust(a,{text:b})}}}};BX.adminPanel.prototype._recountWrapHeight=function(){if(this.isFixed()){BX.adminPanel.panel.parentNode.style.height=BX.adminPanel.panel.offsetHeight+"px"}BX.onCustomEvent(this,"onAdminPanelChange")};BX.adminPanel.prototype.Notify=function(b){if(!BX.isReady){var a=arguments;BX.ready(BX.defer(function(){BX.adminPanel.Notify.apply(this,a)}));return}if(null==BX.adminPanel.NOTIFY){BX.adminPanel.NOTIFY=BX.adminPanel.panel.appendChild(BX.create("DIV",{props:{className:"adm-warning-block"},html:'<span class="adm-warning-text">'+(b||"&nbsp;")+'</span><span class="adm-warning-icon"></span><span onclick="BX.adminPanel.hideNotify(this.parentNode)" class="adm-warning-close"></span>'}))}else{BX.adminPanel.NOTIFY.firstChild.innerHTML=b||"&nbsp;"}BX.removeClass(BX.adminPanel.NOTIFY,"adm-warning-animate");(BX.defer(this._recountWrapHeight,this))();setTimeout(BX.proxy(this._recountWrapHeight,this),310)};BX.adminPanel.hideNotify=BX.adminPanel.prototype.hideNotify=function(a){a=BX.type.isDomNode(a)?a:this;if(!!a&&!!a.parentNode&&!!a.parentNode.parentNode){a.style.height=a.offsetHeight+"px";setTimeout(function(){BX.addClass(a,"adm-warning-animate")},50)}if(BX.type.isDomNode(a)&&a.getAttribute("data-ajax")=="Y"){var b=parseInt(a.getAttribute("data-id"));if(b>0){BX.ajax({url:"/bitrix/admin/admin_notify.php",method:"POST",dataType:"json",data:{ID:b,sessid:BX.bitrix_sessid()}})}}(BX.defer(this._recountWrapHeight,this))();setTimeout(BX.proxy(this._recountWrapHeight,this),310)};BX.adminPanel.Redirect=BX.adminPanel.prototype.Redirect=function(b,a,c){var d=false;if(b&&b.length>0){c=b[0]}if(!c){c=window.event}try{if(c){d=c.shiftKey}}catch(c){}if(d){window.open(a)}else{window.location.href=a}};BX.adminPanel._reShowWait=BX.adminPanel.prototype._reShowWait=function(){BX.adminPanel.closeWait(this);BX.adminPanel.showWait(this)};BX.adminPanel.showWait=BX.adminPanel.prototype.showWait=function(b){if(b&&!BX.type.isElementNode(b)){b=null}b=b||this;if(BX.type.isElementNode(b)&&(b.type=="button"||b.type=="submit")&&!!b.name&&BX.util.in_array(b.name.toLowerCase(),["save","apply","cancel","save_and_add","set_filter","del_filter","template_preview"])){if(b.disabled==true){return null}BX.defer(function(){b.disabled=true})();var c=(BX.hasClass(b,"adm-btn-save")||BX.hasClass(b,"adm-btn-save")),a=BX.findParent(b,BX.is_relative),d=BX.pos(b,!!a);b.bxwaiter=(a||document.body).appendChild(BX.create("DIV",{props:{className:"adm-btn-load-img"+(c?"-green":"")},style:{top:parseInt((d.bottom+d.top)/2-9)+"px",left:parseInt((d.right+d.left)/2-9)+"px"}}));BX.addClass(b,"adm-btn-load");BX.adminPanel.lastWaitElement=b;return b.bxwaiter}return null};BX.adminPanel.closeWait=BX.adminPanel.prototype.closeWait=function(a){if(a&&!BX.type.isElementNode(a)){a=null}a=a||BX.adminPanel.lastWaitElement||this;if(BX.type.isElementNode(a)){if(a.bxwaiter&&a.bxwaiter.parentNode){a.bxwaiter.parentNode.removeChild(a.bxwaiter);a.bxwaiter=null}a.disabled=false;BX.removeClass(a,"adm-btn-load");if(BX.adminPanel.lastWaitElement==a){BX.adminPanel.lastWaitElement=null}}};BX.adminFormTools={modifyFormElements:function(d,b){var c=BX.findFormElements(d);if(c&&c.length>0){for(var a=0;a<c.length;a++){BX.adminFormTools.modifyFormElement(c[a],b)}}},modifyFormElement:function(b,a){if(typeof a=="undefined"||!BX.type.isArray(a)){a=["checkbox","file"]}if(b&&BX.type.isElementNode(b)&&!!b.type){if(BX.util.in_array("*",a)||BX.util.in_array(b.type,a)){switch(b.type){case"checkbox":return BX.adminFormTools.modifyCheckbox(b);case"file":return BX.adminFormTools.modifyFile(b);case"select-one":case"select-multiple":return BX.adminFormTools.modifySelect(b);case"button":case"submit":case"reset":return BX.adminFormTools.modifyButton(b);default:return b}}else{return b}}return null},modifyCheckbox:function(b){if((!BX.browser.IsIE()||BX.browser.IsIE9())&&BX.type.isElementNode(b)&&b.tagName.toUpperCase()=="INPUT"&&b.type.toUpperCase()=="CHECKBOX"){if(!BX.hasClass(b,"adm-designed-checkbox")){if(!b.id){b.id="designed_checkbox_"+Math.random()}var a=BX.create("LABEL",{props:{className:"adm-designed-checkbox-label",htmlFor:b.id,title:b.title}});BX.addClass(a,b.className);BX.addClass(b,"adm-designed-checkbox");if(!!b.nextSibling){b.parentNode.insertBefore(a,b.nextSibling)}else{b.parentNode.appendChild(a)}}}},modifyFile:function(b){if(!BX.hasClass(b,"adm-designed-file")){var a=BX.create("SPAN",{props:{className:"adm-input-file"},html:"<span>"+(!!b.multiple?BX.message("JSADM_FILES"):BX.message("JSADM_FILE"))+"</span>"});BX.bind(b,"change",BX.adminFormTools._modified_file_onchange);BX.addClass(b,"adm-designed-file");if(b.parentNode){b.parentNode.insertBefore(a,b)}a.appendChild(b);return a}else{return b}},_modified_file_onchange:function(){var a=this.files||[this.value],c="";if(!a||a.length<=0){c=(!!this.multiple?BX.message("JSADM_FILES"):BX.message("JSADM_FILE"))}else{c="";for(var b=0;b<a.length;b++){var e=a[b].name||a[b];var d=Math.max(e.lastIndexOf("/"),e.lastIndexOf("\\"));if(d>0){e=e.substring(d+1,e.length)}c+=(c==""?"":", ")+e}}this.parentNode.firstChild.innerHTML=c},modifySelect:function(b){if(BX.type.isElementNode(b)&&b.tagName.toUpperCase()=="SELECT"){if(b.type=="select-one"){if(!BX.hasClass(b,"adm-select")){var a=BX.create("SPAN",{props:{className:"adm-select-wrap"}});BX.addClass(b,"adm-select");if(b.parentNode){b.parentNode.insertBefore(a,b)}a.appendChild(b);return a}}}return null},modifyButton:function(b){if(BX.type.isElementNode(b)&&b.tagName.toUpperCase()=="INPUT"&&(b.type=="submit"||b.type=="reset"||b.type=="button")&&!BX.hasClass(b,"adm-btn")&&!BX.hasClass(b,"adm-btn-save")&&!BX.hasClass(b,"adm-btn-green")){var a=BX.create("SPAN",{props:{className:"adm-btn-wrap "+b.className}});b.className="adm-btn";if(b.parentNode){b.parentNode.insertBefore(a,b)}a.appendChild(b);return a}else{return b}}};BX.adminMenu=function(){this.activeSection="";this.oSections={};this.items=[];this.easing={};var i=this.dest={item:null,fav:null};this.dest_cont={item:null,fav:null};this.bMinimized=false;var g=null;var e=function(j){var k=this.BXTYPEKEY;BX("fav_text_"+k).style.display="none";if(j){BX("fav_text_error_"+k).style.display="none";BX("fav_text_finish_"+k).style.display="inline-block";BX("fav_icon_finish_"+k).style.display="inline-block"}else{BX("fav_text_finish_"+k).style.display="none";BX("fav_icon_finish_"+k).style.display="none";BX("fav_text_error_"+k).style.display="inline-block"}BX.adminFav.refresh(j);this.bxprogress=false;if(!this.bxover){d.apply(this)}};var b=this._ondestdragfinish={item:BX.delegate(function(k){if(typeof k.BXMENUITEM=="undefined"||!this.items[k.BXMENUITEM]){return}g="item";this.dest[g].bxprogress=true;var m=this.items[k.BXMENUITEM].CONFIG.TEXT||k.innerText||k.textContent;if(this.items[k.BXMENUITEM].CONFIG.TITLE){var l=BX("adm-title");if(l){var j=l.textContent||l.innerText;if(j){m=j+": "+m}}}BX.adminFav.add(m,this.items[k.BXMENUITEM].CONFIG.URL,this.items[k.BXMENUITEM].CONFIG.ID,this.items[k.BXMENUITEM].CONFIG.MODULE_ID,BX.proxy(e,this.dest.item))},this),fav:BX.delegate(function(j){if(typeof j.BXMENUITEM=="undefined"||!this.items[j.BXMENUITEM]||!this.items[j.BXMENUITEM].CONFIG.FAV_ID){return}g="fav";this.dest[g].bxprogress=true;BX.adminFav.del(this.items[j.BXMENUITEM].CONFIG.FAV_ID,BX.proxy(e,this.dest.fav))},this)};var f=function(){jsDD.refreshDestArea(this)};var h=BX.delegate(function(k){if(typeof k.BXMENUITEM=="undefined"||!this.items[k.BXMENUITEM]){return}var j=!!this.items[k.BXMENUITEM].CONFIG.FAV_ID?"fav":"item";this.dest_cont[j].bxprogress=true;BX.adminFav.showDDBlock(this.dest_cont[j],BX.proxy(f,this.dest[j]));BX.bind(window,"scroll",BX.proxy(f,this.dest[j]))},this);var c=function(){this.bxover=true};var a=function(){this.bxover=false;setTimeout(BX.delegate(function(){if(!this.bxover&&!this.bxprogress){d.apply(this)}},this),100)};var d=this._ondestdragstop=BX.delegate(function(){if(!g||g==BX.proxy_context.BXTYPEKEY){var j=BX.proxy_context.BXTYPEKEY;if(g==BX.proxy_context.BXTYPEKEY){this.dest_cont.bxover=true;BX.bind(BX.proxy_context,"mouseover",c);BX.bind(BX.proxy_context,"mouseout",a);g=null}else{BX.adminFav.hideDDBlock(this.dest_cont[j],function(){BX("fav_text_"+j).style.display="inline-block";BX("fav_text_error_"+j).style.display="none";BX("fav_text_finish_"+j).style.display="none";BX("fav_icon_finish_"+j).style.display="none"});BX.unbind(window,"scroll",BX.proxy(f,this.dest[j]));BX.unbind(BX.proxy_context,"mouseover",c);BX.unbind(BX.proxy_context,"mouseout",a);BX.unbind(this.dest_cont[j],"mouseout",BX.proxy(d,BX.proxy_context))}}},this);this._onitemdragstart=function(){h(this.NODE);if(null==this.MIRROR){this.MIRROR=document.body.appendChild(BX.create("DIV",{props:{className:BX.hasClass(this.NODE,"adm-main-menu-item")?"adm-favorites-main-menu-wrap":"adm-favorites-sub-menu-wrap"},html:this.NODE.outerHTML||this.NODE.innerHTML}))}this.MIRROR.style.display="block"};this._onitemdrag=function(j,o){var l=BX.GetWindowSize();var n=parseInt(o-this.MIRROR.offsetHeight/2),m=parseInt(j-this.MIRROR.offsetWidth/2);var k=l.scrollLeft+l.innerWidth-20;if(m+this.MIRROR.offsetWidth>k){m-=m+this.MIRROR.offsetWidth-k}if(m<=l.scrollLeft){m=l.scrollLeft}this.MIRROR.style.left=m+"px";this.MIRROR.style.top=n+"px"};this._onitemdragstop=function(){this.MIRROR.style.display="none"};BX.ready(BX.delegate(this.Init,this))};BX.adminMenu.prototype.Init=function(){if(!!BX("bx_menu_panel",true)){for(var a in this.dest){this.dest[a]=BX("fav_dest_"+a);this.dest_cont[a]=BX("fav_cont_"+a);this.dest[a].BXTYPEKEY=a;this.dest[a].onbxdestdraghover=function(){BX.addClass(this,"adm-favorites-center-hover")};this.dest[a].onbxdestdraghout=function(){BX.removeClass(this,"adm-favorites-center-hover")};this.dest[a].onbxdestdragfinish=this._ondestdragfinish[a];this.dest[a].onbxdestdragstop=BX.proxy(this._ondestdragstop,this.dest[a]);jsDD.registerDest(this.dest[a])}setTimeout(BX.delegate(this.InitDeferred,this),200)}};BX.adminMenu.prototype.InitDeferred=function(){new BX.adminMenuResizer(BX("bx_menu_panel",true),!!this.bMinimized);for(var a=0;a<this.items.length;a++){this._registerItem(a)}};BX.adminMenu.prototype.showFavorites=function(a){if(!!a){BX.fireEvent(a,"mouseout")}this.GlobalMenuClick("desktop");if(BX.adminFav.lastId>0){var b=BX.findChild(BX("_global_menu_desktop"),{attr:{"data-fav-id":BX.adminFav.lastId}},true);if(!!b){BX.defer(function(){var e=BX.pos(b),c=BX.GetWindowSize(),d=c.scrollTop+c.innerHeight;if(e.bottom>d||e.top<c.scrollTop){window.scrollTo(c.scrollLeft,e.top-parseInt(c.innerHeight/2))}BX.addClass(b,"adm-submenu-current-fav");(new BX.easing({duration:1200,start:{opacity:0},finish:{opacity:100},transition:function(f){return Math.abs(Math.sin(3*Math.PI*f/2))},step:function(f){b.style.background="rgba(242,245,220,"+(f.opacity/100)+")"},complete:function(){b.style.background="#f2f5dc";var g=function(){this.style.background=null;BX.removeClass(this,"adm-submenu-current-fav");BX.unbind(this,"mouseover",g)};BX.bind(b,"mouseover",g)}})).animate()})()}}};BX.adminMenu.prototype.itemsStretchScroll=function(){BX.onCustomEvent(BX.adminMenu,"onAdminMenuItemsStretchScroll")};BX.adminMenu.prototype.setMinimizedState=function(a){this.bMinimized=a};BX.adminMenu.prototype.setActiveSection=function(a){this.activeSection=a};BX.adminMenu.prototype.setOpenedSections=function(b){var c=b.split(",");for(var a in c){this.oSections[c[a]]=true}};BX.adminMenu.prototype.GlobalMenuClick=function(a){if(a==this.activeSection){return}if(!!this.activeSection){BX.removeClass(BX("global_menu_"+this.activeSection,true),"adm-main-menu-item-active");BX.removeClass(BX("global_submenu_"+this.activeSection,true),"adm-global-submenu-active adm-global-submenu-animate")}this.activeSection=a;BX.addClass(BX("global_menu_"+this.activeSection,true),"adm-main-menu-item-active");BX.addClass(BX("global_submenu_"+this.activeSection,true),"adm-global-submenu-active");if(BX.browser.isPropertySupported("transition")){BX("global_submenu_"+a,true).style.opacity=0;setTimeout(function(){BX.addClass(BX("global_submenu_"+a,true),"adm-global-submenu-animate")},0)}BX.onCustomEvent(this,"onMenuChange")};BX.adminMenu.prototype.startAnimation=function(b,c,a){if(!this.easing[c]){this.easing[c]={icon:BX.findChild(b,{className:"adm-submenu-item-arrow-icon"},true),animation:null,opening:a,childrenCont:b.childNodes[1],startHeight:0}}if(this.easing[c].animation){this.easing[c].animation.stop()}this.easing[c].opening=a;this.easing[c].startHeight=this.easing[c].childrenCont.offsetHeight;this.easing[c].childrenCont.style.overflowY="hidden";this.easing[c].childrenCont.style.height=this.easing[c].startHeight+"px";BX.addClass(this.easing[c].childrenCont,"adm-sub-submenu-block-children-animate");if(BX.browser.isPropertySupported("transform")){BX.addClass(this.easing[c].icon,"adm-submenu-item-arrow-icon-animate")}};BX.adminMenu.prototype.endAnimation=function(d){if(!this.easing[d]){return}var a=this.easing[d].opening;var c=this.easing[d].icon;var b=this.easing[d].childrenCont;var e=BX.browser.isPropertySupported("transform");this.easing[d].animation=new BX.easing({duration:200,start:{rotation:0,height:this.easing[d].startHeight,opacity:a?0:100},finish:{rotation:a?90:-90,height:a?this.easing[d].childrenCont.scrollHeight:0,opacity:a?100:0},transition:BX.easing.transitions.linear,step:function(f){if(e!==false){c.style[e]="rotate("+f.rotation+"deg)"+(e=="WebkitTransform"?" translate3d(0, 0, 0)":"")}b.style.height=f.height+"px";b.style.opacity=f.opacity/100},complete:BX.proxy(function(){c.style.cssText="";b.style.cssText="";BX.removeClass(c,"adm-submenu-item-arrow-icon-animate");BX.removeClass(b,"adm-sub-submenu-block-children-animate");this.easing[d].animation=null},this)});this.easing[d].animation.animate()};BX.adminMenu.prototype.toggleSection=function(a,e,f){var d=!BX.hasClass(a,"adm-sub-submenu-open");this.startAnimation(a,e,d);if(d){BX.addClass(a,"adm-sub-submenu-open")}else{BX.removeClass(a,"adm-sub-submenu-open")}this.endAnimation(e);if(f<=2){this.oSections[e]=d;var b="";for(var c in this.oSections){if(this.oSections[c]==true){b+=(b!=""?",":"")+c}}BX.userOptions.save("admin_menu","pos","sections",b)}BX.onCustomEvent(this,"onMenuChange");return d};BX.adminMenu.prototype.toggleDynSection=function(e,a,c,d,f){if(a.BXLOAD){this.toggleSection(a,d,f);return}a.BXLOAD=true;a.BXLOAD_AJAX=false;var b=BX.create("SPAN",{props:{className:"adm-submenu-loading adm-sub-submenu-block"},style:{marginLeft:parseInt(e)+"px"},text:BX.message("JS_CORE_LOADING")});setTimeout(BX.proxy(function(){if(!a.BXLOAD_AJAX){a.childNodes[1].appendChild(b);this.toggleSection(a,d,f)}},this),200);BX.ajax.get("/bitrix/admin/get_menu.php",{lang:BX.message("LANGUAGE_ID"),admin_mnu_module_id:c,admin_mnu_menu_id:d},BX.proxy(function(g){a.BXLOAD_AJAX=true;g=BX.util.trim(g);if(g!=""){var h=b.parentNode?true:false;a.childNodes[1].innerHTML=g;if(!h){this.toggleSection(a,d,f)}}else{b.innerHTML=BX.message("JS_CORE_NO_DATA");if(!b.parentNode){a.childNodes[1].appendChild(b);this.toggleSection(a,d,f)}}BX.onCustomEvent(this,"onMenuChange")},this))};BX.adminMenu.prototype._item_onmouseover=function(){this.bxover=true;setTimeout(BX.proxy(BX.adminMenu.__item_onmouseover,this),500)};BX.adminMenu.prototype._item_onmouseout=function(){this.bxover=false;setTimeout(BX.proxy(BX.adminMenu.__item_onmouseout,this),50)};BX.adminMenu.prototype.__item_onmouseover=function(){if(this.bxover){var a=BX.pos(this.NODE.lastChild.lastChild);if(a.right>BX("bx_menu_panel",true).offsetWidth){var c=BX.pos(this.NODE);if(!this.MSOVERMIRROR){var b=BX.hasClass(this.NODE.parentNode,"adm-submenu-item-active");this.MSOVERMIRROR=BX("menu_mirrors_cont").appendChild(BX.create("DIV",{props:{className:"adm-submenu-longname"+(b?" adm-submenu-active-longname":"")},html:this.NODE.outerHTML||this.NODE.innerHTML}))}BX.adjust(this.MSOVERMIRROR,{style:{top:c.top+"px",left:c.left+"px",height:c.height+"px",display:"inline-block"}})}}};BX.adminMenu.prototype.__item_onmouseout=function(){if(!this.bxover&&!!this.MSOVERMIRROR){this.MSOVERMIRROR.style.display="none"}};BX.adminMenu.prototype._registerItem=function(a){this.items[a].NODE=BX(this.items[a].ID);this.items[a].NODE.BXMENUITEM=a;if(this.items[a].NODE){this.items[a].NODE.onbxdragstart=BX.delegate(this._onitemdragstart,this.items[a]);this.items[a].NODE.onbxdrag=BX.delegate(this._onitemdrag,this.items[a]);this.items[a].NODE.onbxdragstop=BX.delegate(this._onitemdragstop,this.items[a]);jsDD.registerObject(this.items[a].NODE)}var b=this.items[a].NODE.getAttribute("data-type");switch(b){case"submenu-item":BX.bind(this.items[a].NODE,"mouseover",BX.proxy(this._item_onmouseover,this.items[a]));BX.bind(this.items[a].NODE,"mouseout",BX.proxy(this._item_onmouseout,this.items[a]));BX.addCustomEvent(this,"onAdminMenuItemsStretchScroll",BX.proxy(this._item_onmouseout,this.items[a]));break}};BX.adminMenu.prototype.registerItem=function(b,a){this.items.push({ID:b,CONFIG:a});if(BX.isReady){this._registerItem(this.items.length-1)}};BX.adminMenuResizer=function(b,a){this.node=b;this.bMinimized=!!a;this.min_width=70;this.denySave=false;this.scrollLeft=0;this.pos=this.pos_final=parseInt(this.node.getAttribute("data-width"))||parseInt(BX.style(this.node,"width"));this.dragger=document.body.appendChild(BX.create("DIV",{props:{className:"adm-resize-block"+(this.bMinimized?" adm-resize-block-close":"")},events:{mouseover:function(){if(!this.bDrag){var c=this;c.bxover=true;setTimeout(function(){if(c.bxover&&!c.bDrag){BX.addClass(c,"adm-resize-block-hover")}},100)}},mouseout:function(){var c=this;c.bxover=false;setTimeout(function(){if(!c.bxover){BX.removeClass(c,"adm-resize-block-hover")}},50)}},style:{left:(this.bMinimized?10:this.pos_final-5)+"px"}}));this.minimizer=this.dragger.appendChild(BX.create("DIV",{props:{className:"adm-resizer-btn"+(this.bMinimized?" adm-resizer-btn-close":"")},style:{left:(this.bMinimized?10:this.pos_final-5)+"px"},events:{click:BX.proxy(this.Minimize,this),mousedown:BX.eventCancelBubble}}));BX.bind(this.dragger,"dblclick",BX.proxy(this.Minimize,this));this.dragger.onbxdragstart=BX.delegate(this.Start,this);this.dragger.onbxdrag=BX.delegate(this.Drag,this);this.dragger.onbxdragstop=BX.delegate(this.Save,this);jsDD.registerObject(this.dragger);BX.bind(window,"scroll",BX.delegate(this.setDraggerPos,this));BX.bind(window,"resize",BX.delegate(this.setDraggerPos,this));this.setDraggerPos()};BX.adminMenuResizer.prototype.setDraggerPos=function(){this.scrollLeft=BX.GetWindowScrollPos().scrollLeft;this.dragger.style.left=this.minimizer.style.left=((this.bMinimized?10:this.pos-5)-this.scrollLeft)+"px"};BX.adminMenuResizer.prototype.Start=function(){if(this.bMinimized){BX.removeClass(BX.firstChild(this.node),"adm-main-menu-close")}BX.setUnselectable(document.body);document.body.style.cursor="e-resize";this.dragger.bDrag=true;BX.removeClass(this.dragger,"adm-resize-block-hover")};BX.adminMenuResizer.prototype.Drag=function(a,b){if(a>=this.min_width||this.bMinimized){this.denySave=a<this.min_width;BX.removeClass(this.dragger,"adm-resize-block-close");BX.removeClass(this.minimizer,"adm-resizer-btn-close");if(this.bMinimized&&!this.denySave){BX.removeClass(this.node,"adm-left-side-wrap-close");this.bMinimized=false}this.pos=a;this.node.style.width=this.pos+"px";this.setDraggerPos()}else{if(!this.bMinimized){this.Minimize();jsDD.stopCurrentDrag()}}BX.onCustomEvent(BX.adminMenu,"onAdminMenuResize",[this.pos])};BX.adminMenuResizer.prototype.Save=function(){this.dragger.bDrag=false;if(!this.denySave&&!this.bMinimized){this.pos_final=this.pos}if(this.denySave){if(this.bMinimized){this.Maximize()}this.denySave=false}if(!this.denySave){BX.onCustomEvent(BX.adminMenu,"onAdminMenuResize",[this.pos]);BX.setSelectable(document.body);document.body.style.cursor="";if(window.onresize){window.onresize()}if(!this.bMinimized){BX.userOptions.save("admin_menu","pos","width",this.pos_final)}BX.userOptions.save("admin_menu","pos","ver",this.bMinimized?"off":"on")}};BX.adminMenuResizer.prototype.Minimize=function(){if(this.bMinimized){return this.Maximize()}BX.addClass(this.minimizer,"adm-resizer-btn-animate");BX.addClass(this.node,"adm-left-side-wrap-close");var a=new BX.easing({duration:400,start:{width:this.pos},finish:{width:15},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:BX.delegate(function(b){this.node.style.width=b.width+"px";this.dragger.style.left=this.minimizer.style.left=(b.width-5-this.scrollLeft)+"px";BX.onCustomEvent(BX.adminMenu,"onAdminMenuResize",[b.width])},this),complete:BX.delegate(function(){this.pos=this.pos_final;BX.addClass(this.minimizer,"adm-resizer-btn-close");BX.removeClass(this.minimizer,"adm-resizer-btn-animate");BX.addClass(this.dragger,"adm-resize-block-close");BX.addClass(BX.firstChild(this.node),"adm-main-menu-close");BX.onCustomEvent(BX.adminMenu,"onAdminMenuResize",[this.pos])},this)});a.animate();this.bMinimized=true;this.Save()};BX.adminMenuResizer.prototype.Maximize=function(){BX.addClass(this.minimizer,"adm-resizer-btn-animate");BX.removeClass(this.node,"adm-left-side-wrap-close");BX.removeClass(this.dragger,"adm-resize-block-close");BX.removeClass(BX.firstChild(this.node),"adm-main-menu-close");var a=new BX.easing({duration:400,start:{width:this.pos<this.min_width?this.pos:15},finish:{width:this.pos_final},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:BX.delegate(function(b){this.node.style.width=b.width+"px";this.dragger.style.left=this.minimizer.style.left=(b.width-5-this.scrollLeft)+"px";BX.onCustomEvent(BX.adminMenu,"onAdminMenuResize",[b.width])},this),complete:BX.delegate(function(){BX.removeClass(this.minimizer,"adm-resizer-btn-close");BX.removeClass(this.minimizer,"adm-resizer-btn-animate");BX.onCustomEvent(BX.adminMenu,"onAdminMenuResize",[15])},this)});a.animate();this.bMinimized=false;this.Save()};BX.adminFav={url:"/bitrix/admin/favorite_act.php",lastId:null,add:function(e,f,c,b,g){var a=BX.adminFav.url+"?act=add",d={sessid:BX.bitrix_sessid(),name:e};if(f){d.addurl=f}if(c){d.menu_id=c}if(BX.type.isFunction(b)){g=b;b=""}if(b){d.module_id=b}if(!g){g=function(h){if(h){BX.adminFav.refresh(h);alert(BX.message("JSADM_FAV_ADD_SUC"))}else{alert(BX.message("JSADM_FAV_ADD_ERR"))}}}return BX.ajax.post(a,d,g)},del:function(d,c){var a=BX.adminFav.url+"?act=delete&id="+d,b={sessid:BX.bitrix_sessid()};if(!c){c=function(e){if(e){BX.adminFav.refresh(e);alert(BX.message("JSADM_FAV_DEL_SUC"))}else{alert(BX.message("JSADM_FAV_DEL_ERR"))}}}return BX.ajax.post(a,b,c)},refresh:function(b){if(!b){return}var a=BX("_global_menu_desktop");a.innerHTML=b;BX.adminFav.setActiveItem()},setActiveItem:function(){var b=BX("menucontainer");var d=BX.findChild(b,{className:"adm-submenu-item-active"},true);if(!d){return false}var f=BX.findChild(d,{className:"adm-submenu-item-name-link"},true).href;var g=BX.findChild(d,{className:"adm-submenu-item-name-link-text"},true);var i=g.textContent||g.innerText;i=BX.util.trim(i);var c=BX("_global_menu_desktop");var e=BX.findChildren(c,{className:"adm-sub-submenu-block"},true);for(var j in e){var h=BX.findChild(e[j],{className:"adm-submenu-item-name-link"},true).href;var a=BX.findChild(e[j],{className:"adm-submenu-item-name-link-text"},true);var k=a.textContent||a.innerText;k=BX.util.trim(k);if((h==f)&&f!="javascript:void(0)"){BX.addClass(e[j],"adm-submenu-item-active");return true}if(i&&i==k){BX.addClass(e[j],"adm-submenu-item-active");return true}}return false},setLastId:function(a){BX.adminFav.lastId=a},titleLinkClick:function(b,a,c){BX.adminFav.titleLink=b;BX.adminFav.titleNode=b.parentNode;if(!b.BXFAVSET){b.BXFAVID=a;b.BXITEMSID=c;if(!!b.BXFAVID){BX.adminFav._titleLinkClickDel()}else{BX.adminFav._titleLinkClickAdd()}b.BXFAVSET=true}},_titleLinkClickAdd:function(){BX.adminFav.add(BX.adminFav.titleNode.textContent||BX.adminFav.titleNode.innerText,BX.adminHistory.pushSupported?window.location.pathname+window.location.search:BX("navchain-link").getAttribute("href"),BX.adminFav.titleLink.BXITEMSID,"",function(a){if(a){BX.adminFav.refresh(a);BX.adminFav.titleLink.BXFAVID=BX.adminFav.lastId;BX.addClass(BX.adminFav.titleLink,"adm-fav-link-active");BX.adminFav.titleLink.title=BX.message("JSADM_FAV_DEL");BX.unbind(BX.adminFav.titleLink,"click",BX.adminFav._titleLinkClickAdd);BX.bind(BX.adminFav.titleLink,"click",BX.adminFav._titleLinkClickDel)}else{alert(BX.message("JSADM_FAV_ADD_ERR"))}})},_titleLinkClickDel:function(){BX.adminFav.del(BX.adminFav.titleLink.BXFAVID,function(a){if(a){BX.adminFav.refresh(a);BX.removeClass(BX.adminFav.titleLink,"adm-fav-link-active");BX.adminFav.titleLink.removeAttribute("data-fav-id");BX.adminFav.titleLink.title=BX.message("JSADM_FAV_ADD");BX.unbind(BX.adminFav.titleLink,"click",BX.adminFav._titleLinkClickDel);BX.bind(BX.adminFav.titleLink,"click",BX.adminFav._titleLinkClickAdd)}else{alert(BX.message("JSADM_FAV_DEL_ERR"))}})},onMenuChange:function(){if(BX.adminMenu.activeSection=="desktop"){BX.userOptions.save("favorite","favorite_menu","stick","Y")}else{BX.userOptions.save("favorite","favorite_menu","stick","N")}},showDDBlock:function(e,h){if(!e.BXVISIBLE){e.style.display="";var g={property:0},b={property:-100},d="translate(",c="%,0)",a=BX.browser.isPropertySupported("transform");if(BX.browser.IsIE10()){g.property=0;b.property=33;a="right";d="";c="%"}else{if(!a||BX.browser.IsFirefox()){g.property=-33;b.property=0;a="right";d="";c="%"}}var f=new BX.easing({duration:500,start:g,finish:b,complete:h,transition:BX.easing.makeEaseInOut(BX.easing.transitions.quart),step:function(i){e.style[a]=d+i.property+c}});f.animate();e.BXVISIBLE=true}},hideDDBlock:function(e,h){if(e.BXVISIBLE){var g={property:-100},b={property:0},d="translate(",c="%,0)",a=BX.browser.isPropertySupported("transform");if(BX.browser.IsIE10()){g.property=33;b.property=-2;a="right";d="";c="%"}else{if(!a||BX.browser.IsFirefox()){g.property=0;b.property=-35;a="right";d="";c="%"}}var f=new BX.easing({duration:500,start:g,finish:b,complete:function(){e.style.display="none";if(h){h()}},transition:BX.easing.makeEaseInOut(BX.easing.transitions.quart),step:function(i){e.style[a]=d+i.property+c}});f.animate();e.BXVISIBLE=false}},closeHint:function(a){a.parentNode.style.display="none";BX.userOptions.save("favorites_menu","hint","hide","Y")}};BX.adminList=function(b,a){this.table_id=b;this.params={context_ctrl:!!(a||{}).context_ctrl,context_menu:!!(a||{}).context_menu,FIX_HEADER:!!(a||{}).FIX_HEADER,FIX_FOOTER:!!(a||{}).FIX_FOOTER};this.TABLE=null;this.CHECKBOX=[];this.CHECKBOX_DISABLED=[];this.CHECKBOX_COUNTER=null;this.num_checked=0;this.bSelectAllChecked=false;this._last_row=null;BX.ready(BX.defer(this.Init,this));BX.garbage(BX.proxy(this.Destroy,this))};BX.adminList.prototype.Init=function(){this.TABLE=BX(this.table_id);this.LAYOUT=BX(this.table_id+"_result_div");this.FOOTER=BX(this.table_id+"_footer");this.FOOTER_EDIT=BX(this.table_id+"_footer_edit");this.FORM=document.forms["form_"+this.table_id];this.CHECKBOX_COUNTER=BX(this.table_id+"_selected_count");this.BUTTON_EDIT=BX("action_edit_button");this.BUTTON_DELETE=BX("action_delete_button");if(!!this.FORM){this.ACTION_SELECTOR=this.FORM.action;this.ACTION_BUTTON=this.FORM.apply;this.ACTION_TARGET=this.FORM.action_target;BX.bind(this.ACTION_SELECTOR,"change",BX.proxy(this.UpdateCheckboxCounter,this));BX.bind(this.ACTION_TARGET,"click",BX.proxy(this.UpdateCheckboxCounter,this))}if(!!this.TABLE&&this.TABLE.tBodies[0]&&this.TABLE.tBodies[0].rows.length>0){for(var d=0;d<this.TABLE.tBodies[0].rows.length;d++){if(this.TABLE.tBodies[0].rows[d].oncontextmenu){BX.bind(this.TABLE.tBodies[0].rows[d],"contextmenu",BX.proxy(function(g){if(!this.params.context_menu){return}g=g||window.event;if(!this.params.context_ctrl&&g.ctrlKey||this.params.context_ctrl&&!g.ctrlKey||g.target&&g.target.tagName.toUpperCase()=="A"){return}BX.adminList.ShowMenu({x:g.pageX||(g.clientX+document.body.scrollLeft),y:g.pageY||(g.clientY+document.body.scrollTop)},BX.proxy_context.oncontextmenu(),BX.proxy_context);return BX.PreventDefault(g)},this))}BX.bind(this.TABLE.tBodies[0].rows[d],"click",BX.proxy(this.RowClick,this))}}var c=BX.findChildren(this.LAYOUT||this.TABLE,{tagName:"INPUT",property:{type:"checkbox"}},true);if(!!c){for(d=0;d<c.length;d++){BX.adminFormTools.modifyCheckbox(c[d]);if(c[d].name=="ID[]"){if(!c[d].disabled){BX.bind(c[d],"click",BX.proxy(this._checkboxClick,this));BX.bind(c[d].parentNode,"click",BX.proxy(this._checkboxCellClick,this));BX.bind(c[d].parentNode,"dblclick",BX.PreventDefault);this.CHECKBOX.push(c[d])}else{this.CHECKBOX_DISABLED.push(c[d])}}}}var a=BX(this.table_id+"_check_all");if(this.TABLE&&this.TABLE.tHead&&!!this.params.FIX_HEADER){if(a){a.checked=false;this.bSelectAllChecked=false;var e=a.id;BX.addCustomEvent(this.TABLE.tHead,"onFixedNodeChangeState",BX.delegate(function(g){if(g){a.setAttribute("id","");setTimeout("BX('"+e+"').checked="+this.table_id+".bSelectAllChecked",5)}else{a.checked=this.bSelectAllChecked;a.setAttribute("id",e)}},this))}BX.Fix(this.TABLE.tHead,{type:"top",limit_node:this.TABLE})}if(this.FOOTER||this.FOOTER_EDIT){BX.adminFormTools.modifyFormElements(this.FOOTER||this.FOOTER_EDIT,["*"]);if(!!this.params.FIX_FOOTER){BX.addCustomEvent(this.FOOTER||this.FOOTER_EDIT,"onFixedNodeChangeState",function(g){if(g){BX.addClass(this,"adm-list-table-footer-fixed")}else{BX.removeClass(this,"adm-list-table-footer-fixed")}})}}if(this.FOOTER_EDIT){if(!!this.params.FIX_FOOTER){BX.Fix(this.FOOTER_EDIT,{type:"bottom",limit_node:this.TABLE})}BX.bindDelegate(this.FOOTER_EDIT,"click",{property:{type:/button|submit/}},BX.adminPanel.showWait)}if(!!this.LAYOUT){var f=BX.pos(this.LAYOUT),b=BX.GetWindowSize();if(BX.adminPanel.isFixed()&&BX.adminPanel.panel){f.top-=BX.adminPanel.panel.offsetHeight}if(!!this.FOOTER_EDIT){if(!!this.CHECKBOX_DISABLED[0]){f=BX.pos(this.CHECKBOX_DISABLED[0].parentNode)}window.scrollTo(b.scrollLeft,f.top-parseInt(b.innerHeight/2))}else{if(f.top<b.scrollTop){window.scrollTo(b.scrollLeft,f.top)}}}this.UpdateCheckboxCounter()};BX.adminList.prototype.ReInit=function(){BX.defer(this.Init,this)()};BX.adminList.prototype.GetAdminList=function(a,b){a=BX.util.remove_url_param(a,["mode","table_id"]);a+=(a.indexOf("?")>=0?"&":"?")+"mode=list&table_id="+BX.util.urlencode(this.table_id);BX.ajax({method:"GET",dataType:"html",url:a,onsuccess:BX.delegate(function(c){if(c.length>0){BX.closeWait(this.LAYOUT);BX.onCustomEvent(window,"onAdminListLoaded");this._GetAdminList(c);if(b&&BX.type.isFunction(b)){b(a)}}},this),onfailure:function(){BX.debug("GetAdminList",arguments)}})};BX.adminList.prototype._GetAdminList=function(a){BX.adminPanel.closeWait();this.Destroy();this.LAYOUT.innerHTML=a;this.ReInit();BX.adminChain.addItems(this.table_id+"_navchain_div")};BX.adminList.prototype.PostAdminList=function(a){a=BX.util.remove_url_param(a,["mode","table_id"]);a+=(a.indexOf("?")>=0?"&":"?")+"mode=frame&table_id="+BX.util.urlencode(this.table_id);try{this.FORM.action.parentNode.removeChild(this.FORM.action)}catch(b){}this.FORM.action=a;BX.submit(this.FORM)};BX.adminList.prototype.UpdateCheckboxCounter=function(){if(!this.CHECKBOX_COUNTER){return}var a=this.num_checked>0||this.ACTION_TARGET&&this.ACTION_TARGET.checked;if(!a){if(!!this.FOOTER&&!!this.params.FIX_FOOTER){BX.UnFix(this.FOOTER)}BX.removeClass(this.CHECKBOX_COUNTER,"adm-table-counter-visible");this.CHECKBOX_COUNTER.lastChild.innerHTML="0";if(!!this.ACTION_BUTTON){this.ACTION_BUTTON.disabled=true}}else{if(!!this.FOOTER&&!!this.params.FIX_FOOTER){BX.Fix(this.FOOTER,{type:"bottom",limit_node:this.TABLE.tBodies[0]})}BX.addClass(this.CHECKBOX_COUNTER,"adm-table-counter-visible");this.CHECKBOX_COUNTER.lastChild.innerHTML=this.ACTION_TARGET&&this.ACTION_TARGET.checked?BX.message("JSADM_LIST_SELECTEDALL"):this.num_checked;if(!!this.ACTION_BUTTON){this.ACTION_BUTTON.disabled=this.ACTION_SELECTOR.selectedIndex<=0}}};BX.adminList.prototype.Sort=function(c,d,b){if(d==true){var f=null,a=false;if(b.length>0){f=b[0]}if(!f){f=window.event}if(f){a=f.ctrlKey}c+=(a?"desc":"asc")}this.GetAdminList(c)};BX.adminList.prototype.RowClick=function(f){f=f||window.event;if(f.button!=0){return true}if(f.ctrlKey||f.metaKey||f.shiftKey&&!this._last_row){var h=BX.proxy_context.cells[0].firstChild;h.checked=!h.checked;this.SelectRow(h,h.checked);this.UpdateCheckboxCounter();this.EnableActions()}if(f.shiftKey){if(!this._last_row){this._last_row=BX.proxy_context.parentNode.rows[0]}var a=this._last_row.parentNode,g=Math.min(this._last_row.rowIndex,BX.proxy_context.rowIndex),d=Math.max(this._last_row.rowIndex,BX.proxy_context.rowIndex);for(var b=g;b<=d;b++){h=a.rows[b-1].cells[0].firstChild;if(!h.checked){h.checked=true;this.SelectRow(h,h.checked)}}this.UpdateCheckboxCounter();this.EnableActions();return BX.PreventDefault(f)}};BX.adminList.prototype._checkboxClick=function(a){if(a.shiftKey||a.ctrlKey||a.metaKey){return true}this.SelectRow(BX.proxy_context,BX.proxy_context.checked);this.UpdateCheckboxCounter();this.EnableActions();return BX.eventCancelBubble(a)};BX.adminList.prototype._checkboxCellClick=function(a){if(a.shiftKey||a.ctrlKey||a.metaKey){return true}var b=BX.proxy_context.firstChild;b.checked=!b.checked;this.SelectRow(b,b.checked);this.UpdateCheckboxCounter();this.EnableActions();return BX.PreventDefault(a)};BX.adminList.prototype.SelectRow=function(b,a){if(b.tagName.toUpperCase()!="TR"){if(!b.BXROW){b.BXROW=BX.findParent(b,{tag:"TR"})}if(!!b.BXROW){this.SelectRow(b.BXROW,a)}}else{if(a){BX.addClass(b,"adm-table-row-active")}else{BX.removeClass(b,"adm-table-row-active")}this._last_row=b;this.num_checked+=a?1:-1}};BX.adminList.prototype.SelectAllRows=function(b){this.bSelectAllChecked=!!b.checked;for(var a=0;a<this.CHECKBOX.length;a++){if(this.CHECKBOX[a].checked!=this.bSelectAllChecked&&!this.CHECKBOX[a].disabled){this.CHECKBOX[a].checked=this.bSelectAllChecked;this.SelectRow(this.CHECKBOX[a],this.bSelectAllChecked)}}this.UpdateCheckboxCounter();this.EnableActions()};BX.adminList.prototype.IsActionEnabled=function(a){if(a=="edit"){return !(this.ACTION_TARGET&&this.ACTION_TARGET.checked)&&(this.num_checked>0)}else{return(this.ACTION_TARGET&&this.ACTION_TARGET.checked)||(this.num_checked>0)}};BX.adminList.prototype.EnableActions=function(){if(!!this.BUTTON_EDIT){if(this.IsActionEnabled("edit")){BX.removeClass(this.BUTTON_EDIT,"adm-edit-disable")}else{BX.addClass(this.BUTTON_EDIT,"adm-edit-disable")}}if(!!this.BUTTON_DELETE){if(this.IsActionEnabled("delete")){BX.removeClass(this.BUTTON_DELETE,"adm-edit-disable")}else{BX.addClass(this.BUTTON_DELETE,"adm-edit-disable")}}};BX.adminList.prototype.Destroy=function(){this.CHECKBOX=[];this.CHECKBOX_DISABLED=[];if(BX.PopupMenu.currentItem&&BX.PopupMenu.currentItem.popupWindow.isShown()){BX.PopupMenu.currentItem.popupWindow.close()}if(this.TABLE&&this.TABLE.tHead){BX.UnFix(this.TABLE.tHead)}if(this.FOOTER){BX.UnFix(this.FOOTER)}if(this.FOOTER_EDIT){BX.UnFix(this.FOOTER_EDIT)}this._last_row=null;this.num_checked=0};BX.adminList.prototype.ShowSettings=function(a){(new BX.CDialog({content_url:a,resizable:true,height:475,width:560})).Show()};BX.adminList.prototype.SaveSettings=function(d){var b="",j="",g="",c;var f=document.list_settings.selected_columns;var e=f.length;for(var h=0;h<e;h++){b+=(b!=""?",":"")+f[h].value}f=document.list_settings.order_field;if(f){j=f[f.selectedIndex].value}f=document.list_settings.order_direction;if(f){g=f[f.selectedIndex].value}f=document.list_settings.nav_page_size;c=f[f.selectedIndex].value;var k=(document.list_settings.set_default&&document.list_settings.set_default.checked);BX.userOptions.save("list",this.table_id,"columns",b,k);BX.userOptions.save("list",this.table_id,"by",j,k);BX.userOptions.save("list",this.table_id,"order",g,k);BX.userOptions.save("list",this.table_id,"page_size",c,k);var a=window.location.href;BX.WindowManager.Get().showWait(d);BX.userOptions.send(BX.delegate(function(){this.GetAdminList(a,function(){BX.WindowManager.Get().closeWait(d);BX.WindowManager.Get().Close()})},this))};BX.adminList.prototype.DeleteSettings=function(b){BX.showWait();var a=window.location.href;BX.userOptions.del("list",this.table_id,b,BX.delegate(function(){BX.closeWait();this.GetAdminList(a,function(){BX.WindowManager.Get().Close()})},this))};BX.adminList._onpopupmenushow=function(){BX.addClass(this,"adm-list-row-active")};BX.adminList._onpopupmenuclose=function(){BX.removeClass(this,"adm-list-row-active")};BX.adminList.ShowMenu=function(a,c,b){if(!!c&&c.length>0){if(!!b){BX.addCustomEvent(a,"onAdminMenuShow",BX.proxy(BX.adminList._onpopupmenushow,b));BX.addCustomEvent(a,"onAdminMenuClose",BX.proxy(BX.adminList._onpopupmenuclose,b))}BX.adminShowMenu(a,c,{active_class:"adm-list-table-popup-active"})}};BX.adminTabControl=function(b,c,a){this.name=b;this.unique_name=c;this.aTabs=a;this.bInited=false;this.bFixed={top:true,bottom:true};this.bExpandTabs=false;this.aTabsDisabled={};this.bPublicMode=false;this.PreInit()};BX.adminTabControl.prototype.PreInit=function(f){for(var d=0;d<this.aTabs.length;d++){this.aTabs[d].CONTENT=BX(this.aTabs[d]["DIV"]);var e=BX(this.aTabs[d]["DIV"]+"_edit_table");if(!!e){for(var b=0;b<e.tBodies.length;b++){var g=e.tBodies[b].rows.length;for(var c=0;c<g;c++){if(e.tBodies[b].rows[c].cells.length>1){BX.addClass(e.tBodies[b].rows[c].cells[0],"adm-detail-content-cell-l");BX.addClass(e.tBodies[b].rows[c].cells[1],"adm-detail-content-cell-r")}}}this.aTabs[d].EDIT_TABLE=e;this.aTabs[d].CONTENT_BLOCK=e.parentNode;var a=BX.adminFormTools.modifyFormElements(e)}}if(!f){BX.ready(BX.defer(this.Init,this))}};BX.adminTabControl.prototype.Init=function(){if(this.aTabs&&this.aTabs.length>0){var a=this.TABS_BLOCK=BX(this.name+"_tabs");if(!!a){var b=BX(this.name+"_settings_btn");a.appendChild(BX.create("DIV",{props:{className:"adm-detail-pin-btn-tabs",title:BX.message("JSADM_PIN_OFF")},attrs:{onclick:this.name+".ToggleFix('top')"}}));BX.addCustomEvent(a,"onFixedNodeChangeState",function(d){if(d){BX.addClass(a,"adm-detail-tabs-block-fixed")}else{BX.removeClass(a,"adm-detail-tabs-block-fixed")}if(!!b&&BX.hasClass(b,"bx-settings-btn-active")){BX.onCustomEvent(b,"onChangeNodePosition")}});if(this.bFixed.top){BX.Fix(a,{type:"top",limit_node:a.parentNode})}else{BX.addClass(a,"adm-detail-tabs-block-pin");a.lastChild.title=BX.message("JSADM_PIN_ON")}}}var c=BX(this.name+"_buttons_div");if(!!c){if(c.firstChild){if(BX.util.trim(c.firstChild.innerHTML).length<=0){if(!BX.hasClass(c.firstChild,"adm-detail-content-btns-empty")){BX.addClass(c.firstChild,"adm-detail-content-btns-empty")}}else{c.firstChild.insertBefore(BX.create("DIV",{props:{className:"adm-detail-pin-btn",title:BX.message("JSADM_PIN_OFF")},attrs:{onclick:this.name+".ToggleFix('bottom')"}}),c.firstChild.firstChild);BX.addCustomEvent(c,"onFixedNodeChangeState",function(d){if(d){BX.addClass(c,"adm-detail-content-btns-fixed")}else{BX.removeClass(c,"adm-detail-content-btns-fixed")}});if(this.bFixed.bottom){BX.Fix(c,{type:"bottom",limit_node:c.parentNode})}else{BX.addClass(c,"adm-detail-content-btns-pin");c.firstChild.firstChild.title=BX.message("JSADM_PIN_ON")}}BX.bindDelegate(c,"click",{property:{type:/button|submit/}},BX.adminPanel.showWait)}}this.bInited=true};BX.adminTabControl.prototype.setPublicMode=function(a){this.bPublicMode=!!a;if(this.bPublicMode){var b=this.name;BX.addCustomEvent(BX.WindowManager.Get(),"onWindowClose",function(){window[b]=null})}};BX.adminTabControl.prototype.ToggleFix=function(a,b){if(!this.bInited){this.bFixed[a]=typeof b=="undefined"?!this.bFixed[a]:!!b;return}if(typeof b!="undefined"){this.bFixed[a]=!b}switch(a){case"bottom":var c=BX(this.name+"_buttons_div");if(!!c){if(this.bFixed[a]){BX.addClass(c,"adm-detail-content-btns-pin");c.firstChild.firstChild.title=BX.message("JSADM_PIN_ON");BX.UnFix(c)}else{BX.removeClass(c,"adm-detail-content-btns-pin");c.firstChild.firstChild.title=BX.message("JSADM_PIN_OFF");BX.Fix(c,{type:"bottom",limit_node:c.parentNode})}}break;case"top":if(!!this.TABS_BLOCK){if(this.bFixed[a]){BX.addClass(this.TABS_BLOCK,"adm-detail-tabs-block-pin");this.TABS_BLOCK.lastChild.title=BX.message("JSADM_PIN_ON");BX.UnFix(this.TABS_BLOCK)}else{BX.removeClass(this.TABS_BLOCK,"adm-detail-tabs-block-pin");this.TABS_BLOCK.lastChild.title=BX.message("JSADM_PIN_OFF");BX.Fix(this.TABS_BLOCK,{type:"top",limit_node:this.TABS_BLOCK.parentNode})}}break}this.bFixed[a]=!this.bFixed[a];BX.userOptions.save("edit","admin_tabs","fix_"+a,(this.bFixed[a]?"on":"off"))};BX.adminTabControl.prototype.SelectTab=function(f){if(!this.bInited){setTimeout("window."+this.name+".SelectTab('"+BX.util.jsencode(f)+"')",50)}else{if(!this.aTabsDisabled[f]){var c=BX(f);if(c.style.display!="none"){return}var n=0;var a=0;var h=40;for(var g=0,e=this.aTabs.length;g<e;g++){var d=BX(this.aTabs[g]["DIV"]);if(d.style.display!="none"){n=this.aTabs[g].CONTENT_BLOCK.offsetHeight-h;this.ShowTab(this.aTabs[g]["DIV"],false);d.style.display="none";break}}this.ShowTab(f,true);c.style.display="block";BX(this.name+"_active_tab").value=f;var b=null;for(g=0,e=this.aTabs.length;g<e;g++){if(this.aTabs[g]["DIV"]==f){this.aTabs[g]["_ACTIVE"]=true;if(this.aTabs[g]["ONSELECT"]){BX.evalGlobal(this.aTabs[g]["ONSELECT"])}if(!this.bPublicMode){b=this.aTabs[g];var l=this.aTabs[g].CONTENT_BLOCK;a=l.offsetHeight-h;if(n>0){l.style.height=n+"px";l.style.overflowY="hidden";this.aTabs[g].EDIT_TABLE.style.opacity=0}}break}}if(!!this.TABS_BLOCK){if(BX.hasClass(this.TABS_BLOCK,"adm-detail-tabs-block-fixed")){var k=BX.pos(c),m=BX.GetWindowScrollPos();window.scrollTo(m.scrollLeft,k.top-this.TABS_BLOCK.offsetHeight-parseInt(this.TABS_BLOCK.style.top))}}if(!this.bPublicMode&&n>0&&a>0&&b){var j=new BX.easing({duration:500,start:{height:n,opacity:0},finish:{height:a,opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:BX.proxy(function(i){this.CONTENT_BLOCK.style.height=i.height+"px";this.EDIT_TABLE.style.opacity=i.opacity/100;BX.onCustomEvent("onAdminTabsChange")},b),complete:BX.proxy(function(){this.CONTENT_BLOCK.style.height="auto";this.CONTENT_BLOCK.style.overflowY="visible";BX.onCustomEvent("onAdminTabsChange")},b)});j.animate()}else{BX.onCustomEvent("onAdminTabsChange")}}}};BX.adminTabControl.prototype.ShowTab=function(a,b){if(b){BX.addClass(BX("tab_cont_"+a),"adm-detail-tab-active")}else{BX.removeClass(BX("tab_cont_"+a),"adm-detail-tab-active")}};BX.adminTabControl.prototype.ShowDisabledTab=function(a,c){var b=BX("tab_cont_"+a);if(c){BX.addClass(b,"adm-detail-tab-disable")}else{BX.removeClass(b,"adm-detail-tab-disable")}};BX.adminTabControl.prototype.NextTab=function(){var b=BX(this.name+"_active_tab").value;var c="";for(var a=0;a<this.aTabs.length;a++){if(b==this.aTabs[a]["DIV"]){if(a>=(this.aTabs.length-1)){c=this.aTabs[0]}else{c=this.aTabs[a+1]}}}if(c.DIV){this.SelectTab(c.DIV)}};BX.adminTabControl.prototype.ToggleTabs=function(){this.bExpandTabs=!this.bExpandTabs;var b=BX(this.name+"_expand_link");b.title=(this.bExpandTabs?BX.message("JSADM_TABS_COLLAPSE"):BX.message("JSADM_TABS_EXPAND"));if(this.bExpandTabs){BX.addClass(b,"adm-detail-title-setting-active");this.ToggleFix("top",false)}else{BX.removeClass(b,"adm-detail-title-setting-active");this.ToggleFix("top",true)}for(var d=0;d<this.aTabs.length;d++){var c=this.aTabs[d]["DIV"];this.ShowTab(c,false);this.ShowDisabledTab(c,(this.bExpandTabs||this.aTabsDisabled[c]));var e=BX(c);e.style.display=(this.bExpandTabs&&!this.aTabsDisabled[c]?"block":"none")}if(!this.bExpandTabs){this.ShowTab(this.aTabs[0]["DIV"],true);e=document.getElementById(this.aTabs[0]["DIV"]);e.style.display="block"}BX.userOptions.save("edit",this.unique_name,"expand",(this.bExpandTabs?"on":"off"));BX.onCustomEvent("OnToggleTabs");BX.onCustomEvent("onAdminTabsChange")};BX.adminTabControl.prototype.DisableTab=function(a){this.aTabsDisabled[a]=true;this.ShowDisabledTab(a,true);if(this.bExpandTabs){var b=BX(a);b.style.display="none"}};BX.adminTabControl.prototype.EnableTab=function(a){this.aTabsDisabled[a]=false;this.ShowDisabledTab(a,this.bExpandTabs);if(this.bExpandTabs){var b=BX(a);b.style.display="block"}};BX.adminTabControl.prototype.ShowWarnings=function(c,h){var b=document.forms[c];if(!b){return}for(var g in h){var j=b.elements[h[g]["name"]];if(!j){continue}var k=(j.type?j.type.toLowerCase():"");var a=false;if(j.length>1&&k!="select-one"&&k!="select-multiple"){j=j[0];a=true}if(k=="textarea"||k=="select-multiple"){a=true}var d=j.parentNode;var f;if(a){f=d.insertBefore(new Image(),j);d.insertBefore(document.createElement("BR"),j)}else{f=d.insertBefore(new Image(),j.nextSibling);f.hspace=2;f.vspace=2;f.style.verticalAlign="middle"}f.src="/bitrix/panel/main/images_old/icon_warn.gif";f.title=h[g]["title"]}};BX.adminTabControl.prototype.ShowSettings=function(a){(new BX.CDialog({content_url:a,resizable:true,height:605,width:560})).Show()};BX.adminTabControl.prototype.CloseSettings=function(){BX.WindowManager.Get().Close()};BX.adminTabControl.prototype.SaveSettings=function(c){var a="",p="";var b;var f=BX("selected_tabs");if(f){var g=f.length;for(var l=0;l<g;l++){p=f[l].value+"--#--"+f[l].text;b=BX("selected_fields["+f[l].value+"]");if(b){var d=b.length;for(var h=0;h<d;h++){p+="--,--"+b[h].value+"--#--"+jsUtils.trim(b[h].text)}}a+=p+"--;--"}}var o=(document.form_settings.set_default&&document.form_settings.set_default.checked);var e="";e+="&p[0][c]=form";e+="&p[0][n]="+BX.util.urlencode(this.name);if(o){e+="&p[0][d]=Y"}e+="&p[0][v][tabs]="+BX.util.urlencode(a);var m="/bitrix/admin/user_options.php?lang="+BX.message("LANGUAGE_ID")+"&sessid="+BX.bitrix_sessid();m+="&action=delete&c=form&n="+this.name+"_disabled";BX.WindowManager.Get().showWait(c);BX.ajax.post(m,e,function(){BX.WindowManager.Get().closeWait(c);BX.WindowManager.Get().Close();BX.reload()})};BX.adminTabControl.prototype.DeleteSettings=function(a){BX.showWait();BX.userOptions.del("form",this.name,a,function(){BX.reload()})};BX.adminTabControl.prototype.DisableSettings=function(){var b=new JCHttpRequest;b.Action=function(){BX.reload()};var a="";a+="&p[0][c]=form";a+="&p[0][n]="+encodeURIComponent(this.name+"_disabled");a+="&p[0][v][disabled]=Y";b.Send("/bitrix/admin/user_options.php?lang="+phpVars.LANGUAGE_ID+a+"&sessid="+phpVars.bitrix_sessid)};BX.adminTabControl.prototype.EnableSettings=function(){var b=new JCHttpRequest;b.Action=function(){BX.reload()};var a="";a+="&c=form";a+="&n="+encodeURIComponent(this.name)+"_disabled";a+="&action=delete";b.Send("/bitrix/admin/user_options.php?lang="+phpVars.LANGUAGE_ID+a+"&sessid="+phpVars.bitrix_sessid)};BX.adminViewTabControl=function(a){this.aTabs=a;this.bPublicMode=false;BX.ready(BX.delegate(this.Init,this))};BX.adminViewTabControl.prototype.setPublicMode=function(a){this.bPublicMode=!!a};BX.adminViewTabControl.prototype.SelectTab=function(e){var b=BX(e);if(b.style.display!="none"){return}var n=0;var h=41;for(var f in this.aTabs){var g=BX(this.aTabs[f]["DIV"]);if(g.style.display!="none"){var c=BX("view_tab_"+this.aTabs[f]["DIV"]);BX.removeClass(c,"adm-detail-subtab-active");var m=BX.findChild(g,{className:"adm-detail-content-item-block-view-tab"});if(m){n=m.offsetHeight-h}g.style.display="none";break}}var j=BX("view_tab_"+e);BX.addClass(j,"adm-detail-subtab-active");b.style.display="block";var a=0;var l=BX.findChild(b,{className:"adm-detail-content-item-block-view-tab"});var d=null;if(l){a=l.offsetHeight-h;if(n>0){l.style.height=n+"px";l.style.overflowY="hidden";d=BX.findChild(l,{tagName:"table"});if(d){d.style.opacity=0}}}for(f in this.aTabs){if(this.aTabs[f]["DIV"]==e){if(this.aTabs[f]["ONSELECT"]){BX.evalGlobal(this.aTabs[f]["ONSELECT"])}break}}if(n>0&&a>0&&l){var k=new BX.easing({duration:500,start:{height:n,opacity:0},finish:{height:a,opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:BX.proxy(function(i){this.style.height=i.height+"px";if(d){d.style.opacity=i.opacity/100}BX.onCustomEvent("onAdminTabsChange")},l),complete:BX.proxy(function(){this.style.height="auto";this.style.overflowY="visible";BX.onCustomEvent("onAdminTabsChange")},l)});k.animate()}else{BX.onCustomEvent("onAdminTabsChange")}};BX.adminViewTabControl.prototype.DisableTab=function(a){if(this.aTabs.length<=0){return}var b=null;var d=false;for(var c in this.aTabs){if(this.aTabs[c]["DIV"]==a){if(c>0){b=parseInt(c)-1;while(b>=0){if(BX("view_tab_"+this.aTabs[b]["DIV"]).style.display!="none"){this.SelectTab(this.aTabs[b]["DIV"]);d=true;break}b--}}if(!d){b=parseInt(c)+1;while(b<(this.aTabs.length-1)){if(BX("view_tab_"+this.aTabs[b]["DIV"]).style.display!="none"){this.SelectTab(this.aTabs[b]["DIV"]);d=true;break}b++}}if(!d){BX(a).style.display="none"}BX("view_tab_"+this.aTabs[c]["DIV"]).style.display="none";break}}};BX.adminViewTabControl.prototype.EnableTab=function(a){for(var b in this.aTabs){if(this.aTabs[b]["DIV"]==a){BX("view_tab_"+this.aTabs[b]["DIV"]).style.display="inline-block";this.SelectTab(this.aTabs[b]["DIV"]);break}}};BX.adminViewTabControl.prototype.ReplaceAnchor=function(a){};BX.adminViewTabControl.prototype.RebuildTabs=function(){};BX.adminViewTabControl.prototype.Init=function(){if(this.aTabs.length==0){return}};BX.adminHistory=function(){BX.bind(window,"popstate",BX.proxy(this._get,this));this.bStart=true;this.pushSupported=true;this.state={};this.startState=null;this.disabled=false};BX.adminHistory.pushSupported=false;BX.adminHistory.disable=BX.adminHistory.prototype.disable=function(){BX.adminHistory.disabled=true};BX.adminHistory.enable=BX.adminHistory.prototype.enable=function(){BX.adminHistory.disabled=false};BX.adminHistory.put=function(b,d,a){if(BX.adminHistory.disabled){return}var c=BX("navchain-link");if(c){if(b.indexOf("&amp;")>0){b=BX.util.htmlspecialcharsback(b)}if(BX.type.isArray(a)){b=BX.util.remove_url_param(b,a)}c.href=b;if(b!=window.location.href){BX.addClass(c,"navchain-link-visible")}else{BX.removeClass(c,"navchain-link-visible")}}};BX.adminHistory.prototype.put=function(c,e,a){if(BX.adminHistory.disabled){return}if(c.indexOf("&amp;")>0){c=BX.util.htmlspecialcharsback(c)}if(BX.type.isArray(a)){c=BX.util.remove_url_param(c,a)}c=BX.util.remove_url_param(c,"admin_history");var d={url:c,callback:e};var b=Math.random();this.state[b]=d;if(this.bStart){this.startState=b;this.bStart=false}else{history.pushState(b,"",c)}};BX.adminHistory.prototype._get=function(b){b=b||window.event||{state:null};var a=b.state;if(a===null){a=this.startState}if(a&&this.state[a]){if(this.state[a].callback){this.state[a].callback(this.state[a].url+(this.state[a].url.indexOf("?")>0?"&":"?")+"admin_history=Y")}else{window.location.href=this.state[a].url}}};BX.Fix=function(a,b){if(!a.BXFIXER){if(a.tagName.toUpperCase()=="THEAD"){a.BXFIXER=new BX.CFixerTHead(a,b)}else{a.BXFIXER=new BX.CFixer(a,b)}}a.BXFIXER.Start()};BX.UnFix=function(a){if(!!a&&!!a.BXFIXER){a.BXFIXER.Stop()}};BX.CFixer=function(a,b){this.node=a;this.params=b||{type:"top"};this.pos={};this.limit=-1;this.position_top=null;this.position_bottom=null;this.position_right=null;this.bStarted=false;this.bFixed=false;this.gutter=null};BX.CFixer.prototype.Start=function(){if(this.bStarted){return}this.pos=BX.pos(this.node);BX.bind(window,"scroll",BX.proxy(this._scroll_listener,this));BX.bind(window,"resize",BX.proxy(this._scroll_listener,this));BX.bind(window,"resize",BX.proxy(this._recalc_pos,this));BX.addCustomEvent("onAdminFilterToggleRow",BX.proxy(this._recalc_pos,this));BX.addCustomEvent("onAdminFilterToggleRow",BX.proxy(this._scroll_listener,this));BX.addCustomEvent("onAdminPanelFix",BX.defer(this._scroll_listener,this));BX.addCustomEvent("onAdminPanelChange",BX.defer(this._scroll_listener,this));BX.addCustomEvent("onAdminTabsChange",BX.defer(this._recalc_pos,this));BX.addCustomEvent(BX.adminMenu,"onAdminMenuResize",BX.proxy(this._recalc_pos,this));this._scroll_listener();this.bStarted=true};BX.CFixer.prototype.Stop=function(){if(!this.bStarted){return}this._UnFix();BX.unbind(window,"scroll",BX.proxy(this._scroll_listener,this));BX.unbind(window,"resize",BX.proxy(this._scroll_listener,this));BX.unbind(window,"resize",BX.proxy(this._recalc_pos,this));BX.removeCustomEvent("onAdminFilterToggleRow",BX.proxy(this._recalc_pos,this));BX.removeCustomEvent("onAdminFilterToggleRow",BX.proxy(this._scroll_listener,this));BX.removeCustomEvent("onAdminPanelFix",BX.defer(this._scroll_listener,this));BX.removeCustomEvent("onAdminTabsChange",BX.defer(this._recalc_pos,this));BX.removeCustomEvent("onAdminPanelChange",BX.defer(this._scroll_listener,this));BX.removeCustomEvent(BX.adminMenu,"onAdminMenuResize",BX.proxy(this._recalc_pos,this));this.bStarted=false};BX.CFixer.prototype._recalc_pos=function(){this.pos=BX.pos(this.gutter||this.node);var a=BX.pos(this.node);if(this.bFixed){if(this.params.type=="top"||this.params.type=="bottom"){this.node.style.width=this.pos.width+"px";this.gutter.style.height=a.height+"px"}}this._scroll_listener()};BX.CFixer.prototype._Fix=function(){if(!this.bFixed){this.pos=BX.pos(this.gutter||this.node);if(!this.gutter){this.gutter=this.node.parentNode.insertBefore(BX.create(this.node.tagName,{style:{display:"block",height:this.pos.height+"px"},props:{className:this.node.className}}),this.node)}this._w=this.node.style.width;this.node.style.width=this.pos.width+"px";BX.addClass(this.node,"bx-fixed-"+this.params.type);if(this["position_"+this.params.type]!==null){this.node.style[this.params.type]=this["position_"+this.params.type]+"px"}this.bFixed=true}};BX.CFixer.prototype._UnFix=function(a){if(this.bFixed){this.node.style.width=this._w;BX.removeClass(this.node,"bx-fixed-"+this.params.type);this.node.style[this.params.type]=null;this.bFixed=false;if(!a){if(this.gutter&&this.gutter.parentNode){this.gutter.parentNode.removeChild(this.gutter)}this.gutter=null;this._check_scroll(this.pos.left,this.pos.top)}}};BX.CFixer.prototype._ReFix=function(){if(this.bFixed){this._UnFix(true);BX.defer(this._Fix,this)()}};BX.CFixer.prototype._scroll_listener=function(){var c=BX.GetWindowScrollPos(),b=this.bFixed,a;if(!BX.isNodeInDom(this.node)){return this.Stop()}var e=b?this.pos:BX.pos(this.node);if(this.params.limit_node){var d=BX.pos(this.params.limit_node);switch(this.params.type){case"top":this.limit=d.bottom-this.pos.height;break;case"bottom":this.limit=d.top+this.pos.height;break;case"right":this.limit=d.right+this.node.offsetWidth;break}}if(!BX.isNodeHidden(this.node)){switch(this.params.type){case"top":this.position_top=BX.adminPanel.isFixed()?BX.adminPanel.panel.offsetHeight:0;if(this.limit>0&&c.scrollTop+this.position_top>this.limit){this._UnFix()}else{if(!this.bFixed&&c.scrollTop+this.position_top>=e.top){this._Fix()}else{if(this.bFixed&&c.scrollTop+this.position_top<e.top){this._UnFix()}}}break;case"bottom":a=BX.GetWindowInnerSize();c.scrollBottom=c.scrollTop+a.innerHeight;if(this.limit>0&&c.scrollBottom<this.limit){this._UnFix()}else{if(!this.bFixed&&c.scrollBottom<e.bottom){this._Fix()}else{if(this.bFixed&&c.scrollBottom>=e.bottom){this._UnFix()}}}break;case"right":a=BX.GetWindowInnerSize();c.scrollRight=c.scrollLeft+a.innerWidth-15;if(this.limit>0&&c.scrollRight<this.limit){this._UnFix()}else{if(!this.bFixed&&c.scrollRight<e.right){this._Fix()}else{if(this.bFixed&&c.scrollRight>=e.right){this._UnFix()}}}break}}else{if(this.bFixed){this._UnFix()}}if(this.bFixed){this._check_scroll(c.scrollLeft,c.scrollTop)}else{this._check_scroll(this.pos.left,this.pos.top)}if(b!=this.bFixed){BX.onCustomEvent(this.node,"onFixedNodeChangeState",[this.bFixed])}};BX.CFixer.prototype._check_scroll=function(b,a){if(this.params.type=="top"||this.params.type=="bottom"){this.node.style.left=(this.pos.left-b)+"px"}else{this.node.style.top=(this.pos.top-a)+"px"}if(this.bFixed&&this["position_"+this.params.type]!==null){this.node.style[this.params.type]=this["position_"+this.params.type]+"px"}};BX.CFixerTHead=function(){BX.CFixerTHead.superclass.constructor.apply(this,arguments);this.mirror=null;this.mirror_thead=null};BX.extend(BX.CFixerTHead,BX.CFixer);BX.CFixerTHead.prototype._Fix=function(){if(!this.bFixed){if(!this.mirror){this.pos=BX.pos(this.node);var b=BX.GetWindowScrollPos();this.mirror_thead=BX.clone(this.node);this.mirror=document.body.appendChild(BX.create("DIV",{style:{left:(this.pos.left-b.scrollLeft)+"px"},props:{className:"bx-fixed-"+this.params.type+" adm-list-table-fixed"},children:[BX.create("TABLE",{props:{className:this.node.parentNode.className},style:{width:this.node.parentNode.offsetWidth+"px"},children:[this.mirror_thead]})]}));for(var a=0;a<this.node.rows[0].cells.length;a++){this.mirror_thead.rows[0].cells[a].appendChild(BX.create("SPAN",{style:{cssFloat:"left",height:"1px"},html:'<img src="/bitrix/images/1.gif" style="height: 0; width: '+(this.node.rows[0].cells[a].offsetWidth-4)+'px;">'}));this.mirror_thead.rows[0].cells[a].style.width=this.node.rows[0].cells[a].offsetWidth+"px"}}this.mirror.style.display="block";this.mirror.style.top=(this.position_top!==null?this.position_top:0)+"px";this.bFixed=true}};BX.CFixerTHead.prototype._UnFix=function(){if(this.bFixed){if(!!this.mirror){this._clear_mirror()}this.bFixed=false}};BX.CFixerTHead.prototype._recalc_pos=function(){this.pos=BX.pos(this.node);if(this.bFixed&&(this.params.type=="top"||this.params.type=="bottom")){this.mirror.firstChild.style.width=this.pos.width+"px"}this._scroll_listener()};BX.CFixerTHead.prototype._clear_mirror=function(){if(!!this.mirror){this.mirror.parentNode.removeChild(this.mirror)}this.mirror=null;this.mirror_thead=null};BX.CFixerTHead.prototype._check_scroll=function(a){if(!!this.mirror){this.mirror.style.left=(this.pos.left-a)+"px";if(this.bFixed&&this["position_"+this.params.type]!==null){this.mirror.style[this.params.type]=this["position_"+this.params.type]+"px"}}};BX.adminShowMenu=function(b,g,e){if(b.OPENER){return true}var a=b,d=null;if(typeof b=="object"&&!BX.type.isElementNode(b)&&typeof b.x!="undefined"){d=document.body.appendChild(BX.create("DIV",{style:{position:"absolute",left:b.x+"px",top:b.y+"px",height:0,width:0}}));a=d}e=e||{};a.OPENER=new BX.COpener({DIV:a,MENU:g,TYPE:"click",ACTIVE_CLASS:(typeof e.active_class!="undefined")?e.active_class:"adm-btn-active",CLOSE_ON_CLICK:(typeof e.close_on_click!="undefined")?!!e.close_on_click:true});var c=function(){BX.onCustomEvent(b,"onAdminMenuClose");if(!!d){d.parentNode.removeChild(d);d=null}a=null};BX.addCustomEvent(a.OPENER,"onOpenerMenuClose",c);BX.addCustomEvent(a.OPENER,"onOpenerMenuOpen",function(){BX.onCustomEvent(b,"onAdminMenuShow")});a.OPENER.Toggle()};BX.AdminFilter=function(b,a){var c=this;this.filter_id=b;this.aRows=a;this.oVisRows={};this.oOptions={};this.curID="0";this.form=jsUtils.FindParentObject(BX(this.filter_id),"form");this.popupItems={};this.missingRows=0;this.tableWrap=null;this.table=null;this.easing=null;this.startContentHeight=0;this.table_id=false;this.url=false;this.currentLoadedTab=null;this.presetsDeleted=[];this.state={init:false,requesting:false,clearing:false,folded:false,saving:false};this.params={filteredId:false,activeTabId:false};this.SetFoldedView=function(){BX.toggleClass(BX("adm-filter-tab-wrap-"+this.filter_id),"adm-filter-folded");this.state.folded=!this.state.folded;BX.userOptions.save("filter",this.filter_id,"styleFolded",this.state.folded?"Y":"N");this.SetSwitcherTitle()};this.SetSwitcherTitle=function(){var e=BX("adm-filter-switcher-tab");var d=BX("adm-filter-tab-wrap-"+this.filter_id);e.title=BX.hasClass(d,"adm-filter-folded")?BX.message("JSADM_FLT_UNFOLD"):BX.message("JSADM_FLT_FOLD")};this.InitFilter=function(h){var g=this.isObjectEmpty(h);this.SetSwitcherTitle();this.oVisRows=h;var j=BX(this.filter_id);if(!j){return}this.table=j;var d=j.rows.length;this.missingRows=j.rows.length-this.aRows.length;var p=this.missingRows;for(var k=d-1;k>=0;k--){var q=j.rows[k];var f=q.insertCell(-1);var m="";BX.admFltWrap.Row(q);if(k-p>=0){m=this.aRows[k-p]}else{m="miss-"+k;this.aRows.unshift(m);if(g){this.oVisRows[m]=true}}q.id=this.filter_id+"_row_"+m;if(this.oVisRows[m]!=true){q.style.display="none"}f.innerHTML='<span class="adm-filter-item-delete" onclick="this.blur(); '+this.filter_id+".DeleteFilterRow('"+q.id+'\');" hidefocus="true" title="'+phpVars.messFilterLess+'" style="display: none;"></span>'}for(k=0;k<d;k++){var o=j.insertRow(k*2+1);if(this.oVisRows[this.aRows[k]]!=true){o.style.display="none"}o.id=this.filter_id+"_row_"+this.aRows[k]+"_delim";f=o.insertCell(-1);f.colSpan=3;f.className="delimiter";f.innerHTML='<div class="empty"></div>'}try{j.style.display="table"}catch(l){j.style.display="block"}this.tableWrap=j.parentNode;this.DisplayNonEmptyRows();this.ChangeViewDependVisible();BX.addCustomEvent(window,"onAdminListLoaded",BX.proxy(this.onAdminListLoaded,this));BX.onCustomEvent(window,"onAdminFilterInited",[{filterId:this.filter_id}])};this.InitFirst=function(){this.oOptions["0"]={FIELDS:{},EDITABLE:false};for(var d in this.oOptions){this.oOptions[d]["tab"]=new BX.admFltTab(d,this)}};this.InitFilteredTab=function(d){var g=false;if(this.oOptions[d]){g=d}else{g=this.GetByPresetId(d)}if(g===false){return false}if(!this.ApplyFilter(g)){return false}if(g){if(this.state.folded){this.oOptions["0"]["tab"].UnSetActive();this.oOptions[g]["tab"].SetActive()}var f=this.GetFormButton("set_filter");if(this.filter_id&&this.url){this.OnSet(this.table_id,this.url,f)}else{if(f){f.onclick()}}this.oOptions[g]["tab"].SetFiltered(true);return true}else{var e=this.GetFormButton("del_filter");if(this.filter_id&&this.url){this.OnClear(this.table_id,this.url,e)}else{if(e){e.onclick()}}return false}};this.InitOpenedTab=function(k,g){var j=[k,g];var f,h;for(var e in j){var d=j[e];if(d==""){continue}h=false;if(this.oOptions[d]){h=d}else{h=this.GetByPresetId(d)}if(h===false){continue}f=BX("adm-filter-tab-"+this.filter_id+"-"+h);if(f){break}}if(!f){return false}this.SetActiveTab(f);this.ApplyFilter(h);if(h==k){this.SaveFilterParams()}return true};this.GetByPresetId=function(e){for(var d in this.oOptions){if(this.oOptions[d]&&this.oOptions[d]["PRESET_ID"]&&this.oOptions[d]["PRESET_ID"]==e){return d}}return false};this.isObjectEmpty=function(e){for(var d in e){return false}return true};this.ChangeViewDependVisible=function(){var d=this.CountVisibleRows();if(d<1){this.ToggleFilterRow(this.filter_id+"_row_"+this.aRows[0],true)}if(d<=1){this.ToggleButtonsHideAll()}if(d>=2){this.ToggleButtonsShowAll()}this.SetBottomStyle()};this.UrlAddParams=function(f,e){var d=f;var g=f.substr(f.length-1);if(d.indexOf("?")>=0){if(g!="&"){d+="&"}}else{d+="?"}d+=e;return d};this.OnSet=function(h,d,f){if(!window[h]){return true}if(this.state.requesting){return false}if(!this.table_id){this.table_id=h}if(!this.url){this.url=d}BX.onCustomEvent(window,"onBeforeAdminFilterSet");if(this.curID!="0"&&!this.state.init){this.Save()}var e=this.UrlAddParams(d,"set_filter=Y&adm_filter_applied="+encodeURIComponent(this.curID));if(this.oOptions[this.curID]["PRESET_ID"]){e+=this.UrlAddParams(e,"adm_filter_preset="+encodeURIComponent(this.oOptions[this.curID]["PRESET_ID"]))}var g=this.GetParameters();this.state.requesting=true;BX.defer(function(){if(c.state.folded){c.currentLoadedTab=c.oOptions[c.curID]["tab"].GetObj();c.oOptions[c.curID]["tab"].ShowWheel()}else{BX.adminPanel.showWait(f)}var i={func:function(){if(!c.state.saving){window[h].GetAdminList(e+g);c.oOptions[c.curID]["tab"].SetFiltered(c.state.init);clearInterval(j)}}};var j=window.setInterval(function(){i.func.call(i)},200)})();return false};this.OnClear=function(g,d,f){if(!window[g]){return true}if(this.state.requesting){return false}this.state.clearing=true;BX.onCustomEvent(window,"onBeforeAdminFilterClear");var e=this.UrlAddParams(d,"del_filter=Y"+this.GetParameters());this.state.requesting=true;BX.defer(function(){if(c.state.folded){c.currentLoadedTab=c.oOptions[c.curID]["tab"].GetObj();c.oOptions[c.curID]["tab"].ShowWheel()}else{BX.adminPanel.showWait(f)}if(c.params.filteredId&&c.oOptions[c.params.filteredId]&&!c.state.folded){c.oOptions[c.params.filteredId]["tab"].UnSetFiltered()}window[g].GetAdminList(e)})();return false};this.onAdminListLoaded=function(){if(this.currentLoadedTab===false){return}BX.removeClass(this.currentLoadedTab,"adm-filter-tab-loading");if(this.state.clearing&&this.params.filteredId!==false&&this.oOptions[this.params.filteredId]){this.oOptions[this.params.filteredId]["tab"].UnSetFiltered()}this.currentLoadedTab=null;this.state.clearing=false;this.state.requesting=false};this.GetFormButton=function(d){if(!d){return false}var e=BX(this.filter_id+d);if(e){return e}return this.form[d]};this.ApplyFilter=function(f){if(this.state.requesting&&!this.state.init){return false}if(!this.oOptions[f]){return false}if(this.curID=="0"){this.oOptions["0"]["FIELDS"]=this.GetFilterFields(true)}this.curID=f;this.StartAnimation();this.SetFilterFields(this.oOptions[f]["FIELDS"]);if(!this.state.init){this.SaveFilterParams()}this.EndAnimation();if(this.state.folded&&!this.state.init){this.currentLoadedTab=this.oOptions[f]["tab"].GetObj();this.oOptions[f]["tab"].ShowWheel();if(this.params.filteredId===f){var e=this.GetFormButton("del_filter");if(this.filter_id&&this.url){this.OnClear(this.table_id,this.url,e)}else{if(e){e.onclick()}}}else{var d=this.GetFormButton("set_filter");if(this.filter_id&&this.url){this.OnSet(this.table_id,this.url,d)}else{if(d){d.onclick()}else{this.form.submit()}}}}return true};this.Save=function(e){var d=this.GetFilterFields(true);if((!this.oOptions[this.curID]["EDITABLE"]&&!e)){this.SaveInsteadPreset();return}if(e||this.curID=="0"){this.ShowSaveOptsWnd(d,false)}else{var f=(this.oOptions[this.curID]["COMMON"]=="Y");this.SaveToBase(this.oOptions[this.curID]["NAME"],f,d,false,false)}};this.SaveAs=function(){this.Save(true)};this.Delete=function(){if(!this.oOptions[this.curID].EDITABLE){this.MarkPresetAsDeleted(this.curID)}else{this.DeleteFromBase(this.curID)}};this.GetClearFields=function(){var d=this.GetFilterFields();for(var e in d){d[e]["value"]=""}return d};this.ReplaceFilterTab=function(g,e){if(!g||!e){return false}var f=BX("adm-filter-tab-"+this.filter_id+"-"+g);if(!f){return false}f.id="adm-filter-tab-"+this.filter_id+"-"+e;if(this.url){var d=BX.util.remove_url_param(this.url,["adm_filter_applied","adm_filter_preset"]);d+="&adm_filter_applied="+BX.util.urlencode(e);BX.adminMenu.registerItem(f.id,{URL:d})}f.onclick=function(){c.SetActiveTab(this);c.ApplyFilter(e)};this.MarkPresetAsDeleted(g,e);return true};this.SetFilteredBG=function(d){if(!this.params.filteredId&&d!==false){return}if(d==this.params.filteredId&&d!==false){BX.addClass(BX("adm-filter-tab-wrap-"+this.filter_id),"adm-current-filter")}else{BX.removeClass(BX("adm-filter-tab-wrap-"+this.filter_id),"adm-current-filter")}};this.SetActiveTab=function(e){if(this.state.requesting&&!this.state.init){return false}var d="adm-filter-tab-"+this.filter_id+"-";var f=e.id.substr(d.length,e.id.length);if(this.params.filteredId!==false&&this.params.filteredId===f&&this.state.folded){return true}var h=BX.findChildren(e.parentNode,{tag:"span"},false);for(var g=h.length-1;g>=0;g--){BX.removeClass(h[g],"adm-filter-tab-active")}this.SetFilteredBG(f);this.oOptions[f]["tab"].SetActive();this.params.activeTabId=f;return true};this.ShowSaveOptsWnd=function(e,h){var f=false;if(!window["filterSaveOptsDialog"+this.filter_id]){window["filterSaveOptsDialog"+this.filter_id]=new BX.CDialog({content:'<form name="flt_save_opts_'+this.filter_id+'" onkeypress=" return '+this.filter_id+'.SaveOptsWndKeyPress(event);"></form>',title:BX.message("JSADM_FLT_SAVE_TITLE"),width:450,height:100,resizable:false});f=true}var g=document["flt_save_opts_"+this.filter_id];g.onKeyPress=this.onKeyPress;var d=BX("filter_save_opts_"+this.filter_id).children[0];window["filterSaveOptsDialog"+this.filter_id].ClearButtons();window["filterSaveOptsDialog"+this.filter_id].SetButtons([{id:this.filter_id+"_btn_save",className:"adm-btn-save",title:BX.message("JSADM_FLT_SAVE"),action:function(){var i;if(g.common){i=g.common.checked}else{i=false}c.SaveToBase(g.save_filter_name.value,i,e,true,h);if(c.state.folded){c.SetFoldedView()}this.parentWindow.Close()}},BX.CDialog.prototype.btnCancel]);window["filterSaveOptsDialog"+this.filter_id].adjustSizeEx();window["filterSaveOptsDialog"+this.filter_id].Show();if(f){g.appendChild(d)}if(this.curID!="0"&&!h){g.save_filter_name.value=(this.oOptions[this.curID]["NAME"]?this.oOptions[this.curID]["NAME"]:"");if(g.common){g.common.checked=(this.oOptions[this.curID]["COMMON"]=="Y")}}else{g.save_filter_name.value=BX.message("JSADM_FLT_NEW_NAME");if(g.common){g.common.checked=false}}g.save_filter_name.focus()};this.SaveOptsWndKeyPress=function(d){if(!d){d=window.event}if(!d){return true}if(d.keyCode==13){BX(this.filter_id+"_btn_save").click();return false}if(d.keyCode==27){window["filterSaveOptsDialog"+this.filter_id].Close();return false}return true};this.MarkPresetAsDeleted=function(i,f){if(!f&&!confirm(BX.message("JSADM_FLT_DEL_CONFIRM"))){return}this.presetsDeleted[this.presetsDeleted.length]=i;var j="";for(var g in this.presetsDeleted){j+=(j!=""?",":"")+this.presetsDeleted[g]}var d=false;if(this.params.filteredId==this.curID){d=true}var e="0";if(f){this.oOptions[this.curID]["tab"].id=this.curID=e=f}else{this.oOptions[i]["tab"].DeleteHtml();delete this.oOptions[i]}var h=this.oOptions[e]["tab"].GetObj();if(h){h.click()}BX.userOptions.save("filter",this.filter_id,"presetsDeleted",j);if(d&&this.table_id&&!f){this.OnClear(this.table_id,this.url)}};this.DeleteFromBase=function(f){this.state.saving=true;if(!confirm(BX.message("JSADM_FLT_DEL_CONFIRM"))){return}var d={id:f,action:"del_filter",sessid:phpVars.bitrix_sessid,lang:BX.message("LANGUAGE_ID")};var e=function(g){if(g){c.oOptions[f]["tab"].DeleteHtml();delete c.oOptions[f];var h=false;if(c.params.filteredId==c.curID){h=true}var i=c.oOptions["0"]["tab"].GetObj();if(i){i.click()}c.state.saving=false;if(c.table_id&&h){c.OnClear(c.table_id,c.url)}}else{alert(BX.message("JSADM_FLT_DEL_ERROR"))}};BX.ajax.post("/bitrix/admin/filter_act.php",d,e)};this.SaveInsteadPreset=function(){this.state.saving=true;var d={filter_id:this.filter_id,preset_id:this.curID,action:"save_filter",sessid:phpVars.bitrix_sessid,name:this.oOptions[this.curID]["NAME"],common:"N",fields:c.GetFilterFields(),lang:BX.message("LANGUAGE_ID")};if(this.oOptions[this.curID]["SORT_FIELD"]){d.sort_field=this.oOptions[this.curID]["SORT_FIELD"]}if(this.oOptions[this.curID]["SORT"]){d.sort=this.oOptions[this.curID]["SORT"]}var e=function(f){if(f){c.oOptions[f]={NAME:c.oOptions[c.curID]["NAME"],FIELDS:c.GetFilterFields(),EDITABLE:true,PRESET_ID:c.curID,COMMON:false};c.oOptions[f]["tab"]=new BX.admFltTab(f,c);if(d.sort_field){c.oOptions[f]["SORT_FIELD"]=d.sort_field}if(d.sort){c.oOptions[f]["SORT"]=d.sort}c.ReplaceFilterTab(c.curID,f);c.state.saving=false}else{alert(BX.message("JSADM_FLT_SAVE_ERROR"))}};BX.ajax.post("/bitrix/admin/filter_act.php",d,e)};this.SaveToBase=function(f,g,e,d,i){this.state.saving=true;if(f==""){f=BX.message("JSADM_FLT_NO_NAME")}var h={filter_id:this.filter_id,action:"save_filter",sessid:phpVars.bitrix_sessid,name:f,common:g?"Y":"N",fields:e,lang:BX.message("LANGUAGE_ID")};if(!d&&this.curID!="0"){h.id=this.curID}if(!d&&this.oOptions[this.curID]["PRESET_ID"]){h.preset_id=this.oOptions[this.curID]["PRESET_ID"]}if(this.oOptions[this.curID]["SORT_FIELD"]){h.sort_field=this.oOptions[this.curID]["SORT_FIELD"]}if(this.oOptions[this.curID]["SORT"]){h.sort=this.oOptions[this.curID]["SORT"]}var j=function(k){if(k){c.oOptions[k]={NAME:f,COMMON:g?"Y":"N",FIELDS:e,EDITABLE:true};if(h.sort_field){c.oOptions[k]["SORT_FIELD"]=h.sort_field}if(h.sort){c.oOptions[k]["SORT"]=h.sort}c.oOptions[k]["tab"]=new BX.admFltTab(k,c);if(d||h.id==undefined){c.oOptions[k]["tab"].AddHtml(c.url,f)}if(i){c.ClearParameters()}c.state.saving=false}else{alert(BX.message("JSADM_FLT_SAVE_ERROR"))}};BX.ajax.post("/bitrix/admin/filter_act.php",h,j);return h};this.ClearParameters=function(){if(!this.form){return}var f;var h=this.form.elements.length;for(f=0;f<h;f++){var g=this.form.elements[f];BX.removeClass(g,"adm-calendar-inp-setted");switch(g.type.toLowerCase()){case"text":case"textarea":g.value="";break;case"select-one":g.selectedIndex=0;if(g.onchange){g.onchange()}break;case"select-multiple":var e;var d=g.options.length;for(e=0;e<d;e++){g.options[e].selected=false}break;default:break}}};this.GetRowByElement=function(d){return jsUtils.FindParentObject(d,"tr")};this.SetFilterFields=function(p){this.ClearParameters();var e=[];var d;for(var m=0,g=this.form.elements.length;m<g;m++){var f=this.form.elements[m];if(BX.hasClass(f,"adm-calendar-inp-setted")){continue}if(f.type=="select-multiple"){d=f.name.substr(0,f.name.length-2)}else{if(f.type=="checkbox"&&f.name.search(/[\[\]]/)){d=f.name.substr(0,f.name.length-2);if(e[d]==undefined){e[d]=0}else{e[d]++}d+="_cbxIdx_"+e[d];f.checked=false}else{d=f.name}}if(!p[d]){var r=this.GetRowByElement(f);if(!r){continue}if(this.IsAllRowElementsHidden(r.id,p)){this.ToggleFilterRow(r.id,false,false,true)}continue}switch(f.type.toLowerCase()){case"select-one":f.value=p[d]["value"];if(f.value==""){f.selectedIndex=0}break;case"text":case"textarea":f.value=p[d]["value"];break;case"radio":case"checkbox":f.checked=(f.value==p[d]["value"]);break;case"select-multiple":var q=false;f.value=null;if(f.options.length>0){f.options[0].selected=false;for(var k=0,h=f.options.length;k<h;k++){for(var o in p[d]["value"]){if(f.options[k].value==p[d]["value"][o]){f.options[k].selected=true;q=true}}}if(!q&&f.options[0].value==""){f.options[0].selected=true}}break;default:break}BX.fireEvent(f,"change");if(p[d]["hidden"]=="true"&&this.IsAllRowElementsHidden(this.GetRowByElement(f).id,p)){this.ToggleFilterRow(this.GetRowByElement(f).id,false,false,true)}else{this.ToggleFilterRow(this.GetRowByElement(f).id,true,false)}}if(this.CountVisibleRows()<1){this.ToggleFilterRow(this.filter_id+"_row_"+this.aRows[0],true,false)}};this.IsFormElementHidden=function(d){if(BX.browser.IsOpera()){return !d.offsetWidth&&!d.offsetHeight&&!d.clientHeight&&!d.clientWidth}return !d.offsetWidth&&!d.offsetHeight};this.IsAllRowElementsHidden=function(h,d){var g=true;for(var e=0,j=this.form.elements.length;e<j;e++){var f=this.form.elements[e];if(!d[f.name]){continue}if(jsUtils.FindParentObject(f,"tr").id!=h){continue}if(d[f.name]["hidden"]=="false"){g=false;break}}return g};this.GetFilterFields=function(o){var p={};var e=[];var d;for(var m=0,g=this.form.elements.length;m<g;m++){var f=this.form.elements[m];if(f.type=="select-multiple"){d=f.name.substr(0,f.name.length-2)}else{if(f.type=="checkbox"&&f.name.search(/[\[\]]/)){d=f.name.substr(0,f.name.length-2);if(e[d]==undefined){e[d]=0}else{e[d]++}d+="_cbxIdx_"+e[d]}else{d=f.name}}switch(f.type.toLowerCase()){case"select-one":case"text":case"textarea":p[d]={value:f.value};break;case"radio":if(f.checked){p[d]={value:f.value}}break;case"checkbox":if(f.checked){p[d]={value:f.value}}else{p[d]={value:false}}break;case"select-multiple":p[d]={value:[]};for(var k=0,h=f.options.length;k<h;k++){if(f.options[k].selected&&f.options[k].value){p[d]["value"]["sel_"+f.options[k].value]=f.options[k].value}}break;default:break}if(!p[d]){continue}if(o){p[d]["hidden"]=(this.GetRowByElement(f).style.display=="none"?"true":"false")}else{p[d]["hidden"]=this.IsFormElementHidden(f)?"true":"false"}}return p};this.IsFilterFill=function(){if(!this.form){return}var f;var k=this.form.elements.length;for(f=0;f<k;f++){var g=this.form.elements[f];if(g.disabled){continue}var h=this.GetRowByElement(g);if(h&&h.style&&h.style.display=="none"){continue}switch(g.type.toLowerCase()){case"select-one":if(g.options.length>0){if(g.options[0].value.length!=0&&(g.options[0].value.toUpperCase()!="NOT_REF"||g.value.toUpperCase()=="NOT_REF")){break}}case"text":case"textarea":if(g.value.length>0){return true}break;case"checkbox":if(g.checked){return true}break;case"select-multiple":var e;var d=g.options.length;for(e=0;e<d;e++){if(g.options[e].selected&&g.options[e].value!=""){return true}}break;default:break}}return false};this.GetParameters=function(){if(!this.form){return}var w,m="";var p=this.form.elements.length;for(w=0;w<p;w++){var e=this.form.elements[w];if(e.disabled){continue}var d=this.GetRowByElement(e);if(d&&d.style&&d.style.display=="none"){continue}if(e.className=="adm-select adm-calendar-period"&&e.value!=""){var u=e.parentNode.parentNode;var f=BX.findChild(u,{className:"adm-input adm-calendar-from"},true);var g=BX.findChild(u,{className:"adm-input adm-calendar-to"},true);var r=false;var h=false;var y=new Date();var k=y.getFullYear();var A=y.getMonth();var v=y.getDate();var z=y.getDay();if(z==0){z=7}switch(e.value){case"exact":r=new Date(f.value.replace(/(\d+).(\d+).(\d+)/,"$3/$2/$1"));h=r;break;case"after":g.value="";break;case"before":f.value="";break;default:break}var x=window[f.name+"_bTime"]?BX.message("FORMAT_DATETIME"):BX.message("FORMAT_DATE");if(r){f.value=BX.formatDate(r,x)}if(h){g.value=BX.formatDate(h,x)}}var B="";switch(e.type.toLowerCase()){case"select-one":case"text":case"textarea":case"hidden":B=e.value;break;case"radio":case"checkbox":if(e.checked){B=e.value}break;case"select-multiple":var t;var q=e.options.length;for(t=0;t<q;t++){if(e.options[t].selected){m+="&"+e.name+"="+encodeURIComponent(e.options[t].value)}}break;default:break}if(B!=""){m+="&"+e.name+"="+encodeURIComponent(B)}}if(this.oOptions[this.curID]["SORT_FIELD"]&&typeof this.oOptions[this.curID]["SORT_FIELD"]=="object"){for(var o in this.oOptions[this.curID]["SORT_FIELD"]){m+="&by="+encodeURIComponent(o)+"&order="+this.oOptions[this.curID]["SORT_FIELD"][o];break}}return m};this.CheckActive=function(){var f;var k=this.form.elements.length;for(f=0;f<k;f++){var g=form.elements[f];if(g.disabled){continue}var h=this.GetRowByElement(g);if(h&&h.style&&h.style.display=="none"){continue}switch(g.type.toLowerCase()){case"select-one":if(g.options[0].value.length!=0&&(g.options[0].value.toUpperCase()!="NOT_REF"||g.value.toUpperCase()=="NOT_REF")){break}case"text":case"textarea":if(g.value.length>0){return true}break;case"checkbox":if(g.checked){return true}break;case"select-multiple":var e;var d=g.options.length;for(e=0;e<d;e++){if(g.options[e].selected&&g.options[e].value!=""){return true}}break;default:break}}return false};this.DisplayNonEmptyRows=function(){if(!this.form){return}var g;var m=this.form.elements.length;for(g=0;g<m;g++){var h=this.form.elements[g];if(h.disabled){continue}var e=false;switch(h.type.toLowerCase()){case"select-one":if(h.value.length>0&&(h.options[0].value.length==0||(h.options[0].value!=h.value))){e=true}break;case"text":case"textarea":if(h.value.length>0){e=true}break;case"checkbox":if(h.checked){e=true}break;case"select-multiple":var f;var d=h.options.length;for(f=0;f<d;f++){if(h.options[f].selected&&h.options[f].value!=""){e=true;break}}break;default:break}if(e){var k=jsUtils.FindParentObject(h,"tr");if(k.id){this.ToggleFilterRow(k.id,true,false)}}}};this.CountVisibleRows=function(){var d=0;for(var e=this.aRows.length-1;e>=0;e--){if(this.oVisRows[this.aRows[e]]){d++}}return d};this.SetBottomStyle=function(){var d=BX(this.filter_id+"_bottom_separator");var e=BX(this.filter_id+"_content");if(this.CountVisibleRows()>1){e.className="adm-filter-content";d.style.display="block"}else{e.className="adm-filter-content adm-filter-content-first";d.style.display="none"}};this.ToggleButtonShow=function(d){var e=BX(d);if(!e){return}e.cells[2].children[0].style.display="block"};this.ToggleButtonHide=function(d){var e=BX(d);if(!e){return}e.cells[2].children[0].style.display="none"};this.ToggleButtonsShowAll=function(){for(var d in this.aRows){this.ToggleButtonShow(this.filter_id+"_row_"+this.aRows[d])}};this.ToggleButtonsHideAll=function(){for(var d in this.aRows){this.ToggleButtonHide(this.filter_id+"_row_"+this.aRows[d])}};this.ToggleFilterRow=function(g,l,i,f){var n=BX(g),d=BX(g+"_delim"),k=0;if(!n||!d){return k}var h=g.substr((this.filter_id+"_row_").length);if(l!=true&&l!=false){l=(n.style.display=="none")}if(l==true){try{n.style.display="table-row";d.style.display="table-row"}catch(j){n.style.display="block";d.style.display="block"}this.oVisRows[h]=true;k=n.offsetHeight+d.offsetHeight}else{if(f||this.CountVisibleRows()>1){k=-(n.offsetHeight+d.offsetHeight);n.style.display="none";d.style.display="none";this.oVisRows[h]=false}}this.SetBottomStyle();var m=this.CountVisibleRows();if(m==1){this.ToggleButtonsHideAll()}if(m==2){this.ToggleButtonsShowAll()}if(i!=false){this.SaveRowsOption()}return k};this.DeleteFilterRow=function(d){this.StartAnimation();this.ToggleFilterRow(d);this.EndAnimation()};this.StartAnimation=function(){if(this.state.folded){return}if(this.easing){this.easing.stop()}this.startContentHeight=this.tableWrap.offsetHeight;this.tableWrap.style.height=this.startContentHeight+"px";this.tableWrap.style.overflowY="hidden"};this.EndAnimation=function(){if(this.state.folded){return}var d=this.table.offsetHeight;if(d==0){this.tableWrap.style.height="auto";this.tableWrap.style.overflowY="visible";return}this.easing=new BX.easing({duration:500,start:{height:this.startContentHeight,opacity:0},finish:{height:d,opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:BX.proxy(function(e){this.tableWrap.style.height=e.height+"px";BX.onCustomEvent(this,"onAdminFilterToggleRow")},this),complete:BX.proxy(function(){this.tableWrap.style.height="auto";this.tableWrap.style.overflowY="visible";this.easing=null;BX.onCustomEvent(this,"onAdminFilterToggleRow")},this)});this.easing.animate()};this.SaveFilterParams=function(){var d="filter_id:"+this.filter_id+",";for(var e in this.params){d+=e+":"+this.params[e]+","}d=d.substr(0,d.length-1);document.cookie=BX.message("COOKIE_PREFIX")+"_ADM_FLT_PARAMS="+d};this.SaveRowsOption=function(){if(this.curID!="0"){this.Save(false);return true}var d="";for(var e in this.oVisRows){if(this.oVisRows[e]==true){d+=(d!=""?",":"")+e}}jsUserOptions.SaveOption("filter",this.filter_id,"rows",d)};this.SaveOpenTab=function(e){var d={id:e,filter_id:this.filter_id,action:"open_tab_save",sessid:phpVars.bitrix_sessid,lang:BX.message("LANGUAGE_ID")};BX.ajax.post("/bitrix/admin/filter_act.php",d)};this.SaveFilteredId=function(e){var d={id:e,filter_id:this.filter_id,action:"filtered_tab_save",sessid:phpVars.bitrix_sessid,lang:BX.message("LANGUAGE_ID")};BX.ajax.post("/bitrix/admin/filter_act.php",d)};this.ToggleAllFilterRows=function(d){var f=document.getElementById(this.filter_id);if(!f){return}this.StartAnimation();var h=f.rows.length;for(var e=h-1;e>=0;e--){var g=f.rows[e];if(g.id&&g.cells[0].className!="delimiter"){this.ToggleFilterRow(g.id,d,false)}}if(d){this.ToggleButtonsShowAll()}else{this.ToggleButtonsHideAll()}this.SaveRowsOption();this.EndAnimation()};this.SaveMenuShow=function(e){var d=[];if(this.curID!="0"){d.push({TEXT:BX.message("JSADM_FLT_SAVE"),ONCLICK:b+".Save();"})}d.push({TEXT:BX.message("JSADM_FLT_SAVE_AS"),ONCLICK:"setTimeout(function(){"+b+".SaveAs();},10);"});if(this.curID!="0"){d.push({TEXT:BX.message("JSADM_FLT_DELETE"),ONCLICK:b+".Delete();"})}if(!e.OPENER){BX.adminShowMenu(e,d)}else{e.OPENER.SetMenu(d)}};this.SettMenuItemClick=function(e,g){var f=BX.WindowManager.Get();if(f&&BX.type.isFunction(f.toggleArrow)){f.toggleArrow(false)}this.StartAnimation();var d=this.ToggleFilterRow(e);this.EndAnimation()};this.SettMenuShow=function(f){var h=BX(this.filter_id);if(!h){return}var d=[];var k=this.missingRows;var g=this.aRows.length-1;for(var j=h.rows.length-1;j>=0;j--){var m=h.rows[j];if(!m.id||m.cells[0].className=="delimiter"){continue}var l="";if(g-k>=0){l=this.popupItems[this.aRows[g]]}else{l=(m.cells[0].textContent||m.cells[0].innerText).replace(/:$/,"")}d.unshift({TEXT:l,ONCLICK:b+".SettMenuItemClick('"+m.id+"',this);",CLOSE_ON_CLICK:false,ADJUST_ON_CLICK:false,CHECKED:(m.style.display!="none")});g--}d.push({SEPARATOR:true});d.push({TEXT:BX.message("JSADM_FLT_SHOW_ALL"),ONCLICK:b+".ToggleAllFilterRows(true);"});d.push({TEXT:BX.message("JSADM_FLT_HIDE_ALL"),ONCLICK:b+".ToggleAllFilterRows(false);"});if(!f.OPENER){BX.adminShowMenu(f,d)}else{f.OPENER.SetMenu(d);var e=f.OPENER.GetMenu();if(e){e.toggleArrow(true)}}}};BX.admFltTab=function(b,a){this.id=b;this.filter=a};BX.admFltTab.prototype={GetObjId:function(){return"adm-filter-tab-"+this.filter.filter_id+"-"+this.id},GetObj:function(){var a=this.GetObjId();return BX(a)},SetActive:function(){BX.addClass(this.GetObj(),"adm-filter-tab-active")},UnSetActive:function(){BX.removeClass(this.GetObj(),"adm-filter-tab-active")},SetFiltered:function(a){if(this.filter.params.filteredId!==false&&this.filter.oOptions[this.filter.params.filteredId]!==undefined&&!a){this.filter.oOptions[this.filter.params.filteredId]["tab"].UnSetFiltered()}BX.addClass(this.GetObj(),"adm-current-filter-tab");if(!a){this.filter.params.filteredId=this.id;this.filter.SaveFilterParams()}this.filter.params.filteredId=this.id;this.filter.SetFilteredBG(this.id)},UnSetFiltered:function(){this.filter.params.filteredId=false;BX.removeClass(this.GetObj(),"adm-current-filter-tab");this.filter.SetFilteredBG(false);this.filter.SaveFilterParams()},_RegisterDD:function(d,c,b){if(!c){return false}var a=BX.util.remove_url_param(c,["adm_filter_applied","adm_filter_preset"]);a+="&adm_filter_applied="+BX.util.urlencode(this.id);BX.adminMenu.registerItem(d,{URL:a,TITLE:true})},AddHtml:function(b,a){var e=this;var c=BX("filter-tabs-"+this.filter.filter_id);var d=document.createElement("span");d.className="adm-filter-tab";d.id=this.GetObjId();d.onclick=function(){e.filter.SetActiveTab(this);e.filter.ApplyFilter(e.id)};d.innerHTML=BX.util.htmlspecialchars(a);c.insertBefore(d,BX("adm-filter-add-tab-"+this.filter.filter_id));this._RegisterDD(d.id,b,a);this.filter.SetActiveTab(d);this.filter.ApplyFilter(this.id)},DeleteHtml:function(){var a=this.GetObj();if(a){a.parentNode.removeChild(a)}},ShowWheel:function(){var a=250;setTimeout(BX.proxy(function(){if(this.GetObj()){BX.addClass(this.GetObj(),"adm-filter-tab-loading")}},this),a)}};BX.admFltWrap={Inner:function(d,e,g,f){var c=document.createElement(g);if(f){c.className=f}if(e){d.className=e}var a=BX.findChildren(d);for(var b in a){c.appendChild(a[b])}d.appendChild(c);return c},Element:function(b,c,e,d){var a=document.createElement(e);if(d){a.className=d}if(c){b.className=c}b.parentNode.insertBefore(a,b);a.appendChild(b);return a},Input:function(c){var b=false;switch(c.type){case"select-one":b=BX.admFltWrap.Element(c,"adm-select","span","adm-select-wrap");break;case"select-multiple":b=BX.admFltWrap.Element(c,"adm-select-multiple","span","adm-select-wrap-multiple");break;case"text":b=BX.admFltWrap.Element(c,"adm-input","div","adm-input-wrap");break;case"checkbox":var a=BX.findChild(c.parentNode,{tagName:"label",htmlFor:c.id});if(a){var d=BX.admFltWrap.Element(c,"","label","");if(a&&a.childNodes[0]){d.appendChild(a.childNodes[0]);a.parentNode.removeChild(a)}}BX.adminFormTools.modifyCheckbox(c);break;case"submit":case"button":case"reset":case"hidden":default:break}return b},Cell:function(b){var e=b.cloneNode(true);var d;e.innerHTML="";while(b.childNodes.length){switch(b.childNodes[0].nodeName.toLowerCase()){case"small":BX.admFltWrap.Element(b.childNodes[0],"","span","adm-filter-text-wrap");break;case"#text":b.childNodes[0].nodeValue=jsUtils.trim(b.childNodes[0].nodeValue);if(b.childNodes[0].nodeValue==""){b.removeChild(b.childNodes[0]);continue}BX.admFltWrap.Element(b.childNodes[0],"","span","adm-filter-text-wrap");break;case"label":if(b.childNodes[0].className=="adm-designed-checkbox-label"){break}var c=BX.findChild(b.childNodes[0],{tag:"input"});if(c){d=BX.admFltWrap.Input(c)}break;case"input":var a=false;var f=BX.findNextSibling(b.childNodes[0],{tagName:"INPUT"});if(b.childNodes[0].type=="text"&&(!f||f.type!="text")){a=BX.findChild(b.childNodes[0].parentNode,{className:"adm-input-help-icon"})}d=BX.admFltWrap.Input(b.childNodes[0]);if(a){BX.addClass(d,"adm-input-help-icon-wrap");d.appendChild(a)}break;case"select":BX.admFltWrap.Input(b.childNodes[0]);break;case"iframe":b.childNodes[0].style.display="none";break;case"span":if(b.childNodes[0].style.display!="none"){b.childNodes[0].style.display="inline-block"}break;default:break}e.appendChild(b.childNodes[0])}return e},Row:function(d){d.cells[0].className="adm-filter-item-left";d.cells[1].className="adm-filter-item-center";d.cells[2].className="adm-filter-item-right";d.cells[0].innerHTML=d.cells[0].textContent||d.cells[0].innerText;var a=(!!BX.findChild(d.cells[1],{className:"adm-input adm-input-calendar"},true));if(a){var c=BX.admFltWrap.Inner(d.cells[1],"","DIV","adm-calendar-block adm-filter-alignment");BX.admFltWrap.Inner(c,"","DIV","adm-filter-box-sizing");return null}if(d.cells[1].children[0]&&!BX.hasClass(d.cells[1].children[0],"adm-filter-alignment")){var e=BX.create("div",{props:{className:"adm-filter-box-sizing"}});var b=BX.create("div",{props:{className:"adm-filter-alignment"}});d.cells[1].innerHTML=BX.admFltWrap.Cell(d.cells[1]).innerHTML;while(d.cells[1].children.length>0){e.appendChild(d.cells[1].children[0])}b.appendChild(e);d.cells[1].appendChild(b)}return d}};BX.adminChain={_addon:null,addItems:function(a){BX.ready(function(){BX.adminChain._addItems(a)})},_addItems:function(a){var b=BX("main_navchain");if(!b){return}if(!!this._addon){this._addon.parentNode.removeChild(this._addon);this._addon=null}var c=BX(a);if(!c){return}this._addon=b.appendChild(BX.create("span",{html:'<span class="adm-navchain-delimiter"></span>'+c.innerHTML}))}};BX.InitializeAdmin=function(){BX.adminPanel=new BX.adminPanel();BX.adminMenu=new BX.adminMenu();if(!!(history.pushState&&BX.type.isFunction(history.pushState))){BX.adminHistory=new BX.adminHistory()}BX.ready(function(){var a=BX("adm-workarea");if(a){a.style.opacity=1}})};BX.adminPanel.modifyFormElements=BX.adminFormTools.modifyFormElements;BX.adminPanel.modifyFormElement=BX.adminFormTools.modifyFormElement})();