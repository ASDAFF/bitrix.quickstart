/**
 * jQuery CSS Customizable Scrollbar
 *
 * Copyright 2013, Yuriy Khabarov
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * If you found bug, please contact me via email <13real008@gmail.com>
 *
 * @author Yuriy Khabarov aka Gromo
 * @version 0.1.4
 * @url https://github.com/gromo/dslib/tree/master/jquery.scrollbar
 *
 * TODO:
 *
 */
(function(e,t,n){function h(){var t={border:"none",height:"100px",margin:"0",padding:"0",width:"100px"};var n=e("<div>").css(e.extend({},t));var i=e("<div>").css(e.extend({background:"#F00",left:"-200px",overflow:"scroll",position:"absolute",top:"-200px"},t)).append(n).appendTo("body").scrollLeft(n.width()).scrollTop(n.height());var s={height:i.offset().top-n.offset().top||0,width:i.offset().left-n.offset().left||0};if(r.webkit){s.height=0;s.width=0}i.remove();return s}function p(n,r){e(t).on({"blur.scrollbar":function(){e(t).add("body").off(".scrollbar");n()},"dragstart.scrollbar":function(e){e.preventDefault();return false},"mouseup.scrollbar":function(){e(t).add("body").off(".scrollbar");n()}});e("body").on({"selectstart.scrollbar":function(e){e.preventDefault();return false}});r&&r.preventDefault();return false}function d(e){var t=e.originalEvent;if(t.axis&&t.axis===t.HORIZONTAL_AXIS)return false;if(t.wheelDeltaX)return false;return true}var r={mobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent),webkit:n.WebKitPoint?true:false,log:function(t,r){var i=t;if(r&&typeof t!="string"){i=[];e.each(t,function(e,t){i.push('"'+e+'": '+t)});i=i.join(", ")}if(n.console&&n.console.log){n.console.log(i)}},scroll:null};var i=false;var s=1,o="px";var u=[];var a={autoScrollSize:true,disableBodyScroll:false,duration:200,ignoreMobile:false,scrollStep:30,showArrows:false,type:"advanced",scrollx:null,scrolly:null,onInit:null,onDestroy:null};var f=function(t,n){if(!r.scroll){r.scroll=h();r.log("Init jQuery CSS Customizable Scrollbar v0.1.4")}this.container=t;this.options=e.extend({},a);this.scrollx={};this.scrolly={};if(!(r.mobile&&this.options.ignoreMobile))this.init(n)};f.prototype={destroy:function(){if(!this.wrapper){return}var n=this.container.scrollLeft();var r=this.container.scrollTop();this.container.insertBefore(this.wrapper).css({height:"",margin:""}).removeClass("scroll-content").removeClass("scroll-scrollx_show").removeClass("scroll-scrolly_show").off(".scrollbar").scrollLeft(n).scrollTop(r);this.scrollx.scrollbar.hide().find("div").andSelf().off(".scrollbar");this.scrolly.scrollbar.hide().find("div").andSelf().off(".scrollbar");this.wrapper.remove();e(t).add("body").off(".scrollbar");if(e.isFunction(this.options.onDestroy))this.options.onDestroy.apply(this,[this.container])},getScrollbar:function(t){var n=this.options["scroll"+t];var r={advanced:'<div class="scroll-arrow scroll-arrow_less"></div>'+'<div class="scroll-arrow scroll-arrow_more"></div>'+'<div class="scroll-element_outer">'+'    <div class="scroll-element_size"></div>'+'    <div class="scroll-element_inner-wrapper">'+'        <div class="scroll-element_inner">'+'            <div class="scroll-element_inner-bottom"></div>'+"        </div>"+"    </div>"+'    <div class="scroll-bar">'+'        <div class="scroll-bar_body">'+'            <div class="scroll-bar_body-inner"></div>'+"        </div>"+'        <div class="scroll-bar_bottom"></div>'+'        <div class="scroll-bar_center"></div>'+"    </div>"+"</div>",simple:'<div class="scroll-element_outer">'+'    <div class="scroll-element_size"></div>'+'    <div class="scroll-element_inner"></div>'+'    <div class="scroll-bar"></div>'+"</div>"};var i=r[this.options.type]?this.options.type:"advanced";if(n){if(typeof n=="string"){n=e(n).appendTo(this.wrapper)}else{n=e(n)}}else{n=e("<div>").addClass("scroll-element").html(r[i]).appendTo(this.wrapper)}if(this.options.showArrows){n.addClass("scroll-element_show-arrows")}return n.addClass("scroll-"+t)},init:function(n){function v(t,n){var i="scroll-scroll"+t+"_show";var s=t=="x"?f.y:f.x;var a=parseInt(u.css(t=="x"?"left":"top"),10)||0;var c=n.size;var h=n.visible+a;n.isVisible=c>h;if(n.isVisible){n.scrollbar.show();s.scrollbar.addClass(i);u.addClass(i)}else{n.scrollbar.hide();s.scrollbar.removeClass(i);u.removeClass(i)}if(t=="y"){u.css("height",n.isVisible?h+r.scroll.height+o:"auto")}if(f.x.size!=u.prop("scrollWidth")||f.y.size!=u.prop("scrollHeight")||f.x.visible!=l.width()||f.y.visible!=l.height()||f.x.offset!=(parseInt(u.css("left"),10)||0)||f.y.offset!=(parseInt(u.css("top"),10)||0)){e.each(f,function(t,n){e.extend(n,t=="x"?{offset:parseInt(u.css("left"),10)||0,size:u.prop("scrollWidth"),visible:l.width()}:{offset:parseInt(u.css("top"),10)||0,size:u.prop("scrollHeight"),visible:l.height()})});v(t=="x"?"y":"x",s)}}var i=this;var u=this.container;var a=e.extend(this.options,n);var f={x:this.scrollx,y:this.scrolly};var l=this.wrapper;var c={scrollLeft:u.scrollLeft(),scrollTop:u.scrollTop()};if(!l){this.wrapper=l=u.wrap(e("<div>").css({position:u.css("position")=="absolute"?"absolute":"relative"}).addClass("scroll-wrapper").addClass(u.attr("class"))).parent();u.addClass("scroll-content").css({height:"auto","margin-bottom":r.scroll.height*-1+o,"margin-right":r.scroll.width*-1+o}).on("scroll.scrollbar",function(){f.x.isVisible&&f.x.scroller.css("left",u.scrollLeft()*f.x.kx+o);f.y.isVisible&&f.y.scroller.css("top",u.scrollTop()*f.y.kx+o)});if(a.disableBodyScroll){var h=function(e){d(e)?f.y.isVisible&&f.y.mousewheel(e):f.x.isVisible&&f.x.mousewheel(e)};l.on({"MozMousePixelScroll.scrollbar":h,"mousewheel.scrollbar":h})}}else{u.css({height:"auto"})}e.each(f,function(n,r){var o=null;var l=true;var c=n=="x"?"scrollLeft":"scrollTop";var h=a.scrollStep;var v=function(){var e=u[c]();u[c](e+h);if(l==true&&e+h>=m)e=u[c]();if(l==false&&e+h<=m)e=u[c]();if(u[c]()==e&&o){o()}};var m=0;if(!r.scrollbar){r.scrollbar=i.getScrollbar(n);r.scroller=r.scrollbar.find(".scroll-bar");r.mousewheel=function(e){if(!r.isVisible||n=="x"&&d(e)){return}if(n=="y"&&!d(e)){f.x.mousewheel(e);return}var t=e.originalEvent.wheelDelta*-1||e.originalEvent.detail;var i=r.size-r.visible-r.offset;if(!(m<=0&&t<0||m>=i&&t>0)){m=m+t;if(m<0)m=0;if(m>i)m=i;var s={};s[c]=m;u.stop().animate(s,240,"linear",function(){m=u[c]()})}e.preventDefault();return false};r.scrollbar.on({"MozMousePixelScroll.scrollbar":r.mousewheel,"mousewheel.scrollbar":r.mousewheel,"mouseenter.scrollbar":function(){m=u[c]()}});r.scrollbar.find(".scroll-arrow, .scroll-element_inner").on("mousedown.scrollbar",function(t){if(t.which!=s)return;l=true;var i=r.size-r.visible-r.offset;if(e(this).hasClass("scroll-arrow")){l=e(this).hasClass("scroll-arrow_more");h=l?a.scrollStep:a.scrollStep*-1;m=l?i:0}else{l=t[n=="x"?"pageX":"pageY"]>r.scroller.offset()[n=="x"?"left":"top"];h=l?r.visible:r.visible*-1;m=t[n=="x"?"pageX":"pageY"]-r.scroller.offset()[n=="x"?"left":"top"];if(l)m=m-r.scroller[n=="x"?"width":"height"]();m=u[c]()+m/r.kx}var f=0,d=0;o=function(){m=u[c]();clearInterval(d);clearTimeout(f);f=0;d=0};f=setTimeout(function(){d=setInterval(v,40)},a.duration+100);var g={};g[c]=u[c]()+h;u.animate(g,a.duration);return p(o,t)});r.scroller.on("mousedown.scrollbar",function(i){if(i.which!=s)return;var o=i[n=="x"?"pageX":"pageY"];var a=u[c]();r.scrollbar.addClass("scroll-draggable");e(t).on("mousemove.scrollbar",function(e){var t=parseInt((e[n=="x"?"pageX":"pageY"]-o)/r.kx,10);u[c](a+t)});return p(function(){r.scrollbar.removeClass("scroll-draggable");m=u[c]()},i)})}});e.each(f,function(e,t){var n="scroll-scroll"+e+"_show";var r=e=="x"?f.y:f.x;t.scrollbar.hide();r.scrollbar.removeClass(n);u.removeClass(n)});e.each(f,function(t,n){e.extend(n,t=="x"?{offset:parseInt(u.css("left"),10)||0,size:u.prop("scrollWidth"),visible:l.width()}:{offset:parseInt(u.css("top"),10)||0,size:u.prop("scrollHeight"),visible:l.height()})});e.each(f,v);e.each(f,function(e,t){var n=e=="x"?"left":"top";var r=e=="x"?"width":"height";var i=parseInt(u.css(n),10)||0;var s=t.size;var f=t.visible+i;t.scrollbar.css(r,t.visible+o);var l=t.scrollbar.find(".scroll-element_size");l=l[r]()+parseInt(l.css(n)||0,10);if(a.autoScrollSize){t.scrollbarSize=parseInt(l*f/s,10);t.scroller.css(r,t.scrollbarSize+o)}t.scrollbarSize=parseInt(t.scroller.css(r),10);t.kx=(l-t.scrollbarSize)/(s-f)||1});if(e.isFunction(a.onInit))a.onInit.apply(this,[u]);u.scrollLeft(c.scrollLeft).scrollTop(c.scrollTop).trigger("scroll")}};e.fn.scrollbar=function(t,n){var r=this;if(t=="get")r=null;this.each(function(){var i=e(this);if(i.hasClass("scroll-wrapper")||i.get(0).nodeName=="body"){return}var s=i.data("scrollbar");if(s){if(t==="get"){r=s;return false}t=typeof t=="string"&&s[t]?t:"init";s[t].apply(s,e.isArray(n)?n:[]);if(t=="destroy"){i.removeData("scrollbar");while(e.inArray(s,u)>=0)u.splice(e.inArray(s,u),1)}}else{if(typeof t!="string"){s=new f(i,t);i.data("scrollbar",s);u.push(s)}}});return r};var l=0;var c=setInterval(function(){var e,t,n,s,o,a;for(e=0;e<u.length;e++){n=u[e];t=n.container;s=n.wrapper;o=n.scrollx;a=n.scrolly;if(s.is(":visible")&&(t.prop("scrollWidth")!=o.size||t.prop("scrollHeight")!=a.size||s.width()!=o.visible||s.height()!=a.visible)){n.init();if(i){r.log({scrollHeight:t.prop("scrollHeight")+":"+n.scrolly.size,scrollWidth:t.prop("scrollWidth")+":"+n.scrollx.size,visibleHeight:s.height()+":"+n.scrolly.visible,visibleWidth:s.width()+":"+n.scrollx.visible},true);if(l++>100){r.log("Scroll udpates exceed 100");clearInterval(c)}}}}},300)})(jQuery,document,window)