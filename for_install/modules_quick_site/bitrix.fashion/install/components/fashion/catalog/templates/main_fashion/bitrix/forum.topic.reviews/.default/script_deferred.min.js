function replyActionComment(d,e){if(!BX.util.in_array(e,["DEL","MODERATE"])){return false}if(e=="DEL"&&(!confirm(oText.cdm))){return false}var a=d.getAttribute("href");a=a.replace(/.AJAX_CALL=Y/g,"").replace(/.sessid=[^&]*/g,"");a+=((a.indexOf("?")>-1)?"&":"?")+"AJAX_CALL=Y&sessid="+phpVars.bitrix_sessid;BX.hide(d.parentNode);var c=BX.create("a",{attrs:{className:"reply-action-note"}});c.innerHTML=oText.wait;d.parentNode.parentNode.appendChild(c);var b=function(){BX.remove(c);BX.show(d.parentNode)};BX.ajax.loadJSON(a,function(g){var k=BX.findParent(d,{tag:"table"});if(g.status&&!!k){BX.onCustomEvent(window,"onForumCommentAJAXAction",[e]);var l=window.curpage||top.window.location.href;if(e=="DEL"){BX.fx.hide(k,"scroll",{time:0.15,callback_complete:function(){BX.remove(k);var m=BX.findChild(document,{"class":"reviews-post-table"},true,true);if((!m)||(m.length<1)){if((typeof oForum!="undefined")&&oForum.page_number>1){BX.reload(l)}}b()}})}else{var j=BX.hasClass(k,"reviews-post-hidden");var f=(j?oText.hide:oText.show);var h=BX.findChild(k,{className:"reviews-text"},true);BX.fx.hide(h,"fade",{time:0.1,callback_complete:function(){BX.toggleClass(k,"reviews-post-hidden");d.innerHTML=f;a=a.replace(new RegExp("REVIEW_ACTION="+(j?"SHOW":"HIDE")),("REVIEW_ACTION="+(j?"HIDE":"SHOW")));d.setAttribute("href",a);BX.fx.show(h,"fade",{time:0.1});b();BX.style(h,"background-color",(j?"#FFFFFF":"#E5F8E3"))}})}}else{BX.addClass(c,"error");c.innerHTML='<font class="errortext">'+g.message+"</font>"}});return false}function fTextToNode(b){var a=BX.create("div");a.innerHTML=b;if(a.childNodes.length>0){return a.childNodes[0]}else{return null}}function PostFormAjaxStatus(b){var g=BX.findChild(document,{className:"reviews-note-box"},true,true);if(g){for(i in g){BX.remove(g[i])}}var a=BX.findChild(document,{className:"reviews-block-container"},true);if(!a){return}if(b.length<1){return}var f=fTextToNode(b);if(!f){return}var c=["reviews-reply-form","reviews-collapse"];var d=a;while(d=d.nextSibling){if(d.nodeType==1){var e=false;for(i in c){if(BX.hasClass(d,c[i])){e=true;break}}if(e){d.parentNode.insertBefore(f,d);break}}}}function PostFormAjaxNavigation(g,d,f){var h=fTextToNode(g);if(!h){return}var c=BX.findChildren(document,{className:"reviews-navigation-box"},true);if(!c){var e=BX.findChild(document,{className:"reviews-block-container"},true);if(!e){return false}var a=e.parentNode;a.insertBefore(BX.create("div",{props:{className:"reviews-navigation-box reviews-navigation-top"}}),e);do{e=e.nextSibling}while(e&&e.nodeType!=1);var b=BX.create("div",{props:{className:"reviews-navigation-box reviews-navigation-bottom"}});if(!!e){e.parentNode.insertBefore(b,e)}else{a.appendChild(b)}var c=BX.findChildren(document,{className:"reviews-navigation-box"},true)}for(i in c){c[i].innerHTML=h.innerHTML}oForum.page_number=d;oForum.page_count=f}function SetReviewsAjaxPostTmp(a){window.forumAjaxPostTmp=a}function fReplaceOrInsertNode(c,e,d,f){var b=null;var a=null;if(!BX.type.isDomNode(d)){return false}if(!BX.type.isDomNode(c)&&!BX.type.isArray(c)&&c.length>0){if(!(c=fTextToNode(c))){return false}}if(BX.type.isDomNode(e)){d=e.parentNode;a=e.nextSibling;d.removeChild(e)}if(!a){a=BX.findChild(d,f,true)}if(a){a.parentNode.insertBefore(c,a)}else{d.appendChild(c)}return true}function fRunScripts(b){var a=BX.processHTML(b,true);scripts=a.SCRIPT;BX.ajax.processScripts(scripts,true)}function PostFormAjaxResponse(d,h,l){h.BXFormSubmit_save=null;var m=window.forumAjaxPostTmp;var k={className:/reviews-reply-form|reviews-collapse/};BX.onCustomEvent(window,"onForumCommentAJAXPost",[m]);var c=window.curpage||top.window.location.href;if(typeof m=="undefined"){BX.reload(c);return}var j=BX.findChild(document,{className:"reviews-block-inner"},true);if(!j){var a=BX.create("div",{props:{className:"reviews-block-container reviews-reviews-block-container"},children:[BX.create("div",{props:{className:"reviews-block-outer"},children:[BX.create("div",{props:{className:"reviews-block-inner"}})]})]});fReplaceOrInsertNode(a,null,BX.findChild(document,k,true).parentNode,k);j=BX.findChild(document,{className:"reviews-block-inner"},true)}if(m.reload){BX.reload(c)}if(m.status){if(!!m.allMessages){var b=fTextToNode(m.message);if(!b){return}fReplaceOrInsertNode(b,j,BX.findChild(document,k,true).parentNode,k);if(!!m.navigation&&!!m.pageNumber){PostFormAjaxNavigation(m.navigation,m.pageNumber,m.pageCount)}ClearForumPostForm(h);fRunScripts(m.message)}else{if(typeof m.message!="undefined"){if(msgNode=fTextToNode(m.message)){if(l){j.appendChild(msgNode)}else{j.insertBefore(msgNode,j.firstChild)}}ClearForumPostForm(h);fRunScripts(m.message)}else{if(!!m.previewMessage){previewDIV=BX.findChild(document,{className:"reviews-preview"},true);previewParent=BX.findChild(document,{className:/reviews-reply-form|reviews-collapse/},true).parentNode;fReplaceOrInsertNode(m.previewMessage,previewDIV,previewParent,{className:/reviews-reply-form|reviews-collapse/});PostFormAjaxStatus("");fRunScripts(m.previewMessage)}}}if(!!m.messageID){if(message=BX("message"+m.messageID)){BX.scrollToNode(message)}}}var g=h.getElementsByTagName("input");for(var e=0;e<g.length;e++){var f=g[e];if(f.getAttribute("type")=="submit"){f.disabled=false}}if(input_pageno=BX.findChild(h,{attr:{name:"pageNumber"}},true)){BX.remove(input_pageno)}if(m.statusMessage){PostFormAjaxStatus(m.statusMessage)}}function ClearForumPostForm(d){if(window.oLHE.sEditorMode=="code"){window.oLHE.SetContent("")}else{window.oLHE.SetEditorContent("")}if(window.oLHE.fAutosave){BX.bind(window.oLHE.pEditorDocument,"keydown",BX.proxy(window.oLHE.fAutosave.Init,window.oLHE.fAutosave))}if(!BX.type.isDomNode(d)){return}if(previewDIV=BX.findChild(document,{className:"reviews-preview"},true)){BX.remove(previewDIV)}var c=0;while(fileDIV=BX("upload_files_"+(c++)+"_")){if(fileINPUT=BX.findChild(fileDIV,{tag:"input"})){fileINPUT.value=""}BX.hide(fileDIV)}var b=BX.findChild(d,{className:"forum-upload-file-attach"},true);if(b){BX.show(b)}var a=BX.findChild(d,{className:"reviews-upload-info"},true);if(a){BX.hide(a)}captchaIMAGE=null;captchaHIDDEN=BX.findChild(d,{attr:{name:"captcha_code"}},true);captchaINPUT=BX.findChild(d,{attr:{name:"captcha_word"}},true);captchaDIV=BX.findChild(d,{className:"reviews-reply-field-captcha-image"},true);if(captchaDIV){captchaIMAGE=BX.findChild(captchaDIV,{tag:"img"})}if(captchaHIDDEN&&captchaINPUT&&captchaIMAGE){captchaINPUT.value="";BX.ajax.getCaptcha(function(e){captchaHIDDEN.value=e.captcha_sid;captchaIMAGE.src="/bitrix/tools/captcha.php?captcha_code="+e.captcha_sid})}}function ValidateForm(e,l,b,m){if(e.BXFormSubmit_save){return true}if(typeof e!="object"||typeof e.REVIEW_TEXT!="object"){return false}if(typeof oForum=="undefined"){oForum={}}MessageMax=64000;var k="";var f=e.REVIEW_TEXT.value.length;if(e.TITLE&&(e.TITLE.value.length<2)){k+=oErrors.no_topic_name}if(f<2){k+=oErrors.no_message}else{if((MessageMax!=0)&&(f>MessageMax)){k+=oErrors.max_len.replace(/\#MAX_LENGTH\#/gi,MessageMax).replace(/\#LENGTH\#/gi,f)}}if(k!=""){alert(k);return false}var d=BX.findChild(e,{attribute:{name:"send_button"}},true);if(d){d.disabled=true}var a=BX.findChild(e,{attribute:{name:"view_button"}},true);if(a){a.disabled=true}if(l=="Y"&&window.ForumPostMessage){ForumPostMessage(e)}if(b=="Y"){var h=e;var c=(m=="Y");if(typeof oForum!="undefined"&&typeof oForum.page_number!="undefined"){var g=BX.findChild(h,{attr:{name:"pageNumber"}});if(!g){g=BX.create("input",{props:{type:"hidden",name:"pageNumber"}});g.value=oForum.page_number;h.appendChild(g)}else{g.value=oForum.page_number}}if(typeof oForum!="undefined"&&typeof oForum.page_count!="undefined"){var j=BX.findChild(h,{attr:{name:"pageCount"}});if(!j){j=BX.create("input",{props:{type:"hidden",name:"pageCount"}});j.value=oForum.page_count;h.appendChild(j)}else{j.value=oForum.page_count}}setTimeout(function(){BX.ajax.submit(h,function(n){PostFormAjaxResponse(n,h,c)})},50);return false}return true}function ShowLastEditReason(a,b){if(b){if(a){b.style.display="block"}else{b.style.display="none"}}}function AttachFile(d,h,g,b){var c=null;var a=false;d=parseInt(d);h=parseInt(h);document.getElementById("upload_files_info_"+g).style.display="block";for(var e=d;e<(d+h);e++){c=document.getElementById("upload_files_"+e+"_"+g);if(!c||typeof(c)==null){break}if(c.style.display=="none"){a=true;c.style.display="block";break}}var f=(!a?true:(e>=(d+h-1)));if(f==true){b.style.display="none"}}var GetSelection=function(){var a="";if(typeof window.getSelection=="function"){try{var b=window.getSelection().getRangeAt(0).cloneContents();var c=BX.create("div");c.appendChild(b);a=c.innerHTML}catch(c){}}else{if(document.selection&&document.selection.createRange){a=document.selection.createRange().htmlText}}return a};function quoteMessageEx(c,g){replyForumFormOpen();var f="";var d=0;f=GetSelection();if(document.getSelection){f=f.replace(/\r\n\r\n/gi,"_newstringhere_").replace(/\r\n/gi," ");f=f.replace(/  /gi,"").replace(/_newstringhere_/gi,"\r\n\r\n")}if(f==""&&g){d=parseInt(g.replace(/message_text_/gi,""));if(d>0){var j=document.getElementById(g);if(typeof(j)=="object"&&j){f=j.innerHTML}}else{if(g.length>0){f=g}}}if(f!=""){f=f.replace(/[\n|\r]*\<br(\s)*(\/)*\>/gi,"\n");var a=function(q,p,o,n){var k=" ";var m=/showWMVPlayer.*?bx_wmv_player.*?file:[\s'"]*([^"']*).*?width:[\s'"]*([^"']*).*?height:[\s'"]*([^'"]*).*?/gi;res=m.exec(p);if(res){k="[VIDEO WIDTH="+res[2]+" HEIGHT="+res[3]+"]"+res[1]+"[/VIDEO]"}if(k==" "){var l=/bxPlayerOnload[\s\S]*?[\s'"]*file[\s'"]*:[\s'"]*([^"']*)[\s\S]*?[\s'"]*height[\s'"]*:[\s'"]*([^"']*)[\s\S]*?[\s'"]*width[\s'"]*:[\s'"]*([^"']*)/gi;res=l.exec(p);if(res){k="[VIDEO WIDTH="+res[3]+" HEIGHT="+res[2]+"]"+res[1]+"[/VIDEO]"}}return k};f=f.replace(/\<script[^\>]*>/gi,"\001").replace(/\<\/script[^\>]*>/gi,"\002");f=f.replace(/\001([^\002]*)\002/gi,a);f=f.replace(/\<noscript[^\>]*>/gi,"\003").replace(/\<\/noscript[^\>]*>/gi,"\004");f=f.replace(/\003([^\004]*)\004/gi," ");f=f.replace(/\<table class\=[\"]*forum-quote[\"]*\>[^<]*\<thead\>[^<]*\<tr\>[^<]*\<th\>([^<]+)\<\/th\>\<\/tr\>\<\/thead\>[^<]*\<tbody\>[^<]*\<tr\>[^<]*\<td\>/gi,"\001");f=f.replace(/\<table class\=[\"]*forum-code[\"]*\>[^<]*\<thead\>[^<]*\<tr\>[^<]*\<th\>([^<]+)\<\/th\>\<\/tr\>\<\/thead\>[^<]*\<tbody\>[^<]*\<tr\>[^<]*\<td\>/gi,"\002");f=f.replace(/\<table class\=[\"]*data-table[\"]*\>[^<]*\<tbody\>/gi,"\004");f=f.replace(/\<\/td\>[^<]*\<\/tr\>(\<\/tbody\>)*\<\/table\>/gi,"\003");f=f.replace(/[\r|\n]{2,}([\001|\002])/gi,"\n$1");var h=0;while(h++<50&&(f.search(/\002([^\002\003]*)\003/gi)>=0||f.search(/\001([^\001\003]*)\003/gi)>=0)){f=f.replace(/\002([^\002\003]*)\003/gi,"[CODE]$1[/CODE]").replace(/\001([^\001\003]*)\003/gi,"[QUOTE]$1[/QUOTE]")}function b(o,k,n){var p=new RegExp("\004([^\004\003]*)("+k+")([^\004\003]*)\003","i");var m=new RegExp("((?:\004)(?:[^\004\003]*))("+k+")((?:[^\004\003]*)(?:\003))","i");var l=0;while((l++<300)&&(o.search(p)>=0)){o=o.replace(m,"$1"+n+"$3")}return o}var h=0;while(h++<10&&(f.search(/\004([^\004\003]*)\003/gi)>=0)){f=b(f,"<tr>","[TR]");f=b(f,"</tr>","[/TR]");f=b(f,"<td>","[TD]");f=b(f,"</td>","[/TD]");f=f.replace(/\004([^\004\003]*)\003/gi,"[TABLE]$1[/TD][/TR][/TABLE]")}if(BX.browser.IsIE()){f=f.replace(/\<img(?:(?:\s+alt\s*=\s*\"?smile([^\"\s]+)\"?)|(?:\s+\w+\s*=\s*[^\s\>]*))*\>/gi,"$1")}else{f=f.replace(/\<img.*?alt=[\"]*smile([^\"\s]+)[\"]*[^>]*\>/gi,"$1")}f=f.replace(/\<a[^>]+href=[\"]([^\"]+)\"[^>]+\>([^<]+)\<\/a\>/gi,"[URL=$1]$2[/URL]");f=f.replace(/\<a[^>]+href=[\']([^\']+)\'[^>]+\>([^<]+)\<\/a\>/gi,"[URL=$1]$2[/URL]");f=f.replace(/\<[^\>]+\>/gi," ").replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&quot;/gi,'"');f=f.replace(/(smile(?=[:;8]))/g,"");f=f.replace(/\&shy;/gi,"");f=f.replace(/\&nbsp;/gi," ");if(c!=null&&c){f=c+oText.author+f}if(window.oLHE){var e=window.oLHE.GetEditorContent();e+="[QUOTE]"+f+"[/QUOTE]";if(window.oLHE.sEditorMode=="code"){window.oLHE.SetContent(e)}else{window.oLHE.SetEditorContent(e)}setTimeout(function(){window.oLHE.SetFocusToEnd()},300);return true}}return false}BX(function(){if(BX.browser.IsIE()){var c=BX.findChildren(document,{className:"reviews-post-table"},true);if(!c){return}for(a in c){var b=c[a].getElementsByTagName("*"),a=b.length;while(a--){if(b[a].scrollWidth>b[a].offsetWidth){b[a].style.paddingBottom="20px";b[a].style.overflowY="hidden"}}}}});