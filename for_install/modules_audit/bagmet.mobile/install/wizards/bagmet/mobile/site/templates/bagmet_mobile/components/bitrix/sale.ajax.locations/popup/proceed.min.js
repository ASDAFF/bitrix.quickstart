if(typeof oObject!="object"){window.oObject={}}function JsSuggest(oHandler,sParams,sParser,domain){var t=this,tmp=0;t.oObj=oHandler;t.sParams=sParams;t.domain=domain;if(sParser){t.sExp=new RegExp("["+sParser+"]+","i")}else{t.sExp=new RegExp(",")}t.oLast={str:false,arr:false};t.oThis={str:false,arr:false};t.oEl={start:false,end:false};t.oUnfinedWords={};t.bReady=true,t.eFocus=true;t.aDiv=null,t.oDiv=null;t.oActive=null,t.oPointer=Array(),t.oPointer_default=Array(),t.oPointer_this="input_field";t.oObj.onblur=function(){t.eFocus=false};t.oObj.onfocus=function(){if(!t.eFocus){t.eFocus=true;setTimeout(function(){t.CheckModif("focus")},500)}};t.oLast.arr=t.oObj.value.split(t.sExp);t.oLast.str=t.oLast.arr.join(":");setTimeout(function(){t.CheckModif("this")},500);this.CheckModif=function(__data){var sThis=false,tmp=0,bUnfined=false,word="",cursor={};if(!t.eFocus){return}if(t.bReady&&t.oObj.value.length>0){t.oThis.arr=t.oObj.value.split(t.sExp);t.oThis.str=t.oThis.arr.join(":");if(t.oThis.str&&(t.oThis.str!=t.oLast.str)){cursor.position=TCJsUtils.getCursorPosition(t.oObj);if(cursor.position["end"]>0&&!t.sExp.test(t.oObj.value.substr(cursor.position["end"]-1,1))){cursor.arr=t.oObj.value.substr(0,cursor.position["end"]).split(t.sExp);sThis=t.oThis.arr[cursor.arr.length-1];t.oEl.start=cursor.position["end"]-cursor.arr[cursor.arr.length-1].length;t.oEl.end=t.oEl.start+sThis.length;t.oEl.content=sThis;t.oLast.arr=t.oThis.arr;t.oLast.str=t.oThis.str}}if(sThis){for(tmp=2;tmp<=sThis.length;tmp++){word=sThis.substr(0,tmp);if(t.oUnfinedWords[word]=="!fined"){bUnfined=true;break}}if(!bUnfined){t.Send(sThis)}}}setTimeout(function(){t.CheckModif("this")},500)},t.Send=function(sSearch){if(!sSearch){return false}var TID=null,oError=Array();t.bReady=false;PShowWaitMessage("wait_container",true);TID=CPHttpRequest.InitThread();CPHttpRequest.SetAction(TID,function(data){var result={};t.bReady=true;try{eval("result = "+data+";")}catch(e){oError.result_unval=e}if(TCJsUtils.empty(result)){oError.result_empty="Empty result"}try{if(TCJsUtils.empty(oError)&&(typeof result=="object")){if(!(result.length==1&&result[0]["NAME"]==t.oEl.content)){t.Show(result);return}}else{t.oUnfinedWords[t.oEl.content]="!fined"}}catch(e){oError.unknown_error=e}PCloseWaitMessage("wait_container",true);return});url="/bitrix/components/bitrix/sale.ajax.locations/search.php";if(t.domain){url=domain+"/bitrix/components/bitrix/sale.ajax.locations/search.php"}CPHttpRequest.Send(TID,url,{search:sSearch,params:t.sParams})},t.Show=function(result){t.Destroy();t.oDiv=document.body.appendChild(document.createElement("DIV"));t.oDiv.id=t.oObj.id+"_div";t.oDiv.className="search-popup";t.oDiv.style.position="absolute";t.aDiv=t.Print(result);var pos=TCJsUtils.GetRealPos(t.oObj);TCJsUtils.show(t.oDiv,pos.left,pos.bottom);TCJsUtils.addEvent(document,"click",t.CheckMouse);TCJsUtils.addEvent(document,"keydown",t.CheckKeyword)},t.Print=function(aArr){var aEl=null,sPrefix="",sColumn="",aResult=Array(),aRes=Array(),iCnt=0,tmp=0,tmp_=0,bFirst=true,oDiv=null,oSpan=null;sPrefix=t.oDiv.id;for(tmp_ in aArr){aEl=aArr[tmp_];aRes=Array();aRes.ID=(aEl.ID&&aEl.ID.length>0)?aEl.ID:iCnt++;aRes.GID=sPrefix+"_"+aRes.ID;locName=aEl.NAME;if(aEl.REGION_NAME.length>0&&locName.length<=0){locName=aEl.REGION_NAME}else{if(aEl.REGION_NAME.length>0){locName=locName+", "+aEl.REGION_NAME}}if(aEl.COUNTRY_NAME.length>0){locName=locName+", "+aEl.COUNTRY_NAME}aRes.NAME=TCJsUtils.htmlspecialcharsEx(locName);aResult[aRes.GID]=aRes;t.oPointer.push(aRes.GID);oDiv=t.oDiv.appendChild(document.createElement("DIV"));oDiv.id=aRes.GID;oDiv.name=sPrefix+"_div";oDiv.className="search-popup-row";oDiv.onmouseover=function(){t.Init();this.className="search-popup-row-active"};oDiv.onmouseout=function(){t.Init();this.className="search-popup-row"};oDiv.onclick=function(){t.oActive=this.id};oSpan=oDiv.appendChild(document.createElement("DIV"));oSpan.id=oDiv.id+"_NAME";oSpan.className="search-popup-el search-popup-el-name";oSpan.innerHTML=aRes.NAME}t.oPointer.push("input_field");t.oPointer_default=t.oPointer;return aResult},t.Destroy=function(){try{TCJsUtils.hide(t.oDiv);t.oDiv.parentNode.removeChild(t.oDiv)}catch(e){}t.aDiv=Array();t.oPointer=Array(),t.oPointer_default=Array(),t.oPointer_this="input_field";t.bReady=true,t.eFocus=true,oError={},t.oActive=null;TCJsUtils.removeEvent(document,"click",t.CheckMouse);TCJsUtils.removeEvent(document,"keydown",t.CheckKeyword)},t.Replace=function(){if(typeof t.oActive=="string"){var tmp=t.aDiv[t.oActive];var tmp1="";if(typeof tmp=="object"){var elEntities=document.createElement("span");elEntities.innerHTML=TCJsUtils.htmlspecialcharsback(tmp.NAME);tmp1=elEntities.innerHTML;var n=t.oObj.name.substr(0,(t.oObj.name.length-4));document.getElementById(n).value=tmp.ID;submitForm()}var start=t.oEl.start;while(start<t.oObj.value.length&&t.oObj.value.substring(start,start+1)==" "){start++}t.oObj.value=t.oObj.value.substring(0,start)+tmp1+t.oObj.value.substr(t.oEl.end);TCJsUtils.setCursorPosition(t.oObj,start+tmp1.length)}return},t.Init=function(){t.oActive=false;t.oPointer=t.oPointer_default;t.Clear();t.oPointer_this="input_pointer"},t.Clear=function(){var oEl={},ii="";oEl=t.oDiv.getElementsByTagName("div");if(oEl.length>0&&typeof oEl=="object"){for(ii in oEl){var oE=oEl[ii];if(oE&&(typeof oE=="object")&&(oE.name==t.oDiv.id+"_div")){oE.className="search-popup-row"}}}return},t.CheckMouse=function(){t.Replace();t.Destroy()},t.CheckKeyword=function(e){if(!e){e=window.event}var oP=null,oEl=null,ii=null;if((37<e.keyCode&&e.keyCode<41)||(e.keyCode==13)){t.Clear();switch(e.keyCode){case 38:oP=t.oPointer.pop();if(t.oPointer_this==oP){t.oPointer.unshift(oP);oP=t.oPointer.pop()}if(oP!="input_field"){t.oActive=oP;oEl=document.getElementById(oP);if(typeof oEl=="object"){oEl.className="search-popup-row-active"}}t.oPointer.unshift(oP);break;case 40:oP=t.oPointer.shift();if(t.oPointer_this==oP){t.oPointer.push(oP);oP=t.oPointer.shift()}if(oP!="input_field"){t.oActive=oP;oEl=document.getElementById(oP);if(typeof oEl=="object"){oEl.className="search-popup-row-active"}}t.oPointer.push(oP);break;case 39:t.Replace();t.Destroy();break;case 13:t.Replace();t.Destroy();break}t.oPointer_this=oP}else{t.Destroy()}}}var TCJsUtils={arEvents:Array(),addEvent:function(a,c,b){if(a.attachEvent){a.attachEvent("on"+c,b)}else{if(a.addEventListener){a.addEventListener(c,b,false)}else{a["on"+c]=b}}this.arEvents[this.arEvents.length]={element:a,event:c,fn:b}},removeEvent:function(a,c,b){if(a.detachEvent){a.detachEvent("on"+c,b)}else{if(a.removeEventListener){a.removeEventListener(c,b,false)}else{a["on"+c]=null}}},getCursorPosition:function(b){var a={start:0,end:0};if(!b||(typeof b!="object")){return a}try{if(document.selection!=null&&b.selectionStart==null){b.focus();var j=document.selection.createRange(),h=j.parentElement(),f=j.getBookmark(),d=sContents_=b.value,c="__"+Math.random()+"__";while(d.indexOf(c)!=-1){c="__"+Math.random()+"__"}if(!h||h==null||(h.type!="textarea"&&h.type!="text")){return a}j.text=c+j.text+c;d=b.value;a.start=d.indexOf(c);d=d.replace(c,"");a.end=d.indexOf(c);b.value=sContents_;j.moveToBookmark(f);j.select();return a}else{return{start:b.selectionStart,end:b.selectionEnd}}}catch(g){}return a},setCursorPosition:function(b,c){var a=false;if(typeof b!="object"){return false}b.focus();try{if(document.selection!=null&&b.selectionStart==null){var f=document.selection.createRange();f.select()}else{b.selectionStart=c;b.selectionEnd=c}return true}catch(d){return false}},printArray:function(c,f,b){try{var a="",h="",g=null,d=0;if(b==undefined){b=0}if(!f){f="\n"}for(d=0;d<=b;d++){h+="  "}for(g in c){if(typeof c[g]=="object"){a+=h+g+" = {"+f+TCJsUtils.printArray(c[g],f,b+1)+", "+f+"}"+f}else{a+=h+g+" = "+c[g]+"; "+f}}return a}catch(k){return}},empty:function(b){var a=true;if(b){for(i in b){a=false;break}}return a},show:function(a,c,b){if(typeof a!="object"){return}var d=parseInt(a.style.zIndex);if(d<=0||isNaN(d)){d=100}a.style.zIndex=d;a.style.left=c+"px";a.style.top=b+"px";return a},hide:function(a){if(a){a.style.display="none"}},GetRealPos:function(c){if(!c||!c.offsetParent){return false}var b=Array();var a=c.offsetParent;b.left=c.offsetLeft;b.top=c.offsetTop;while(a&&a.tagName!="BODY"){b.left+=a.offsetLeft;b.top+=a.offsetTop;a=a.offsetParent}b.right=b.left+c.offsetWidth;b.bottom=b.top+c.offsetHeight;b.width=c.offsetWidth;b.height=c.offsetHeight;return b},htmlspecialcharsEx:function(a){res=a.replace(/&amp;/g,"&amp;amp;").replace(/&lt;/g,"&amp;lt;").replace(/&gt;/g,"&amp;gt;").replace(/&quot;/g,"&amp;quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");return res},htmlspecialcharsback:function(a){res=a.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;;/g,'"').replace(/&amp;/g,"&");return res}};SuggestLoaded=true;