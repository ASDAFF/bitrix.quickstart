<? $GLOBALS['_609448371_']=Array('fmod','f' .'m' .'o' .'d','intval','e' .'xplode','' .'in' .'_' .'arra' .'y','floatval','' .'ses' .'sion_star' .'t','fl' .'o' .'atval','intval','session_st' .'art','i' .'ntva' .'l','explo' .'de','in_arra' .'y','intval','f' .'loatval','sessi' .'on_start','is_a' .'r' .'r' .'ay','is_ar' .'ray','count','floatval','' .'session' .'_st' .'art','intval','in' .'tval','se' .'ssion_sta' .'r' .'t','is_arra' .'y','' .'array_' .'keys','' .'ses' .'sion_start'); ?><? function _2058267116($i){$a=Array('STARTSHOP','QUANTITY','USE','STARTSHOP','QUANTITY','VALUE','STARTSHOP','QUANTITY','VALUE','STARTSHOP','QUANTITY','RATIO','STARTSHOP','QUANTITY','RATIO',',','GROUPS','GROUPS','STARTSHOP','AVAILABLE','STARTSHOP','OFFERS','STARTSHOP','BASKET','STARTSHOP','BASKET',"QUANTITY","PRICE",'CODE','STARTSHOP','BASKET',"QUANTITY",'STARTSHOP','BASKET',"QUANTITY",'STARTSHOP','BASKET',"QUANTITY","STARTSHOP",'BASKET',"STARTSHOP",'BASKET',',','GROUPS','STARTSHOP','AVAILABLE','STARTSHOP','BASKET','INSIDE','STARTSHOP','BASKET','PRICE','STARTSHOP','AVAILABLE','STARTSHOP','BASKET','INSIDE','STARTSHOP','BASKET','QUANTITY','STARTSHOP','BASKET','PRICE','VALUE','STARTSHOP','BASKET','QUANTITY','STARTSHOP','BASKET','ID','PRICE','QUANTITY','QUANTITY','ID','QUANTITY','QUANTITY','PRICE','PRICE','STARTSHOP','BASKET','STARTSHOP','BASKET','STARTSHOP','BASKET','STARTSHOP','BASKET','QUANTITY','STARTSHOP','BASKET','STARTSHOP','BASKET','ID','STARTSHOP','BASKET','Delete','Delete','SetQuantity','SetQuantity','Clear','Clear');return $a[$i];} ?><? class CStartShopBasket extends CStartShop{private static function HandleQuantity($_0,$_1){if($_1<$_0['STARTSHOP']['QUANTITY']['RATIO']|| empty($_1))$_1=$_0['STARTSHOP']['QUANTITY']['RATIO'];if($_0[_2058267116(0)][_2058267116(1)][_2058267116(2)])if($_1>$_0[_2058267116(3)][_2058267116(4)][_2058267116(5)])$_1=$_0[_2058267116(6)][_2058267116(7)][_2058267116(8)];if($GLOBALS['_609448371_'][0]($_1,$_0[_2058267116(9)][_2058267116(10)][_2058267116(11)])!= 0)$_1=$_1-$GLOBALS['_609448371_'][1]($_1,$_0[_2058267116(12)][_2058267116(13)][_2058267116(14)]);return $_1;}public static function Add($_2,$_1=0,$_3=false,$_4=true,$_5=SITE_ID){global $USER;if(!CModule::IncludeModule("iblock"))return false;$_2=$GLOBALS['_609448371_'][2]($_2);$_6=array();if(!empty($_3)){$_6=CStartShopPrice::GetByCode($_3)->Fetch();}else{$_6=CStartShopPrice::GetBase()->Fetch();}if(empty($_6))return false;if($_4){$_7=$GLOBALS['_609448371_'][3](_2058267116(15),$USER->GetGroups());$_8=false;if(!empty($_6[_2058267116(16)])){foreach($_7 as $_9)if($GLOBALS['_609448371_'][4]($_9,$_6[_2058267116(17)])){$_8=true;break;}}else{$_8=true;}if(!$_8)return false;unset($_7,$_8);}$_0=CStartShopCatalogProduct::GetByID($_2)->Fetch();if(!$_0 ||!$_0[_2058267116(18)][_2058267116(19)])return false;if(!empty($_0[_2058267116(20)][_2058267116(21)]))return false;$_1=$GLOBALS['_609448371_'][5]($_1);$_1=static::HandleQuantity($_0,$_1);$GLOBALS['_609448371_'][6]();if(!$_SESSION[_2058267116(22)][_2058267116(23)][$_5][$_2])$_SESSION[_2058267116(24)][_2058267116(25)][$_5][$_2]=array(_2058267116(26)=> $_1,_2058267116(27)=> $_6[_2058267116(28)]);else $_SESSION[_2058267116(29)][_2058267116(30)][$_5][$_2][_2058267116(31)]+= $_1;$_SESSION[_2058267116(32)][_2058267116(33)][$_5][$_2][_2058267116(34)]=static::HandleQuantity($_0,$_SESSION['STARTSHOP']['BASKET'][$_5][$_2]["QUANTITY"]);CStartShopEvents::Call('OnBasketItemAdded',array('ID'=> $_2,'QUANTITY'=> $_1,'SID'=> $_5));return $GLOBALS['_609448371_'][7]($_SESSION[_2058267116(35)][_2058267116(36)][$_5][$_2][_2058267116(37)]);}public static function Delete($_2,$_5=SITE_ID){$_2=$GLOBALS['_609448371_'][8]($_2);@$GLOBALS['_609448371_'][9]();if(isset($_SESSION[_2058267116(38)][_2058267116(39)][$_5][$_2])){unset($_SESSION[_2058267116(40)][_2058267116(41)][$_5][$_2]);CStartShopEvents::Call('OnBasketItemDeleted',array('ID'=> $_2,'SID'=> $_5));return true;}return false;}public static function SetPriceType($_2,$_3,$_4,$_5=SITE_ID){global $USER;$_2=$GLOBALS['_609448371_'][10]($_2);$_6=CStartShopPrice::GetByCode($_3)->Fetch();if($_4){$_7=$GLOBALS['_609448371_'][11](_2058267116(42),$USER->GetGroups());$_8=false;foreach($_7 as $_9)if($GLOBALS['_609448371_'][12]($_9,$_6[_2058267116(43)])){$_8=true;break;}if(!$_8)return false;unset($_7,$_8);}$_0=CStartShopCatalogProduct::GetByID($_2)->Fetch();if(!$_0 ||!$_0[_2058267116(44)][_2058267116(45)]||!$_0[_2058267116(46)][_2058267116(47)][_2058267116(48)])return false;CStartShopEvents::Call('OnBasketItemPriceTypeSet',array('ID'=> $_2,'PRICE'=>&$_3,'CHECK_USER_GROUP'=> $_4,'SID'=> $_5));if(CStartShopPrice::GetByCode($_3)->Fetch()){$_SESSION[_2058267116(49)][_2058267116(50)][$_5][$_2][_2058267116(51)]=$_3;}else{return false;}return true;}public static function SetQuantity($_2,$_1,$_5=SITE_ID){$_2=$GLOBALS['_609448371_'][13]($_2);$_1=$GLOBALS['_609448371_'][14]($_1);$_0=CStartShopCatalogProduct::GetByID($_2)->Fetch();if(!$_0 ||!$_0[_2058267116(52)][_2058267116(53)]||!$_0[_2058267116(54)][_2058267116(55)][_2058267116(56)])return 0;$_1=static::HandleQuantity($_0,$_1);@$GLOBALS['_609448371_'][15]();CStartShopEvents::Call('OnBasketItemQuantitySet',array('ID'=> $_2,'QUANTITY'=>&$_1,'SID'=> $_5));$_SESSION[_2058267116(57)][_2058267116(58)][$_5][$_2][_2058267116(59)]=$_1;return $_1;}public static function GetItemPriceType($_2,$_5=SITE_ID){if($GLOBALS['_609448371_'][16]($_SESSION['STARTSHOP']['BASKET'][$_5]))return $_SESSION['STARTSHOP']['BASKET'][$_5][$_2]['PRICE'];return null;}public static function GetItemsCount($_5=SITE_ID){if($GLOBALS['_609448371_'][17]($_SESSION['STARTSHOP']['BASKET'][$_5]))return $GLOBALS['_609448371_'][18]($_SESSION['STARTSHOP']['BASKET'][$_5]);return 0;}public static function GetItemsAmount($_5=SITE_ID,$_10=false,$_11=LANGUAGE_ID){static::Recount($_5);$_12=self::GetList(array(),array(),array(),array(),$_10,$_5);$_13=0;while($_0=$_12->Fetch())$_13 +=($_0[_2058267116(60)][_2058267116(61)][_2058267116(62)][_2058267116(63)]*$_0[_2058267116(64)][_2058267116(65)][_2058267116(66)]);return CStartShopCurrency::FormatAsArray($_13,$_10,$_11);}public static function Recount($_5=SITE_ID){$_14=array();$_12=self::GetList(array(),array(),$_5);while($_0=$_12->Fetch()){$_15=$_SESSION[_2058267116(67)][_2058267116(68)][$_5][$_0[_2058267116(69)]];if(empty($_15[_2058267116(70)]))continue;if(!CStartShopPrice::GetByCode($_15['PRICE'])->Fetch())continue;$_15[_2058267116(71)]=static::HandleQuantity($_0,$GLOBALS['_609448371_'][19]($_15[_2058267116(72)]));$_14[$_0[_2058267116(73)]]=array(_2058267116(74)=> $_15[_2058267116(75)],_2058267116(76)=> $_15[_2058267116(77)]);}CStartShopEvents::Call('OnBasketRecount',array('SID'=> $_5,'ITEMS'=>&$_14));@$GLOBALS['_609448371_'][20]();$_SESSION[_2058267116(78)][_2058267116(79)][$_5]=$_14;}public static function InBasket($_2,$_5=SITE_ID){$_2=$GLOBALS['_609448371_'][21]($_2);if(!empty($_SESSION[_2058267116(80)][_2058267116(81)][$_5][$_2]))return true;return false;}public static function GetQuantity($_2,$_5=SITE_ID){$_2=$GLOBALS['_609448371_'][22]($_2);$GLOBALS['_609448371_'][23]();if(!empty($_SESSION[_2058267116(82)][_2058267116(83)][$_5][$_2]))return $_SESSION[_2058267116(84)][_2058267116(85)][$_5][$_2][_2058267116(86)];return 0;}public static function GetList($_16=array(),$_17=array(),$_18=array(),$_19=array(),$_20=false,$_5=SITE_ID){$_21=array();$_12=new CDBResult();$_12->InitFromArray(array());if($GLOBALS['_609448371_'][24]($_SESSION[_2058267116(87)][_2058267116(88)][$_5]))$_21=$GLOBALS['_609448371_'][25]($_SESSION[_2058267116(89)][_2058267116(90)][$_5]);if(!empty($_21)){$_17[_2058267116(91)]=$_21;$_12=CStartShopCatalogProduct::GetList($_16,$_17,$_18,$_19,$_20,false);}return $_12;}public static function Clear($_5=SITE_ID){$GLOBALS['_609448371_'][26]();unset($_SESSION[_2058267116(92)][_2058267116(93)][$_5]);CStartShopEvents::Call('OnBasketClear',array('SID'=> $_5));}public static function HandleRequestActions($_22,$_23,$_1,$_3=false,$_5=SITE_ID,$_24=array('Add'=> 'Add','Delete'=> 'Delete','SetQuantity'=> 'SetQuantity','Clear'=> 'Clear')){if(!empty($_22)){if($_24['Add']!== false)if($_22 == $_24['Add'])return static::Add($_23,$_1,$_3,true,$_5);if($_24[_2058267116(94)]!== false)if($_22 == $_24[_2058267116(95)])return static::Delete($_23,$_5);if($_24[_2058267116(96)]!== false)if($_22 == $_24[_2058267116(97)])return static::SetQuantity($_23,$_1,$_5);if($_24[_2058267116(98)]!== false)if($_22 == $_24[_2058267116(99)]){static::Clear($_5);return true;}}return false;}} ?>
