(function(){if(window.BX.CImageView){return}BX.viewImage=function(c,b,e,g,f){f=f||{};f.cycle=false;f.list=[{image:c,height:e,width:b,title:g}];var d=new BX.CImageView(f);d.show();return d};BX.viewImageBind=function(f,e,d,c){var b=new BX.CImageView(e);if(!d){d={tag:"IMG"}}BX.ready(function(){a(f,d,c,b)});return b};function a(e,d,c,b){var e=BX(e);if(!!e){BX.bindDelegate(e,"click",d,function(o){var p=e;if(!!c){p=BX.findParent(this,c,e)||p}var f=BX.findChildren(p,d,true),j=[],k=false;for(var l=0;l<f.length;l++){var g={thumb:f[l].src,image:f[l].getAttribute("data-bx-image"),width:f[l].getAttribute("data-bx-width"),height:f[l].getAttribute("data-bx-height"),full:f[l].getAttribute("data-bx-full"),full_width:f[l].getAttribute("data-bx-full-width"),full_height:f[l].getAttribute("data-bx-full-height"),full_size:f[l].getAttribute("data-bx-full-size"),title:f[l].getAttribute("data-bx-title")||f[l].alt||f[l].title};var h=f[l].parentNode.tagName.toUpperCase()=="A"&&!!f[l].parentNode.href;if(h){g.image=g.image||f[l].parentNode.href;g.title=g.title||f[l].parentNode.title;g.width=f[l].parentNode.getAttribute("data-bx-width");g.height=f[l].parentNode.getAttribute("data-bx-height");g.full=g.full||f[l].parentNode.getAttribute("data-bx-full");if(!!g.full){g.full_width=g.full_width||f[l].parentNode.getAttribute("data-bx-full-width");g.full_height=g.full_height||f[l].parentNode.getAttribute("data-bx-full-height");g.full_size=g.full_size||f[l].parentNode.getAttribute("data-bx-full-size")}g.title=g.title||f[l].parentNode.getAttribute("data-bx-title")||f[l].parentNode.alt||f[l].parentNode.title}g.image=g.image||g.thumb;if(f[l]==this){k=g.image}if(!!g.image){j.push(g)}}var m=this.parentNode.tagName.toUpperCase()=="A"&&!!this.parentNode.href,n=m&&!!k&&this.parentNode.href!=k;if(!n){b.setList(j);b.show(this.getAttribute("data-bx-image")||this.src);if(m){return BX.PreventDefault(o)}}})}}BX.CImageView=function(c){this.params=BX.clone(BX.CImageView.defaultSettings);for(var b in c){this.params[b]=c[b]}this.DIV=null;this.OVERLAY=null;this.IMAGE_WRAP=null;this.IMAGE=BX.create("IMG",{props:{className:"bx-images-viewer-image"},events:{load:BX.proxy(this.adjustPos,this),click:BX.proxy(this.next,this)}});this.list=this.params.list;this.list_preload=[];this._current=0;this.bVisible=false};BX.CImageView.defaultSettings={list:[],cycle:true,resize:"WH",resizeToggle:false,showTitle:true,preload:1,minMargin:20,minPadding:12,lockScroll:false,keyMap:{27:"close",33:"prev",37:"prev",38:"prev",34:"next",39:"next",40:"next",32:"next"}};BX.CImageView.prototype._create=function(){if(!this.DIV){var b=BX.browser.IsIE()&&!BX.browser.IsDoctype()?"A":"SPAN",c=b=="A"?"javascript:void(0)":null;this.OVERLAY=document.body.appendChild(BX.create("DIV",{props:{className:"bx-images-viewer-overlay"},events:{click:BX.proxy(this._hide,this)}}));this.DIV=this.OVERLAY.appendChild(BX.create("DIV",{props:{className:"bx-images-viewer-wrap-outer"},events:{click:BX.eventCancelBubble},children:[(this.PREV_LINK=BX.create(b,{props:{className:"bx-images-viewer-prev-outer",href:c},events:{click:BX.proxy(this.prev,this)},html:'<span class="bx-images-viewer-prev"></span>'})),(this.NEXT_LINK=BX.create(b,{props:{className:"bx-images-viewer-next-outer",href:c},events:{click:BX.proxy(this.next,this)},html:'<span class="bx-images-viewer-next"></span>'})),(this.IMAGE_TITLE=BX.create("DIV",{style:{bottom:"0"},props:{className:"bx-images-viewer-title"}})),BX.create("DIV",{props:{className:"bx-images-viewer-wrap-inner"},style:{padding:this.params.minPadding+"px"},children:[(this.IMAGE_WRAP=BX.create("DIV",{props:{className:"bx-images-viewer-wrap"},children:[this.IMAGE]}))]}),BX.create(b,{props:{className:"bx-images-viewer-close",href:c},events:{click:BX.proxy(this._hide,this)},html:'<span class="bx-images-viewer-close-inner"></span>'})]}));if(!!this.params.resizeToggle){this.IMAGE_WRAP.appendChild(BX.create("SPAN",{props:{className:"bx-images-viewer-size-toggle"},style:{right:this.params.minPadding+"px",bottom:this.params.minPadding+"px"},events:{click:BX.proxy(this._toggle_resize,this)}}))}}};BX.CImageView.prototype._keypress=function(c){var b=(c||window.event).keyCode||(c||window.event).charCode;if(!!this.params.keyMap&&!!this.params.keyMap[b]&&!!this[this.params.keyMap[b]]){this[this.params.keyMap[b]].apply(this);return BX.PreventDefault(c)}};BX.CImageView.prototype._toggle_resize=function(){var b=this.params.resize;this.params.resize=this.params.resizeToggle;this.params.resizeToggle=b;if(this.params.resize!="WH"){this.params.lockScroll=true;this._lock_scroll()}else{this.params.lockScroll=false;this._unlock_scroll()}this.adjustSize();this.adjustPos()};BX.CImageView.prototype.adjustPos=function(){if(this.list[this._current].height>0&&this.list[this._current].width>0){this._adjustPosByImg()}else{if(!this.IMAGE_WRAP.style.height){this.IMAGE_WRAP.style.height="100px"}if(!this.IMAGE_WRAP.style.width){this.IMAGE_WRAP.style.width="100px"}setTimeout(BX.proxy(this._adjustPosByImg,this),250)}};BX.CImageView.prototype._adjustPosByImg=function(){if(this.bVisible){var b=BX.GetWindowSize(),d=parseInt((b.innerHeight-parseInt(this.IMAGE_WRAP.style.height)-2*this.params.minPadding)/2),c=parseInt((b.innerWidth-parseInt(this.IMAGE_WRAP.style.width)-2*this.params.minPadding)/2);if(!this.params.lockScroll&&b.innerWidth<b.scrollHeight){c-=20}if(d<this.params.minMargin){d=this.params.minMargin}if(c<this.params.minMargin+Math.min(70,this.PREV_LINK.offsetWidth)){c=this.params.minMargin+Math.min(70,this.PREV_LINK.offsetWidth)}if(this.params.showTitle&&!!this.list[this._current].title){d-=20}this.DIV.style.top=d+"px";this.DIV.style.left=c+"px"}};BX.CImageView.prototype.adjustSize=function(){var d=BX.GetWindowSize(),c=this.list[this._current];if(!!c.height&&!!c.width){if(!this.params.lockScroll&&d.innerWidth<d.scrollHeight){d.innerWidth-=20}d.innerWidth-=this.params.minMargin*2+this.params.minPadding*2+Math.min(140,this.PREV_LINK.offsetWidth+this.NEXT_LINK.offsetWidth);d.innerHeight-=this.params.minMargin*2+this.params.minPadding*2;if(this.params.showTitle&&!!this.list[this._current].title){d.innerHeight-=40}var b=c.height,g=c.width,f=[1];if(this.params.resize){if(this.params.resize.indexOf("W")>=0){f.push(d.innerWidth/g)}if(this.params.resize.indexOf("H")>=0){f.push(d.innerHeight/b)}}f=Math.min.apply(window,f);b*=f;g*=f;this.IMAGE_WRAP.style.height=parseInt(b)+"px";this.IMAGE_WRAP.style.width=parseInt(g)+"px";if(BX.browser.IsIE()){var e=parseInt(this.IMAGE_WRAP.style.height)+this.params.minPadding*2;this.PREV_LINK.style.height=this.NEXT_LINK.style.height=e+"px";this.PREV_LINK.firstChild.style.top=this.NEXT_LINK.firstChild.style.top=parseInt(e/2-20)+"px"}}};BX.CImageView.prototype._lock_scroll=function(){if(this.params.lockScroll){BX.addClass(document.body,"bx-images-viewer-lock-scroll")}};BX.CImageView.prototype._unlock_scroll=function(){if(this.params.lockScroll){BX.removeClass(document.body,"bx-images-viewer-lock-scroll")}};BX.CImageView.prototype._unhide=function(){this.bVisible=true;this.DIV.style.display="block";this.OVERLAY.style.display="block";this.PREV_LINK.style.display=(this.list.length>1&&(this.params.cycle||this._current>0))?"block":"none";this.NEXT_LINK.style.display=(this.list.length>1&&(this.params.cycle||this._current<this.list.length-1))?"block":"none";this.adjustPos();BX.unbind(document,"keydown",BX.proxy(this._keypress,this));BX.unbind(window,"resize",BX.proxy(this.adjustSize,this));BX.unbind(window,"resize",BX.proxy(this.adjustPos,this));BX.bind(document,"keydown",BX.proxy(this._keypress,this));BX.bind(window,"resize",BX.proxy(this.adjustSize,this));BX.bind(window,"resize",BX.proxy(this.adjustPos,this));this._lock_scroll()};BX.CImageView.prototype._hide=function(){this.bVisible=false;this.DIV.style.display="none";this.OVERLAY.style.display="none";BX.unbind(document,"keydown",BX.proxy(this._keypress,this));BX.unbind(window,"resize",BX.proxy(this.adjustSize,this));BX.unbind(window,"resize",BX.proxy(this.adjustPos,this));this._unlock_scroll();BX.onCustomEvent(this,"onImageViewClose",[this.list[this._current]])};BX.CImageView.prototype.add=function(b){this.list.push(b)};BX.CImageView.prototype.setList=function(c){this.list=[];this.list_preload=[];if(!!c&&BX.type.isArray(c)){for(var b=0;b<c.length;b++){this.add(c[b])}}if(this.bVisible){if(this.list.length>0){this.show()}else{this.close()}}};BX.CImageView.prototype.show=function(b){var d=this._current;if(BX.type.isElementNode(b)){b=b.getAttribute("src")}if(typeof(b)=="object"&&(!!b.image||!!b.thumb)){b=(b.image||b.thumb)}if(BX.type.isString(b)){for(var c=0;c<this.list.length;c++){if(this.list[c].image==b||this.list[c].thumb==b){d=c;break}}}b=this.list[d];if(!b){return}this._current=d;this._create();this.IMAGE.style.opacity=0;this.adjustSize();if(!this.list_preload[this._current]){BX.addClass(this.IMAGE_WRAP,"bx-images-viewer-wrap-loading");this.list_preload[this._current]=new Image();this.list_preload[this._current].bxloaded=false;this.list_preload[this._current].onload=this._get_image_onload();this.list_preload[this._current].src=b.image;BX.defer(function(){if((this.list_preload[this._current].width>0||this.list_preload[this._current].height>0)){this.IMAGE.onload=null;this.IMAGE.style.opacity=1}},this)()}else{if(this.list_preload[this._current].bxloaded){setTimeout(BX.delegate(this.list_preload[this._current].onload,this.list_preload[this._current]),350)}}setTimeout(BX.proxy(this._check_title,this),300);this._unhide();BX.onCustomEvent(this,"onImageViewShow",[b])};BX.CImageView.prototype._check_title=function(){this.IMAGE_TITLE.innerHTML="";if(this.params.showTitle&&this.list[this._current].title||this.list[this._current].full){var b=0,c=0,e={style:{opacity:"1"},children:[]};if(this.params.showTitle&&this.list[this._current].title){e.children.push(BX.create("DIV",{props:{className:"bx-images-viewer-title-item"},text:this.list[this._current].title}));b+=35;c+=35}if(this.list[this._current].full){var d=[];if(this.list[this._current].full_height&&this.list[this._current].full_width){d.push(this.list[this._current].full_width+"x"+this.list[this._current].full_height)}if(this.list[this._current].full_size){d.push(this.list[this._current].full_size)}html='<a href="'+this.list[this._current].full+'" class="bx-images-viewer-full-link" target="_blank">'+BX.message("JS_CORE_IMAGE_FULL")+(d.length>0?(" ("+d.join(", ")+")"):"")+"</a>";e.children.push(BX.create("DIV",{props:{className:"bx-images-viewer-title-item bx-images-viewer-full"},html:html}));b+=35;c+=35}e.style.height=b+"px";e.style.bottom=-c+"px";BX.adjust(this.IMAGE_TITLE,e)}else{this.IMAGE_TITLE.style.opacity="0";this.IMAGE_TITLE.style.bottom="0";this.IMAGE_TITLE.style.height="0"}};BX.CImageView.prototype._get_image_onload=function(b){b=typeof b=="undefined"?this._current:b;return BX.delegate(function(){BX.proxy_context.bxloaded=true;if(b==this._current){var c=this.list[this._current];BX.removeClass(this.IMAGE_WRAP,"bx-images-viewer-wrap-loading");this.IMAGE.onload=function(){this.onload=null;this.style.opacity=1};this.IMAGE.src=BX.proxy_context.src;if(BX.proxy_context.width){c.width=BX.proxy_context.width}if(BX.proxy_context.height){c.height=BX.proxy_context.height}this.adjustSize();this.adjustPos();BX.defer(this._preload,this)()}BX.onCustomEvent(this,"onImageViewLoad",[this.list[b],b==this._current])},this)};BX.CImageView.prototype._preload=function(){if(this.params.preload>0){var d=Math.max(this._current-this.params.preload,this.params.cycle?-1000:0),e=Math.min(this._current+this.params.preload,this.params.cycle?this.list.length+1000:this.list.length-1);if(d<e){for(var c=e;c>=d;c--){var b=c;if(b<0){b+=this.list.length}else{if(b>=this.list.length){b-=this.list.length}}if(!this.list_preload[b]){this.list_preload[b]=new Image();this.list_preload[b].src=this.list[b].image;this.list_preload[b].onload=this._get_image_onload(b)}}}}};BX.CImageView.prototype.next=function(){if(this.list.length>1){this._current++;if(this._current>=this.list.length){if(!!this.params.cycle){this._current=0}else{this._current--}BX.onCustomEvent(this,"onImageViewFinishList",[this.list[this._current],1])}this.show()}};BX.CImageView.prototype.prev=function(){if(this.list.length>1){this._current--;if(this._current<0){if(!!this.params.cycle){this._current=this.list.length-1}else{this._current++}BX.onCustomEvent(this,"onImageViewFinishList",[this.list[this._current],-1])}this.show()}};BX.CImageView.prototype.close=function(){this._hide()}})(window);