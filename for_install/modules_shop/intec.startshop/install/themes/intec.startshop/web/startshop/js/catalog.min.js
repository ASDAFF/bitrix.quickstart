Startshop.Catalog.Offers=function(a){this.Offers={};this.Offers.Current=null;this.Offers.List=a.OFFERS;this.Offers.Properties=a.PROPERTIES;this.Events={};this.Events.OnOfferChange=function(b){};this.Events=$.extend({},this.Events,a.EVENTS||{})};Startshop.Catalog.Offers.prototype.GetParameters=function(){var b={};var c=this;b.Offer=this.GetCurrentOffer();b.Properties={};b.Properties.Displayed=[];b.Properties.Disabled=[];b.Properties.Enabled=[];b.Properties.Selected=[];Startshop.Functions.forEach(this.Offers.List,function(h,g){var i=c.GetOfferPropertiesTree(g.ID);Startshop.Functions.forEach(i,function(k,j){var l={Key:k,Value:j};if(!Startshop.Functions.inArray(l,b.Properties.Displayed)){b.Properties.Displayed.push(l)}})});var d=this.GetCurrentOffer();var a=null;if(d!=null){a=this.GetOfferPropertiesTree(d.ID)}var f=[];var e=[];Startshop.Functions.forEach(c.Offers.Properties,function(g,h){f.push(h.CODE)});Startshop.Functions.forEach(f,function(i,g){var h=f[i];Startshop.Functions.forEach(c.Offers.List,function(j,m){var k=true;var n=c.GetOfferPropertiesTree(m.ID);if(d!=null){Startshop.Functions.forEach(e,function(p,o){if(n[o]!=a[o]){k=false;return false}})}else{if(e.length>0){k=false}}if(k==true){var l={Key:h,Value:n[h]};if(!Startshop.Functions.inArray(l,b.Properties.Enabled)){b.Properties.Enabled.push(l)}}});e.push(h)});Startshop.Functions.forEach(b.Properties.Displayed,function(h,g){if(!Startshop.Functions.inArray(g,b.Properties.Enabled)){b.Properties.Disabled.push(g)}});if(a!=null){Startshop.Functions.forEach(a,function(g,h){b.Properties.Selected.push({Key:g,Value:h})})}return b};Startshop.Catalog.Offers.prototype.GetOfferByID=function(b){if(typeof b==="string"){b=parseInt(b)}if(isNaN(b)){return null}if(typeof b==="number"){var a=this.Offers.List[b];if(a!==undefined){return a}}return null};Startshop.Catalog.Offers.prototype.GetOfferByPropertiesTree=function(a){var b=null;Startshop.Functions.forEach(this.Offers.List,function(e,c){var d=true;Startshop.Functions.forEach(a,function(g,h){var f=c.OFFER["PROPERTIES"][g];if(h==""){h=null}if(h!=null){if(f!==undefined){if(f.VALUE["CODE"]!=h){d=false}}else{d=false}}else{if(f!==undefined){d=false}}return d});if(d){b=c;return false}});return b};Startshop.Catalog.Offers.prototype.GetCurrentOffer=function(){return this.GetOfferByID(this.Offers.Current)};Startshop.Catalog.Offers.prototype.SetCurrentOfferByID=function(a){if(this.GetOfferByID(a)!=null){this.Offers.Current=a;if(Startshop.Functions.isFunction(this.Events.OnOfferChange)){this.Events.OnOfferChange(this.GetParameters())}return true}return false};Startshop.Catalog.Offers.prototype.GetOfferPropertiesTree=function(c){var a={};var b=this.GetOfferByID(c);if(b==null){return a}Startshop.Functions.forEach(this.Offers.Properties,function(e,f){var d=b.OFFER["PROPERTIES"][f.CODE];if(d!==undefined){a[f.CODE]=d.VALUE["CODE"]}else{a[f.CODE]=""}});return a};Startshop.Catalog.Offers.prototype.SetCurrentOfferByPropertyValue=function(b,e){var g=this.GetCurrentOffer();var d=null;var f=null;if(g==null||typeof b!="string"){return false}Startshop.Functions.forEach(this.Offers.Properties,function(h,i){if(i.CODE==b){f=i;return false}});if(f==null){return false}var a={};var c=this.GetOfferPropertiesTree(g.ID);Startshop.Functions.forEach(c,function(h,i){a[h]=i;if(h==b){a[h]=e}});d=this.GetOfferByPropertiesTree(a);if(d!=null){this.SetCurrentOfferByID(d.ID);return true}a={};Startshop.Functions.forEach(c,function(h,i){a[h]=i;if(h==b){a[h]=e;return false}});d=this.GetOfferByPropertiesTree(a);if(d!=null){this.SetCurrentOfferByID(d.ID);return true}};Startshop.Catalog.Offers.prototype.Initialize=function(){var a=this;Startshop.Functions.forEach(this.Offers.List,function(c,b){a.SetCurrentOfferByID(b.ID);return false})};